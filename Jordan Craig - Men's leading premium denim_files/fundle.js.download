!function(){"use strict";var t;!function(t,e){void 0===e&&(e={});var n=e.insertAt;if("undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}('[id^=cashback-module]{width:100%}.fnd-cashback-modal{all:unset;align-items:center;background-color:#fff;border-radius:8px;bottom:0;box-sizing:border-box;color:#000;font-family:Fondue-Inter,sans-serif;height:max-content;justify-content:center;left:50%;letter-spacing:.5px;line-height:17px;max-height:95%;overflow:auto;padding:48px 48px 0;position:fixed;right:50%;text-align:center;top:50%;transform:translate(-50%,-50%);width:650px;z-index:2147483647}.fnd-cashback-modal *{all:unset;box-sizing:border-box;font-family:Fondue-Inter,sans-serif!important}.fnd-cashback-modal img{object-fit:contain}.fnd-cashback-modal .fnd-cashback-modal-content,.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-header{align-items:center;display:flex;flex-direction:column}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-header h3{font-size:34px;font-weight:700;line-height:41px;margin:10px 0}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-header span{font-size:20px;font-weight:400;line-height:24px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-header img{height:55px;width:55px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-info{align-items:center;display:flex;justify-content:space-around;margin-top:24px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-info .fnd-cashback-modal-content-info-icon{align-items:center;display:flex;flex-direction:column;max-width:135px;min-height:80px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-info .fnd-cashback-modal-content-info-icon img{height:40px;width:40px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-info .fnd-cashback-modal-content-info-icon img.fnd-modal-email-icon{width:30px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-info .fnd-cashback-modal-content-info-icon span{font-size:12px;font-weight:400;line-height:14px;max-width:110px;position:relative;top:10px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-info .fnd-cashback-modal-content-info-arrow{align-items:center;display:flex;justify-content:center;margin:10px 0;width:35px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-info .fnd-cashback-modal-content-info-arrow .fnd-long-arrow-img{height:20px;position:relative;top:-16px;width:85px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-info .fnd-cashback-modal-content-info-arrow .fnd-short-arrow-img{display:none;height:20px;width:85px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products{background:#f5f4f6;border-radius:10px;font-size:12px;margin-top:40px;max-width:450px;position:relative;width:100%}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products .fnd-eligible-products-badge,.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products .fnd-not-eligible-products-badge{background:#d1fae5;border-radius:12px;color:#065f46;height:20px;left:25px;line-height:16px;padding:2px 12px;position:absolute;text-align:center;top:-10px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products .fnd-not-eligible-products-badge{background:#fef3c7;color:#92400e}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products .fnd-eligible-products-footer{align-items:center;border-top:1px solid #d1d5db;display:flex;justify-content:space-between;padding:12px 16px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products .fnd-eligible-products-footer .fnd-eligible-products-footer-promotion-name{font-size:14px;font-weight:700}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products .fnd-eligible-products-footer .fnd-eligible-products-footer-promotion-badge{background:#d1fae5;border-radius:4px;color:#065f46;font-size:12px;font-weight:500;height:20px;margin-left:10px;padding:2px 10px;width:46px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products .fnd-eligible-products-footer .fnd-eligible-products-footer-promotion-total{color:#065f46;font-size:14px;font-weight:700;line-height:17px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products .fnd-eligible-products-threshold-info{align-items:start;display:flex;margin-bottom:12px;min-height:15px;padding:0 16px;text-align:left;width:auto}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products .fnd-eligible-products-threshold-info img{margin-right:6px;margin-top:2px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products .fnd-eligible-products-threshold-info p{margin:0}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-eligible-products .fnd-eligible-products-threshold-info span{color:#991b1b;font-weight:700}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-bottom span{display:block;font-size:11px;font-weight:400;line-height:17px;margin-top:12px;max-width:450px;opacity:.8;text-align:left}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-modal-content-bottom span a{color:inherit}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-footer{align-items:center;display:flex;font-size:10px;height:60px;justify-content:space-between;margin-top:30px;width:100%}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-footer .fnd-safe-secure-wrapper{display:inline-block;margin-left:2px;text-align:left;width:150px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-footer .fnd-safe-secure-wrapper img{height:14px;position:relative;top:3px;width:14px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-footer .fnd-powered-wrapper{opacity:.7}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-footer .fnd-powered-wrapper img{height:10px;position:relative;top:2px;width:40px}.fnd-cashback-modal .fnd-cashback-modal-content .fnd-cashback-footer .fnd-cashback-redemption-terms-link{color:inherit;text-decoration:underline;white-space:nowrap;width:150px}.fnd-cashback-modal .fnd-close-btn{color:#000!important;cursor:pointer;display:flex;padding:4px;position:absolute;right:8px;top:8px}.fnd-cashback-modal .fnd-close-btn img{height:12px;width:12px}.fnd-bg-wrapper{background-color:rgba(75,85,99,.5);bottom:0;display:flex!important;height:0;left:0;opacity:0;position:fixed;right:0;top:0;z-index:2147483646}@media only screen and (max-width:670px){.fnd-cashback-modal{width:calc(100% - 24px)}}@media only screen and (max-width:500px){.fnd-cashback-modal{padding:24px}.fnd-cashback-modal .fnd-cashback-modal-content-info-arrow .fnd-long-arrow-img{display:none}.fnd-cashback-modal .fnd-cashback-modal-content-info-arrow .fnd-short-arrow-img{display:block!important}.fnd-cashback-modal .fnd-powered-wrapper{text-align:left!important}.fnd-cashback-modal .fnd-cashback-footer{display:flex!important;flex-wrap:wrap;margin-bottom:12px;margin-top:24px!important}.fnd-cashback-modal .fnd-cashback-footer .fnd-safe-secure-wrapper{display:block!important;text-align:center!important;width:100%!important}}@media only screen and (max-width:380px){.fnd-cashback-modal .fnd-cashback-footer{flex-direction:column;flex-wrap:nowrap;justify-content:center!important}.fnd-cashback-modal .fnd-cashback-footer .fnd-powered-wrapper{text-align:center!important}}@media only screen and (max-width:600px) and (min-width:320px){.fnd-bg-wrapper{padding:0 15px}.fnd-cashback-chip-container div.fnd-cashback-chip{font-size:10px;left:0;padding:0 5px;top:0}}.fnd-collapsible{display:block;max-height:50px;overflow:hidden;padding-top:18px;transition:max-height .2s ease-out}.fnd-collapsible.fnd-open{max-height:200px;overflow-y:auto}.fnd-collapsible.fnd-open .fnd-collapsible-arrow{transform:rotate(0deg)!important}.fnd-collapsible .fnd-collapsible-header{cursor:pointer;display:flex;justify-content:space-between;padding:0 16px}.fnd-collapsible .fnd-collapsible-header .fnd-collapsible-arrow{transform:rotate(180deg);transition:transform .2s ease-out}.fnd-collapsible .fnd-collapsible-content{align-items:start;display:flex;flex-direction:column;margin-bottom:10px;margin-top:26px;padding:0 16px;text-align:left}.fnd-collapsible .fnd-collapsible-content .fnd-collapsible-content-no-products{font-weight:700;padding-bottom:8px;text-align:center;width:100%}.drawer__inner{overflow:auto!important}.fnd-cashback-chip-container{position:relative}.fnd-cashback-chip-container .fnd-cashback-chip{align-items:center;background:#fff;border-radius:12px;display:flex;font-family:Fondue-Inter,sans-serif;font-size:12px;font-weight:400;justify-content:center;left:10px;letter-spacing:-.02em;line-height:15px;padding:3px 8px;position:absolute;right:10px;top:10px;width:fit-content;z-index:1}#fnd-cashback-product-banner-container-product-page{margin:14px 0 14px auto;width:100%}.fnd-legacy-banner-wrapper{background:#fafafa;border-radius:6px;box-sizing:border-box;margin-bottom:14px;padding:12px}.fnd-legacy-banner-wrapper .fnd-legacy-banner-wrapper-top{align-items:center;display:flex;justify-content:space-between;margin-bottom:10px;width:100%}.fnd-legacy-banner-wrapper .fnd-legacy-banner-wrapper-top .fnd-legacy-logos-container{align-items:center;display:flex}.fnd-legacy-banner-wrapper .fnd-legacy-banner-wrapper-top .fnd-legacy-logos-container .fnd-legacy-image-wrapper{display:flex;margin-right:4px}.fnd-legacy-banner-wrapper .fnd-legacy-banner-wrapper-top .fnd-legacy-info-wrapper{cursor:pointer}.fnd-legacy-banner-wrapper .fnd-legacy-banner-wrapper-bottom{font-family:Fondue-Inter,sans-serif;font-size:12px;font-style:normal;font-weight:400;text-align:left!important}.fnd-legacy-banner-wrapper .fnd-legacy-banner-wrapper-bottom p{color:#1f2937;font-size:12px;line-height:15px;margin:0}.fnd-legacy-banner-wrapper .fnd-legacy-banner-wrapper-bottom p span{display:inline-block;font-weight:700}.fnd-banner-wrapper{align-items:flex-end;background:#fff;border-radius:4px;display:flex;flex-wrap:wrap;justify-content:space-between;max-width:600px;padding:20px;text-align:left}.fnd-banner-wrapper .fnd-left-side{align-items:flex-start;display:flex;justify-content:flex-start;margin:0 16px 0 0}.fnd-banner-wrapper .fnd-left-side .fnd-content-text{color:#111827;display:flex;flex-direction:column}.fnd-banner-wrapper .fnd-left-side .fnd-content-text .fnd-content-title-container{align-items:flex-end;display:flex;justify-content:flex-start}.fnd-banner-wrapper .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title{display:flex;flex-wrap:wrap;font-size:14px;font-weight:700;line-height:22px}.fnd-banner-wrapper .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title .fnd-tooltip{all:unset;background-color:#1f2937;border-radius:4px;color:#fff;display:none;font-size:12px;left:50%;line-height:16px;padding:8px;position:absolute;text-align:center;top:-40px;transform:translateX(-50%);white-space:nowrap}.fnd-banner-wrapper .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title .fnd-tooltip:before{border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid #1f2937;content:"";height:0;left:50%;position:absolute;top:27px;transform:translateX(-50%);width:0}.fnd-banner-wrapper .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title .fnd-include-exclude-with-threshold{position:relative;text-decoration:underline dotted}.fnd-banner-wrapper .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title .fnd-include-exclude-with-threshold:hover .fnd-tooltip{display:block}.fnd-banner-wrapper .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title .fnd-pay-back-container{display:inline-block;margin:0 0 0 4px!important;white-space:nowrap}.fnd-banner-wrapper .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title .fnd-pay-back-container .fnd-pay-back{color:#047857;white-space:nowrap}.fnd-banner-wrapper .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-img-container{display:flex;margin:0 0 0 8px!important}.fnd-banner-wrapper .fnd-left-side .fnd-content-text .fnd-content-subtitle{font-size:12px;font-weight:500;line-height:20px}.fnd-banner-wrapper .fnd-right-side .fnd-popup-trigger{color:#374151;cursor:pointer;font-size:12px;font-weight:500;line-height:16px;text-decoration:underline;white-space:nowrap}.fnd-toast-wrapper{animation:fnd-toast-wrapper 1s forwards;background:#fff;border-radius:6px;bottom:0;box-shadow:0 10px 15px -3px rgba(0,0,0,.1);box-sizing:border-box;display:flex;height:108px;margin-bottom:40px;margin-right:60px;padding:12px;position:fixed;right:0;transform:translateY(100%);width:350px;z-index:2147483647!important}.fnd-toast-wrapper .fnd-close-btn{color:#111827;cursor:pointer;display:flex;position:absolute;right:20px;top:20px}.fnd-toast-wrapper .fnd-close-btn img{height:20px;width:20px}.fnd-toast-wrapper .fnd-toast-gif-wrapper{align-items:center;display:flex}.fnd-toast-wrapper .fnd-toast-gif-wrapper .fnd-toast-gif-background{background-color:#86b6ff;border-radius:50%;display:block;height:60px;position:absolute;width:60px;z-index:-1}.fnd-toast-wrapper .fnd-toast-gif-wrapper .fnd-toast-gif-image{height:60px;width:60px}.fnd-toast-wrapper .fnd-toast-text-wrapper{margin-bottom:auto;margin-left:20px;margin-top:auto;width:200px}.fnd-toast-wrapper .fnd-toast-text-wrapper .fnd-cashback-applied-text{color:#111827;cursor:default;font-family:Fondue-Inter,sans-serif;font-size:16px;font-weight:700;line-height:24px}.fnd-toast-wrapper .fnd-toast-text-wrapper .fnd-info-wrapper{color:#6b7280;cursor:pointer;font-family:Fondue-Inter,sans-serif;font-size:14px;font-style:normal;font-weight:400;line-height:20px;text-decoration:underline}@keyframes fnd-toast-wrapper{0%{bottom:-100px}to{bottom:0}}@media only screen and (min-width:769px){.fnd-toast-wrapper{animation:fnd-toast-wrapper 1s forwards;bottom:0;position:fixed;right:0;transform:translateY(0)}.fnd-bubble-container{bottom:20vh;height:80px;left:0;position:fixed;width:60px}.fnd-bubble-container .fnd-bubble-background{border-radius:0 60px 60px 0;height:80px;width:60px}.fnd-bubble-container .fnd-bubble-background .fnd-bubble-image{height:43.64px;width:60px}.fnd-bubble-container .fnd-bubble-background .fnd-bubble-details{font-size:14px}.fnd-bubble-container .fnd-bubble-background .fnd-bubble-details .fnd-bubble-amount{margin:0 0 5px}.fnd-bubble-container .fnd-bubble-background .fnd-bubble-details .fnd-bubble-amount .fnd-bubble-amount-decimal{font-size:10px}.fnd-bubble-module-container{margin:0 0 -12px 40px}}@media only screen and (max-width:768px){.fnd-toast-wrapper{bottom:0;left:50%;position:fixed;transform:translateX(-50%)}.fnd-bubble-container{bottom:20vh;height:80px;left:0;position:fixed;width:48px}.fnd-bubble-container .fnd-bubble-background{border-radius:0 40px 40px 0;height:80px;width:48px}.fnd-bubble-container .fnd-bubble-background .fnd-bubble-image{height:34.91px;width:40px}.fnd-bubble-container .fnd-bubble-background .fnd-bubble-details{font-size:12px}.fnd-bubble-container .fnd-bubble-background .fnd-bubble-details .fnd-bubble-amount{margin:0 0 2px}.fnd-bubble-container .fnd-bubble-background .fnd-bubble-details .fnd-bubble-amount .fnd-bubble-amount-decimal{font-size:8px}.fnd-bubble-module-container{left:50%;margin:0 0 -12px;transform:translateX(-50%)}}.fnd-bubble-anchor{display:none}.fnd-bubble-module-container{bottom:20vh}.fnd-root-bubble-container{bottom:20vh;position:fixed;z-index:2147483647!important}.fnd-root-bubble-container .fnd-bubble-module-container{background:#fff;border:1px solid #f3f4f6;border-radius:8px;bottom:20vh;box-shadow:0 10px 10px -5px rgba(0,0,0,.15),0 -10px 10px -5px rgba(0,0,0,.15),10px 0 10px -5px rgba(0,0,0,.15),-10px 0 10px -5px rgba(0,0,0,.15),0 20px 25px -5px rgba(0,0,0,.15);display:none;position:fixed;width:320px}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper{width:100%}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module{font-family:Fondue-Inter,sans-serif}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module .fnd-banner-wrapper{align-items:flex-start;display:flex;flex-direction:column;justify-content:space-between}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module .fnd-left-side{margin:0 16px 8px 0}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title{font-size:16px;line-height:24px}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title .fnd-pay-back-container{margin:0!important}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title .fnd-pay-back-container .fnd-pay-back{color:#000}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title .fnd-cashback-eligable-container{margin:0!important}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module .fnd-left-side .fnd-content-text .fnd-content-title-container .fnd-content-title .fnd-cashback-eligable-container .fnd-cashback-eligable{color:#059669}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module .fnd-left-side .fnd-content-text .fnd-content-subtitle,.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module .fnd-right-side .fnd-popup-trigger{font-size:14px}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module-close-btn{color:#111827;cursor:pointer;display:flex;position:absolute;right:20px;top:22px}.fnd-root-bubble-container .fnd-bubble-module-container .fnd-bubble-module-wrapper .fnd-bubble-module-close-btn img{height:20px;width:20px}.fnd-root-bubble-container .fnd-bubble-container{align-items:center;background:transparent;cursor:pointer;display:flex;left:0;margin-left:0;transform:translateY(0);z-index:2147483647!important}.fnd-root-bubble-container .fnd-bubble-container .fnd-bubble-background{align-items:center;box-shadow:0 4px 8px 4px rgba(0,0,0,.1);display:flex;flex-direction:column;justify-content:center;position:absolute;z-index:-1}.fnd-root-bubble-container .fnd-bubble-container .fnd-bubble-background.fnd-bubble-code-applied{background-color:#10b981;display:none;flex-direction:row;justify-content:flex-start}.fnd-root-bubble-container .fnd-bubble-container .fnd-bubble-background.fnd-bubble-cashback-eligable{background-color:#fff;display:none}.fnd-root-bubble-container .fnd-bubble-container .fnd-bubble-image{margin:0 0 0 -7px}.fnd-root-bubble-container .fnd-bubble-container .fnd-bubble-details{font-family:Fondue-Inter,sans-serif;letter-spacing:0;line-height:12px;margin:0 0 0 -4px;text-align:center;width:100%}.fnd-root-bubble-container .fnd-bubble-container .fnd-bubble-details .fnd-bubble-amount{color:#059669;font-weight:800}.fnd-root-bubble-container .fnd-bubble-container .fnd-bubble-details .fnd-bubble-text{color:#000;font-weight:700}@keyframes fnd-bubble-fade-in{0%{opacity:0}to{opacity:1}}@keyframes fnd-bubble-fade-out{0%{opacity:1}to{opacity:0}}.fnd-root-bubble-container .fnd-bubble-fade-in{animation:fnd-bubble-fade-in .6s ease-out}.fnd-root-bubble-container .fnd-bubble-fade-out{animation:fnd-bubble-fade-out .5s ease-out}.fnd-in-store-wrapper{position:relative;z-index:999}.fnd-modal-body-container{background-color:#fff}.fnd-modal-body-container .fnd-content{display:flex;flex-direction:column;gap:24px}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options{align-items:center;display:flex;flex-direction:row}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-separator{height:120px;position:relative;width:24px}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-cashback-method-option-container{align-items:center;display:flex;flex:1 0 0;flex-direction:column;gap:8px;padding:0 16px}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-cashback-method-option-container .fnd-option-img{height:70px;width:88px}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-cashback-method-option-container .fnd-content-title{color:#111827;font-family:Fondue-Inter,sans-serif;font-style:normal;font-weight:700;line-height:150%;text-align:center}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-cashback-method-option-container .fnd-content-subtitle{color:#111827;font-family:Fondue-Inter,sans-serif;font-style:normal;font-weight:500;line-height:200%;text-align:center}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-cashback-method-option-container .fnd-content-text{align-items:center;display:flex;flex-direction:column;gap:4px;padding:0 24px;width:340px}.fnd-modal-body-container .fnd-content .fnd-content-title{color:#111827;font-family:Fondue-Inter,sans-serif;font-style:normal;font-weight:700;line-height:150%;text-align:center}.fnd-modal-body-container .fnd-content .fnd-content-container{align-items:center;display:flex;flex-direction:column;gap:8px;padding:0 0 24px}.fnd-modal-body-container .fnd-content .fnd-content-subtitle-container{align-items:center;display:flex;gap:8px}.fnd-modal-body-container .fnd-content .fnd-content-subtitle-container .fnd-content-subtitle-img{height:16px;width:16px}.fnd-modal-body-container .fnd-content .fnd-content-subtitle-container .fnd-content-subtitle{color:#111827;font-family:Fondue-Inter,sans-serif;font-style:normal;font-weight:700;line-height:150%;text-align:center}.fnd-modal-body-container .fnd-content .fnd-content-text-container{align-items:center;display:flex;flex-direction:column}.fnd-modal-body-container .fnd-content .fnd-content-text{align-self:stretch;color:#374151;font-family:Fondue-Inter,sans-serif;font-style:normal;font-weight:400;line-height:150%;text-align:center}.fnd-modal-body-container .fnd-modal-footer-container{align-items:center;align-self:stretch;display:flex;flex-direction:column}.fnd-modal-body-container .fnd-modal-footer-container .fnd-content-text{color:#374151;font-family:Fondue-Inter,sans-serif;font-style:normal;font-weight:400;line-height:150%;text-align:center}.fnd-modal-body-container .fnd-modal-footer-container .fnd-footer{align-items:center;background-color:#fff;display:flex;flex-direction:column;gap:4px;justify-content:center;padding:0}.fnd-modal-body-container .fnd-modal-footer-container .fnd-footer .fnd-item-container{align-items:center;display:flex;gap:2px;justify-content:center}.fnd-modal-body-container .fnd-modal-footer-container .fnd-footer .fnd-item-container .fnd-secure-img{height:16px;width:16px}.fnd-modal-body-container .fnd-modal-footer-container .fnd-footer .fnd-text{color:#6b7280;font-family:Fondue-Inter,sans-serif;font-size:12px;font-style:normal;font-weight:400;line-height:normal}.fnd-modal-body-container .fnd-modal-footer-container .fnd-footer .fnd-text.fnd-link{color:#2563eb;margin-bottom:6px}@media only screen and (max-width:768px){.fnd-modal-body-container .fnd-content .fnd-content-subtitle{font-size:16px}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-cashback-method-option-container .fnd-content-title,.fnd-modal-body-container .fnd-content .fnd-content-text{font-size:14px}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-cashback-method-option-container .fnd-content-subtitle,.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-cashback-method-option-container .fnd-content-text{font-size:12px}.fnd-modal-body-container .fnd-modal-footer-container{gap:16px}.fnd-modal-body-container .fnd-modal-footer-container .fnd-content-text{font-size:14px}.fnd-modal-body-container .fnd-modal-footer-container .fnd-footer .fnd-text{font-size:10px}.fnd-modal-body-container .fnd-modal-footer-container .fnd-footer .fnd-log-img{height:10px;width:47.5px}}@media only screen and (min-width:769px){.fnd-modal-body-container .fnd-content .fnd-content-subtitle{font-size:18px}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-cashback-method-option-container .fnd-content-title,.fnd-modal-body-container .fnd-content .fnd-content-text{font-size:14px}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-cashback-method-option-container .fnd-content-subtitle{font-size:12px}.fnd-modal-body-container .fnd-content .fnd-cashback-method-options .fnd-cashback-method-option-container .fnd-content-text{font-size:14px}.fnd-modal-body-container .fnd-modal-footer-container{gap:24px}.fnd-modal-body-container .fnd-modal-footer-container .fnd-content-text{font-size:14px}.fnd-modal-body-container .fnd-modal-footer-container .fnd-footer .fnd-text{font-size:12px}.fnd-modal-body-container .fnd-modal-footer-container .fnd-footer .fnd-log-img{height:12px;width:57px}}.fnd-modal-header-container .fnd-content{color:#111827;font-family:Fondue-Inter,sans-serif;font-size:24px;font-style:normal;font-weight:600;text-align:center}.fnd-modal-header-container .fnd-content .fnd-cashback-eligible{color:#047857}.fnd-modal-header-container .fnd-modal-header-subtitle{color:#111827;font-family:Fondue-Inter,sans-serif;font-size:14px;font-weight:500;line-height:20px;margin:8px 0 0;text-align:center}.fnd-modal-header-container .fnd-modal-header-eligible-items-wrapper{align-items:center;display:flex;flex-direction:column;gap:8px;justify-content:center;position:relative}.fnd-modal-header-container .fnd-modal-header-eligible-items-wrapper .fnd-modal-header-eligible-items-total-cb-container{align-items:center;color:#111827;cursor:pointer;display:flex;flex-direction:row;font-family:Fondue-Inter,sans-serif;font-size:14px;font-style:normal;font-weight:500;height:20px;justify-content:center;letter-spacing:.12px;line-height:24px;text-align:center}.fnd-modal-header-container .fnd-modal-header-eligible-items-wrapper .fnd-modal-header-eligible-items-total-cb-container .fnd-chevron-arrow{align-items:center;display:flex;justify-content:center;margin-left:4px}.fnd-modal-header-container .fnd-modal-header-eligible-items-wrapper .fnd-modal-header-eligible-items-total-cb-container .fnd-chevron-arrow .fnd-chevron-arrow-img{height:10px;transform:rotate(180deg);width:10px}.fnd-modal-header-container .fnd-modal-header-eligible-items-wrapper .fnd-modal-header-eligible-items-total-cb-container .fnd-chevron-arrow .fnd-chevron-arrow-img.fnd-clicked{transform:rotate(0deg)}.fnd-modal-header-container .fnd-modal-header-eligible-items-wrapper .fnd-modal-header-eligible-items-container{display:none;flex-direction:column;opacity:0;overflow-x:hidden;overflow-y:auto;scrollbar-color:#d1d5db #fff;scrollbar-width:thin;transition:opacity .5s ease-in-out}.fnd-modal-header-container .fnd-modal-header-eligible-items-wrapper .fnd-modal-header-eligible-items-container.fnd-show{display:block}.fnd-modal-header-container .fnd-modal-header-eligible-items-wrapper .fnd-modal-header-eligible-items-container.fnd-show.fnd-el-animation{opacity:1}.fnd-modal-header-container .fnd-modal-header-eligible-items-wrapper .fnd-modal-header-eligible-items-container .fnd-eligible-line-item-container{align-items:center;display:flex;gap:8px;justify-content:space-between;margin-bottom:4px;transition:opacity .5s ease-in-out}.fnd-modal-header-container .fnd-modal-header-eligible-items-wrapper .fnd-modal-header-eligible-items-container .fnd-eligible-line-item-container .fnd-eligible-line-item-sign{align-items:center;display:flex;justify-content:center;margin-right:8px}.fnd-modal-header-container .fnd-modal-header-eligible-items-wrapper .fnd-modal-header-eligible-items-container .fnd-eligible-line-item-container .fnd-eligible-line-item-title{color:#374151;font-family:Fondue-Inter,sans-serif;font-style:normal;font-weight:400;line-height:21px}@media only screen and (max-width:768px){.fnd-modal-header-container .fnd-modal-header-container .fnd-content{font-size:26px;letter-spacing:-.48px;line-height:40px}.fnd-modal-header-container .fnd-modal-header-container .fnd-modal-header-subtitle{font-size:12px;font-weight:500;line-height:20px;margin:0}.fnd-modal-header-container .fnd-modal-header-container .fnd-modal-header-eligible-items-total-cb-container{font-size:14px;width:280px}.fnd-modal-header-container .fnd-modal-header-container .fnd-modal-header-eligible-items-container{max-height:100px}.fnd-modal-header-container .fnd-modal-header-container .fnd-modal-header-eligible-items-container.fnd-show.fnd-top-gradient-background:before{background:linear-gradient(180deg,#fff,hsla(0,0%,100%,0));content:" ";height:24px;left:15px;position:absolute;top:27px;width:250px;z-index:1}.fnd-modal-header-container .fnd-modal-header-container .fnd-modal-header-eligible-items-container.fnd-show.fnd-bottom-gradient-background:after{background:linear-gradient(180deg,hsla(0,0%,100%,0),#fff);content:" ";height:24px;left:15px;position:absolute;top:106px;width:250px;z-index:1}.fnd-modal-header-container .fnd-modal-header-container .fnd-eligible-line-item-container{font-size:12px;width:240px}.fnd-modal-header-container .fnd-modal-header-container .fnd-eligible-line-item-container .fnd-eligible-line-item-sign{height:16px;width:16px}.fnd-modal-header-container .fnd-modal-header-container .fnd-eligible-line-item-container .fnd-eligible-line-item-title{font-size:12px;letter-spacing:.12px}}@media only screen and (min-width:769px){.fnd-modal-header-container .fnd-content{font-size:30px;letter-spacing:-.6px;line-height:150%}.fnd-modal-header-container .fnd-modal-header-eligible-items-total-cb-container{font-size:14px;width:293px}.fnd-modal-header-container .fnd-modal-header-eligible-items-container{max-height:140px}.fnd-modal-header-container .fnd-modal-header-eligible-items-container.fnd-show.fnd-top-gradient-background:before{background:linear-gradient(180deg,#fff,hsla(0,0%,100%,0));content:" ";height:24px;left:15px;position:absolute;top:27px;width:268px;z-index:1}.fnd-modal-header-container .fnd-modal-header-eligible-items-container.fnd-show.fnd-bottom-gradient-background:after{background:linear-gradient(180deg,hsla(0,0%,100%,0),#fff);content:" ";height:24px;left:15px;position:absolute;top:146px;width:268px;z-index:1}.fnd-modal-header-container .fnd-eligible-line-item-container{font-size:14px;width:260px}.fnd-modal-header-container .fnd-eligible-line-item-container .fnd-eligible-line-item-sign{height:20px;margin-left:4px;width:20px}.fnd-modal-header-container .fnd-eligible-line-item-container .fnd-eligible-line-item-title{font-size:14px;letter-spacing:.14px}}.fnd-modal{align-items:flex-end;background-color:#fff;border-radius:8px;box-shadow:0 4px 6px -2px rgba(0,0,0,.05),0 10px 15px -3px rgba(0,0,0,.1);box-sizing:border-box;display:flex;flex-direction:column;font-family:Fondue-Inter,sans-serif;height:max-content;justify-content:flex-end;letter-spacing:0;line-height:17px;max-height:95%;overflow:auto;position:fixed;text-align:center;transform:translate(-50%,-50%);z-index:2147483647}.fnd-modal.fnd-show{animation:fnd-modal-show-with-dissolve .35s ease-in forwards}.fnd-modal.fnd-close{animation:fnd-modal-hide-with-dissolve .35s ease-out forwards}@keyframes fnd-modal-show-with-dissolve{0%{opacity:0}to{opacity:1}}@keyframes fnd-modal-hide-with-dissolve{0%{opacity:1}to{opacity:0}}.fnd-modal-close-btn{align-items:center;align-self:stretch;cursor:pointer;display:flex;gap:10px;justify-content:flex-end}.fnd-modal-close-btn .fnd-modal-close-btn-img{height:24px;width:24px}.fnd-modal-container{align-items:center;background-color:#fff;border-radius:8px;box-sizing:border-box;display:flex;flex-direction:column;font-family:Fondue-Inter,sans-serif;gap:24px;justify-content:flex-end;letter-spacing:0;line-height:17px;text-align:center}@media only screen and (max-width:768px){.fnd-modal-container{padding:0 24px 24px;width:360px}.fnd-modal-close-btn{padding:16px 16px 0 24px}}@media only screen and (min-width:769px){.fnd-modal-container{padding:0 32px 32px;width:460px}.fnd-modal-close-btn{padding:24px 24px 0}}.fnd-in-store-fab-modal-wrapper{background:rgba(0,0,0,.4);height:100%;left:0;position:fixed;top:0;width:100%}.fnd-in-store-fab-modal-wrapper.fnd-open{display:flex}.fnd-in-store-fab-modal-wrapper.fnd-close{display:none}.fnd-in-store-fab-modal-wrapper.fnd-show{display:flex}.fnd-in-store-fab-modal-wrapper.fnd-hide{display:none}@media only screen and (max-width:1199px){.fnd-in-store-fab-modal-wrapper .fnd-modal{bottom:0;left:50%;margin-bottom:8px;transform:translateX(-50%)}.fnd-in-store-fab-modal-wrapper .fnd-modal.fnd-height-middle{bottom:50%;margin-bottom:0;transform:translate(-50%,50%)}}@media only screen and (min-width:1199px){.fnd-in-store-fab-modal-wrapper .fnd-modal{bottom:48px;left:33px;transform:none}.fnd-in-store-fab-modal-wrapper .fnd-modal.fnd-height-middle{bottom:50%;left:50%;margin-bottom:0;transform:translate(-50%,50%)}}:root{--fnd-in-store-fab-bubble-height:80px;--fnd-in-store-fab-bubble-height-range:calc(100vh - var(--fnd-in-store-fab-bottom-padding) - var(--fnd-in-store-fab-top-padding) - var(--fnd-in-store-fab-bubble-height))}.fnd-in-store-fab-container{bottom:0;left:0;position:fixed}.fnd-in-store-fab-container .fnd-in-store-fab-content-container{display:flex;flex-direction:column;position:relative}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content{background:#fff;border:1px solid #e5e7eb;box-sizing:border-box;cursor:pointer;margin-left:12px;padding:4px 12px 4px 20px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content .fnd-in-store-fab-content-title{align-items:center;display:flex;gap:4px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-post-title,.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-pre-title{overflow:hidden}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-post-title .fnd-in-store-fab-pre-post-title-text-wrapper,.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-pre-title .fnd-in-store-fab-pre-post-title-text-wrapper{color:#111827;font-family:Fondue-Inter,sans-serif;font-size:14px;font-style:normal;font-weight:500;height:0;letter-spacing:.12px;line-height:16px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-post-title.fnd-fold,.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-pre-title.fnd-fold{animation:fnd-in-store-fab-content-height-remove .5s forwards}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-post-title.fnd-unfold,.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-pre-title.fnd-unfold{animation:fnd-in-store-fab-content-height-add .5s forwards}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-pre-title{transform:rotate(180deg)}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-pre-title .fnd-in-store-fab-pre-post-title-text-wrapper{height:16px;transform:rotate(180deg)}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content .fnd-content-amount-element{height:max-content}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content .fnd-in-store-fab-text-wrapper{color:#2c1804;font-family:Fondue-Inter,sans-serif;font-style:normal;font-weight:600;letter-spacing:.08px;line-height:24px;margin-bottom:auto;margin-top:auto}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content .fnd-fab-show-text-animation{animation:fnd-fab-show-text-animation .8s forwards;direction:rtl;overflow:hidden;width:0}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content .fnd-cashback-eligible{color:#047857;font-weight:700}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content .fnd-in-store-fab-info-btn{margin-bottom:auto;margin-left:4px;margin-top:auto}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-close-btn{align-items:center;border:4px;cursor:pointer;display:flex;flex-direction:row;height:44px;justify-content:center;opacity:0;width:44px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-close-btn.fnd-open,.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-close-btn.fnd-show{opacity:1}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-close-btn img{background:hsla(0,0%,100%,.4);border-radius:10px;height:20px;width:20px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content-window{background:red;border:1px solid #e5e7eb;box-sizing:border-box;display:block;left:12px;overflow:hidden;position:absolute}.fnd-in-store-fab-container.fnd-position-not-bottom.fnd-show-animation{animation:fnd-fab-not-bottom-show .5s ease-out forwards!important}.fnd-in-store-fab-container.fnd-position-not-bottom.fnd-close-animation{animation:fnd-fab-not-bottom-hide .5s ease-out forwards!important}.fnd-in-store-fab-container.fnd-open-animation{animation:fnd-fab-slide-in .5s ease-out forwards!important}.fnd-in-store-fab-container.fnd-open{display:flex}.fnd-in-store-fab-container.fnd-close-animation{animation:fnd-fab-hide .5s ease-out forwards!important}.fnd-in-store-fab-container.fnd-close{display:none;opacity:0}.fnd-in-store-fab-container.fnd-show-animation{animation:fnd-fab-show .5s ease-in}.fnd-in-store-fab-container.fnd-show{display:flex}.fnd-in-store-fab-container.fnd-hide{display:none}@keyframes fnd-fab-move-up-and-down{0%{transform:translateY(0)}28%{transform:translateY(-8px)}72%{transform:translateY(-8px)}to{transform:translateY(0)}}.fnd-in-store-fab-container.fnd-fab-element-move-up-and-down{animation:fnd-fab-move-up-and-down 1.8s forwards}@keyframes fnd-fab-slide-in{0%{opacity:0;transform:translateY(100%)}to{opacity:1;transform:translateY(0)}}@keyframes fnd-fab-not-bottom-hide{0%{opacity:1}to{opacity:0;transform:translateX(-100%)}}@keyframes fnd-fab-hide{0%{opacity:1}to{opacity:0;transform:translateY(130%) translateX(-130%)}}@keyframes fnd-fab-not-bottom-show{0%{opacity:0;transform:translateX(-100%)}to{opacity:1;transform:translateX(0)}}@keyframes fnd-fab-show{0%{opacity:0;transform:translateY(100%) translateX(-100%)}to{opacity:1;transform:translateY(0) translateX(0)}}@keyframes fnd-in-store-fab-content-height-remove{0%{height:16px}to{height:0}}@keyframes fnd-in-store-fab-content-height-add{0%{height:0}to{height:16px}}@media only screen and (max-width:1199px){:root{--fnd-in-store-fab-top-padding:52px;--fnd-in-store-fab-bottom-padding:12px}.fnd-in-store-fab-container{bottom:calc(var(--fnd-in-store-fab-bubble-height-range)*var(--fnd-in-store-fab-bottom-height-percentage) + 27px)}.fnd-in-store-fab-container .fnd-in-store-fab-content-container{bottom:5px;margin-left:2px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content{border-radius:16px;box-shadow:3px 4px 0 0 rgba(55,65,81,.7)}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-post-title,.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-pre-title{margin:0}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-post-title .fnd-in-store-fab-pre-post-title-text-wrapper,.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content #fnd-in-store-fab-pre-title .fnd-in-store-fab-pre-post-title-text-wrapper{font-size:12px;line-height:16px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content .fnd-in-store-fab-text-wrapper{font-size:16px;line-height:24px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content .fnd-in-store-fab-info-btn{height:16px;width:16px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-close-btn{align-items:flex-start;border:4px;cursor:pointer;display:flex;flex-direction:column;height:44px;justify-content:center;margin:0 0 -14px;width:44px}@keyframes fnd-fab-show-text-animation{0%{width:0}to{width:29.3px}}}@media only screen and (min-width:1199px){.fnd-in-store-fab-container{bottom:calc(var(--fnd-in-store-fab-bubble-height-range)*var(--fnd-in-store-fab-bottom-height-percentage) + 38px)}.fnd-in-store-fab-container .fnd-in-store-fab-content-container{margin-left:20px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content{border-radius:16px;box-shadow:5px 6px 0 0 rgba(55,65,81,.7);padding:5.5px 13px 5.5px 20px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content .fnd-in-store-fab-text-wrapper{font-size:18px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-content .fnd-in-store-fab-info-btn{height:20px;width:20px}.fnd-in-store-fab-container .fnd-in-store-fab-content-container .fnd-in-store-fab-close-btn{margin:0 0 -15px -15px}@keyframes fnd-fab-show-text-animation{0%{width:0}to{width:33px}}}:root{--fnd-in-store-fab-bottom-height-percentage:0;--fnd-in-store-fab-bottom-padding:40px;--fnd-in-store-fab-top-padding:120px;--fnd-in-store-minimized-fab-bubble-height:60px;--fnd-in-store-minimized-fab-bubble-height-range:calc(100vh - var(--fnd-in-store-fab-bottom-padding) - var(--fnd-in-store-fab-top-padding) - var( --fnd-in-store-minimized-fab-bubble-height))}.fnd-in-store-minimized-fab-middle{align-items:center;background:#10b981;border:1px solid #e5e7eb;bottom:calc(var(--fnd-in-store-minimized-fab-bubble-height-range)*var(--fnd-in-store-fab-bottom-height-percentage));cursor:pointer;display:flex;gap:4px;padding:0 4px;position:fixed}.fnd-in-store-minimized-fab-middle.fnd-fab-element-move-up-and-down{animation:fnd-minimized-fab-move-up-and-down-middle .8s forwards}.fnd-in-store-minimized-fab-middle.fnd-open-animation{animation:fnd-minimized-fab-show-middle .5s ease-out forwards!important}.fnd-in-store-minimized-fab-middle.fnd-open{display:flex}.fnd-in-store-minimized-fab-middle.fnd-close{display:none;opacity:0}.fnd-in-store-minimized-fab-middle.fnd-show-animation{animation:fnd-minimized-fab-show-middle .5s ease-out forwards!important}.fnd-in-store-minimized-fab-middle.fnd-show{display:flex}.fnd-in-store-minimized-fab-middle.fnd-hide-animation{animation:fnd-minimized-fab-hide-middle .5s ease-out forwards!important}.fnd-in-store-minimized-fab-middle.fnd-hide{display:none}.fnd-in-store-minimized-fab{align-items:center;background:#10b981;border:1px solid #e5e7eb;cursor:pointer;display:flex;gap:4px;padding:0 4px;position:fixed}.fnd-in-store-minimized-fab.fnd-fab-element-move-up-and-down{animation:fnd-minimized-fab-move-up-and-down .8s forwards}.fnd-in-store-minimized-fab.fnd-open-animation{animation:fnd-minimized-fab-show .5s ease-out forwards!important}.fnd-in-store-minimized-fab.fnd-open{display:flex}.fnd-in-store-minimized-fab.fnd-close{display:none;opacity:0}.fnd-in-store-minimized-fab.fnd-show-animation{animation:fnd-minimized-fab-show .5s ease-out forwards!important}.fnd-in-store-minimized-fab.fnd-show{display:flex}.fnd-in-store-minimized-fab.fnd-hide-animation{animation:fnd-minimized-fab-hide .5s ease-out forwards!important}.fnd-in-store-minimized-fab.fnd-hide{display:none}@media only screen and (max-width:1199px){:root{--fnd-in-store-fab-top-padding:52px;--fnd-in-store-fab-bottom-padding:12px}.fnd-in-store-minimized-fab-middle{border-radius:88px;bottom:calc(var(--fnd-in-store-minimized-fab-bubble-height-range)*var(--fnd-in-store-fab-bottom-height-percentage));height:88px;left:-44px;width:88px}.fnd-in-store-minimized-fab{border-radius:88px;bottom:-44px;height:88px;left:-44px;width:88px}@keyframes fnd-minimized-fab-show{0%{bottom:-88px;left:-88px}to{bottom:-44px;left:-44px}}@keyframes fnd-minimized-fab-hide{0%{opacity:1}to{bottom:-88px;left:-88px}}@keyframes fnd-minimized-fab-show-middle{0%{left:-88px}to{left:-44px}}@keyframes fnd-minimized-fab-hide-middle{0%{opacity:1}to{left:-88px}}@keyframes fnd-minimized-fab-move-up-and-down{0%{transform:translateY(0)}63%{border-radius:108px;bottom:-64px;height:108px;left:-64px;transform:translateY(-20px) translateX(20px);width:108px}to{transform:translateY(0) translateX(0)}}@keyframes fnd-minimized-fab-move-up-and-down-middle{0%{transform:scale(1)}50%{transform:scale(1.2)}to{transform:scale(1)}}}@media only screen and (min-width:1199px){.fnd-in-store-minimized-fab-middle{border-radius:100px;bottom:calc(var(--fnd-in-store-minimized-fab-bubble-height-range)*var(--fnd-in-store-fab-bottom-height-percentage));height:100px;left:-60px;width:100px}.fnd-in-store-minimized-fab-middle.fnd-mouse-hover{animation:fnd-minimized-fab-hover-middle .3s forwards}.fnd-in-store-minimized-fab-middle.fnd-mouse-leave{animation:fnd-minimized-fab-leave-middle .3s forwards}.fnd-in-store-minimized-fab{border-radius:120px;bottom:-60px;height:120px;left:-60px;width:120px}.fnd-in-store-minimized-fab.fnd-mouse-hover{animation:fnd-minimized-fab-hover .3s forwards}.fnd-in-store-minimized-fab.fnd-mouse-leave{animation:fnd-minimized-fab-leave .3s forwards}@keyframes fnd-minimized-fab-show{0%{bottom:-120px;left:-120px}to{bottom:-60px;left:-60px}}@keyframes fnd-minimized-fab-hide{0%{opacity:1}to{bottom:-120px;left:-120px}}@keyframes fnd-minimized-fab-show-middle{0%{left:-120px}to{left:-60px}}@keyframes fnd-minimized-fab-hide-middle{0%{opacity:1}to{left:-120px}}@keyframes fnd-minimized-fab-move-up-and-down{0%{transform:translateY(0)}63%{border-radius:180px;bottom:-100px;height:180px;left:-100px;transform:translateY(-20px) translateX(20px);width:180px}to{transform:translateY(0) translateX(0)}}@keyframes fnd-minimized-fab-move-up-and-down-middle{0%{transform:scale(1)}50%{transform:scale(1.2)}to{transform:scale(1)}}@keyframes fnd-minimized-fab-hover{0%{transform:translateY(0)}to{height:160px;transform:translateY(20px) translateX(-20px);width:160px}}@keyframes fnd-minimized-fab-leave{0%{height:160px;transform:translateY(20px) translateX(-20px);width:160px}to{height:120px;transform:translateY(0) translateX(0);width:120px}}@keyframes fnd-minimized-fab-hover-middle{0%{transform:scale(1)}to{transform:scale(1.2)}}@keyframes fnd-minimized-fab-leave-middle{0%{transform:scale(1.2)}to{transform:scale(1)}}}'),function(t){t.Storefront="STOREFRONT",t.Ajax="AJAX"}(t||(t={}));class e{get(){return document.getElementById("fondue-cashback")?.getAttribute("api")??t.Ajax}}var n=Symbol("@ts-pattern/matcher"),o="@ts-pattern/anonymous-select-key",i=function(t){return Boolean(t&&"object"==typeof t)},r=function(t){return t&&!!t[n]},a=function t(e,o,a){if(i(e)){if(r(e)){var s=e[n]().match(o),c=s.matched,d=s.selections;return c&&d&&Object.keys(d).forEach((function(t){return a(t,d[t])})),c}if(!i(o))return!1;if(Array.isArray(e))return!!Array.isArray(o)&&e.length===o.length&&e.every((function(e,n){return t(e,o[n],a)}));if(e instanceof Map)return o instanceof Map&&Array.from(e.keys()).every((function(n){return t(e.get(n),o.get(n),a)}));if(e instanceof Set){if(!(o instanceof Set))return!1;if(0===e.size)return 0===o.size;if(1===e.size){var l=Array.from(e.values())[0];return r(l)?Array.from(o.values()).every((function(e){return t(l,e,a)})):o.has(l)}return Array.from(e.values()).every((function(t){return o.has(t)}))}return Object.keys(e).every((function(i){var s,c=e[i];return(i in o||r(s=c)&&"optional"===s[n]().matcherType)&&t(c,o[i],a)}))}return Object.is(o,e)},s=function t(e){var o,a,s;return i(e)?r(e)?null!=(o=null==(a=(s=e[n]()).getSelectionKeys)?void 0:a.call(s))?o:[]:Array.isArray(e)?c(e,t):c(Object.values(e),t):[]},c=function(t,e){return t.reduce((function(t,n){return t.concat(e(n))}),[])};function d(t){var e;return(e={})[n]=function(){return{match:function(e){var n={},o=function(t,e){n[t]=e};return void 0===e?(s(t).forEach((function(t){return o(t,void 0)})),{matched:!0,selections:n}):{matched:a(t,e,o),selections:n}},getSelectionKeys:function(){return s(t)},matcherType:"optional"}},e}function l(t){var e;return(e={})[n]=function(){return{match:function(e){if(!Array.isArray(e))return{matched:!1};var n={};if(0===e.length)return s(t).forEach((function(t){n[t]=[]})),{matched:!0,selections:n};var o=function(t,e){n[t]=(n[t]||[]).concat([e])};return{matched:e.every((function(e){return a(t,e,o)})),selections:n}},getSelectionKeys:function(){return s(t)}}},e}function u(){var t,e=[].slice.call(arguments);return(t={})[n]=function(){return{match:function(t){var n={},o=function(t,e){n[t]=e};return{matched:e.every((function(e){return a(e,t,o)})),selections:n}},getSelectionKeys:function(){return c(e,s)},matcherType:"and"}},t}function h(){var t,e=[].slice.call(arguments);return(t={})[n]=function(){return{match:function(t){var n={},o=function(t,e){n[t]=e};return c(e,s).forEach((function(t){return o(t,void 0)})),{matched:e.some((function(e){return a(e,t,o)})),selections:n}},getSelectionKeys:function(){return c(e,s)},matcherType:"or"}},t}function f(t){var e;return(e={})[n]=function(){return{match:function(e){return{matched:!a(t,e,(function(){}))}},getSelectionKeys:function(){return[]},matcherType:"not"}},e}function p(t){var e;return(e={})[n]=function(){return{match:function(e){return{matched:Boolean(t(e))}}}},e}function m(){var t,e=[].slice.call(arguments),i="string"==typeof e[0]?e[0]:void 0,r=2===e.length?e[1]:"string"==typeof e[0]?void 0:e[0];return(t={})[n]=function(){return{match:function(t){var e,n=((e={})[null!=i?i:o]=t,e);return{matched:void 0===r||a(r,t,(function(t,e){n[t]=e})),selections:n}},getSelectionKeys:function(){return[null!=i?i:o].concat(void 0===r?[]:s(r))}}},t}var b,g,y,v=p((function(t){return!0})),w=v,k=p((function(t){return"string"==typeof t})),x=p((function(t){return"number"==typeof t})),C=p((function(t){return"boolean"==typeof t})),E=p((function(t){return"bigint"==typeof t})),S=p((function(t){return"symbol"==typeof t})),I=p((function(t){return null==t})),A={__proto__:null,optional:d,array:l,intersection:u,union:h,not:f,when:p,select:m,any:v,_:w,string:k,number:x,boolean:C,bigint:E,symbol:S,nullish:I,instanceOf:function(t){return p(function(t){return function(e){return e instanceof t}}(t))},typed:function(){return{array:l,optional:d,intersection:u,union:h,not:f,select:m,when:p}}},T=function(t){return new P(t,[])},P=function(){function t(t,e){this.value=void 0,this.cases=void 0,this.value=t,this.cases=e}var e=t.prototype;return e.with=function(){var e=[].slice.call(arguments),n=e[e.length-1],i=[e[0]],r=[];return 3===e.length&&"function"==typeof e[1]?(i.push(e[0]),r.push(e[1])):e.length>2&&i.push.apply(i,e.slice(1,e.length-1)),new t(this.value,this.cases.concat([{match:function(t){var e={},n=Boolean(i.some((function(n){return a(n,t,(function(t,n){e[t]=n}))}))&&r.every((function(e){return e(t)})));return{matched:n,value:n&&Object.keys(e).length?o in e?e[o]:e:t}},handler:n}]))},e.when=function(e,n){return new t(this.value,this.cases.concat([{match:function(t){return{matched:Boolean(e(t)),value:t}},handler:n}]))},e.otherwise=function(e){return new t(this.value,this.cases.concat([{match:function(t){return{matched:!0,value:t}},handler:e}])).run()},e.exhaustive=function(){return this.run()},e.run=function(){for(var t=this.value,e=void 0,n=0;n<this.cases.length;n++){var o=this.cases[n],i=o.match(this.value);if(i.matched){t=i.value,e=o.handler;break}}if(!e){var r;try{r=JSON.stringify(this.value)}catch(t){r=this.value}throw new Error("Pattern matching error: no pattern matches value "+r)}return e(t,this.value)},t}();function _(t){return null==t||!(Object.keys(t)||t).length}!function(t){t.ShopifyAjax="SHOPIFY_AJAX",t.ShopifyStorefront="SHOPIFY_STOREFRONT",t.Rebuy="REBUY"}(b||(b={}));class L{constructor(t){this.apiTypeResolver=t}getType(){const t=this.getShopifyCartType();return _(window.Rebuy)||_(window.Rebuy.SmartCart)||"disabled"===window.Rebuy.SmartCart.status?t:b.Rebuy}getShopifyCartType(){const e=this.apiTypeResolver.get();return T(e).with(t.Storefront,(()=>b.ShopifyStorefront)).with(t.Ajax,(()=>b.ShopifyAjax)).exhaustive()}}class O{constructor(t,e){this.storage=t,this.fondueUtils=e}extract(){const t=new URLSearchParams(window.location.search).get(this.fondueUtils.urlParamsCode);if(!_(t))return this.storage.setItem(this.fondueUtils.cashbackCodeStorageKey,t),t}}class R{constructor(t,e){this.extensionRunnerBuilder=t,this.cartIdentifier=e}async run(){return _(window.Rebuy)?await this.extensionRunnerBuilder.build(!1).run():_(window.Rebuy.SmartCart)?await this.registerRebuyLoadedEventListener():await this.initByCartMode()}async registerRebuyLoadedEventListener(){document.addEventListener("rebuy.loaded",async function(t){return await this.initByCartMode()}.bind(this))}async initByCartMode(){const t=this.cartIdentifier.getType()===b.Rebuy;await this.extensionRunnerBuilder.build(t).run()}}!function(t){t.Product="Product",t.Note="Note",t.Hybrid="Hybrid"}(g||(g={})),function(t){t.ForceRebuy="FORCE_REBUY",t.BypassRebuy="BYPASS_REBUY",t.AutomaticIdentification="AUTOMATIC_IDENTIFICATION"}(y||(y={}));class F{constructor(t,e){this.extensionRunnerBuilder=t,this.cartBasedExtensionRunner=e}async run(t){return T(t).with(y.ForceRebuy,(async()=>await this.extensionRunnerBuilder.build(!0).run())).with(y.BypassRebuy,(async()=>await this.extensionRunnerBuilder.build(!1).run())).with(y.AutomaticIdentification,(async()=>await this.cartBasedExtensionRunner.run())).otherwise((()=>{throw new Error("Not supported force cart mode value")}))}}const M={cashbackCodeStorageKey:"fondue-cashback-code",cashbackProductStorageKey:"fondue-cashback-in-session",shopperExperimentAttributionStorageKey:"fondue-shopper-experiment-attribution",cashbackProductTypePrefix:"Fondue Cashback",requestIndicator:"?_fondue_internal=true",settingsStorageKey:"fondue-store-front-settings",cashbackAmountKey:"fodnue-cashback-amount",klaviyo:{popupProperty:"fondueCode",eventName:"klaviyoForms"},events:{internal:{extensionReady:"fondue:internal:extension.ready",fondueCartUpdated:"fondue:internal:cart.updated",fonduePromotionApplied:"fondue:internal:promotion.applied",fondueCodeApplied:"fondue:internal:code.applied",promotionInit:"fondue:internal:promotion.init",modalOpened:"fondue:internal:modal.opened",modalClosed:"fondue:internal:modal.closed",promotionCodeExtracted:"fondue:internal:promotion.code.extracted"},public:{promotionApplied:"fondue:promotion.applied",cartUpdated:"fondue:external:cart.updated"}},sessionKeys:{fondueSessionId:"fondue-session-id",fonduebugger:"fonduebugger",cashbackToast:"cashback-toast",fondueFeature:"fondue-feature",cbAppliedShown:"fondue-cb-applied-shown",sessionCartId:"fondue-session-cart-id"},urlParamsCode:"cashback",vendor:"Fondue",cashbackProductTypes:{siteWide:"Fondue Cashback - SiteWide",urlBased:"Fondue Cashback - UrlBased"},fondueCartSnapshot:"fondue-cart-snapshot",fondueModuleAnchor:"fondue-cashback-module",fondueModuleBodyWrapper:"fnd-banner-wrapper",bubbleUtils:{selectors:{anchor:"fnd-bubble-anchor",rootContainer:"fnd-root-bubble-container",codeApplied:"fnd-bubble-code-applied",cashbackEligibleAmount:"fnd-bubble-cashback-eligable",bubbleContainer:"fnd-bubble-container",moduleContainer:"fnd-bubble-module-container",moduleWrapper:"fnd-bubble-module-wrapper",moduleCloseButton:"fnd-bubble-module-close-btn",moduleHowtoButton:"fnd-bubble-module-how-to-btn",popupCloseButton:"fnd-bubble-popup-close-btn",popupContainer:"fnd-bubble-popup-container",popupWrapper:"bubble-cash-back-modal-wrapper"},events:{closeModuleButtonClicked:"closeModuleButtonClicked",howtoModuleButtonClicked:"howtoModuleButtonClicked",closePopupButtonClicked:"closePopupButtonClicked",firstEligibleItemAddedToCart:"firstEligibleItemAddedToCart"}},common:{mobileMaxScreenSize:1199},noteAttributesKeys:{shopperSession:"__fondue_session",promotionToken:"__fondue_token",fabPlaced:"__fondue_fab_placed"}};let D;const N=new Uint8Array(16);function $(){if(!D&&(D="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!D))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return D(N)}const B=[];for(let t=0;t<256;++t)B.push((t+256).toString(16).slice(1));var U={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function H(t,e,n){if(U.randomUUID&&!e&&!t)return U.randomUUID();const o=(t=t||{}).random||(t.rng||$)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){n=n||0;for(let t=0;t<16;++t)e[n+t]=o[t];return e}return function(t,e=0){return(B[t[e+0]]+B[t[e+1]]+B[t[e+2]]+B[t[e+3]]+"-"+B[t[e+4]]+B[t[e+5]]+"-"+B[t[e+6]]+B[t[e+7]]+"-"+B[t[e+8]]+B[t[e+9]]+"-"+B[t[e+10]]+B[t[e+11]]+B[t[e+12]]+B[t[e+13]]+B[t[e+14]]+B[t[e+15]]).toLowerCase()}(o)}class q{getItem(t){try{const e=JSON.parse(sessionStorage.getItem(t));if(!e.expiredIn)return e.value;if(e.expiredIn<(new Date).getTime())return;return e.value}catch(t){return}}setItem(t,e,n){const o={value:e,expiredIn:n?this.expirationDate(n):void 0};sessionStorage.setItem(t,JSON.stringify(o))}removeItem(t){try{return sessionStorage.removeItem(t),!0}catch(t){return!1}}expirationDate(t){return(new Date).getTime()+t}}class j{constructor(t,e){if(this.fondueUtils=t,this.storage=e,j.instance)throw new Error("Error - use SessionProvider.getInstance()")}set(){const t=H();return this.storage.setItem(this.fondueUtils.noteAttributesKeys.shopperSession,t),t}async get(){const t=this.storage.getItem(this.fondueUtils.noteAttributesKeys.shopperSession);return _(t)?this.set():t}static getInstance(){return j.instance?this.instance:new j(M,new q)}}class G{constructor(t){this.fondueUtils=t}publish(t){document.dispatchEvent(new CustomEvent(this.fondueUtils.events.internal.fonduePromotionApplied,{detail:t}))}}class z{constructor(t){this.fondueUtils=t}publish(t){document.dispatchEvent(new CustomEvent(this.fondueUtils.events.internal.fondueCodeApplied,{detail:t}))}}class X{constructor(t,e,n,o,i){this.storage=t,this.cashbackExtractPublisher=e,this.codeAppliedPublisher=n,this.fondueUtils=o,this.sessionProvider=i}persist(t){const e=this.storage.getItem(this.fondueUtils.cashbackProductStorageKey);(_(e)||e.publicId!==t.publicId)&&(this.storage.setItem(this.fondueUtils.cashbackProductStorageKey,t),this.startSession(),this.cashbackExtractPublisher.publish({item:t}),this.storage.getItem(this.fondueUtils.settingsStorageKey).common.enableToastNotification&&this.codeAppliedPublisher.publish({item:t}))}startSession(){this.sessionProvider.set(),this.storage.removeItem(this.fondueUtils.sessionKeys.cbAppliedShown)}static build(t){const e=new G(M),n=new z(M);return new X(t,e,n,M,j.getInstance())}}var V={log:"log",debug:"debug",info:"info",warn:"warn",error:"error"},W=console,K={};Object.keys(V).forEach((function(t){K[t]=W[t]}));var J,Y="Datadog Browser SDK:",Z={debug:K.debug.bind(W,Y),log:K.log.bind(W,Y),info:K.info.bind(W,Y),warn:K.warn.bind(W,Y),error:K.error.bind(W,Y)};function Q(t,e){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];try{return t.apply(void 0,n)}catch(t){Z.error(e,t)}}}!function(t){t.PAGEHIDE="pagehide",t.FEATURE_FLAGS="feature_flags",t.RESOURCE_PAGE_STATES="resource_page_states",t.COLLECT_FLUSH_REASON="collect_flush_reason",t.ZERO_LCP_TELEMETRY="zero_lcp_telemetry",t.DISABLE_REPLAY_INLINE_CSS="disable_replay_inline_css",t.WRITABLE_RESOURCE_GRAPHQL="writable_resource_graphql",t.CUSTOM_VITALS="custom_vitals"}(J||(J={}));var tt,et=new Set;function nt(t){return et.has(t)}function ot(t){return 0!==t&&100*Math.random()<=t}function it(t){return function(t){return"number"==typeof t}(t)&&t>=0&&t<=100}function rt(){return(new Date).getTime()}function at(){return rt()}function st(){return performance.now()}function ct(){return{relative:st(),timeStamp:at()}}function dt(){return void 0===tt&&(tt=performance.timing.navigationStart),tt}var lt=/[^\u0000-\u007F]/;function ut(t){return lt.test(t)?void 0!==window.TextEncoder?(new TextEncoder).encode(t).length:new Blob([t]).size:t.length}function ht(t,e){return-1!==t.indexOf(e)}function ft(t){if(Array.from)return Array.from(t);var e=[];if(t instanceof Set)t.forEach((function(t){return e.push(t)}));else for(var n=0;n<t.length;n++)e.push(t[n]);return e}function pt(t){return Object.keys(t).map((function(e){return t[e]}))}function mt(t,e){return t.slice(0,e.length)===e}function bt(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.forEach((function(e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})),t}function gt(t,e){return Object.keys(t).some((function(n){return t[n]===e}))}function yt(t){return 0===Object.keys(t).length}function vt(){if("object"==typeof globalThis)return globalThis;Object.defineProperty(Object.prototype,"_dd_temp_",{get:function(){return this},configurable:!0});var t=_dd_temp_;return delete Object.prototype._dd_temp_,"object"!=typeof t&&(t="object"==typeof self?self:"object"==typeof window?window:{}),t}function wt(t,e){var n,o=vt();return o.Zone&&"function"==typeof o.Zone.__symbol__&&(n=t[o.Zone.__symbol__(e)]),n||(n=t[e]),n}var kt,xt=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;i<r;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},Ct=!1;function Et(t){Ct=t}function St(t,e,n){var o=n.value;n.value=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=kt?It(o):o;return n.apply(this,t)}}function It(t){return function(){return At(t,this,arguments)}}function At(t,e,n){try{return t.apply(e,n)}catch(t){if(Tt(t),kt)try{kt(t)}catch(t){Tt(t)}}}function Tt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ct&&Z.error.apply(Z,xt(["[MONITOR]"],t,!1))}function Pt(t,e){return wt(vt(),"setTimeout")(It(t),e)}function _t(t){wt(vt(),"clearTimeout")(t)}function Lt(t,e){return wt(vt(),"setInterval")(It(t),e)}function Ot(t){wt(vt(),"clearInterval")(t)}var Rt=function(){function t(t){this.onFirstSubscribe=t,this.observers=[]}return t.prototype.subscribe=function(t){var e=this;return!this.observers.length&&this.onFirstSubscribe&&(this.onLastUnsubscribe=this.onFirstSubscribe(this)||void 0),this.observers.push(t),{unsubscribe:function(){e.observers=e.observers.filter((function(e){return t!==e})),!e.observers.length&&e.onLastUnsubscribe&&e.onLastUnsubscribe()}}},t.prototype.notify=function(t){this.observers.forEach((function(e){return e(t)}))},t}();function Ft(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Rt((function(e){var n=t.map((function(t){return t.subscribe((function(t){return e.notify(t)}))}));return function(){return n.forEach((function(t){return t.unsubscribe()}))}}))}function Mt(t,e,n){var o,i,r=!n||void 0===n.leading||n.leading,a=!n||void 0===n.trailing||n.trailing,s=!1;return{throttled:function(){for(var n=[],c=0;c<arguments.length;c++)n[c]=arguments[c];s?o=n:(r?t.apply(void 0,n):o=n,s=!0,i=Pt((function(){a&&o&&t.apply(void 0,o),s=!1,o=void 0}),e))},cancel:function(){_t(i),s=!1,o=void 0}}}function Dt(){}function Nt(t){return t?(parseInt(t,10)^16*Math.random()>>parseInt(t,10)/4).toString(16):"".concat(1e7,"-").concat(1e3,"-").concat(4e3,"-").concat(8e3,"-").concat(1e11).replace(/[018]/g,Nt)}var $t,Bt,Ut,Ht=/([\w-]+)\s*=\s*([^;]+)/g;function qt(t,e,n){void 0===n&&(n="");var o=t.charCodeAt(e-1),i=o>=55296&&o<=56319?e+1:e;return t.length<=i?t:"".concat(t.slice(0,i)).concat(n)}function jt(t,e,n,o){var i=new Date;i.setTime(i.getTime()+n);var r="expires=".concat(i.toUTCString()),a=o&&o.crossSite?"none":"strict",s=o&&o.domain?";domain=".concat(o.domain):"",c=o&&o.secure?";secure":"",d=o&&o.partitioned?";partitioned":"";document.cookie="".concat(t,"=").concat(e,";").concat(r,";path=/;samesite=").concat(a).concat(s).concat(c).concat(d)}function Gt(t){return function(t,e){for(Ht.lastIndex=0;;){var n=Ht.exec(t);if(!n)break;if(n[1]===e)return n[2]}}(document.cookie,t)}function zt(t){return Bt||(Bt=function(t){var e=new Map;for(Ht.lastIndex=0;;){var n=Ht.exec(t);if(!n)break;e.set(n[1],n[2])}return e}(document.cookie)),Bt.get(t)}function Xt(t,e){jt(t,"",0,e)}var Vt=/^([a-z]+)=([a-z0-9-]+)$/;function Wt(t){return yt(t)}function Kt(t){t.expire=String(rt()+9e5)}function Jt(t){return(e=t,Object.keys(e).map((function(t){return[t,e[t]]}))).map((function(t){var e=t[0],n=t[1];return"".concat(e,"=").concat(n)})).join("&");var e}function Yt(t){var e={};return function(t){return!!t&&(-1!==t.indexOf("&")||Vt.test(t))}(t)&&t.split("&").forEach((function(t){var n=Vt.exec(t);if(null!==n){var o=n[1],i=n[2];e[o]=i}})),e}function Zt(){return Yt(Gt("_dd_s"))}function Qt(t){return function(){Xt("_dd_s",t)}}function te(t){localStorage.setItem("_dd_s",Jt(t))}function ee(){return Yt(localStorage.getItem("_dd_s"))}function ne(){localStorage.removeItem("_dd_s")}var oe,ie=[];function re(t,e,n){var o;void 0===n&&(n=0);var i=e.isLockEnabled,r=e.retrieveSession,a=e.persistSession,s=e.clearSession;if(oe||(oe=t),t===oe)if(i&&n>=100)se(e);else{var c,d=r();if(i){if(d.lock)return void ae(t,e,n);if(c=Nt(),d.lock=c,a(d),(d=r()).lock!==c)return void ae(t,e,n)}var l=t.process(d);if(i&&(d=r()).lock!==c)ae(t,e,n);else{if(l&&(Wt(l)?s():(Kt(l),a(l))),i&&(!l||!Wt(l))){if((d=r()).lock!==c)return void ae(t,e,n);delete d.lock,a(d),l=d}null===(o=t.after)||void 0===o||o.call(t,l||d),se(e)}}else ie.push(t)}function ae(t,e,n){Pt((function(){re(t,e,n+1)}),10)}function se(t){oe=void 0;var e=ie.shift();e&&re(e,t)}function ce(t){var e=function(t){var e=function(t){var e={};return e.secure=!!t.useSecureSessionCookie||!!t.usePartitionedCrossSiteSessionCookie||!!t.useCrossSiteSessionCookie,e.crossSite=!!t.usePartitionedCrossSiteSessionCookie||!!t.useCrossSiteSessionCookie,e.partitioned=!!t.usePartitionedCrossSiteSessionCookie,t.trackSessionAcrossSubdomains&&(e.domain=function(){if(void 0===Ut){for(var t="dd_site_test_".concat(Nt()),e=window.location.hostname.split("."),n=e.pop();e.length&&!Gt(t);)jt(t,"test",1e3,{domain:n="".concat(e.pop(),".").concat(n)});Xt(t,{domain:n}),Ut=n}return Ut}()),e}(t);return function(t){if(void 0===document.cookie||null===document.cookie)return!1;try{var e="dd_cookie_test_".concat(Nt()),n="test";jt(e,n,6e4,t);var o=Gt(e)===n;return Xt(e,t),o}catch(t){return Z.error(t),!1}}(e)?{type:"Cookie",cookieOptions:e}:void 0}(t);return!e&&t.allowFallbackToLocalStorage&&(e=function(){try{var t=Nt(),e="".concat("_dd_test_").concat(t);localStorage.setItem(e,t);var n=localStorage.getItem(e);return localStorage.removeItem(e),t===n?{type:"LocalStorage"}:void 0}catch(t){return}}()),e}var de={GRANTED:"granted",NOT_GRANTED:"not-granted"};function le(t,e,n){if("object"!=typeof t||null===t)return JSON.stringify(t);var o=ue(Object.prototype),i=ue(Array.prototype),r=ue(Object.getPrototypeOf(t)),a=ue(t);try{return JSON.stringify(t,e,n)}catch(t){return"<error: unable to serialize object>"}finally{o(),i(),r(),a()}}function ue(t){var e=t,n=e.toJSON;return n?(delete e.toJSON,function(){e.toJSON=n}):Dt}function he(t){return function(t,e){var n=function(){if(void 0===fe)try{var t=new pe("http://test/path");fe="http://test/path"===t.href}catch(t){fe=!1}return fe?pe:void 0}();if(n)try{return void 0!==e?new n(t,e):new n(t)}catch(n){throw new Error("Failed to construct URL: ".concat(String(n)," ").concat(le({url:t,base:e})))}if(void 0===e&&!/:/.test(t))throw new Error("Invalid URL: '".concat(t,"'"));var o=document,i=o.createElement("a");if(void 0!==e){var r=(o=document.implementation.createHTMLDocument("")).createElement("base");r.href=e,o.head.appendChild(r),o.body.appendChild(i)}return i.href=t,i}(t,location.href).href}var fe,pe=URL;function me(t,e,n){var o=function(t,e){var n="/api/v2/".concat(e),o=t.proxy;if("string"==typeof o){var i=he(o);return function(t){return"".concat(i,"?ddforward=").concat(encodeURIComponent("".concat(n,"?").concat(t)))}}if("function"==typeof o)return function(t){return o({path:n,parameters:t})};var r=function(t){var e=t.site,n=void 0===e?"datadoghq.com":e,o=t.internalAnalyticsSubdomain;if(o&&"datadoghq.com"===n)return"".concat(o,".").concat("datadoghq.com");if("dd0g-gov.com"===n)return"http-intake.logs.".concat(n);var i=n.split("."),r=i.pop();return"browser-intake-".concat(i.join("-"),".").concat(r)}(t);return function(t){return"https://".concat(r).concat(n,"?").concat(t)}}(t,e);return{build:function(i,r){var a=function(t,e,n,o,i){var r=t.clientToken,a=t.internalAnalyticsSubdomain,s=i.retry,c=i.flushReason,d=i.encoding,l=["sdk_version:".concat("5.11.0"),"api:".concat(o)].concat(n);c&&nt(J.COLLECT_FLUSH_REASON)&&l.push("flush_reason:".concat(c)),s&&l.push("retry_count:".concat(s.count),"retry_after:".concat(s.lastFailureStatus));var u=["ddsource=browser","ddtags=".concat(encodeURIComponent(l.join(","))),"dd-api-key=".concat(r),"dd-evp-origin-version=".concat(encodeURIComponent("5.11.0")),"dd-evp-origin=browser","dd-request-id=".concat(Nt())];return d&&u.push("dd-evp-encoding=".concat(d)),"rum"===e&&u.push("batch_time=".concat(at())),a&&u.reverse(),u.join("&")}(t,e,n,i,r);return o(a)},urlPrefix:o(""),trackType:e}}var be=/[^a-z0-9_:./-]/;function ge(t,e){var n=200-t.length-1;(e.length>n||be.test(e))&&Z.warn("".concat(t," value doesn't meet tag requirements and will be sanitized"));var o=e.replace(/,/g,"_");return"".concat(t,":").concat(o)}function ye(t,e,n){var o=t[e],i=function(t,e){return function(){var n,o,i=arguments;return At(e,null,[{target:this,parameters:i,onPostCall:function(t){o=t}}]),"function"==typeof t&&(n=t.apply(this,i)),o&&At(o,null,[n]),n}}(o,n),r=function(){if("function"==typeof i)return i.apply(this,arguments)};return t[e]=r,{stop:function(){t[e]===r?t[e]=o:i=o}}}function ve(t){var e=[],n=Ae(t,"stack"),o=String(t);return n&&mt(n,o)&&(n=n.slice(o.length)),n&&n.split("\n").forEach((function(t){var n=function(t){var e=ke.exec(t);if(e){var n=e[2]&&0===e[2].indexOf("native"),o=e[2]&&0===e[2].indexOf("eval"),i=xe.exec(e[2]);return o&&i&&(e[2]=i[1],e[3]=i[2],e[4]=i[3]),{args:n?[e[2]]:[],column:e[4]?+e[4]:void 0,func:e[1]||"?",line:e[3]?+e[3]:void 0,url:n?void 0:e[2]}}}(t)||function(t){var e=Ce.exec(t);if(e)return{args:[],column:e[3]?+e[3]:void 0,func:"?",line:e[2]?+e[2]:void 0,url:e[1]}}(t)||function(t){var e=Ee.exec(t);if(e)return{args:[],column:e[4]?+e[4]:void 0,func:e[1]||"?",line:+e[3],url:e[2]}}(t)||function(t){var e=Se.exec(t);if(e){var n=e[3]&&e[3].indexOf(" > eval")>-1,o=Ie.exec(e[3]);return n&&o&&(e[3]=o[1],e[4]=o[2],e[5]=void 0),{args:e[2]?e[2].split(","):[],column:e[5]?+e[5]:void 0,func:e[1]||"?",line:e[4]?+e[4]:void 0,url:e[3]}}}(t);n&&(!n.func&&n.line&&(n.func="?"),e.push(n))})),{message:Ae(t,"message"),name:Ae(t,"name"),stack:e}}var we="((?:file|https?|blob|chrome-extension|native|eval|webpack|snippet|<anonymous>|\\w+\\.|\\/).*?)",ke=new RegExp("^\\s*at (.*?) ?\\(".concat(we).concat("(?::(\\d+))","?").concat("(?::(\\d+))","?\\)?\\s*$"),"i"),xe=new RegExp("\\((\\S*)".concat("(?::(\\d+))").concat("(?::(\\d+))","\\)")),Ce=new RegExp("^\\s*at ?".concat(we).concat("(?::(\\d+))","?").concat("(?::(\\d+))","??\\s*$"),"i"),Ee=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,Se=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|capacitor|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,Ie=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i;function Ae(t,e){if("object"==typeof t&&t&&e in t){var n=t[e];return"string"==typeof n?n:void 0}}var Te=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?([\s\S]*)$/;function Pe(t,e){var n;void 0===e&&(e=225280);var o=ue(Object.prototype),i=ue(Array.prototype),r=[],a=new WeakMap,s=_e(t,"$",void 0,r,a),c=(null===(n=JSON.stringify(s))||void 0===n?void 0:n.length)||0;if(!(c>e)){for(;r.length>0&&c<e;){var d=r.shift(),l=0;if(Array.isArray(d.source))for(var u=0;u<d.source.length;u++){if(c+=void 0!==(h=_e(d.source[u],d.path,u,r,a))?JSON.stringify(h).length:4,c+=l,l=1,c>e){Le(e,"truncated",t);break}d.target[u]=h}else for(var u in d.source)if(Object.prototype.hasOwnProperty.call(d.source,u)){var h;if(void 0!==(h=_e(d.source[u],d.path,u,r,a))&&(c+=JSON.stringify(h).length+l+u.length+3,l=1),c>e){Le(e,"truncated",t);break}d.target[u]=h}}return o(),i(),s}Le(e,"discarded",t)}function _e(t,e,n,o,i){var r=function(t){var e=t;if(e&&"function"==typeof e.toJSON)try{return e.toJSON()}catch(t){}return t}(t);if(!r||"object"!=typeof r)return function(t){return"bigint"==typeof t?"[BigInt] ".concat(t.toString()):"function"==typeof t?"[Function] ".concat(t.name||"unknown"):"symbol"==typeof t?"[Symbol] ".concat(t.description||t.toString()):t}(r);var a=function(t){try{if(t instanceof Event)return{isTrusted:t.isTrusted};var e=Object.prototype.toString.call(t).match(/\[object (.*)\]/);if(e&&e[1])return"[".concat(e[1],"]")}catch(t){}return"[Unserializable]"}(r);if("[Object]"!==a&&"[Array]"!==a&&"[Error]"!==a)return a;var s=t;if(i.has(s))return"[Reference seen at ".concat(i.get(s),"]");var c=void 0!==n?"".concat(e,".").concat(n):e,d=Array.isArray(r)?[]:{};return i.set(s,c),o.push({source:r,target:d,path:c}),d}function Le(t,e,n){Z.warn("The data provided has been ".concat(e," as it is over the limit of ").concat(t," characters:"),n)}function Oe(t){var e=t.stackTrace,n=t.originalError,o=t.handlingStack,i=t.startClocks,r=t.nonErrorPrefix,a=t.source,s=t.handling,c=n instanceof Error,d=function(t,e,n,o){return(null==t?void 0:t.message)&&(null==t?void 0:t.name)?t.message:e?"Empty message":"".concat(n," ").concat(le(Pe(o)))}(e,c,r,n),l=function(t,e){return void 0!==e&&(!!t||e.stack.length>0&&(e.stack.length>1||void 0!==e.stack[0].url))}(c,e)?Fe(e):"No stack, consider using an instance of Error",u=c?Ne(n,a):void 0;return{startClocks:i,source:a,handling:s,handlingStack:o,originalError:n,type:null==e?void 0:e.name,message:d,stack:l,causes:u,fingerprint:Re(n)}}function Re(t){return t instanceof Error&&"dd_fingerprint"in t?String(t.dd_fingerprint):void 0}function Fe(t){var e=Me(t);return t.stack.forEach((function(t){var n="?"===t.func?"<anonymous>":t.func,o=t.args&&t.args.length>0?"(".concat(t.args.join(", "),")"):"",i=t.line?":".concat(t.line):"",r=t.line&&t.column?":".concat(t.column):"";e+="\n  at ".concat(n).concat(o," @ ").concat(t.url).concat(i).concat(r)})),e}function Me(t){return"".concat(t.name||"Error",": ").concat(t.message)}function De(){var t,e=new Error;if(!e.stack)try{throw e}catch(t){}return At((function(){var n=ve(e);n.stack=n.stack.slice(2),t=Fe(n)})),t}function Ne(t,e){for(var n=t,o=[];(null==n?void 0:n.cause)instanceof Error&&o.length<10;){var i=ve(n.cause);o.push({message:n.cause.message,source:e,type:null==i?void 0:i.name,stack:i&&Fe(i)}),n=n.cause}return o.length?o:void 0}var $e,Be="agent",Ue="logger",He="source";function qe(t,e){e.silentMultipleInit||Z.error("".concat(t," is already initialized."))}function je(t,e,n,o,i){return Ge(t,e,[n],o,i)}function Ge(t,e,n,o,i){var r=void 0===i?{}:i,a=r.once,s=r.capture,c=r.passive,d=It((function(e){(e.isTrusted||e.__ddIsTrusted||t.allowUntrustedEvents)&&(a&&h(),o(e))})),l=c?{capture:s,passive:c}:s,u=wt(e,"addEventListener");function h(){var t=wt(e,"removeEventListener");n.forEach((function(n){return t.call(e,n,d,l)}))}return n.forEach((function(t){return u.call(e,t,d,l)})),{stop:h}}!function(t){t.BEFORE_UNLOAD="beforeunload",t.CLICK="click",t.DBL_CLICK="dblclick",t.KEY_DOWN="keydown",t.LOAD="load",t.POP_STATE="popstate",t.SCROLL="scroll",t.TOUCH_START="touchstart",t.TOUCH_END="touchend",t.TOUCH_MOVE="touchmove",t.VISIBILITY_CHANGE="visibilitychange",t.PAGE_SHOW="pageshow",t.FREEZE="freeze",t.RESUME="resume",t.DOM_CONTENT_LOADED="DOMContentLoaded",t.POINTER_DOWN="pointerdown",t.POINTER_UP="pointerup",t.POINTER_CANCEL="pointercancel",t.HASH_CHANGE="hashchange",t.PAGE_HIDE="pagehide",t.MOUSE_DOWN="mousedown",t.MOUSE_UP="mouseup",t.MOUSE_MOVE="mousemove",t.FOCUS="focus",t.BLUR="blur",t.CONTEXT_MENU="contextmenu",t.RESIZE="resize",t.CHANGE="change",t.INPUT="input",t.PLAY="play",t.PAUSE="pause",t.SECURITY_POLICY_VIOLATION="securitypolicyviolation",t.SELECTION_CHANGE="selectionchange",t.STORAGE="storage"}($e||($e={}));var ze={intervention:"intervention",deprecation:"deprecation",cspViolation:"csp_violation"};function Xe(t,e,n,o,i){return n?Fe({name:t,message:e,stack:[{func:"?",url:n,line:null!=o?o:void 0,column:null!=i?i:void 0}]}):void 0}function Ve(t,e){var n=window.__ddBrowserSdkExtensionCallback;n&&n({type:t,payload:e})}function We(t){return null===t?"null":Array.isArray(t)?"array":typeof t}function Ke(t,e,n){if(void 0===n&&(n=function(){if("undefined"!=typeof WeakSet){var t=new WeakSet;return{hasAlreadyBeenSeen:function(e){var n=t.has(e);return n||t.add(e),n}}}var e=[];return{hasAlreadyBeenSeen:function(t){var n=e.indexOf(t)>=0;return n||e.push(t),n}}}()),void 0===e)return t;if("object"!=typeof e||null===e)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){var o=e.flags||[e.global?"g":"",e.ignoreCase?"i":"",e.multiline?"m":"",e.sticky?"y":"",e.unicode?"u":""].join("");return new RegExp(e.source,o)}if(!n.hasAlreadyBeenSeen(e)){if(Array.isArray(e)){for(var i=Array.isArray(t)?t:[],r=0;r<e.length;++r)i[r]=Ke(i[r],e[r],n);return i}var a="object"===We(t)?t:{};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(a[s]=Ke(a[s],e[s],n));return a}}function Je(t){return Ke(void 0,t)}function Ye(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var o=0,i=e;o<i.length;o++){var r=i[o];null!=r&&(t=Ke(t,r))}return t}function Ze(){var t,e=window.navigator;return{status:e.onLine?"connected":"not_connected",interfaces:e.connection&&e.connection.type?[e.connection.type]:void 0,effective_type:null===(t=e.connection)||void 0===t?void 0:t.effectiveType}}var Qe,tn=["https://www.datadoghq-browser-agent.com","https://www.datad0g-browser-agent.com","https://d3uc069fcn7uxw.cloudfront.net","https://d20xtzwzcl0ceb.cloudfront.net","http://localhost","<anonymous>"],en=["ddog-gov.com"],nn={maxEventsPerPage:0,sentEventCount:0,telemetryEnabled:!1,telemetryConfigurationEnabled:!1};function on(t,e){Tt(V.debug,t,e),an(bt({type:"log",message:t,status:"debug"},e))}function rn(t,e){an(bt({type:"log",status:"error"},function(t){if(t instanceof Error){var e=ve(t);return{error:{kind:e.name,stack:Fe(sn(e))},message:e.message}}return{error:{stack:"No stack, consider using an instance of Error"},message:"".concat("Uncaught"," ").concat(le(t))}}(t),e))}function an(t){Qe&&nn.sentEventCount<nn.maxEventsPerPage&&(nn.sentEventCount+=1,Qe(t))}function sn(t){return t.stack=t.stack.filter((function(t){return!t.url||tn.some((function(e){return mt(t.url,e)}))})),t}function cn(t,e){var n=t.indexOf(e);n>=0&&t.splice(n,1)}var dn=function(){function t(t,e){var n=this;this.expireDelay=t,this.maxEntries=e,this.entries=[],this.clearOldValuesInterval=Lt((function(){return n.clearOldValues()}),6e4)}return t.prototype.add=function(t,e){var n=this,o={value:t,startTime:e,endTime:1/0,remove:function(){cn(n.entries,o)},close:function(t){o.endTime=t}};return this.maxEntries&&this.entries.length>=this.maxEntries&&this.entries.pop(),this.entries.unshift(o),o},t.prototype.find=function(t){void 0===t&&(t=1/0);for(var e=0,n=this.entries;e<n.length;e++){var o=n[e];if(o.startTime<=t){if(t<=o.endTime)return o.value;break}}},t.prototype.closeActive=function(t){var e=this.entries[0];e&&1/0===e.endTime&&e.close(t)},t.prototype.findAll=function(t,e){void 0===t&&(t=1/0),void 0===e&&(e=0);var n=t+e;return this.entries.filter((function(e){return e.startTime<=n&&t<=e.endTime})).map((function(t){return t.value}))},t.prototype.reset=function(){this.entries=[]},t.prototype.stop=function(){Ot(this.clearOldValuesInterval)},t.prototype.clearOldValues=function(){for(var t=st()-this.expireDelay;this.entries.length>0&&this.entries[this.entries.length-1].endTime<t;)this.entries.pop()},t}();function ln(t,e,n,o){var i=new Rt,r=new Rt,a=function(t,e,n){var o=new Rt,i=new Rt,r="Cookie"===t.type?function(t){var e,n={isLockEnabled:1===(null!=$t?$t:$t=function(t){var e;void 0===t&&(t=window);var n=t.navigator.userAgent;return t.chrome||/HeadlessChrome/.test(n)?1:0===(null===(e=t.navigator.vendor)||void 0===e?void 0:e.indexOf("Apple"))||/safari/i.test(n)&&!/chrome|android/i.test(n)?2:t.document.documentMode?0:3}()),persistSession:(e=t,function(t){jt("_dd_s",Jt(t),9e5,e)}),retrieveSession:Zt,clearSession:Qt(t)};return function(t){if(!zt("_dd_s")){var e=zt("_dd"),n=zt("_dd_r"),o=zt("_dd_l"),i={};e&&(i.id=e),o&&/^[01]$/.test(o)&&(i.logs=o),n&&/^[012]$/.test(n)&&(i.rum=n),Wt(i)||(Kt(i),t.persistSession(i))}}(n),n}(t.cookieOptions):{isLockEnabled:!1,persistSession:te,retrieveSession:ee,clearSession:ne},a=r.clearSession,s=r.retrieveSession,c=Lt((function(){re({process:function(t){return m(t)?void 0:{}},after:f},r)}),1e3),d=function(){var t=s();return m(t)?t:{}}(),l=Mt((function(){var t;re({process:function(o){var i=f(o);return t=function(t){var o=n(t[e]),i=o.trackingType,r=o.isTracked;return t[e]=i,r&&!t.id&&(t.id=Nt(),t.created=String(rt())),r}(i),i},after:function(e){t&&!p()&&function(t){d=t,o.notify()}(e),d=e}},r)}),1e3),u=l.throttled,h=l.cancel;function f(t){return m(t)||(t={}),p()&&(function(t){return d.id!==t.id||d[e]!==t[e]}(t)?(d={},i.notify()):d=t),t}function p(){return void 0!==d[e]}function m(t){return(void 0===t.created||rt()-Number(t.created)<144e5)&&(void 0===t.expire||rt()<Number(t.expire))}return{expandOrRenewSession:u,expandSession:function(){re({process:function(t){return p()?f(t):void 0}},r)},getSession:function(){return d},renewObservable:o,expireObservable:i,expire:function(){h(),a(),f({})},stop:function(){Ot(c)}}}(t.sessionStoreStrategyType,e,n),s=new dn(144e5);function c(){return{id:a.getSession().id,trackingType:a.getSession()[e]}}return a.renewObservable.subscribe((function(){s.add(c(),st()),i.notify()})),a.expireObservable.subscribe((function(){r.notify(),s.closeActive(st())})),a.expandOrRenewSession(),s.add(c(),[0,dt()][0]),o.observable.subscribe((function(){o.isGranted()?a.expandOrRenewSession():a.expire()})),function(t,e){Ge(t,window,[$e.CLICK,$e.TOUCH_START,$e.KEY_DOWN,$e.SCROLL],(function(){o.isGranted()&&a.expandOrRenewSession()}),{capture:!0,passive:!0}).stop}(t),function(t,e){var n=function(){"visible"===document.visibilityState&&a.expandSession()};je(t,document,$e.VISIBILITY_CHANGE,n).stop,Lt(n,6e4)}(t),{findActiveSession:function(t){return s.find(t)},renewObservable:i,expireObservable:r,expire:a.expire}}function un(t){return t>=500}function hn(t,e,n,o,i){0===e.transportStatus&&0===e.queuedPayloads.size()&&e.bandwidthMonitor.canHandle(t)?pn(t,e,n,{onSuccess:function(){return mn(0,e,n,o,i)},onFailure:function(){e.queuedPayloads.enqueue(t),fn(e,n,o,i)}}):e.queuedPayloads.enqueue(t)}function fn(t,e,n,o){2===t.transportStatus&&Pt((function(){pn(t.queuedPayloads.first(),t,e,{onSuccess:function(){t.queuedPayloads.dequeue(),t.currentBackoffTime=1e3,mn(1,t,e,n,o)},onFailure:function(){t.currentBackoffTime=Math.min(6e4,2*t.currentBackoffTime),fn(t,e,n,o)}})}),t.currentBackoffTime)}function pn(t,e,n,o){var i=o.onSuccess,r=o.onFailure;e.bandwidthMonitor.add(t),n(t,(function(n){e.bandwidthMonitor.remove(t),function(t){return"opaque"!==t.type&&(0===t.status&&!navigator.onLine||408===t.status||429===t.status||un(t.status))}(n)?(e.transportStatus=e.bandwidthMonitor.ongoingRequestCount>0?1:2,t.retry={count:t.retry?t.retry.count+1:1,lastFailureStatus:n.status},r()):(e.transportStatus=0,i())}))}function mn(t,e,n,o,i){0===t&&e.queuedPayloads.isFull()&&!e.queueFullReported&&(i({message:"Reached max ".concat(o," events size queued for upload: ").concat(3,"MiB"),source:Be,startClocks:ct()}),e.queueFullReported=!0);var r=e.queuedPayloads;for(e.queuedPayloads=bn();r.size()>0;)hn(r.dequeue(),e,n,o,i)}function bn(){var t=[];return{bytesCount:0,enqueue:function(e){this.isFull()||(t.push(e),this.bytesCount+=e.bytesCount)},first:function(){return t[0]},dequeue:function(){var e=t.shift();return e&&(this.bytesCount-=e.bytesCount),e},size:function(){return t.length},isFull:function(){return this.bytesCount>=3145728}}}var gn=!1;function yn(t,e,n,o){var i=new XMLHttpRequest;i.open("POST",e,!0),n instanceof Blob&&i.setRequestHeader("Content-Type",n.type),je(t,i,"loadend",(function(){null==o||o({status:i.status})}),{once:!0}),i.send(n)}function vn(){var t=vt().DatadogEventBridge;if(t)return{getCapabilities:function(){var e;return JSON.parse((null===(e=t.getCapabilities)||void 0===e?void 0:e.call(t))||"[]")},getPrivacyLevel:function(){var e;return null===(e=t.getPrivacyLevel)||void 0===e?void 0:e.call(t)},getAllowedWebViewHosts:function(){return JSON.parse(t.getAllowedWebViewHosts())},send:function(e,n,o){var i=o?{id:o}:void 0;t.send(JSON.stringify({eventType:e,event:n,view:i}))}}}function wn(t){var e;void 0===t&&(t=null===(e=vt().location)||void 0===e?void 0:e.hostname);var n=vn();return!!n&&n.getAllowedWebViewHosts().some((function(e){return t===e||(n=t,o=".".concat(e),n.slice(-o.length)===o);var n,o}))}var kn={HIDDEN:"visibility_hidden",UNLOADING:"before_unload",PAGEHIDE:"page_hide",FROZEN:"page_frozen"},xn=function(){function t(t,e,n,o){var i=this;this.encoder=t,this.request=e,this.flushController=n,this.messageBytesLimit=o,this.upsertBuffer={},this.flushSubscription=this.flushController.flushObservable.subscribe((function(t){return i.flush(t)}))}return t.prototype.add=function(t){this.addOrUpdate(t)},t.prototype.upsert=function(t,e){this.addOrUpdate(t,e)},t.prototype.stop=function(){this.flushSubscription.unsubscribe()},t.prototype.flush=function(t){var e=pt(this.upsertBuffer).join("\n");this.upsertBuffer={};var n,o=(n=t.reason,ht(pt(kn),n)),i=o?this.request.sendOnExit:this.request.send;if(o&&this.encoder.isAsync){var r=this.encoder.finishSync();r.outputBytesCount&&i(Cn(r,t));var a=[r.pendingData,e].filter(Boolean).join("\n");a&&i({data:a,bytesCount:ut(a),flushReason:t.reason})}else e&&this.encoder.write(this.encoder.isEmpty?e:"\n".concat(e)),this.encoder.finish((function(e){i(Cn(e,t))}))},t.prototype.addOrUpdate=function(t,e){var n=le(t),o=this.encoder.estimateEncodedBytesCount(n);o>=this.messageBytesLimit?Z.warn("Discarded a message whose size was bigger than the maximum allowed size ".concat(this.messageBytesLimit,"KB.")):(this.hasMessageFor(e)&&this.remove(e),this.push(n,o,e))},t.prototype.push=function(t,e,n){var o=this;this.flushController.notifyBeforeAddMessage(e),void 0!==n?(this.upsertBuffer[n]=t,this.flushController.notifyAfterAddMessage()):this.encoder.write(this.encoder.isEmpty?t:"\n".concat(t),(function(t){o.flushController.notifyAfterAddMessage(t-e)}))},t.prototype.remove=function(t){var e=this.upsertBuffer[t];delete this.upsertBuffer[t];var n=this.encoder.estimateEncodedBytesCount(e);this.flushController.notifyAfterRemoveMessage(n)},t.prototype.hasMessageFor=function(t){return void 0!==t&&void 0!==this.upsertBuffer[t]},t}();function Cn(t,e){return{data:"string"==typeof t.output?t.output:new Blob([t.output],{type:"text/plain"}),bytesCount:t.outputBytesCount,encoding:t.encoding,flushReason:e.reason}}function En(t,e,n,o,i,r){var a=c(t,e),s=n&&c(t,n);function c(t,e){var n=e.endpoint,a=e.encoder;return new xn(a,function(t,e,n,o){var i={transportStatus:0,currentBackoffTime:1e3,bandwidthMonitor:{ongoingRequestCount:0,ongoingByteCount:0,canHandle:function(t){return 0===this.ongoingRequestCount||this.ongoingByteCount+t.bytesCount<=81920&&this.ongoingRequestCount<32},add:function(t){this.ongoingRequestCount+=1,this.ongoingByteCount+=t.bytesCount},remove:function(t){this.ongoingRequestCount-=1,this.ongoingByteCount-=t.bytesCount}},queuedPayloads:bn(),queueFullReported:!1},r=function(o,i){return function(t,e,n,o,i){if(function(){try{return window.Request&&"keepalive"in new Request("http://a")}catch(t){return!1}}()&&o.bytesCount<n){var r=e.build("fetch",o);fetch(r,{method:"POST",body:o.data,keepalive:!0,mode:"cors"}).then(It((function(t){return null==i?void 0:i({status:t.status,type:t.type})})),It((function(){var n=e.build("xhr",o);yn(t,n,o.data,i)})))}else{var a=e.build("xhr",o);yn(t,a,o.data,i)}}(t,e,n,o,i)};return{send:function(t){hn(t,i,r,e.trackType,o)},sendOnExit:function(o){!function(t,e,n,o){if(navigator.sendBeacon&&o.bytesCount<n)try{var i=e.build("beacon",o);if(navigator.sendBeacon(i,o.data))return}catch(t){!function(t){gn||(gn=!0,rn(t))}(t)}yn(t,e.build("xhr",o),o.data)}(t,e,n,o)}}}(t,n,t.batchBytesLimit,o),function(t){var e,n=t.messagesLimit,o=t.bytesLimit,i=t.durationLimit,r=t.sessionExpireObservable,a=t.pageExitObservable.subscribe((function(t){return u(t.reason)})),s=r.subscribe((function(){return u("session_expire")})),c=new Rt((function(){return function(){a.unsubscribe(),s.unsubscribe()}})),d=0,l=0;function u(t){if(0!==l){var e=l,n=d;l=0,d=0,h(),c.notify({reason:t,messagesCount:e,bytesCount:n})}}function h(){_t(e),e=void 0}return{flushObservable:c,get messagesCount(){return l},notifyBeforeAddMessage:function(t){d+t>=o&&u("bytes_limit"),l+=1,d+=t,void 0===e&&(e=Pt((function(){u("duration_limit")}),i))},notifyAfterAddMessage:function(t){void 0===t&&(t=0),d+=t,l>=n?u("messages_limit"):d>=o&&u("bytes_limit")},notifyAfterRemoveMessage:function(t){d-=t,0==(l-=1)&&h()}}}({messagesLimit:t.batchMessagesLimit,bytesLimit:t.batchBytesLimit,durationLimit:t.flushTimeout,pageExitObservable:i,sessionExpireObservable:r}),t.messageBytesLimit)}return{flushObservable:a.flushController.flushObservable,add:function(t,e){void 0===e&&(e=!0),a.add(t),s&&e&&s.add(n.transformMessage?n.transformMessage(t):t)},upsert:function(t,e){a.upsert(t,e),s&&s.upsert(n.transformMessage?n.transformMessage(t):t,e)},stop:function(){a.stop(),null==s||s.stop()}}}function Sn(){var t="",e=0;return{isAsync:!1,get isEmpty(){return!t},write:function(n,o){var i=ut(n);e+=i,t+=n,o&&o(i)},finish:function(t){t(this.finishSync())},finishSync:function(){var n={output:t,outputBytesCount:e,rawBytesCount:e,pendingData:""};return t="",e=0,n},estimateEncodedBytesCount:function(t){return t.length}}}var In,An,Tn=function(){function t(){this.callbacks={}}return t.prototype.notify=function(t,e){var n=this.callbacks[t];n&&n.forEach((function(t){return t(e)}))},t.prototype.subscribe=function(t,e){var n=this;return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),{unsubscribe:function(){n.callbacks[t]=n.callbacks[t].filter((function(t){return e!==t}))}}},t}(),Pn=new WeakMap;function _n(t){var e=t.target,n=t.parameters,o=n[0],i=n[1];Pn.set(e,{state:"open",method:String(o).toUpperCase(),url:he(String(i))})}function Ln(t){var e=t.target,n=Pn.get(e);n&&(n.isAborted=!0)}var On={};function Rn(t,e,n){var o,i,r,a=t.map((function(t){return function(t){return"string"==typeof t?Pe(t):t instanceof Error?Me(ve(t)):le(Pe(t),void 0,2)}(t)})).join(" ");if(e===V.error){var s=function(t,e){for(var n=0;n<t.length;n+=1){var o=t[n];if(e(o))return o}}(t,(function(t){return t instanceof Error}));o=s?Fe(ve(s)):void 0,i=Re(s),r=s?Ne(s,"console"):void 0}return{api:e,message:a,stack:o,handlingStack:n,fingerprint:i,causes:r}}var Fn=function(){function t(){this.buffer=[]}return t.prototype.add=function(t){this.buffer.push(t)>500&&this.buffer.splice(0,1)},t.prototype.remove=function(t){cn(this.buffer,t)},t.prototype.drain=function(t){this.buffer.forEach((function(e){return e(t)})),this.buffer.length=0},t}();function Mn(t){var e={},n=new Rt,o={getContext:function(){return Je(e)},setContext:function(i){"object"===We(i)?(e=Pe(i),t.updateCustomerData(e)):o.clearContext(),n.notify()},setContextProperty:function(o,i){e[o]=Pe(i),t.updateCustomerData(e),n.notify()},removeContextProperty:function(o){delete e[o],t.updateCustomerData(e),n.notify()},clearContext:function(){e={},t.resetCustomerData(),n.notify()},changeObservable:n};return o}var Dn=[];function Nn(t,e,n,o){var i=function(t,e){return"".concat("_dd_c","_").concat(t,"_").concat(e)}(n,o);function r(){var t=localStorage.getItem(i);return null!==t?JSON.parse(t):{}}Dn.push(je(t,window,$e.STORAGE,(function(t){var n=t.key;i===n&&e.setContext(r())}))),e.changeObservable.subscribe((function(){localStorage.setItem(i,JSON.stringify(e.getContext()))})),e.setContext(Ye(r(),e.getContext()))}function $n(t){var e=0,n=Mt((function(n){e=ut(le(n)),t()}),200),o=n.throttled,i=n.cancel,r=function(){i(),e=0};return{updateCustomerData:function(t){yt(t)?r():o(t)},resetCustomerData:r,getBytesCount:function(){return e},stop:function(){i()}}}function Bn(){return Boolean(window._DATADOG_SYNTHETICS_INJECTS_RUM||zt("datadog-synthetics-injects-rum"))}function Un(){var t=window._DATADOG_SYNTHETICS_RESULT_ID||zt("datadog-synthetics-result-id");return"string"==typeof t?t:void 0}function Hn(t){var e=bt({},t);return["id","name","email"].forEach((function(t){t in e&&(e[t]=String(e[t]))})),e}var qn={debug:"debug",error:"error",info:"info",warn:"warn"},jn="http",Gn=Object.keys(qn),zn=function(){function t(t,e,n,o,i,r){void 0===o&&(o=jn),void 0===i&&(i=qn.debug),void 0===r&&(r={}),this.handleLogStrategy=t,this.handlerType=o,this.level=i,this.contextManager=Mn(e),this.contextManager.setContext(r),n&&this.contextManager.setContextProperty("logger",{name:n})}return t.prototype.log=function(t,e,n,o){var i;if(void 0===n&&(n=qn.info),null!=o){var r=Oe({stackTrace:o instanceof Error?ve(o):void 0,originalError:o,nonErrorPrefix:"Provided",source:Ue,handling:"handled",startClocks:ct()});i={stack:r.stack,kind:r.type,message:r.message,causes:r.causes}}var a=Pe(e),s=i?Ye({error:i},a):a;this.handleLogStrategy({message:Pe(t),context:s,status:n},this)},t.prototype.debug=function(t,e,n){this.log(t,e,qn.debug,n)},t.prototype.info=function(t,e,n){this.log(t,e,qn.info,n)},t.prototype.warn=function(t,e,n){this.log(t,e,qn.warn,n)},t.prototype.error=function(t,e,n){this.log(t,e,qn.error,n)},t.prototype.setContext=function(t){this.contextManager.setContext(t)},t.prototype.getContext=function(){return this.contextManager.getContext()},t.prototype.setContextProperty=function(t,e){this.contextManager.setContextProperty(t,e)},t.prototype.removeContextProperty=function(t){this.contextManager.removeContextProperty(t)},t.prototype.clearContext=function(){this.contextManager.clearContext()},t.prototype.setHandler=function(t){this.handlerType=t},t.prototype.getHandler=function(){return this.handlerType},t.prototype.setLevel=function(t){this.level=t},t.prototype.getLevel=function(){return this.level},function(t,e,n,o){var i,r=arguments.length,a=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);r>3&&a&&Object.defineProperty(e,n,a)}([St],t.prototype,"log",null),t}();function Xn(t,e,n){return void 0===t?[]:"all"===t||Array.isArray(t)&&t.every((function(t){return ht(e,t)}))?"all"===t?e:(o=t,i=new Set,o.forEach((function(t){return i.add(t)})),ft(i)):void Z.error("".concat(n,' should be "all" or an array with allowed values "').concat(e.join('", "'),'"'));var o,i}function Vn(t){return ot(t.sessionSampleRate)?"1":"0"}var Wn,Kn=!1;function Jn(t){var e,n=window;if(Bn()){var o=i(n.DD_RUM_SYNTHETICS);return o||Kn||(Kn=!0,on("Logs sent before RUM is injected by the synthetics worker",{testId:(e=window._DATADOG_SYNTHETICS_PUBLIC_ID||zt("datadog-synthetics-public-id"),"string"==typeof e?e:void 0),resultId:Un()})),o}return i(n.DD_RUM);function i(e){if(e&&e.getInternalContext)return e.getInternalContext(t)}}var Yn,Zn=((Wn={})[V.log]=qn.info,Wn[V.debug]=qn.debug,Wn[V.info]=qn.info,Wn[V.warn]=qn.warn,Wn[V.error]=qn.error,Wn),Qn=((Yn={})[ze.cspViolation]=qn.error,Yn[ze.intervention]=qn.error,Yn[ze.deprecation]=qn.warn,Yn);function to(t,e){return t.length>e.requestErrorResponseLengthLimit?"".concat(t.substring(0,e.requestErrorResponseLengthLimit),"..."):t}function eo(t){return"xhr"===t?"XHR":"Fetch"}var no,oo=Tn,io=((no={})[qn.debug]=0,no[qn.info]=1,no[qn.warn]=2,no[qn.error]=3,no);function ro(t,e,n){var o=n.getHandler(),i=Array.isArray(o)?o:[o];return io[t]>=io[n.getLevel()]&&ht(i,e)}var ao,so,co,lo,uo,ho,fo,po,mo=function(t){var e,n,o=function(t){void 0===t&&(t=2);var e=new Map,n=!1;function o(o){if(void 0===o&&(o=0),!n&&0!==t){var i=2===t?3072:16384,r=o;e.forEach((function(t){r+=t.getBytesCount()})),r>i&&(function(t){Z.warn("Customer data exceeds the recommended ".concat(t/1024,"KiB threshold. More details: https://docs.datadoghq.com/real_user_monitoring/browser/troubleshooting/#customer-data-exceeds-the-recommended-threshold-warning"))}(i),n=!0)}}return{createDetachedTracker:function(){var t=$n((function(){return o(t.getBytesCount())}));return t},getOrCreateTracker:function(t){return e.has(t)||e.set(t,$n(o)),e.get(t)},setCompressionStatus:function(e){0===t&&(t=e,o())},getCompressionStatus:function(){return t},stop:function(){e.forEach((function(t){return t.stop()})),e.clear()}}}(),i=Mn(o.getOrCreateTracker(2)),r=Mn(o.getOrCreateTracker(1)),a={tryToInit:function(t){e||(e=t)},update:function(t){e=t,n.notify()},isGranted:function(){return e===de.GRANTED},observable:n=new Rt};function s(){return function(t,e){return{view:{referrer:document.referrer,url:window.location.href},context:t.getContext(),user:e.getContext()}}(i,r)}var c,d,l=function(t,e,n){var o,i,r=new Fn,a=e.observable.subscribe(s);function s(){if(i&&o&&e.isGranted()){a.unsubscribe();var t=n(o,i);r.drain(t)}}return{init:function(t){if(t)if(wn()&&(t=function(t){return bt({},t,{clientToken:"empty"})}(t)),o=t,i)qe("DD_LOGS",t);else{var n=function(t){var e=function(t){var e,n,o,i;if(t&&t.clientToken)if(void 0===t.sessionSampleRate||it(t.sessionSampleRate))if(void 0===t.telemetrySampleRate||it(t.telemetrySampleRate))if(void 0===t.telemetryConfigurationSampleRate||it(t.telemetryConfigurationSampleRate)){if(void 0===t.trackingConsent||gt(de,t.trackingConsent))return Array.isArray(t.enableExperimentalFeatures)&&t.enableExperimentalFeatures.filter((function(t){return gt(J,t)})).forEach((function(t){et.add(t)})),bt({beforeSend:t.beforeSend&&Q(t.beforeSend,"beforeSend threw an error:"),sessionStoreStrategyType:ce(t),sessionSampleRate:null!==(e=t.sessionSampleRate)&&void 0!==e?e:100,telemetrySampleRate:null!==(n=t.telemetrySampleRate)&&void 0!==n?n:20,telemetryConfigurationSampleRate:null!==(o=t.telemetryConfigurationSampleRate)&&void 0!==o?o:5,service:t.service,silentMultipleInit:!!t.silentMultipleInit,allowUntrustedEvents:!!t.allowUntrustedEvents,trackingConsent:null!==(i=t.trackingConsent)&&void 0!==i?i:de.GRANTED,batchBytesLimit:16384,eventRateLimiterThreshold:3e3,maxTelemetryEventsPerPage:15,flushTimeout:3e4,batchMessagesLimit:50,messageBytesLimit:262144},function(t){var e=function(t){var e=t.env,n=t.service,o=t.version,i=t.datacenter,r=[];return e&&r.push(ge("env",e)),n&&r.push(ge("service",n)),o&&r.push(ge("version",o)),i&&r.push(ge("datacenter",i)),r}(t),n=function(t,e){return{logsEndpointBuilder:me(t,"logs",e),rumEndpointBuilder:me(t,"rum",e),sessionReplayEndpointBuilder:me(t,"replay",e)}}(t,e),o=pt(n).map((function(t){return t.urlPrefix})),i=function(t,e,n){if(t.replica){var o=bt({},t,{site:"datadoghq.com",clientToken:t.replica.clientToken}),i={logsEndpointBuilder:me(o,"logs",n),rumEndpointBuilder:me(o,"rum",n)};return e.push.apply(e,pt(i).map((function(t){return t.urlPrefix}))),bt({applicationId:t.replica.applicationId},i)}}(t,o,e);return bt({isIntakeUrl:function(t){return o.some((function(e){return 0===t.indexOf(e)}))},replica:i,site:t.site||"datadoghq.com"},n)}(t));Z.error('Tracking Consent should be either "granted" or "not-granted"')}else Z.error("Telemetry Configuration Sample Rate should be a number between 0 and 100");else Z.error("Telemetry Sample Rate should be a number between 0 and 100");else Z.error("Session Sample Rate should be a number between 0 and 100");else Z.error("Client Token is not configured, we will not send any data.")}(t),n=Xn(t.forwardConsoleLogs,pt(V),"Forward Console Logs"),o=Xn(t.forwardReports,pt(ze),"Forward Reports");if(e&&n&&o)return t.forwardErrorsToLogs&&!ht(n,V.error)&&n.push(V.error),bt({forwardErrorsToLogs:!1!==t.forwardErrorsToLogs,forwardConsoleLogs:n,forwardReports:o,requestErrorResponseLengthLimit:32768},e)}(t);n&&(i=n,e.tryToInit(n.trackingConsent),s())}else Z.error("Missing configuration")},get initConfiguration(){return o},getInternalContext:Dt,handleLog:function(e,n,o,i){void 0===o&&(o=t()),void 0===i&&(i=at()),r.add((function(t){return t.handleLog(e,n,o,i)}))}}}(s,a,(function(t,e){t.storeContextsAcrossPages&&(Nn(e,i,"logs",2),Nn(e,r,"logs",1));var n=function(t,e,n,o){var i=new oo,r=[];i.subscribe(1,(function(t){return Ve("logs",t)}));var a=function(t){return function(e){t.notify(0,{rawLogsEvent:{message:e.message,date:e.startClocks.timeStamp,origin:Be,status:qn.error}}),on("Error reported to customer",{"error.message":e.message})}}(i),s=function(t){return new Rt((function(e){var n=nt(J.PAGEHIDE),o=Ge(t,window,[$e.VISIBILITY_CHANGE,$e.FREEZE,$e.PAGE_HIDE],(function(t){t.type===$e.PAGE_HIDE&&n?e.notify({reason:kn.PAGEHIDE}):t.type===$e.VISIBILITY_CHANGE&&"hidden"===document.visibilityState?e.notify({reason:kn.HIDDEN}):t.type===$e.FREEZE&&e.notify({reason:kn.FROZEN})}),{capture:!0}).stop,i=Dt;return n||(i=je(t,window,$e.BEFORE_UNLOAD,(function(){e.notify({reason:kn.UNLOADING})})).stop),function(){o(),i()}}))}(e),c=!e.sessionStoreStrategyType||wn()||Bn()?function(t){var e="1"===Vn(t)?{}:void 0;return{findTrackedSession:function(){return e},expireObservable:new Rt}}(e):function(t,e){var n=ln(t,"logs",(function(e){return function(t,e){var n=function(t){return"0"===t||"1"===t}(e)?e:Vn(t);return{trackingType:n,isTracked:"1"===n}}(t,e)}),e);return{findTrackedSession:function(t){var e=n.findActiveSession(t);return e&&"1"===e.trackingType?{id:e.id}:void 0},expireObservable:n.expireObservable}}(e,o),d=function(t,e,n,o,i){var r=function(t,e){var n,o=new Rt;nn.telemetryEnabled=!ht(en,e.site)&&ot(e.telemetrySampleRate),nn.telemetryConfigurationEnabled=nn.telemetryEnabled&&ot(e.telemetryConfigurationSampleRate);var i={is_local_file:"file:"===window.location.protocol,is_worker:"WorkerGlobalScope"in self};return Qe=function(t){if(nn.telemetryEnabled){var e=function(t,e,o){return Ye({type:"telemetry",date:at(),service:"browser-logs-sdk",version:"5.11.0",source:"browser",_dd:{format_version:2},telemetry:Ye(e,{runtime_env:o,connectivity:Ze()}),experimental_features:ft(et)},void 0!==n?n():{})}(0,t,i);o.notify(e),Ve("telemetry",e)}},kt=rn,bt(nn,{maxEventsPerPage:e.maxTelemetryEventsPerPage,sentEventCount:0}),{setContextProvider:function(t){n=t},observable:o,enabled:nn.telemetryEnabled}}(0,e);r.setContextProvider((function(){var t,e,n,o,r,a;return{application:{id:null===(t=Jn())||void 0===t?void 0:t.application_id},session:{id:null===(e=i.findTrackedSession())||void 0===e?void 0:e.id},view:{id:null===(o=null===(n=Jn())||void 0===n?void 0:n.view)||void 0===o?void 0:o.id},action:{id:null===(a=null===(r=Jn())||void 0===r?void 0:r.user_action)||void 0===a?void 0:a.id}}}));var a=[];if(wn()){var s=vn(),c=r.observable.subscribe((function(t){return s.send("internal_telemetry",t)}));a.push((function(){return c.unsubscribe()}))}else{var d=En(e,{endpoint:e.rumEndpointBuilder,encoder:Sn()},e.replica&&{endpoint:e.replica.rumEndpointBuilder,encoder:Sn()},n,o,i.expireObservable);a.push((function(){return d.stop()}));var l=r.observable.subscribe((function(t){return d.add(t,function(t){return"datad0g.com"===t.site}(e))}));a.push((function(){return l.unsubscribe()}))}return function(t){nn.telemetryConfigurationEnabled&&an({type:"configuration",configuration:t})}(function(t){var e,n={session_sample_rate:(e=t).sessionSampleRate,telemetry_sample_rate:e.telemetrySampleRate,telemetry_configuration_sample_rate:e.telemetryConfigurationSampleRate,use_before_send:!!e.beforeSend,use_cross_site_session_cookie:e.useCrossSiteSessionCookie,use_partitioned_cross_site_session_cookie:e.usePartitionedCrossSiteSessionCookie,use_secure_session_cookie:e.useSecureSessionCookie,use_proxy:!!e.proxy,silent_multiple_init:e.silentMultipleInit,track_session_across_subdomains:e.trackSessionAcrossSubdomains,allow_fallback_to_local_storage:!!e.allowFallbackToLocalStorage,store_contexts_across_pages:!!e.storeContextsAcrossPages,allow_untrusted_events:!!e.allowUntrustedEvents};return bt({forward_errors_to_logs:t.forwardErrorsToLogs,forward_console_logs:t.forwardConsoleLogs,forward_reports:t.forwardReports},n)}(t)),{telemetry:r,stop:function(){a.forEach((function(t){return t()}))}}}(t,e,a,s,c).stop;r.push((function(){return d()})),function(t,e){if(!t.forwardErrorsToLogs)return{stop:Dt};var n=function(t){return In||(In=function(t){return new Rt((function(e){var n=ye(XMLHttpRequest.prototype,"open",_n).stop,o=ye(XMLHttpRequest.prototype,"send",(function(n){!function(t,e,n){var o=t.target,i=Pn.get(o);if(i){var r=i;r.state="start",r.startClocks=ct(),r.isAborted=!1,r.xhr=o;var a=!1,s=ye(o,"onreadystatechange",(function(){o.readyState===XMLHttpRequest.DONE&&c()})).stop,c=function(){if(d(),s(),!a){a=!0;var t,e=i;e.state="complete",e.duration=(t=r.startClocks.timeStamp,at()-t),e.status=o.status,n.notify(bt({},e))}},d=je(e,o,"loadend",c).stop;n.notify(r)}}(n,t,e)})).stop,i=ye(XMLHttpRequest.prototype,"abort",Ln).stop;return function(){n(),o(),i()}}))}(t)),In}(t).subscribe((function(t){"complete"===t.state&&i("xhr",t)})),o=(An||(An=new Rt((function(t){if(window.fetch){var e=ye(window,"fetch",(function(e){return function(t,e){var n=t.parameters,o=t.onPostCall,i=n[0],r=n[1],a=r&&r.method;void 0===a&&i instanceof Request&&(a=i.method);var s=void 0!==a?String(a).toUpperCase():"GET",c=i instanceof Request?i.url:he(String(i)),d={state:"start",init:r,input:i,method:s,startClocks:ct(),url:c};e.notify(d),n[0]=d.input,n[1]=d.init,o((function(t){return function(t,e,n){var o=function(e){var o=n;o.state="resolve","stack"in e||e instanceof Error?(o.status=0,o.isAborted=e instanceof DOMException&&e.code===DOMException.ABORT_ERR,o.error=e):"status"in e&&(o.response=e,o.responseType=e.type,o.status=e.status,o.isAborted=!1),t.notify(o)};e.then(It(o),It(o))}(e,t,d)}))}(e,t)})).stop;return e}}))),An).subscribe((function(t){"resolve"===t.state&&i("fetch",t)}));function i(n,o){function i(t){e.notify(0,{rawLogsEvent:{message:"".concat(eo(n)," error ").concat(o.method," ").concat(o.url),date:o.startClocks.timeStamp,error:{stack:t||"Failed to load"},http:{method:o.method,status_code:o.status,url:o.url},status:qn.error,origin:"network"}})}t.isIntakeUrl(o.url)||!function(t){return 0===t.status&&"opaque"!==t.responseType}(o)&&!un(o.status)||("xhr"in o?function(t,e,n){"string"==typeof t.response?n(to(t.response,e)):n(t.response)}(o.xhr,t,i):o.response?function(t,e,n){var o=function(t){try{return t.clone()}catch(t){return}}(t);o&&o.body?window.TextDecoder?function(t,e,n){!function(t,e,n){var o=t.getReader(),i=[],r=0;function a(){var t,a;if(o.cancel().catch(Dt),n.collectStreamBody){var s;if(1===i.length)s=i[0];else{s=new Uint8Array(r);var c=0;i.forEach((function(t){s.set(t,c),c+=t.length}))}t=s.slice(0,n.bytesLimit),a=s.length>n.bytesLimit}e(void 0,t,a)}!function t(){o.read().then(It((function(e){e.done?a():(n.collectStreamBody&&i.push(e.value),(r+=e.value.length)>n.bytesLimit?a():t())})),It((function(t){return e(t)})))}()}(t,(function(t,e,o){if(t)n(t);else{var i=(new TextDecoder).decode(e);o&&(i+="..."),n(void 0,i)}}),{bytesLimit:e,collectStreamBody:!0})}(o.body,e.requestErrorResponseLengthLimit,(function(t,e){n(t?"Unable to retrieve response: ".concat(t):e)})):o.text().then(It((function(t){return n(to(t,e))})),It((function(t){return n("Unable to retrieve response: ".concat(t))}))):n()}(o.response,t,i):o.error&&function(t,e,n){n(to(Fe(ve(t)),e))}(o.error,t,i))}}(e,i),function(t,e){if(!t.forwardErrorsToLogs)return{stop:Dt};var n=new Rt;(function(t){var e,n=function(e,n){var o=Oe({stackTrace:e,originalError:n,startClocks:ct(),nonErrorPrefix:"Uncaught",source:He,handling:"unhandled"});t.notify(o)},o=(e=n,ye(window,"onerror",(function(t){var n,o=t.parameters,i=o[0],r=o[1],a=o[2],s=o[3],c=o[4];n=c instanceof Error?ve(c):function(t,e,n,o){var i=[{url:e,column:o,line:n}],r=function(t){var e,n,o;return"[object String]"==={}.toString.call(t)&&(n=(e=Te.exec(t))[1],o=e[2]),{name:n,message:o}}(t);return{name:r.name,message:r.message,stack:i}}(i,r,a,s),e(n,null!=c?c:i)}))).stop,i=function(t){return ye(window,"onunhandledrejection",(function(e){var n=e.parameters[0].reason||"Empty reason",o=ve(n);t(o,n)}))}(n).stop;return{stop:function(){o(),i()}}})(n).stop,n.subscribe((function(t){e.notify(0,{rawLogsEvent:{message:t.message,date:t.startClocks.timeStamp,error:{kind:t.type,stack:t.stack,causes:t.causes},origin:He,status:qn.error}})}))}(e,i),function(t,e){(function(t){var e=t.map((function(t){return On[t]||(On[t]=function(t){return new Rt((function(e){var n=W[t];return W[t]=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];n.apply(console,o);var r=De();At((function(){e.notify(Rn(o,t,r))}))},function(){W[t]=n}}))}(t)),On[t]}));return Ft.apply(void 0,e)})(t.forwardConsoleLogs).subscribe((function(t){e.notify(0,{rawLogsEvent:{date:at(),message:t.message,origin:"console",error:t.api===V.error?{stack:t.stack,fingerprint:t.fingerprint,causes:t.causes}:void 0,status:Zn[t.api]}})}))}(e,i),function(t,e){(function(t,e){var n=[];ht(e,ze.cspViolation)&&n.push(function(t){return new Rt((function(e){return je(t,document,$e.SECURITY_POLICY_VIOLATION,(function(t){e.notify(function(t){var e=ze.cspViolation,n="'".concat(t.blockedURI,"' blocked by '").concat(t.effectiveDirective,"' directive");return{type:ze.cspViolation,subtype:t.effectiveDirective,message:"".concat(e,": ").concat(n),stack:Xe(t.effectiveDirective,t.originalPolicy?"".concat(n,' of the policy "').concat(qt(t.originalPolicy,100,"..."),'"'):"no policy",t.sourceFile,t.lineNumber,t.columnNumber),originalReport:t}}(t))})).stop}))}(t));var o=e.filter((function(t){return t!==ze.cspViolation}));return o.length&&n.push(function(t){return new Rt((function(e){if(window.ReportingObserver){var n=It((function(t,n){return t.forEach((function(t){e.notify(function(t){var e=t.type,n=t.body;return{type:e,subtype:n.id,message:"".concat(e,": ").concat(n.message),originalReport:t,stack:Xe(n.id,n.message,n.sourceFile,n.lineNumber,n.columnNumber)}}(t))}))})),o=new window.ReportingObserver(n,{types:t,buffered:!0});return o.observe(),function(){o.disconnect()}}}))}(o)),Ft.apply(void 0,n)})(t,t.forwardReports).subscribe((function(t){var n,o=t.message,i=Qn[t.type];i===qn.error?n={kind:t.subtype,stack:t.stack}:t.stack&&(o+=" Found in ".concat(function(t){var e;return null===(e=/@ (.+)/.exec(t))||void 0===e?void 0:e[1]}(t.stack))),e.notify(0,{rawLogsEvent:{date:at(),message:o,origin:"report",error:n,status:i}})}))}(e,i);var l,u=function(t){return{handleLog:function(e,n,o,i){var r=Ye(n.getContext(),e.context);ro(e.status,"console",n)&&function(t,e){K[t.status].call(W,t.message,e)}(e,r),ro(e.status,jn,n)&&t.notify(0,{rawLogsEvent:{date:i||at(),message:e.message,status:e.status,origin:Ue},messageContext:r,savedCommonContext:o})}}}(i).handleLog;if(function(t,e,n,o,i){var r=Gn.concat(["custom"]),a={};r.forEach((function(t){var n,o,r,s,c;a[t]=(n=t,o=e.eventRateLimiterThreshold,r=i,s=0,c=!1,{isLimitReached:function(){if(0===s&&Pt((function(){s=0}),6e4),(s+=1)<=o||c)return c=!1,!1;if(s===o+1){c=!0;try{r({message:"Reached max number of ".concat(n,"s by minute: ").concat(o),source:Be,startClocks:ct()})}finally{c=!1}}return!0}})})),n.subscribe(0,(function(i){var r,s,c=i.rawLogsEvent,d=i.messageContext,l=void 0===d?void 0:d,u=i.savedCommonContext,h=void 0===u?void 0:u,f=c.date-dt(),p=t.findTrackedSession(f);if(p){var m=h||o(),b=Ye({service:e.service,session_id:p.id,usr:yt(m.user)?void 0:m.user,view:m.view},m.context,Jn(f),c,l);!1===(null===(r=e.beforeSend)||void 0===r?void 0:r.call(e,b))||b.origin!==Be&&(null!==(s=a[b.status])&&void 0!==s?s:a.custom).isLimitReached()||n.notify(1,b)}}))}(c,e,i,n,a),wn())!function(t){var e=vn();t.subscribe(1,(function(t){e.send("log",t)}))}(i);else{var h=function(t,e,n,o,i){var r=En(t,{endpoint:t.logsEndpointBuilder,encoder:Sn()},t.replica&&{endpoint:t.replica.logsEndpointBuilder,encoder:Sn()},n,o,i.expireObservable);return e.subscribe(1,(function(t){r.add(t)})),r}(e,i,a,s,c).stop;r.push((function(){return h()}))}return{handleLog:u,getInternalContext:(l=c,{get:function(t){var e=l.findTrackedSession(t);if(e)return{session_id:e.id}}}).get,stop:function(){r.forEach((function(t){return t()}))}}}(t,e,s,a);return l=function(t,e){return bt({init:function(t){qe("DD_LOGS",t)},initConfiguration:t},e)}(t,n),n})),u={},h=new zn((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l.handleLog.apply(l,t)}),o.createDetachedTracker());return c={logger:h,init:It((function(t){return l.init(t)})),setTrackingConsent:It((function(t){return a.update(t)})),getGlobalContext:It((function(){return i.getContext()})),setGlobalContext:It((function(t){return i.setContext(t)})),setGlobalContextProperty:It((function(t,e){return i.setContextProperty(t,e)})),removeGlobalContextProperty:It((function(t){return i.removeContextProperty(t)})),clearGlobalContext:It((function(){return i.clearContext()})),createLogger:It((function(t,e){return void 0===e&&(e={}),u[t]=new zn((function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return l.handleLog.apply(l,t)}),o.createDetachedTracker(),Pe(t),e.handler,e.level,Pe(e.context)),u[t]})),getLogger:It((function(t){return u[t]})),getInitConfiguration:It((function(){return Je(l.initConfiguration)})),getInternalContext:It((function(t){return l.getInternalContext(t)})),setUser:It((function(t){(function(t){var e="object"===We(t);return e||Z.error("Unsupported user:",t),e})(t)&&r.setContext(Hn(t))})),getUser:It((function(){return r.getContext()})),setUserProperty:It((function(t,e){var n,o=Hn((n={},n[t]=e,n))[t];r.setContextProperty(t,o)})),removeUserProperty:It((function(t){return r.removeContextProperty(t)})),clearUser:It((function(){return r.clearContext()}))},d=bt({version:"5.11.0",onReady:function(t){t()}},c),Object.defineProperty(d,"_setDebug",{get:function(){return Et},enumerable:!1}),d}();ao=vt(),so=mo,co=ao.DD_LOGS,ao.DD_LOGS=so,co&&co.q&&co.q.forEach((function(t){return Q(t,"onReady callback threw an error:")()}));class bo{static init(t,e,n){if(bo.context={},bo.enabled=t,bo.clientToken=n,_(bo.clientToken)&&(bo.isDatadogEnabled=!1),!bo.isDatadogEnabled)try{mo.onReady((()=>{mo.init({clientToken:bo.clientToken,service:"shopify-storefront",site:"datadoghq.com",env:e,forwardErrorsToLogs:!1,sessionSampleRate:100}),bo.isDatadogEnabled=!0}))}catch(t){bo.error("Logger",t.toString())}}static publishDebug(t,e){mo.onReady((()=>mo.logger.debug(t,{...bo.context,...e})))}static publishInfo(t,e){mo.onReady((()=>mo.logger.info(t,{...bo.context,...e})))}static publishWarn(t,e){mo.onReady((()=>mo.logger.warn(t,{...bo.context,...e})))}static publishError(t,e){mo.onReady((()=>mo.logger.error(t,{...bo.context,...e})))}static debug(t,e,n){if(!bo.enabled)return;const o=`FONDUE | [${t}] DEBUG: ${e}`;bo.enabled&&console.debug(`%c ${this.currentDate()} | ${o}${this.addMetaFields(n)}`,"background: #FACC14; color: #000596"),bo.isDatadogEnabled&&bo.publishDebug(o,n)}static info(t,e,n){if(!bo.enabled)return;const o=`FONDUE | [${t}]: ${e}`;bo.enabled&&console.log(`%c ${this.currentDate()} | ${o}${this.addMetaFields(n)}`,"background: #FACC14; color: #423121"),bo.isDatadogEnabled&&bo.publishInfo(o,n)}static warn(t,e,n){const o=`FONDUE | [${t}] WARN: ${e} `;bo.isDatadogEnabled&&bo.publishWarn(o,n),bo.enabled&&console.warn(`%c ${this.currentDate()} | ${o}${this.addMetaFields(n)}`,"background: #FACC14; color: brown")}static error(t,e,n){const o=`FONDUE | [${t}] ERROR: ${e} `;bo.isDatadogEnabled&&bo.publishError(o,n),bo.enabled&&console.error(`%c ${this.currentDate()} | ${o}${this.addMetaFields(n)}`,"background: #FACC14; color: red")}static report(t,e,n){const o=`[${t}] REPORTING: ${e}`;bo.isDatadogEnabled&&bo.publishInfo(o,n)}static addMetaFields(t){return _(t)?"":`, [meta-fields]: ${JSON.stringify(t)}`}static currentDate(){return(new Date).toISOString()}static addContext(t,e){_(bo.context)&&(bo.context={}),bo.context[t]=e}}function go(t){return{type:"ok",data:t}}function yo(t){return{type:"error",message:t}}function vo(t){return"error"===t.type}bo.enabled=!1,bo.isDatadogEnabled=!1;class wo{constructor(t,e,n,o,i){this.fondueApi=t,this.fondueUtils=e,this.storage=n,this.cartClient=o,this.persister=i,this.LOG_PREFIX="CashbackProductService"}async getAndPersist(t,e){bo.info(this.LOG_PREFIX,"Extracting and store cb");const n=await this.fetchCashbackProduct(t,e);if(vo(n))return void bo.warn(this.LOG_PREFIX,n.message,{code:t});const o=n.data;return this.persister.persist(o),await this.updateCartNoteAttributes(o.publicId),o}async fetchCashbackProduct(t,e){const n=await this.fondueApi.getPromotion(t,e);if(vo(n))return bo.warn(this.LOG_PREFIX,n.message,{code:t}),n;if(void 0===n.data.data[t])return bo.info(this.LOG_PREFIX,"no data return from fondue api"),yo("no data return from fondue api");const o=n.data.data[t];return go({publicId:o.publicId,variantId:o.cashbackVariantId,amount:o.amount,currency:o.currency,unit:o.unit,target:o.target,appliedRule:o.appliedRule})}get(){return this.storage.getItem(this.fondueUtils.cashbackProductStorageKey)}async addToCart(t,e,n){return n?e.items.find((e=>e.variantId===t))?go(void 0):(await this.removeAllFromCart(e.items),await this.cartClient.add(t,1)):await this.cartClient.add(t,1)}async injectCashbackOnload(t,e,n){return _(t)||!e?(bo.info(this.LOG_PREFIX,"no cashback item found, return"),go(void 0)):(bo.info(this.LOG_PREFIX,"injecting cashback to cart on load"),await this.addToCart(t.variantId,n,!0))}async removeAllFromCart(t){return await this.cartClient.remove(t)}async updateCartNoteAttributes(t){const e=this.storage.getItem(this.fondueUtils.noteAttributesKeys.shopperSession),n=[{key:this.fondueUtils.noteAttributesKeys.promotionToken,value:t},{key:this.fondueUtils.noteAttributesKeys.shopperSession,value:e}],o=await this.cartClient.updateNotes(n);vo(o)&&bo.error(this.LOG_PREFIX,"Unable to add cart note attributes with the current code",{error:o,promotionToken:t})}}class ko{constructor(t){this.fondueUtils=t}isCashbackProduct(t){return(t.productType&&t.productType.includes(this.fondueUtils.cashbackProductTypePrefix)||t.vendor&&t.vendor.includes(this.fondueUtils.vendor))??!1}static build(){return new ko(M)}}!function(t){t.Any="ANY",t.Field="FIELD"}(lo||(lo={})),lo.Any;class xo{constructor(t){this.cashbackProductUtils=t}isEligible(t){return!this.cashbackProductUtils.isCashbackProduct(t)}}!function(t){t.LineItems="LINE_ITEM",t.Collection="COLLECTION"}(uo||(uo={}));class Co{constructor(t){this.lineItemEligibilityChecker=t}isEligible(t,e){return e.value.map((n=>{const o={fieldName:uo.LineItems,type:lo.Field,operator:e.operator,value:n.lineItems};return this.lineItemEligibilityChecker.isEligible(t,o)})).every((t=>t))}}!function(t){t.LineItems="LINE_ITEM",t.Collection="COLLECTION"}(ho||(ho={}));class Eo{constructor(t,e){this.lineItemsEligibilityChecker=t,this.collectionsEligibilityChecker=e}isEligible(t,e){return T(e).with({fieldName:ho.LineItems},(e=>this.lineItemsEligibilityChecker.isEligible(t,e))).with({fieldName:ho.Collection},(e=>this.collectionsEligibilityChecker.isEligible(t,e))).exhaustive()}}!function(t){t.Includes="INCLUDES",t.Excludes="EXCLUDES"}(fo||(fo={}));class So{constructor(t){this.cashbackProductUtils=t}isEligible(t,e){if(this.cashbackProductUtils.isCashbackProduct(t))return!1;const n=this.extractVariantIds(e);return T(e).with({operator:fo.Excludes},(()=>!n.includes(t.variantId))).with({operator:fo.Includes},(()=>n.includes(t.variantId))).exhaustive()}extractVariantIds(t){let e=[];for(const n of t.value)e=[...e,...n.variantIds];return e}}class Io{constructor(t,e){this.anyEligibilityChecker=t,this.fieldEligibilityChecker=e}isEligible(t,e){return T(e).with({type:lo.Any},(e=>this.anyEligibilityChecker.isEligible(t,e))).with({type:lo.Field},(e=>this.fieldEligibilityChecker.isEligible(t,e))).exhaustive()}static build(){const t=ko.build(),e=new So(t);return new Io(new xo(t),new Eo(e,new Co(e)))}}class Ao{dispatch(t){const e={detail:{cartData:t}},n=new CustomEvent(M.events.internal.fondueCartUpdated,e);document.dispatchEvent(n)}}!function(t){t.ModalOpened="EXTENSION_MODAL_OPENED",t.ModalClosed="EXTENSION_MODAL_CLOSED"}(po||(po={}));class To{constructor(t,e,n,o){this.url=t,this.shopDomain=e,this.version=n,this.fondueUtils=o,this.headers={"Content-Type":"application/json","x-fondue-version":this.version}}async storeFrontSettings(){try{const t=await j.getInstance().get(),e=await fetch(`${this.url}/cashback/settings?shop=${this.shopDomain}`,{method:"GET",headers:{...this.headers,"x-session-id":t}});return go(JSON.parse(JSON.stringify(await e.json())))}catch(t){return yo(`Unable to get store: [${this.shopDomain}] settings - Error: ${JSON.stringify(t)}`)}}async cart(t){try{const e=JSON.stringify({cartItems:t}),n=await fetch(`${this.url}/cashback/cart?shop=${this.shopDomain}&${this.fondueUtils.requestIndicator}`,{method:"POST",body:e,headers:this.headers});return n.ok?go(await n.json()):yo(`Error while trying to get cart of store: [${this.shopDomain}] - Error: ${JSON.stringify(n)}`)}catch(t){return yo(`Unable to get store: [${this.shopDomain}] settings - Error: ${JSON.stringify(t)}`)}}async cartV2(t,e){try{const n=JSON.stringify({lineItems:t,promotionToken:e}),o=await fetch(`${this.url}/cashback/v2/cart?shop=${this.shopDomain}&${this.fondueUtils.requestIndicator}`,{method:"POST",body:n,headers:this.headers});return o.ok?go(await o.json()):yo(`Error while trying to get cart v2 of store: [${this.shopDomain}] - Error: ${JSON.stringify(o)}`)}catch(t){return yo(`Unable to get store: [${this.shopDomain}] settings - Error: ${JSON.stringify(t)}`)}}async getPromotion(t,e){try{const n=JSON.stringify({code:t,source:e.toString()}),o=await j.getInstance().get(),i=this.fondueUtils.requestIndicator,r=await fetch(`${this.url}/cashback/promotions?shop=${this.shopDomain}&${i}`,{method:"POST",body:n,headers:{...this.headers,"x-session-id":o}});return r.ok?go(JSON.parse(JSON.stringify(await r.json()))):yo(`Error while trying to fetch code [${t}] of store: [${this.shopDomain}] - Error: ${JSON.stringify(r)}`)}catch(e){return yo(`Unable to fetch code [${t}] of store: [${this.shopDomain}] - Error: ${JSON.stringify(e)}`)}}async attributeShopperToExperimentVariation(t){try{const e=JSON.stringify(t),n=await j.getInstance().get();if(!n)return bo.warn(this.constructor.name,"Failed to attribute shopper to experiment due to missing session ID",{custom:{payload:t}}),yo("Unable to attribute shopper to experiment due to missing session ID");const o=await fetch(`${this.url}/cashback/shopper-experiment?shop=${this.shopDomain}`,{method:"POST",body:e,headers:{...this.headers,"x-session-id":n}});if(!o.ok){const e=await o.json();return bo.warn(this.constructor.name,"Failed to attribute shopper to experiment",{custom:{payload:t,response:e}}),yo("Unable to attribute shopper to experiment")}return go(void 0)}catch(e){return bo.warn(this.constructor.name,"Failed to attribute shopper to experiment",{custom:{payload:t},error:e}),yo(`Unable to attribute shopper to experiment - Error: ${JSON.stringify(e)}`)}}async reportMetric(t){try{const e=T(t).with({type:po.ModalOpened,properties:A.select()},(t=>({eventType:po.ModalOpened,properties:{origin:t.origin}}))).with({type:po.ModalClosed,properties:A.select()},(t=>({eventType:po.ModalClosed,properties:{origin:t.origin}}))).exhaustive(),n=JSON.stringify(e),o=await j.getInstance().get();if(!o)return bo.warn(this.constructor.name,"Failed to report metric due to missing session ID",{custom:{payload:t}}),yo("Unable to report metric due to missing session ID");const i=await fetch(`${this.url}/cashback/metric?shop=${this.shopDomain}`,{method:"POST",body:n,headers:{...this.headers,"x-session-id":o}});if(!i.ok){const e=await i.json();return bo.warn(this.constructor.name,"Failed to report metric",{custom:{payload:t,response:e}}),yo("Unable to report metric")}return go(void 0)}catch(e){return bo.warn(this.constructor.name,"Failed to report metric",{custom:{payload:t},error:e}),yo(`Unable report metric - Error: ${JSON.stringify(e)}`)}}}var Po="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var _o={},Lo={};const Oo={staleTTL:6e4,cacheKey:"gbFeaturesCache",backgroundSync:!0},Ro={fetch:globalThis.fetch?globalThis.fetch.bind(globalThis):void 0,SubtleCrypto:globalThis.crypto?globalThis.crypto.subtle:void 0,EventSource:globalThis.EventSource};try{globalThis.localStorage&&(Ro.localStorage=globalThis.localStorage)}catch(Ja){}const Fo=new Map;let Mo=!1;const Do=new Map,No=new Map,$o=new Map,Bo=new Set;async function Uo(){try{if(!Ro.localStorage)return;await Ro.localStorage.setItem(Oo.cacheKey,JSON.stringify(Array.from(Do.entries())))}catch(t){}}function Ho(t){const[e,n]=t.getApiInfo();return["".concat(e,"||").concat(n),e,n]}function qo(t,e){const n=e.dateUpdated||"",o=new Date(Date.now()+Oo.staleTTL),i=Do.get(t);if(i&&n&&i.version===n)return i.staleAt=o,void Uo();Do.set(t,{data:e,version:n,staleAt:o,sse:Bo.has(t)}),Uo();const r=Fo.get(t);r&&r.forEach((t=>jo(t,e)))}async function jo(t,e){await(e.encryptedExperiments?t.setEncryptedExperiments(e.encryptedExperiments,void 0,Ro.SubtleCrypto):t.setExperiments(e.experiments||t.getExperiments())),await(e.encryptedFeatures?t.setEncryptedFeatures(e.encryptedFeatures,void 0,Ro.SubtleCrypto):t.setFeatures(e.features||t.getFeatures()))}async function Go(t){const[e,n,o]=Ho(t),i=n+"/api/features/"+o;let r=No.get(e);return r||(r=Ro.fetch(i).then((t=>("enabled"===t.headers.get("x-sse-support")&&Bo.add(e),t.json()))).then((n=>(qo(e,n),zo(t),No.delete(e),n))).catch((t=>(No.delete(e),Promise.resolve({})))),No.set(e,r)),await r}function zo(t){const[e,n,o]=Ho(t);if(Oo.backgroundSync&&Bo.has(e)&&Ro.EventSource){if($o.has(e))return;const t={src:null,cb:i=>{try{const n=JSON.parse(i.data);qo(e,n),t.errors=0}catch(i){Xo(t,n,o)}},errors:0};$o.set(e,t),Wo(t,n,o)}}function Xo(t,e,n){if(t.errors++,t.errors>3||t.src&&2===t.src.readyState){const o=Math.pow(3,t.errors-3)*(1e3+1e3*Math.random());Vo(t),setTimeout((()=>{Wo(t,e,n)}),Math.min(o,3e5))}}function Vo(t){t.src&&(t.src.onopen=null,t.src.onerror=null,t.src.close(),t.src=null)}function Wo(t,e,n){t.src=new Ro.EventSource("".concat(e,"/sub/").concat(n)),t.src.addEventListener("features",t.cb),t.src.onerror=()=>{Xo(t,e,n)},t.src.onopen=()=>{t.errors=0}}function Ko(t,e){Vo(t),$o.delete(e)}function Jo(){Bo.clear(),$o.forEach(Ko),Fo.clear()}var Yo=/^[a-zA-Z:_][a-zA-Z0-9:_.-]*$/,Zo={revert:function(){}},Qo=new Map,ti=new Set;function ei(t){var e=Qo.get(t);return e||(e={element:t,attributes:{}},Qo.set(t,e)),e}function ni(t,e,n,o,i){var r=n(t),a={isDirty:!1,originalValue:r,virtualValue:r,mutations:[],el:t,observer:new MutationObserver((function(){var e=n(t);e!==a.virtualValue&&(a.originalValue=e,i(a))})),mutationRunner:i,setValue:o,getCurrentValue:n};return a.observer.observe(t,function(t){return"html"===t?{childList:!0,subtree:!0,attributes:!0,characterData:!0}:{childList:!1,subtree:!1,attributes:!0,attributeFilter:[t]}}(e)),a}function oi(t,e){var n=e.getCurrentValue(e.el);e.virtualValue=t,t&&"string"!=typeof t?n&&t.parentNode===n.parentNode&&t.insertBeforeNode===n.insertBeforeNode||(e.isDirty=!0,Ei()):t!==n&&(e.isDirty=!0,Ei())}function ii(t){var e=t.originalValue;t.mutations.forEach((function(t){return e=t.mutate(e)})),oi(function(t){return pi||(pi=document.createElement("div")),pi.innerHTML=t,pi.innerHTML}(e),t)}function ri(t){var e=new Set(t.originalValue.split(/\s+/).filter(Boolean));t.mutations.forEach((function(t){return t.mutate(e)})),oi(Array.from(e).filter(Boolean).join(" "),t)}function ai(t){var e=t.originalValue;t.mutations.forEach((function(t){return e=t.mutate(e)})),oi(e,t)}function si(t){var e=t.originalValue;t.mutations.forEach((function(t){var n=function(t){var e=t.parentSelector,n=t.insertBeforeSelector,o=document.querySelector(e);if(!o)return null;var i=n?document.querySelector(n):null;return n&&!i?null:{parentNode:o,insertBeforeNode:i}}(t.mutate());e=n||e})),oi(e,t)}var ci=function(t){return t.innerHTML},di=function(t,e){return t.innerHTML=e};function li(t){var e=ei(t);return e.html||(e.html=ni(t,"html",ci,di,ii)),e.html}var ui=function(t){return{parentNode:t.parentElement,insertBeforeNode:t.nextElementSibling}},hi=function(t,e){e.parentNode.insertBefore(t,e.insertBeforeNode)};function fi(t){var e=ei(t);return e.position||(e.position=ni(t,"position",ui,hi,si)),e.position}var pi,mi=function(t,e){return e?t.className=e:t.removeAttribute("class")},bi=function(t){return t.className};function gi(t){var e=ei(t);return e.classes||(e.classes=ni(t,"class",bi,mi,ri)),e.classes}function yi(t,e){var n,o=ei(t);return o.attributes[e]||(o.attributes[e]=ni(t,e,(n=e,function(t){var e;return null!=(e=t.getAttribute(n))?e:null}),function(t){return function(e,n){return null!==n?e.setAttribute(t,n):e.removeAttribute(t)}}(e),ai)),o.attributes[e]}function vi(t,e,n){if(n.isDirty){n.isDirty=!1;var o=n.virtualValue;n.mutations.length||function(t,e){var n,o,i=Qo.get(t);if(i)if("html"===e)null==(n=i.html)||null==(o=n.observer)||o.disconnect(),delete i.html;else if("class"===e){var r,a;null==(r=i.classes)||null==(a=r.observer)||a.disconnect(),delete i.classes}else if("position"===e){var s,c;null==(s=i.position)||null==(c=s.observer)||c.disconnect(),delete i.position}else{var d,l,u;null==(d=i.attributes)||null==(l=d[e])||null==(u=l.observer)||u.disconnect(),delete i.attributes[e]}}(t,e),n.setValue(t,o)}}var wi,ki=!1;function xi(t,e){t.html&&vi(e,"html",t.html),t.classes&&vi(e,"class",t.classes),t.position&&vi(e,"position",t.position),Object.keys(t.attributes).forEach((function(n){vi(e,n,t.attributes[n])}))}function Ci(){ki=!1,Qo.forEach(xi)}function Ei(){ki||(ki=!0,requestAnimationFrame(Ci))}function Si(t,e){var n=null;if("html"===t.kind?n=li(e):"class"===t.kind?n=gi(e):"attribute"===t.kind?n=yi(e,t.attribute):"position"===t.kind&&(n=fi(e)),n){var o=n.mutations.indexOf(t);-1!==o&&n.mutations.splice(o,1),n.mutationRunner(n)}}function Ii(t){var e=new Set(t.elements),n=new Set;document.querySelectorAll(t.selector).forEach((function(o){n.add(o),e.has(o)||(t.elements.add(o),function(t,e){var n=null;"html"===t.kind?n=li(e):"class"===t.kind?n=gi(e):"attribute"===t.kind?n=yi(e,t.attribute):"position"===t.kind&&(n=fi(e)),n&&(n.mutations.push(t),n.mutationRunner(n))}(t,o))})),e.forEach((function(e){n.has(e)||(t.elements.delete(e),Si(t,e))}))}function Ai(){ti.forEach(Ii)}function Ti(t){return"undefined"==typeof document?Zo:(ti.add(t),Ii(t),{revert:function(){var e;(e=t).elements.forEach((function(t){return Si(e,t)})),e.elements.clear(),ti.delete(e)}})}function Pi(t,e){return Ti({kind:"html",elements:new Set,mutate:e,selector:t})}function _i(t,e){return Ti({kind:"class",elements:new Set,mutate:e,selector:t})}function Li(t,e,n){return Yo.test(e)?"class"===e||"className"===e?_i(t,(function(t){var e=n(Array.from(t).join(" "));t.clear(),e&&e.split(/\s+/g).filter(Boolean).forEach((function(e){return t.add(e)}))})):Ti({kind:"attribute",attribute:e,elements:new Set,mutate:n,selector:t}):Zo}"undefined"!=typeof document&&(wi||(wi=new MutationObserver((function(){Ai()}))),Ai(),wi.observe(document.documentElement,{childList:!0,subtree:!0,attributes:!1,characterData:!1}));var Oi=function(t){var e=t.selector,n=t.action,o=t.value,i=t.attribute,r=t.parentSelector,a=t.insertBeforeSelector;if("html"===i){if("append"===n)return Pi(e,(function(t){return t+(null!=o?o:"")}));if("set"===n)return Pi(e,(function(){return null!=o?o:""}))}else if("class"===i){if("append"===n)return _i(e,(function(t){o&&t.add(o)}));if("remove"===n)return _i(e,(function(t){o&&t.delete(o)}));if("set"===n)return _i(e,(function(t){t.clear(),o&&t.add(o)}))}else if("position"===i){if("set"===n&&r)return function(t,e){return Ti({kind:"position",elements:new Set,mutate:e,selector:t})}(e,(function(){return{insertBeforeSelector:a,parentSelector:r}}))}else{if("append"===n)return Li(e,i,(function(t){return null!==t?t+(null!=o?o:""):null!=o?o:""}));if("set"===n)return Li(e,i,(function(){return null!=o?o:""}));if("remove"===n)return Li(e,i,(function(){return null}))}return Zo};function Ri(t){let e=2166136261;const n=t.length;for(let o=0;o<n;o++)e^=t.charCodeAt(o),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}function Fi(t,e,n){return 2===n?Ri(Ri(t+e)+"")%1e4/1e4:1===n?Ri(e+t)%1e3/1e3:null}function Mi(t,e){return t>=e[0]&&t<e[1]}function Di(t){try{const e=t.replace(/([^\\])\//g,"$1\\/");return new RegExp(e)}catch(t){return void console.error(t)}}function Ni(t,e){if(!e.length)return!1;let n=!1,o=!1;for(let i=0;i<e.length;i++){const r=$i(t,e[i].type,e[i].pattern);if(!1===e[i].include){if(r)return!1}else n=!0,r&&(o=!0)}return o||!n}function $i(t,e,n){try{const o=new URL(t,"https://_");if("regex"===e){const t=Di(n);return!!t&&(t.test(o.href)||t.test(o.href.substring(o.origin.length)))}return"simple"===e&&function(t,e){try{const n=new URL(e.replace(/^([^:/?]*)\./i,"https://$1.").replace(/\*/g,"_____"),"https://_____"),o=[[t.host,n.host,!1],[t.pathname,n.pathname,!0]];return n.hash&&o.push([t.hash,n.hash,!1]),n.searchParams.forEach(((e,n)=>{o.push([t.searchParams.get(n)||"",e,!1])})),!o.some((t=>!function(t,e,n){try{let o=e.replace(/[*.+?^${}()|[\]\\]/g,"\\$&").replace(/_____/g,".*");return n&&(o="\\/?"+o.replace(/(^\/|\/$)/g,"")+"\\/?"),new RegExp("^"+o+"$","i").test(t)}catch(t){return!1}}(t[0],t[1],t[2])))}catch(t){return!1}}(o,n)}catch(t){return!1}}const Bi=t=>Uint8Array.from(atob(t),(t=>t.charCodeAt(0)));async function Ui(t,e,n){if(e=e||"",!(n=n||globalThis.crypto&&globalThis.crypto.subtle))throw new Error("No SubtleCrypto implementation found");try{const o=await n.importKey("raw",Bi(e),{name:"AES-CBC",length:128},!0,["encrypt","decrypt"]),[i,r]=t.split("."),a=await n.decrypt({name:"AES-CBC",iv:Bi(i)},o,Bi(r));return(new TextDecoder).decode(a)}catch(t){throw new Error("Failed to decrypt")}}function Hi(t){const e=t.replace(/(^v|\+.*$)/g,"").split(/[-.]/);return 3===e.length&&e.push("~"),e.map((t=>t.match(/^[0-9]+$/)?t.padStart(5," "):t)).join("-")}const qi={};function ji(t,e){if("$or"in e)return Ki(t,e.$or);if("$nor"in e)return!Ki(t,e.$nor);if("$and"in e)return function(t,e){for(let n=0;n<e.length;n++)if(!ji(t,e[n]))return!1;return!0}(t,e.$and);if("$not"in e)return!ji(t,e.$not);for(const[n,o]of Object.entries(e))if(!zi(o,Gi(t,n)))return!1;return!0}function Gi(t,e){const n=e.split(".");let o=t;for(let t=0;t<n.length;t++){if(!o||"object"!=typeof o||!(n[t]in o))return null;o=o[n[t]]}return o}function zi(t,e){if("string"==typeof t)return e+""===t;if("number"==typeof t)return 1*e===t;if("boolean"==typeof t)return!!e===t;if(null===t)return null===e;if(Array.isArray(t)||!Xi(t))return JSON.stringify(e)===JSON.stringify(t);for(const n in t)if(!Wi(n,e,t[n]))return!1;return!0}function Xi(t){const e=Object.keys(t);return e.length>0&&e.filter((t=>"$"===t[0])).length===e.length}function Vi(t,e){return Array.isArray(t)?t.some((t=>e.includes(t))):e.includes(t)}function Wi(t,e,n){switch(t){case"$veq":return Hi(e)===Hi(n);case"$vne":return Hi(e)!==Hi(n);case"$vgt":return Hi(e)>Hi(n);case"$vgte":return Hi(e)>=Hi(n);case"$vlt":return Hi(e)<Hi(n);case"$vlte":return Hi(e)<=Hi(n);case"$eq":return e===n;case"$ne":return e!==n;case"$lt":return e<n;case"$lte":return e<=n;case"$gt":return e>n;case"$gte":return e>=n;case"$exists":return n?null!==e:null===e;case"$in":return!!Array.isArray(n)&&Vi(e,n);case"$nin":return!!Array.isArray(n)&&!Vi(e,n);case"$not":return!zi(n,e);case"$size":return!!Array.isArray(e)&&zi(n,e.length);case"$elemMatch":return function(t,e){if(!Array.isArray(t))return!1;const n=Xi(e)?t=>zi(e,t):t=>ji(t,e);for(let e=0;e<t.length;e++)if(t[e]&&n(t[e]))return!0;return!1}(e,n);case"$all":if(!Array.isArray(e))return!1;for(let t=0;t<n.length;t++){let o=!1;for(let i=0;i<e.length;i++)if(zi(n[t],e[i])){o=!0;break}if(!o)return!1}return!0;case"$regex":try{return(o=n,qi[o]||(qi[o]=new RegExp(o.replace(/([^\\])\//g,"$1\\/"))),qi[o]).test(e)}catch(t){return!1}case"$type":return function(t){if(null===t)return"null";if(Array.isArray(t))return"array";const e=typeof t;return["string","number","boolean","object","undefined"].includes(e)?e:"unknown"}(e)===n;default:return console.error("Unknown operator: "+t),!1}var o}function Ki(t,e){if(!e.length)return!0;for(let n=0;n<e.length;n++)if(ji(t,e[n]))return!0;return!1}const Ji="undefined"!=typeof window&&"undefined"!=typeof document;var Yi=Object.freeze({__proto__:null,GrowthBook:class{constructor(t){t=t||{},this._ctx=this.context=t,this._renderer=null,this._trackedExperiments=new Set,this._trackedFeatures={},this.debug=!1,this._subscriptions=new Set,this._rtQueue=[],this._rtTimer=0,this.ready=!1,this._assigned=new Map,this._forcedFeatureValues=new Map,this._attributeOverrides={},this._activeAutoExperiments=new Map,t.features&&(this.ready=!0),Ji&&t.enableDevMode&&(window._growthbook=this,document.dispatchEvent(new Event("gbloaded"))),t.experiments&&(this.ready=!0,this._updateAllAutoExperiments()),t.clientKey&&this._refresh({},!0,!1)}async loadFeatures(t){await this._refresh(t,!0,!0),!1!==this._ctx.backgroundSync&&(this._ctx.subscribeToChanges||t&&t.autoRefresh)&&function(t){const[e]=Ho(t),n=Fo.get(e)||new Set;n.add(t),Fo.set(e,n)}(this)}async refreshFeatures(t){await this._refresh(t,!1,!0)}getApiInfo(){return[(this._ctx.apiHost||"https://cdn.growthbook.io").replace(/\/*$/,""),this._ctx.clientKey||""]}async _refresh(t,e,n){if(t=t||{},!this._ctx.clientKey)throw new Error("Missing clientKey");await async function(t,e,n,o,i,r){r||(Oo.backgroundSync=!1);const a=await async function(t,e,n,o){const[i]=Ho(t),r=new Date;await async function(){if(!Mo){Mo=!0;try{if(Ro.localStorage){const t=await Ro.localStorage.getItem(Oo.cacheKey);if(t){const e=JSON.parse(t);e&&Array.isArray(e)&&e.forEach((t=>{let[e,n]=t;Do.set(e,{...n,staleAt:new Date(n.staleAt)})}))}}}catch(t){}}}();const a=Do.get(i);if(a&&!o&&(e||a.staleAt>r))return a.sse&&Bo.add(i),a.staleAt<r?Go(t):zo(t),a.data;{const e=await function(t,e){return new Promise((n=>{let o,i=!1;const r=t=>{i||(i=!0,o&&clearTimeout(o),n(t||null))};e&&(o=setTimeout((()=>r()),e)),t.then((t=>r(t))).catch((()=>r()))}))}(Go(t),n);return e}}(t,o,e,n);i&&a&&await jo(t,a)}(this,t.timeout,t.skipCache||this._ctx.enableDevMode,e,n,!1!==this._ctx.backgroundSync)}_render(){this._renderer&&this._renderer()}setFeatures(t){this._ctx.features=t,this.ready=!0,this._render()}async setEncryptedFeatures(t,e,n){const o=await Ui(t,e||this._ctx.decryptionKey,n);this.setFeatures(JSON.parse(o))}setExperiments(t){this._ctx.experiments=t,this.ready=!0,this._updateAllAutoExperiments()}async setEncryptedExperiments(t,e,n){const o=await Ui(t,e||this._ctx.decryptionKey,n);this.setExperiments(JSON.parse(o))}setAttributes(t){this._ctx.attributes=t,this._render(),this._updateAllAutoExperiments()}setAttributeOverrides(t){this._attributeOverrides=t,this._render(),this._updateAllAutoExperiments()}setForcedVariations(t){this._ctx.forcedVariations=t||{},this._render(),this._updateAllAutoExperiments()}setForcedFeatures(t){this._forcedFeatureValues=t,this._render()}setURL(t){this._ctx.url=t,this._updateAllAutoExperiments(!0)}getAttributes(){return{...this._ctx.attributes,...this._attributeOverrides}}getFeatures(){return this._ctx.features||{}}getExperiments(){return this._ctx.experiments||[]}subscribe(t){return this._subscriptions.add(t),()=>{this._subscriptions.delete(t)}}getAllResults(){return new Map(this._assigned)}destroy(){var t;this._subscriptions.clear(),this._assigned.clear(),this._trackedExperiments.clear(),this._trackedFeatures={},this._rtQueue=[],this._rtTimer&&clearTimeout(this._rtTimer),t=this,Fo.forEach((e=>e.delete(t))),Ji&&window._growthbook===this&&delete window._growthbook,this._activeAutoExperiments.forEach((t=>{t.undo()})),this._activeAutoExperiments.clear()}setRenderer(t){this._renderer=t}forceVariation(t,e){this._ctx.forcedVariations=this._ctx.forcedVariations||{},this._ctx.forcedVariations[t]=e,this._render()}run(t){const e=this._run(t,null);return this._fireSubscriptions(t,e),e}triggerExperiment(t){if(!this._ctx.experiments)return null;const e=this._ctx.experiments.find((e=>e.key===t));return e&&e.manual?this._runAutoExperiment(e,!0):null}_runAutoExperiment(t,e,n){const o=t.key,i=this._activeAutoExperiments.get(o);if(t.manual&&!e&&!i)return null;const r=this.run(t),a=JSON.stringify(r.value);if(!n&&r.inExperiment&&i&&i.valueHash===a)return r;if(i&&this._undoActiveAutoExperiment(o),r.inExperiment){const e=this._applyDOMChanges(r.value);e&&this._activeAutoExperiments.set(t.key,{undo:e,valueHash:a})}return r}_undoActiveAutoExperiment(t){const e=this._activeAutoExperiments.get(t);e&&(e.undo(),this._activeAutoExperiments.delete(t))}_updateAllAutoExperiments(t){const e=this._ctx.experiments||[],n=new Set(e.map((t=>t.key)));this._activeAutoExperiments.forEach(((t,e)=>{n.has(e)||(t.undo(),this._activeAutoExperiments.delete(e))})),e.forEach((e=>{this._runAutoExperiment(e,!1,t)}))}_fireSubscriptions(t,e){const n=t.key,o=this._assigned.get(n);o&&o.result.inExperiment===e.inExperiment&&o.result.variationId===e.variationId||(this._assigned.set(n,{experiment:t,result:e}),this._subscriptions.forEach((n=>{try{n(t,e)}catch(t){console.error(t)}})))}_trackFeatureUsage(t,e){if("override"===e.source)return;const n=JSON.stringify(e.value);if(this._trackedFeatures[t]!==n){if(this._trackedFeatures[t]=n,this._ctx.onFeatureUsage)try{this._ctx.onFeatureUsage(t,e)}catch(t){}Ji&&window.fetch&&(this._rtQueue.push({key:t,on:e.on}),this._rtTimer||(this._rtTimer=window.setTimeout((()=>{this._rtTimer=0;const t=[...this._rtQueue];this._rtQueue=[],this._ctx.realtimeKey&&window.fetch("https://rt.growthbook.io/?key=".concat(this._ctx.realtimeKey,"&events=").concat(encodeURIComponent(JSON.stringify(t))),{cache:"no-cache",mode:"no-cors"}).catch((()=>{}))}),this._ctx.realtimeInterval||2e3)))}}_getFeatureResult(t,e,n,o,i,r){const a={value:e,on:!!e,off:!e,source:n,ruleId:o||""};return i&&(a.experiment=i),r&&(a.experimentResult=r),this._trackFeatureUsage(t,a),a}isOn(t){return this.evalFeature(t).on}isOff(t){return this.evalFeature(t).off}getFeatureValue(t,e){const n=this.evalFeature(t).value;return null===n?e:n}feature(t){return this.evalFeature(t)}evalFeature(t){if(this._forcedFeatureValues.has(t))return this._getFeatureResult(t,this._forcedFeatureValues.get(t),"override");if(!this._ctx.features||!this._ctx.features[t])return this._getFeatureResult(t,null,"unknownFeature");const e=this._ctx.features[t];if(e.rules)for(const n of e.rules){if(n.condition&&!this._conditionPasses(n.condition))continue;if(n.filters&&this._isFilteredOut(n.filters))continue;if("force"in n){if(!this._isIncludedInRollout(n.seed||t,n.hashAttribute,n.range,n.coverage,n.hashVersion))continue;return n.tracks&&n.tracks.forEach((t=>{this._track(t.experiment,t.result)})),this._getFeatureResult(t,n.force,"force",n.id)}if(!n.variations)continue;const e={variations:n.variations,key:n.key||t};"coverage"in n&&(e.coverage=n.coverage),n.weights&&(e.weights=n.weights),n.hashAttribute&&(e.hashAttribute=n.hashAttribute),n.namespace&&(e.namespace=n.namespace),n.meta&&(e.meta=n.meta),n.ranges&&(e.ranges=n.ranges),n.name&&(e.name=n.name),n.phase&&(e.phase=n.phase),n.seed&&(e.seed=n.seed),n.hashVersion&&(e.hashVersion=n.hashVersion),n.filters&&(e.filters=n.filters);const o=this._run(e,t);if(this._fireSubscriptions(e,o),o.inExperiment&&!o.passthrough)return this._getFeatureResult(t,o.value,"experiment",n.id,e,o)}return this._getFeatureResult(t,void 0===e.defaultValue?null:e.defaultValue,"defaultValue")}_isIncludedInRollout(t,e,n,o,i){if(!n&&void 0===o)return!0;const{hashValue:r}=this._getHashAttribute(e);if(!r)return!1;const a=Fi(t,r,i||1);return null!==a&&(n?Mi(a,n):void 0===o||a<=o)}_conditionPasses(t){return ji(this.getAttributes(),t)}_isFilteredOut(t){return t.some((t=>{const{hashValue:e}=this._getHashAttribute(t.attribute);if(!e)return!0;const n=Fi(t.seed,e,t.hashVersion||2);return null===n||!t.ranges.some((t=>Mi(n,t)))}))}_run(t,e){const n=t.key,o=t.variations.length;if(o<2)return this._getResult(t,-1,!1,e);if(!1===this._ctx.enabled)return this._getResult(t,-1,!1,e);t=this._mergeOverrides(t);const i=function(t,e,n){if(!e)return null;const o=e.split("?")[1];if(!o)return null;const i=o.replace(/#.*/,"").split("&").map((t=>t.split("=",2))).filter((e=>{let[n]=e;return n===t})).map((t=>{let[,e]=t;return parseInt(e)}));return i.length>0&&i[0]>=0&&i[0]<n?i[0]:null}(n,this._getContextUrl(),o);if(null!==i)return this._getResult(t,i,!1,e);if(this._ctx.forcedVariations&&n in this._ctx.forcedVariations){const o=this._ctx.forcedVariations[n];return this._getResult(t,o,!1,e)}if("draft"===t.status||!1===t.active)return this._getResult(t,-1,!1,e);const{hashValue:r}=this._getHashAttribute(t.hashAttribute);if(!r)return this._getResult(t,-1,!1,e);if(t.filters){if(this._isFilteredOut(t.filters))return this._getResult(t,-1,!1,e)}else if(t.namespace&&!function(t,e){const n=Fi("__"+e[0],t,1);return null!==n&&n>=e[1]&&n<e[2]}(r,t.namespace))return this._getResult(t,-1,!1,e);if(t.include&&!function(t){try{return t()}catch(t){return console.error(t),!1}}(t.include))return this._getResult(t,-1,!1,e);if(t.condition&&!this._conditionPasses(t.condition))return this._getResult(t,-1,!1,e);if(t.groups&&!this._hasGroupOverlap(t.groups))return this._getResult(t,-1,!1,e);if(t.url&&!this._urlIsValid(t.url))return this._getResult(t,-1,!1,e);if(t.urlPatterns&&!Ni(this._getContextUrl(),t.urlPatterns))return this._getResult(t,-1,!1,e);const a=Fi(t.seed||n,r,t.hashVersion||1);if(null===a)return this._getResult(t,-1,!1,e);const s=function(t,e){for(let n=0;n<e.length;n++)if(Mi(t,e[n]))return n;return-1}(a,t.ranges||function(t,e,n){(e=void 0===e?1:e)<0?e=0:e>1&&(e=1);const o=(i=t)<=0?[]:new Array(i).fill(1/i);var i;(n=n||o).length!==t&&(n=o);const r=n.reduce(((t,e)=>e+t),0);(r<.99||r>1.01)&&(n=o);let a=0;return n.map((t=>{const n=a;return a+=t,[n,n+e*t]}))}(o,void 0===t.coverage?1:t.coverage,t.weights));if(s<0)return this._getResult(t,-1,!1,e);if("force"in t)return this._getResult(t,void 0===t.force?-1:t.force,!1,e);if(this._ctx.qaMode)return this._getResult(t,-1,!1,e);if("stopped"===t.status)return this._getResult(t,-1,!1,e);const c=this._getResult(t,s,!0,e,a);return this._track(t,c),c}log(t,e){this.debug&&(this._ctx.log?this._ctx.log(t,e):console.log(t,e))}_track(t,e){if(!this._ctx.trackingCallback)return;const n=t.key,o=e.hashAttribute+e.hashValue+n+e.variationId;if(!this._trackedExperiments.has(o)){this._trackedExperiments.add(o);try{this._ctx.trackingCallback(t,e)}catch(t){console.error(t)}}}_mergeOverrides(t){const e=t.key,n=this._ctx.overrides;return n&&n[e]&&"string"==typeof(t=Object.assign({},t,n[e])).url&&(t.url=Di(t.url)),t}_getHashAttribute(t){const e=t||"id";let n="";return this._attributeOverrides[e]?n=this._attributeOverrides[e]:this._ctx.attributes?n=this._ctx.attributes[e]||"":this._ctx.user&&(n=this._ctx.user[e]||""),{hashAttribute:e,hashValue:n}}_getResult(t,e,n,o,i){let r=!0;(e<0||e>=t.variations.length)&&(e=0,r=!1);const{hashAttribute:a,hashValue:s}=this._getHashAttribute(t.hashAttribute),c=t.meta?t.meta[e]:{},d={key:c.key||""+e,featureId:o,inExperiment:r,hashUsed:n,variationId:e,value:t.variations[e],hashAttribute:a,hashValue:s};return c.name&&(d.name=c.name),void 0!==i&&(d.bucket=i),c.passthrough&&(d.passthrough=c.passthrough),d}_getContextUrl(){return this._ctx.url||(Ji?window.location.href:"")}_urlIsValid(t){const e=this._getContextUrl();if(!e)return!1;const n=e.replace(/^https?:\/\//,"").replace(/^[^/]*\//,"/");return!!t.test(e)||!!t.test(n)}_hasGroupOverlap(t){const e=this._ctx.groups||{};for(let n=0;n<t.length;n++)if(e[t[n]])return!0;return!1}_applyDOMChanges(t){if(!Ji)return;const e=[];if(t.css){const n=document.createElement("style");n.innerHTML=t.css,document.head.appendChild(n),e.push((()=>n.remove()))}if(t.js){const n=document.createElement("script");n.innerHTML=t.js,document.body.appendChild(n),e.push((()=>n.remove()))}return t.domMutations&&t.domMutations.forEach((t=>{e.push(Oi(t).revert)})),()=>{e.forEach((t=>t()))}}},clearCache:async function(){Do.clear(),No.clear(),Jo(),Mo=!1,await Uo()},configureCache:function(t){Object.assign(Oo,t),Oo.backgroundSync||Jo()},isURLTargeted:Ni,setPolyfills:function(t){Object.assign(Ro,t)}}),Zi=function(t){var e=t.default;if("function"==typeof e){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var o=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,o.get?o:{enumerable:!0,get:function(){return t[e]}})})),n}(Yi);Object.defineProperty(Lo,"__esModule",{value:!0}),Lo.FeatureTogglesManager=void 0;const Qi=Zi;class tr{growthBookClient;ready=!1;constructor(t){this.growthBookClient=t}async init(t){await this.growthBookClient.setAttributes(t),await this.growthBookClient.loadFeatures({timeout:2e3}),this.ready=!0}get(t,e){if(!this.ready)return e;try{const n=this.growthBookClient.getFeatureValue(t,e);return null===n?e:n}catch(t){return e}}static build(t){const e=new Qi.GrowthBook({apiHost:t.credentials.host,clientKey:t.credentials.clientKey,backgroundSync:!1,enableDevMode:t.enableDevMode,subscribeToChanges:!0,trackingCallback:t.experimentAttributionCallback});return new tr(e)}}var er,nr,or;Lo.FeatureTogglesManager=tr,er=_o,nr=Po&&Po.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,o,i)}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),or=Po&&Po.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||nr(e,t,n)},Object.defineProperty(er,"__esModule",{value:!0}),or(Lo,er);class ir{constructor(t){this.underlying=t}static manager(){if(!ir.instance)throw bo.error("ShopperFeatureTogglesManagerProvider","ShopperFeatureTogglesManagerProvider has been called before being initialized"),new Error("ShopperFeatureTogglesManagerProvider has not been initialized");return ir.instance.underlying}static build(t){const e=window.Fondue?.getEnvVar("growthbookApiHost"),n=window.Fondue?.getEnvVar("growthbookClientKey"),o=window.Fondue?.getEnvVar("appEnv")??"production";bo.info("ExtensionRunner","initializing shopper feature toggles");const i=_o.FeatureTogglesManager.build({credentials:{host:e,clientKey:n},enableDevMode:"production"!==o,experimentAttributionCallback:async(e,n)=>{bo.info("ShopperFeatureTogglesManagerProvider","Attributing shopper to experiment",{custom:{experimentId:e.key,variationId:n.key}}),await t.attribute({experimentId:e.key,variationId:n.key})}});ir.instance=new ir(i)}}class rr{exists(t,e){const n=e.originalLineItems.map((t=>t.variantId));return _(t.originalLineItems.filter((t=>!n.includes(t.variantId))))}}class ar{constructor(t){this.helper=t}parse(t){try{const e=Object.fromEntries(new URLSearchParams(t.body[0])),n=this.helper.findVariantIdInArray(t.cart.items,e.line);if(_(n))return;return[{variantId:n,quantity:parseInt(e.quantity)}]}catch(t){return}}}class sr{constructor(t){this.helper=t}parse(t){try{const e=this.helper.extractBody(t.body),n=JSON.parse(t.body.body||e),o=this.helper.findVariantIdInArray(t.cart.items,n.line);if(_(o))return;return[{variantId:o,quantity:parseInt(n.quantity)}]}catch(t){return}}}class cr{constructor(t){this.helper=t,this.shopifyFormatRegex=/updates[[0-9]*]/g}parse(t){try{const e=decodeURI(t.body[0]);if(!e.match(this.shopifyFormatRegex))return;const n=e.match(/\d+/g),o=this.helper.parseId(n[0]),i=parseInt(n[1]);if(_(o))return;return[{variantId:o,quantity:i}]}catch(t){return}}}class dr{constructor(t){this.helper=t}parse(t){try{const e=this.helper.extractBody(t.body.body||t.body),n=this.helper.decodeUrl(e);if(_(n)||_(n.id))return;const o=this.helper.parseId(n.id);if(_(o))return;return[{variantId:o,quantity:parseInt(n.quantity)}]}catch(t){return}}}class lr{parse(t){try{const e=t.body.getAll("id[]");if(_(e))return;return e.map((t=>({variantId:t,quantity:1})))}catch(t){return}}}class ur{constructor(t){this.helper=t}parse(t){try{const e=this.helper.extractBody(t.body),n=e.body||e,o=n.get("id"),i=n.get("quantity")??1;if(!o)return;return[{quantity:parseInt(i),variantId:this.helper.parseId(o)}]}catch(t){return}}}class hr{constructor(t){this.helper=t}parse(t){try{const e=this.helper.extractBody(t.body),n=new URLSearchParams(e),o={};for(const[t,e]of n){const n=t.split("["),i=n[1].split("]")[0],r=n[2].split("]")[0];o[i]||(o[i]={}),o[i][r]=e}const i=Object.values(o);if(_(i))return;return i}catch(t){return}}}class fr{constructor(t){this.helper=t}parse(t){try{if(_(t.body))return;const e=t.body.body||this.helper.extractBody(t.body);return("object"==typeof e?e:JSON.parse(e)).items.map((t=>({quantity:parseInt(t.quantity??1),variantId:this.helper.parseId(t.id.toString())})))}catch(t){return}}}class pr{parseId(t){return decodeURI(t).match(/\d+/g)[0]}decodeUrl(t){const e={};try{const n=decodeURI(t).split("&");for(const t of n){const n=t.split("=");e[n[0]]=n[1]}return e}catch(t){return e}}findVariantIdInArray(t,e){try{return t[parseInt(e)-1].variantId}catch(t){return}}extractBody(t){return this.isArgument(t)?t[0]:t}isArgument(t){return"[object Arguments]"==Object.prototype.toString.call(t)}}class mr{constructor(t){this.helper=t}parse(t){try{const e=t.body,n=this.helper.decodeUrl(e),o=this.helper.findVariantIdInArray(t.cart.items,n.line);if(_(o))return;return[{variantId:o,quantity:parseInt(n.quantity)}]}catch(t){return}}}class br{constructor(t){this.helper=t,this.shopifyFormatRegex=/updates\[(\d+)(:|%3A)([^\]]+)\]=(\d+)/g}parse(t){try{this.shopifyFormatRegex.lastIndex=0;const e=decodeURI(t.body[0]),n=this.shopifyFormatRegex.exec(e);if(!n)return;const o=this.helper.parseId(n[1]),i=parseInt(n[4]);if(_(o))return;return[{variantId:o,quantity:i}]}catch(t){return}}}class gr{constructor(t){this.helper=t}parse(t){try{const e=this.helper.extractBody(t.body),n=JSON.parse(t.body.body||e),o=Object.entries(n.updates),i=[];for(const[t,e]of o){const n=this.helper.parseId(t),o=e;_(n)||i.push({variantId:n,quantity:o})}return i}catch(t){return}}}class yr{constructor(t){this.helper=t}parse(t){try{const e=this.helper.extractBody(t.body),n=JSON.parse(t.body.body||e);if(void 0===n.id)return;const o=n.id.toString(),i=this.helper.parseId(o);if(_(i))return;return[{quantity:parseInt(n.quantity??1),variantId:i}]}catch(t){return}}}class vr{parse(t){try{const e=t.body.getAll("updates[]");if(_(e))return;return[t.cart.items.find(((t,n)=>{const o=parseInt(e[n]);if(!_(o)&&t.quantity!==o&&!_(t.variantId))return{variantId:t.variantId,quantity:o}}))]}catch(t){return}}}class wr{constructor(t){this.parsers=t,this.LOG_PREFIX="CartRequestParser"}parse(t){for(const e of this.parsers){const n=e.parse(t);if(n)return bo.info(this.LOG_PREFIX,"Cart request parser applied",{parser:e.constructor.name}),n}}static build(){const t=new pr;return new wr([new dr(t),new yr(t),new fr(t),new ur(t),new br(t),new ar(t),new sr(t),new vr,new mr(t),new gr(t),new hr(t),new lr,new cr(t)])}}class kr{constructor(t,e,n){this.fondueApi=t,this.fondueUtils=e,this.featureToggleManager=n,this.LogPrefix="CashbackCartDataBuilder: "}async build(t){const e=await this.fondueApi.cartV2(t.leanCart.items,t.cashbackProduct.publicId);if(vo(e))return bo.warn(this.LogPrefix,"Error while trying to get fondue cashback with v2 api",{cartRes:e,stringifyError:JSON.stringify(e)}),yo("Unable to get fondue cashback");const n=e.data.data.cashback;return go({cashback:{activePromotions:n.activePromotions,availableMethods:n.availableMethods,appliedLineItems:n.appliedLineItems,totalAmount:n.totalAmount,products:n.activePromotions,remainingAmountToThreshold:n.remainingAmountToThreshold},totalAmount:t.leanCart.totalAmount,cartItems:t.leanCart.items})}appendCashbackProductIfNeed(t,e){if(this.containCashbackProduct(t.items))return t;const n={variantId:e.variantId,productId:"product-id",productType:this.fondueUtils.vendor,quantity:1,totalPrice:0,currency:"USD",title:"CASHBACK",vendor:this.fondueUtils.vendor,isSubscription:!1,merchantLineItemId:"cashback-line-item-id"};return{...t,items:[...t.items,n]}}containCashbackProduct(t){return t.some((t=>t.vendor===this.fondueUtils.vendor))}}var xr={},Cr={},Er={exports:{}};!function(t,e){var n,o,i,r="[object Map]",a="[object Promise]",s="[object Set]",c="[object WeakMap]",d="[object DataView]",l=/^\[object .+?Constructor\]$/,u="object"==typeof Po&&Po&&Po.Object===Object&&Po,h="object"==typeof self&&self&&self.Object===Object&&self,f=u||h||Function("return this")(),p=e&&!e.nodeType&&e,m=p&&t&&!t.nodeType&&t,b=m&&m.exports===p,g=Function.prototype,y=Object.prototype,v=f["__core-js_shared__"],w=(n=/[^.]+$/.exec(v&&v.keys&&v.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",k=g.toString,x=y.hasOwnProperty,C=y.toString,E=RegExp("^"+k.call(x).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),S=b?f.Buffer:void 0,I=y.propertyIsEnumerable,A=S?S.isBuffer:void 0,T=(o=Object.keys,i=Object,function(t){return o(i(t))}),P=U(f,"DataView"),_=U(f,"Map"),L=U(f,"Promise"),O=U(f,"Set"),R=U(f,"WeakMap"),F=!I.call({valueOf:1},"valueOf"),M=q(P),D=q(_),N=q(L),$=q(O),B=q(R);function U(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){if(!V(t)||function(t){return!!w&&w in t}(t))return!1;var e=X(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?E:l;return e.test(q(t))}(n)?n:void 0}var H=function(t){return C.call(t)};function q(t){if(null!=t){try{return k.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(P&&H(new P(new ArrayBuffer(1)))!=d||_&&H(new _)!=r||L&&H(L.resolve())!=a||O&&H(new O)!=s||R&&H(new R)!=c)&&(H=function(t){var e=C.call(t),n="[object Object]"==e?t.constructor:void 0,o=n?q(n):void 0;if(o)switch(o){case M:return d;case D:return r;case N:return a;case $:return s;case B:return c}return e});var j=Array.isArray;function G(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}(t.length)&&!X(t)}var z=A||function(){return!1};function X(t){var e=V(t)?C.call(t):"";return"[object Function]"==e||"[object GeneratorFunction]"==e}function V(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}t.exports=function(t){if(G(t)&&(j(t)||"string"==typeof t||"function"==typeof t.splice||z(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&G(t)}(t)&&x.call(t,"callee")&&(!I.call(t,"callee")||"[object Arguments]"==C.call(t))}(t)))return!t.length;var e=H(t);if(e==r||e==s)return!t.size;if(F||function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||y)}(t))return!T(t).length;for(var n in t)if(x.call(t,n))return!1;return!0}}(Er,Er.exports),Object.defineProperty(Cr,"__esModule",{value:!0}),Cr.isEmpty=void 0;const Sr=Er.exports;var Ir,Ar,Tr;Cr.isEmpty=function(t){return Sr(t)},function(t){var e=Po&&Po.__createBinding||(Object.create?function(t,e,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(e,n);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,o,i)}:function(t,e,n,o){void 0===o&&(o=n),t[o]=e[n]}),n=Po&&Po.__exportStar||function(t,n){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(n,o)||e(n,t,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(Cr,t)}(xr),function(t){t.Initializing="initializing",t.Ready="ready"}(Ir||(Ir={}));class Pr{constructor(t,e,n,o){this.cartClient=t,this.storage=e,this.fondueUtils=n,this.fonduePublicObject=o}async fill(t){if(this.fonduePublicObject.status!==Ir.Ready)return;const e=this.storage.getItem(this.fondueUtils.noteAttributesKeys.shopperSession),n=this.storage.getItem(this.fondueUtils.cashbackProductStorageKey),o=[];this.isSessionIdMissing(e,t)&&o.push({key:this.fondueUtils.noteAttributesKeys.shopperSession,value:e}),this.isTokenMissing(n,t)&&o.push({key:this.fondueUtils.noteAttributesKeys.promotionToken,value:n.publicId}),xr.isEmpty(o)||await this.cartClient.updateNotes(o)}isSessionIdMissing(t,e){return!(!t||e.attributes[this.fondueUtils.noteAttributesKeys.shopperSession])}isTokenMissing(t,e){return!(!t||e.attributes[this.fondueUtils.noteAttributesKeys.promotionToken])}}class _r{constructor(t,e,n){this.clients=t,this.identifier=e,this.noteFiller=n}async add(t,e){return await this.getClient().add(t,e)}async get(){const t=await this.getClient().get();return vo(t)||await this.noteFiller.fill(t.data),t}async remove(t){return await this.getClient().remove(t)}async updateItem(t,e){return await this.getClient().updateItem(t,e)}async updateNotes(t){const e=this.identifier.getType()===b.ShopifyStorefront?b.ShopifyStorefront:b.ShopifyAjax,n=this.clients.get(e);return await n.updateNotes(t)}getClient(){const t=this.identifier.getType();return this.clients.get(t)}}class Lr{check(t){return!0===t?.selling_plan_allocation?.selling_plan?.recurring_deliveries}}class Or{constructor(t,e){this.fondueUtils=t,this.isSubscriptionLineItemChecker=e,this.LOG_PREFIX="RebuyCartClient"}async get(){try{const t=await this.rebuyCart().getCart();return go({items:t?.items.map((e=>({variantId:e.variant_id.toString(),productId:e.product_id.toString(),productType:e.product_type,quantity:e.quantity,totalPrice:e.discounted_price/100,currency:t.currency,title:e.product_title,vendor:e.vendor,properties:e.properties&&Object.entries(e.properties).map((t=>({name:t[0],value:t[1]}))),isSubscription:this.isSubscriptionLineItemChecker.check(e),merchantLineItemId:e.id.toString()}))),totalAmount:t?.total_price/100,token:t?.token,attributes:t?.attributes??{}})}catch(t){return bo.warn(this.LOG_PREFIX,"Failed to get current Rebuy cart ",{error:t,errorMessage:t?.message,stringifyError:JSON.stringify(t)}),yo(`Unable to get current cart from Rebuy - ${JSON.stringify(t)}`)}}async add(t,e){try{const n={items:[{id:t,quantity:e}]};return await this.rebuyCart().addItem(n,{}),bo.info(this.LOG_PREFIX,"Successfully [ADD] item to  rebuy cart"),go(void 0)}catch(e){return yo(`Rebuy cart - Unable to ADD - Variant Id: [${t}] to cart`)}}async updateItem(t,e){try{const n={id:t,quantity:e};return await this.rebuyCart().setItemQuantity(n,e,{}),bo.info(this.LOG_PREFIX,"Successfully [Update] item to  rebuy cart"),go(void 0)}catch(e){return yo(`Rebuy cart - Unable to ADD - Variant Id: [${t}] to cart`)}}async remove(t){try{const t=[this.fondueUtils.cashbackProductTypes.siteWide,this.fondueUtils.cashbackProductTypes.urlBased];return this.rebuyCart().getItems().filter((e=>t.includes(e.product_type))).forEach((t=>this.rebuyCart().removeItem(t))),go(void 0)}catch(t){return yo(t.message)}}updateNotes(t){return Promise.resolve(void 0)}rebuyCart(){return window.Rebuy.Cart}static build(){return new Or(M,new Lr)}}!function(t){t.Fetch="FETCH",t.Xhr="XHR",t.Form="FORM",t.Click="CLICK",t.Rebuy="REBUY"}(Ar||(Ar={})),function(t){t.DoNotIntercept="DO_NOT_INTERCEPT",t.Intercept="INTERCEPT",t.Block="BLOCK"}(Tr||(Tr={}));const Rr=window.fetch;class Fr{constructor(){this.LOG_PREFIX="FondueFetchInterceptor",this.handler=null,this.originalMethod=()=>Rr}apply(){this.applied?bo.info(this.LOG_PREFIX,"Interceptor already applied"):this.originalMethod?(window.fetch=this.overrideFetch(),this.applied=!0):bo.info(this.LOG_PREFIX,"No original method found")}unapply(){this.applied=!1,window.fetch=Rr}register(t){this.handler=t}unregisterAll(){this.handler=null}overrideFetch(){const t=this;return async function(e,n){try{const o=t.handler.shouldHandle(e,n,Ar.Fetch);return T(o).with({result:Tr.Intercept},(async()=>{await t.handler.before(e,n,Ar.Fetch);const o=await Rr(e,n);return await t.handler.after(e,n,Ar.Fetch),o})).with({result:Tr.DoNotIntercept},(async()=>await Rr(e,n))).with({result:Tr.Block},(()=>(bo.info(t.LOG_PREFIX,"Skipping original request"),new Response))).exhaustive()}catch(o){return bo.error(t.LOG_PREFIX,"Failed to override fetch",{e:o.message,stackTrace:o.stack,url:e,params:n}),new Response}}}}class Mr{constructor(t,e,n){this.fondueUtils=t,this.cashbackProductUtils=e,this.isSubscriptionLineItemChecker=n,this.LOG_PREFIX="ShopifyCartClient"}async get(){try{const t=await Rr(`/cart.js?fetchcart=1&${this.fondueUtils.requestIndicator}`,{method:"GET",headers:{Accept:"application/json"}});if(200!==t.status)return bo.warn(this.LOG_PREFIX,"Unable to get cart from shopify",{custom:{cartResponse:{status:t.status,statusText:t.statusText,headers:JSON.stringify(t.headers)}}}),yo("Unable to get cart from shopify");let e;try{e=await t.json()}catch(e){return bo.warn(this.LOG_PREFIX,"Failed to convert cart response to json",{custom:{cartResponse:{status:t.status,statusText:t.statusText,headers:JSON.stringify(t.headers)}}}),yo(`Unable to get cart from shopify ${e.message}`)}return go({items:e?.items.map((t=>({variantId:t.variant_id.toString(),productId:t.product_id.toString(),productType:t.product_type,quantity:t.quantity,totalPrice:t.discounted_price/100,currency:e.currency,title:t.product_title,vendor:t.vendor,properties:t.properties&&Object.entries(t.properties).map((t=>({name:t[0],value:t[1]}))),isSubscription:this.isSubscriptionLineItemChecker.check(t),merchantLineItemId:t.id.toString()}))),totalAmount:e.total_price/100,token:e?.token,attributes:e?.attributes??{}})}catch(t){return bo.warn(this.LOG_PREFIX,"Failed to get current cart Shopify",{error:t,errorMessage:t?.message,stringifyError:JSON.stringify(t)}),yo(`Unable to get current cart from shopify - ${JSON.stringify(t)}`)}}async add(t,e){try{return await Rr(`/cart/add.js${this.fondueUtils.requestIndicator}`,{body:JSON.stringify({items:[{quantity:e,id:t}]}),credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"xmlhttprequest"},method:"POST"}),go(void 0)}catch(e){return yo(`Unable to ADD - Variant Id: [${t}] to cart`)}}async updateItem(t,e){try{return await Rr(`/cart/update.js${this.fondueUtils.requestIndicator}`,{body:JSON.stringify({updates:{[t]:e}}),credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"xmlhttprequest"},method:"POST"}),go(void 0)}catch(e){return yo(`Unable to UPDATE - Variant Id: [${t}] to cart`)}}async remove(t){const e=t.filter((t=>this.cashbackProductUtils.isCashbackProduct(t)));return Promise.all(e.map((async t=>this.updateItem(t.variantId,0)))).then((()=>(bo.info(this.LOG_PREFIX,"Successfully removed cashbacks from cart",{cashbacksInCart:e}),go(void 0)))).catch((t=>(bo.info(this.LOG_PREFIX,"Unable to remove items from cart"),yo(t.map))))}async updateNotes(t){try{const e=(t=>t.reduce(((t,e)=>(t[e.key]=e.value,t)),{}))(t),n=await Rr(`/cart/update.js${this.fondueUtils.requestIndicator}`,{body:JSON.stringify({attributes:e}),credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"xmlhttprequest"},method:"POST"});return 200!==n.status?(bo.warn(this.LOG_PREFIX,"Unable to perform update of notes",{error:JSON.stringify(n.body)}),yo("Unable to perform update of notes")):go(void 0)}catch(t){return bo.warn(this.LOG_PREFIX,"Unable to perform update of notes",{error:JSON.stringify(t)}),yo("Unable to add note attributes")}}static build(){const t=ko.build(),e=new Lr;return new Mr(M,t,e)}}class Dr{convert(t){return{items:t.lines.edges.map((t=>this.convertToLeanLineItem(t.node))),totalAmount:t.cost.totalAmount.amount,token:"no-token-in-storefront-api",attributes:t.attributes}}convertToLeanLineItem(t){return{variantId:t.merchandise.id.split("gid://shopify/ProductVariant/")[1],productId:t.merchandise.product.id.split("gid://shopify/Product/")[1],productType:t.merchandise.product.productType,quantity:t.quantity,totalPrice:this.getItemPrice(t.cost.totalAmount.amount,t.quantity),currency:t.cost.totalAmount.currencyCode,title:t.merchandise.title,vendor:t.merchandise.product.vendor,isSubscription:t.sellingPlanAllocation?.sellingPlan.recurringDeliveries??!1,properties:this.convertAttributesToProperties(t.attributes),merchantLineItemId:t.id.split("gid://shopify/CartLine/")[1]}}getItemPrice(t,e){return e>0?parseFloat(t)/e:0}convertAttributesToProperties(t){return t.map((t=>({name:t.key,value:t.value})))}}class Nr{constructor(t,e,n,o=M,i,r){this.shopDomain=t,this.storefrontAccessToken=e,this.storage=n,this.fondueUtils=o,this.converter=i,this.fonduePublicObject=r,this.LogPrefix="StorefrontCartClient",this.ApiVersion="2023-10",this.headers={"Content-Type":"application/json","X-Shopify-Storefront-Access-Token":this.storefrontAccessToken}}async get(){try{const t=this.getCartId();if(xr.isEmpty(t))return yo("Failed to get cart, current cart id is missing");const e=await fetch(`https://${this.shopDomain}/api/${this.ApiVersion}/graphql.json`,{method:"POST",body:JSON.stringify({query:this.buildCartQuery(t)}),headers:this.headers});if(200!==e.status)return yo(`Failed to get cart, unexpected response status code from shopify - ${e.status}`);let n;try{n=await e.json()}catch(t){return yo("Failed to get cart, response cannot be converted to json")}return n.errors?.graphQLErrors.length>0?yo(`Failed to get cart, response error - ${JSON.stringify(n.errors?.graphQLErrors)}`):go(this.converter.convert(n?.data?.cart))}catch(t){return yo(`Failed to get cart through storefront cart client - ${JSON.stringify(t.message)}`)}}async updateNotes(t){try{const e=this.getCartId();if(xr.isEmpty(e))return yo("Failed to update cart notes, current cart id is missing");const n=await fetch(`https://${this.shopDomain}/api/${this.ApiVersion}/graphql.json`,{method:"POST",body:JSON.stringify({query:this.buildNoteMutation(),variables:{cartId:e,attributes:t}}),headers:this.headers});if(200!==n.status)return yo(`Failed to update cart notes, unexpected response status code from shopify - ${n.status}`);let o;try{o=await n.json()}catch(t){return yo("Failed to update cart notes, response cannot be converted to json")}return o.errors?.graphQLErrors.length>0?yo(`Failed to update cart note, response error - ${JSON.stringify(o.errors?.graphQLErrors)}`):go(void 0)}catch(t){return bo.warn(this.LogPrefix,"Failed to update cart notes through storefront API",{error:t,errorMessage:t?.message,stringifyError:JSON.stringify(t)}),yo(`Failed to update cart notes through storefront API - ${JSON.stringify(t)}`)}}async add(t,e){return bo.warn(this.LogPrefix,"StorefrontCartClient.add method should not be used in Storefront API"),go(void 0)}async updateItem(t,e){return bo.warn(this.LogPrefix,"StorefrontCartClient.updateItem method should not be used in Storefront API"),go(void 0)}async remove(t){return bo.warn(this.LogPrefix,"StorefrontCartClient.remove method should not be used in Storefront API"),go(void 0)}getCartId(){return this.fonduePublicObject.Cart.getCartId()||this.storage.getItem(this.fondueUtils.sessionKeys.sessionCartId)}buildCartQuery(t){return`query {\n                cart(\n                  id: "${t}"\n                ) {\n                  id\n                  lines(first: 250) {\n                    edges {\n                      node {\n                        id\n                        quantity\n                        merchandise {\n                          ... on ProductVariant {\n                            id\n                            title\n                            product {\n                              id\n                              vendor\n                              productType\n                            }\n                          }\n                        }\n                        cost {\n                          totalAmount {\n                            amount\n                            currencyCode\n                          }\n                        }\n                        attributes {\n                          key\n                          value\n                        }\n                        sellingPlanAllocation {\n                          sellingPlan {\n                            recurringDeliveries\n                          }\n                        }\n                      }\n                    }\n                  }\n                  attributes {\n                    key\n                    value\n                  }\n                  cost {\n                    totalAmount {\n                      amount\n                      currencyCode\n                    }\n                  }\n                }\n              }`}buildNoteMutation(){return"\n       mutation cartAttributesUpdate($cartId: ID!, $attributes: [AttributeInput!]!) {\n          cartAttributesUpdate(cartId: $cartId, attributes: $attributes) {\n            cart {\n              id\n              attributes {\n                key\n                value\n              }\n            }\n            userErrors {\n              field\n              message\n            }\n          }\n        }\n    "}}class $r{static build(t,n,o){const i=new L(new e),{cartClientsMap:r,noteFillerClient:a}=T(i.getType()).with(b.ShopifyStorefront,(()=>{const e=n.getItem(M.settingsStorageKey);if(!e?.common?.storeFrontAccessToken)throw new Error("Storefront access token is missing, cannot build cart client");const i=new Nr(t,e?.common?.storeFrontAccessToken,n,M,new Dr,o);return{cartClientsMap:new Map([[b.ShopifyStorefront,i]]),noteFillerClient:i}})).with(b.ShopifyAjax,b.Rebuy,(()=>{const t=Mr.build();return{cartClientsMap:new Map([[b.ShopifyAjax,t],[b.Rebuy,Or.build()]]),noteFillerClient:t}})).exhaustive();return new _r(r,new L(new e),new Pr(a,n,M,o))}}class Br{constructor(t){this.cashbackProductUtils=t}partition(t){const e=[],n=[];return t.forEach((t=>this.cashbackProductUtils.isCashbackProduct(t)?e.push(t):n.push(t))),{cashbackLineItems:e,originalLineItems:n}}}class Ur{constructor(t,e,n,o){this.cashbackProductService=t,this.requestLineItemsPartitioner=e,this.lineItemsPartitioner=n,this.addCashbackChecker=o,this.LOG_PREFIX="AddMethodHandler"}async handle(t){try{const e=this.requestLineItemsPartitioner.partition(t),n=this.lineItemsPartitioner.partition(t.cart.items);if(void 0===e)return bo.info(this.LOG_PREFIX,"Failed to parse line items from request, returning"),go(void 0);if(this.addCashbackChecker.check(e,t.cashbackProduct,n))return bo.info(this.LOG_PREFIX,"Adding cashback to cart"),await this.cashbackProductService.addToCart(t.cashbackProduct.variantId,t.cart,!0)}catch(t){return yo(t.message)}}}class Hr{constructor(t,e){this.eligibilityChecker=t,this.cartChangeComparator=e,this.LOG_PREFIX="AddCashbackChecker"}check(t,e,n){if(this.cashbackIsAlreadyInRequest(t))return bo.info(this.LOG_PREFIX,"Cashback should not be added cause it is already in request"),!1;if(this.noOriginalProductWasUpdated(t.originalLineItems))return bo.info(this.LOG_PREFIX,"Cashback should not be added cause no original product was updated"),!1;const o=[...t.originalLineItems,...n.originalLineItems.map((t=>({variantId:t.variantId,quantity:t.quantity})))],i=!this.cartChangeComparator.exists(t,n),r=this.anyProductIsEligibleForCashback(o,e);return i&&r}cashbackIsAlreadyInRequest(t){return!_(t.cashbackLineItems.filter((t=>0!==t.quantity)))}noOriginalProductWasUpdated(t){return 0===t.filter((t=>0!==t.quantity)).length}anyProductIsEligibleForCashback(t,e){for(const n of t)if(this.eligibilityChecker.isEligible(n,e.appliedRule))return!0;return!1}}class qr{constructor(t){this.eligibilityChecker=t,this.LOG_PREFIX="RemoveCashbackChecker"}check(t,e,n){return this.noEligibleLineItemLeftInCart(t,e,n)}noEligibleLineItemLeftInCart(t,e,n){const o=this.extractLineItemsLeftInCart(t,n);for(const t of o)if(this.eligibilityChecker.isEligible(t,e.appliedRule))return!1;return bo.info(this.LOG_PREFIX,"Cashback should be removed cause no eligible items will be left in cart"),!0}extractLineItemsLeftInCart(t,e){const n=t.originalLineItems.filter((t=>0===t.quantity)).map((t=>t.variantId));return _(n)?e.originalLineItems:e.originalLineItems.filter((t=>!n.includes(t.variantId)))}}class jr{constructor(t,e,n,o,i){this.cashbackProductService=t,this.requestLineItemsPartitioner=e,this.lineItemsPartitioner=n,this.addCashbackChecker=o,this.removeCashbackChecker=i,this.LOG_PREFIX="ChangeOrUpdateMethodHandler"}async handle(t){try{const e=this.requestLineItemsPartitioner.partition(t),n=this.lineItemsPartitioner.partition(t.cart.items);return void 0===e?(bo.info(this.LOG_PREFIX,"Failed to parse line items from request, returning"),go(void 0)):this.addCashbackChecker.check(e,t.cashbackProduct,n)?(bo.info(this.LOG_PREFIX,"Adding cashback to cart"),await this.cashbackProductService.addToCart(t.cashbackProduct.variantId,t.cart,!0)):this.removeCashbackChecker.check(e,t.cashbackProduct,n)?(bo.info(this.LOG_PREFIX,"Removing cashback from cart"),this.cashbackProductService.removeAllFromCart(n.cashbackLineItems)):go(void 0)}catch(t){return yo(t)}}}var Gr,zr,Xr,Vr,Wr,Kr,Jr,Yr,Zr,Qr;!function(t){t.Add="cart/add",t.Change="cart/change",t.Update="cart/update",t.Clear="cart/clear",t.RebuyChange="rebuy.change",t.RebuyAdd="rebuy.add"}(Gr||(Gr={})),function(t){t.Add="ADD",t.Change="CHANGE",t.Update="UPDATE",t.RebuyChange="REBUY-CHANGE",t.RebuyAdd="REBUY-ADD"}(zr||(zr={}));class ta{constructor(t){this.methodHandlers=t,this.LOG_PREFIX="MethodHandlerFactory"}get(t){return t.toString().includes(Gr.Add)?(bo.info(this.LOG_PREFIX,"returning [Add Handler]"),this.methodHandlers.get(zr.Add)):t.toString().includes(Gr.RebuyChange)?(bo.info(this.LOG_PREFIX,"returning [Rebuy Change Handler]"),this.methodHandlers.get(zr.RebuyChange)):t.toString().includes(Gr.RebuyAdd)?(bo.info(this.LOG_PREFIX,"returning [Rebuy Change Handler]"),this.methodHandlers.get(zr.RebuyAdd)):(bo.info(this.LOG_PREFIX,"returning [Change / Update Handler]"),this.methodHandlers.get(zr.Update))}}class ea{constructor(t,e,n,o,i){this.lineItemsPartitioner=t,this.cashbackProductService=e,this.fondueUtils=n,this.eligibilityChecker=o,this.isSubscriptionLineItemChecker=i,this.LOG_PREFIX="RebuyAddMethodHandler"}async handle(t){try{const e=t.requestParams.item.items||Array.of(t.requestParams.item),n=t.requestParams.cart.getCart().currency,o=this.parseRawItems(e,n),i=this.parseRawItems(t.requestParams.cart.cart.items,n);if(!_(o.find((t=>this.isCashbackProduct(t)))))return go(void 0);const{cashbackLineItems:r}=this.lineItemsPartitioner.partition(i);return _(r)?(bo.info(this.LOG_PREFIX,"adding cashback to cart"),this.eligibleProductIsAdded(o,t.cashbackProduct)&&await this.cashbackProductService.addToCart(t.cashbackProduct.variantId,t.cart,!0),go(void 0)):go(void 0)}catch(t){return yo(t)}}parseRawItems(t,e){return t.map((t=>({variantId:t.variant_id.toString(),productId:t.product_id.toString(),productType:t.product_type,quantity:t.quantity,totalPrice:t.price,currency:e,title:t.product_title,vendor:t.vendor,isSubscription:this.isSubscriptionLineItemChecker.check(t),merchantLineItemId:t.id.toString()})))}isCashbackProduct(t){return t.vendor===this.fondueUtils.vendor}eligibleProductIsAdded(t,e){for(const n of t)if(this.eligibilityChecker.isEligible(n,e.appliedRule))return!0;return!1}}class na{constructor(t,e,n){this.lineItemsPartitioner=t,this.cashbackProductService=e,this.eligibilityChecker=n,this.LOG_PREFIX="RebuyChangeMethodHandler"}async handle(t){try{const e=t.cart.items,{originalLineItems:n,cashbackLineItems:o}=this.lineItemsPartitioner.partition(e);return this.cartIsEmpty(n,o)?(bo.info(this.LOG_PREFIX,"Cart is empty, returning"),go(void 0)):this.noEligibleProductLeftInCart(n,t.cashbackProduct)?(bo.info(this.LOG_PREFIX,"only cashbacks in cart, removing them"),this.cashbackProductService.removeAllFromCart(o)):go(void 0)}catch(t){return yo(t)}}noEligibleProductLeftInCart(t,e){for(const n of t)if(this.eligibilityChecker.isEligible(n,e.appliedRule))return!1;return!0}cartIsEmpty(t,e){return _(t)&&_(e)}}class oa{constructor(t){this.requestParser=t,this.LOG_PREFIX="RequestLineItemsPartitioner"}partition(t){const e=this.requestParser.parse({body:t.requestParams,source:t.source,cart:t.cart});if(!e)return void bo.info(this.LOG_PREFIX,"Could not find parser to extract payload, returning");const n=[],o=[],i=t.cashbackProduct.variantId;return e.forEach((t=>t.variantId===i?n.push(t):o.push(t))),{cashbackLineItems:n,originalLineItems:o}}}class ia{constructor(t,e,n,o,i,r,a){this.cashbackProductService=t,this.cartClient=e,this.methodHandlerFactory=n,this.eligibilityChecker=o,this.cashbackProductUtils=i,this.cartUpdatedEventDispatcher=r,this.cashbackCartDataBuilder=a,this.LOG_PREFIX="CartService"}async run(t){bo.info(this.LOG_PREFIX,"Start add cashback flow");const e=this.cashbackProductService.get();if(!e)return void bo.info(this.LOG_PREFIX,"No cashback product in session");bo.info(this.LOG_PREFIX,"Cashback has found in session storage");const n=await this.cartClient.get();if(vo(n))return void bo.warn(this.LOG_PREFIX,n.message);bo.info(this.LOG_PREFIX,"Got shopify current cart, handling request",{url:t.url});const o=await this.methodHandlerFactory.get(t.url).handle({cart:n.data,cashbackProduct:e,requestParams:t.params,source:t.source});vo(o)?bo.error(this.LOG_PREFIX,o.message):bo.info(this.LOG_PREFIX,"Cart Facade - handle cart change successfully")}async apply(t,e){const n=e??await this.fetchCart();if(!n)return go(!1);const o=n.items;if(this.anyProductIsEligibleForCashback(o,t)){const e=await this.cashbackProductService.addToCart(t.variantId,n,!0);if(vo(e))return yo(e.message)}else await this.removeCashbackFromCart(n);return await this.buildCartDataAndDispatchEvent(n,t),go(!0)}async dispatchCartUpdatedEvent(){const t=await this.fetchCart();if(_(t))return;const e=this.cashbackProductService.get();_(e)||await this.buildCartDataAndDispatchEvent(t,e)}async fetchCart(){const t=await this.cartClient.get();if(!vo(t))return t.data;bo.warn(this.LOG_PREFIX,t.message)}async removeCashbackFromCart(t){const e=t.items.filter((t=>this.cashbackProductUtils.isCashbackProduct(t)));if(_(e))return go(void 0);await this.cashbackProductService.removeAllFromCart(e)}anyProductIsEligibleForCashback(t,e){for(const n of t)if(this.eligibilityChecker.isEligible(n,e.appliedRule))return!0;return!1}async buildCartDataAndDispatchEvent(t,e){const n=await this.cashbackCartDataBuilder.build({leanCart:t,cashbackProduct:e});vo(n)?bo.warn(this.LOG_PREFIX,"Failed to fetch cashback data from fondue endpoint",{e:n.message}):this.cartUpdatedEventDispatcher.dispatch(n.data)}static build(t,e,n,o,i){const r=new To(e,t,n,M),a=ko.build(),s=$r.build(t,o,i),c=X.build(o),d=new wo(r,M,o,s,c),l=wr.build(),u=new Br(a),h=new oa(l),f=Io.build(),p=new Hr(f,new rr),m=new Lr,b=new ta(new Map([[zr.Add,new Ur(d,h,u,p)],[zr.Update,new jr(d,h,u,p,new qr(f))],[zr.RebuyChange,new na(u,d,f)],[zr.RebuyAdd,new ea(u,d,M,f,m)]]));return new ia(d,s,b,f,a,new Ao,new kr(r,M,ir.manager()))}}class ra{constructor(t,e,n){this.cartClient=t,this.fondueUtils=e,this.storage=n,this.LOG_PREFIX="CartStoreService"}async storeCurrentCartSnapshot(){const t=await this.cartClient.get();if(!vo(t))return this.storage.setItem(this.fondueUtils.fondueCartSnapshot,t.data),t.data;bo.warn(this.LOG_PREFIX,"Unable to store cart snapshot due to get cart failure",{e:t.message})}getCartSnapshot(){return this.storage.getItem(this.fondueUtils.fondueCartSnapshot)}}class aa{constructor(t,e){this.fondueUtils=t,this.cartService=e}register(){document.addEventListener(this.fondueUtils.events.public.cartUpdated,this.run.bind(this))}async run(t){await this.cartService.dispatchCartUpdatedEvent()}}class sa{constructor(t,e){this.storage=t,this.fondueUtils=e}publish(t){this.storage.setItem(this.fondueUtils.cashbackCodeStorageKey,t.code),window.dispatchEvent(new CustomEvent(this.fondueUtils.events.internal.promotionCodeExtracted,{detail:t}))}}!function(t){t.Utm="UTM",t.Klaviyo="KLAVIYO",t.PublicEvent="PUBLIC_EVENT"}(Xr||(Xr={}));class ca{constructor(t,e){this.storage=t,this.fondueUtils=e}extract(){return this.storage.getItem(this.fondueUtils.cashbackCodeStorageKey)}}class da{constructor(t,e){this.storage=t,this.fondueUtils=e}extract(){const t=this.storage.getItem(this.fondueUtils.settingsStorageKey);if(t&&t.common.alwaysAppliedSiteWide.enabled&&""!==t.common.alwaysAppliedSiteWide.code)return t.common.alwaysAppliedSiteWide.code}}class la{constructor(t,e){this.extractors=t,this.codeExtractedPublisher=e}extract(){const t=this.extractors.map((t=>t.extract())).find((t=>!_(t)));return t&&this.codeExtractedPublisher.publish({code:t,disabledFeatures:[],source:Xr.Utm}),t}static build(t){return new la(la.getExtractors(t),new sa(t,M))}static getExtractors(t){return[new O(t,M),new ca(t,M),new da(t,M)]}}!function(t){t.CartFlow="CART_FLOW_FEATURE",t.CartModule="CART_MODULE_FEATURE",t.Toast="TOAST",t.InStoreFab="IN_STORE_FAB"}(Vr||(Vr={})),function(t){t.UnSet="UNSET",t.Initializing="INITIALIZING",t.Initialized="INITIALIZED"}(Wr||(Wr={}));class ua{constructor(t,e,n,o){this.fondueUtils=t,this.featuresInitiator=e,this.storage=n,this.publisher=o,this.eventNameToCallbackMap=[[M.events.internal.promotionCodeExtracted,this.run],[M.klaviyo.eventName,this.extractCodeFromKlavyioEvent],[M.events.internal.promotionInit,this.extractCodeFromPromotionInitEvent]]}register(){Object.assign(this.eventNameToCallbackMap).forEach((([t,e])=>{window.addEventListener(t,e.bind(this))})),bo.info("PromotionCodeEventListener","registered event listeners",{eventNames:this.eventNameToCallbackMap.keys()})}async run(t){const e=t.detail.code;this.storage.setItem(this.fondueUtils.cashbackCodeStorageKey,e),this.publisher.dispatch({code:e}),await this.featuresInitiator.init({code:e,disabledFeatures:t.detail.disabledFeatures,source:t.detail.source})}async extractCodeFromKlavyioEvent(t){if(!this.klavyioSubmitEvent(t))return;const e=t.detail.metaData[this.fondueUtils.klaviyo.popupProperty];await this.run(new CustomEvent(this.fondueUtils.klaviyo.eventName,{detail:{code:e,disabledFeatures:[],source:Xr.Klaviyo}}))}klavyioSubmitEvent(t){return["submit"].includes(t.detail.type)}async extractCodeFromPromotionInitEvent(t){const e=t.detail.code,n=t.detail.disableToast?[Vr.Toast]:[];await this.run(new CustomEvent(M.events.internal.promotionCodeExtracted,{detail:{code:e,disabledFeatures:n,source:Xr.PublicEvent}}))}}class ha{dispatch(t){const e=void 0===t?{}:{detail:{cartData:t}},n=new CustomEvent(M.events.internal.extensionReady,e);document.dispatchEvent(n)}}class fa{constructor(t){this.fondueUtils=t}dispatch(t){const e={detail:{code:t.code}},n=new CustomEvent(this.fondueUtils.events.public.promotionApplied,e);document.dispatchEvent(n)}}class pa{constructor(t,e,n){this.fondueApi=t,this.fondueUtils=e,this.storage=n}async attribute(t){if(this.alreadyAttributed(t))return bo.info(this.constructor.name,"Shopper already attributed to experiment variation",{custom:{experimentId:t.experimentId,variationId:t.variationId}}),go(void 0);const e=await this.fondueApi.attributeShopperToExperimentVariation({experimentId:t.experimentId,variationId:t.variationId});return vo(e)?(bo.warn(this.constructor.name,"Failed to attribute shopper to experiment variation",{custom:{payload:t},error:e}),e):(this.storeAttribution(t),go(void 0))}getStoredAttributions(){return this.storage.getItem(this.fondueUtils.shopperExperimentAttributionStorageKey)??{}}storeAttribution(t){const e={...this.getStoredAttributions(),[t.experimentId]:t.variationId};this.storage.setItem(this.fondueUtils.shopperExperimentAttributionStorageKey,e)}alreadyAttributed(t){const e=this.getStoredAttributions()[t.experimentId];return e?e===t.variationId||(bo.warn(this.constructor.name,"Shopper already attributed to another experiment variation",{custom:{experimentId:t.experimentId,attributedVariationId:e,newVariationId:t.variationId}}),!1):(bo.info(this.constructor.name,"Shopper not attributed to experiment variation",{custom:{experimentId:t.experimentId,variationId:t.variationId}}),!1)}}class ma{constructor(t){this.fondueApi=t}register(){document.addEventListener(M.events.internal.modalClosed,this.run.bind(this))}async run(t){const e=await this.fondueApi.reportMetric({type:po.ModalClosed,properties:{origin:t.detail.origin}});vo(e)&&bo.warn("ModalOpenedMetricListener","Failed to report metric",{error:e,custom:{payload:t}})}}class ba{constructor(t){this.fondueApi=t}register(){document.addEventListener(M.events.internal.modalOpened,this.run.bind(this))}async run(t){const e=await this.fondueApi.reportMetric({type:po.ModalOpened,properties:{origin:t.detail.origin}});vo(e)&&bo.warn("ModalOpenedMetricListener","Failed to report metric",{error:e,custom:{payload:t}})}}class ga{isUsd(){const t=window.Shopify?.currency?.active;return!t||"USD"===t}}class ya{constructor(t,e,n){this.fondueUtils=t,this.currencyIdentifier=e,this.storage=n,this.logPrefix="ExtensionEnabler: "}enabled(t){return"true"===this.storage.getItem(this.fondueUtils.sessionKeys.fonduebugger)?(bo.enabled=!0,bo.info(this.logPrefix,"Extension is running in debug mode, to disable please clear session"),!0):!1===t?.common?.extensionEnabled?(bo.info(this.logPrefix,"Extension is disabled by store front config"),!1):!!this.currencyIdentifier.isUsd()||(bo.info(this.logPrefix,"Extension is disabled because of non usd currency"),!1)}}!function(t){t.Observer="OBSERVER",t.Rebuy="REBUY"}(Kr||(Kr={}));class va{constructor(t,e,n){this.cartRequestObserver=t,this.rebuyCartListener=e,this.cartIdentifier=n}async register(){const t=this.cartIdentifier.getType();return await T(t).with(b.Rebuy,(()=>this.initRebuyCartListener())).with(b.ShopifyAjax,b.ShopifyStorefront,(()=>this.initObserver())).exhaustive()}async initObserver(){bo.info(this.constructor.name,"Initializing cart request observer"),await this.cartRequestObserver.observe(),document.addEventListener("rebuy.loaded",this.initRebuyCartListener.bind(this))}async initRebuyCartListener(){bo.report(this.constructor.name,"Initializing Rebuy cart listener"),this.cartRequestObserver.turnOff(),await this.rebuyCartListener.listen()}}!function(t){t.Fetch="fetch",t.Xml="xmlhttprequest"}(Jr||(Jr={}));class wa{constructor(t,e){this.fondueUtils=t,this.cartService=e,this.LOG_PREFIX="CartRequestObserver",this.CART_REQUEST_ENTRY_NAME="cart";try{this.observer=new PerformanceObserver((async t=>{const e=t.getEntries();for(const t of e)Object.values(Jr).includes(t.initiatorType.toLowerCase())&&this.isValidCartUpdateRequest(t)&&await this.cartService.dispatchCartUpdatedEvent()}))}catch(t){bo.error(this.LOG_PREFIX,"Failed to create cart update observer",{error:t}),this.observer=void 0}}async observe(){if(this.observer)try{this.observer.observe({entryTypes:["resource"]})}catch(t){bo.error(this.LOG_PREFIX,"Failed to run cart update observer",{error:t})}else bo.error(this.LOG_PREFIX,"Failed to run cart update observer - observer is undefined")}turnOff(){try{this.observer.disconnect()}catch(t){bo.error(this.LOG_PREFIX,"Failed to turn off cart update observer",{error:t})}}isValidCartUpdateRequest(t){return!_(t.name)&&(!t.name.toLowerCase().includes(this.fondueUtils.requestIndicator)&&(this.isCommonCartUpdateRequest(t)||this.isXmlCartUpdateRequest(t)))}isCommonCartUpdateRequest(t){const e=t.name.toLowerCase();return Object.values(Gr).some((t=>e.includes(t)))}isXmlCartUpdateRequest(t){const e=t.name.includes("ridge");return t.initiatorType===Jr.Xml&&t.name.includes(this.CART_REQUEST_ENTRY_NAME)&&e}static build(t,e){return new wa(M,e)}}class ka{constructor(t){this.cartService=t}async listen(){document.addEventListener("rebuy:cart.add",this.dispatchCartUpdatedEvent.bind(this)),document.addEventListener("rebuy:cart.change",this.dispatchCartUpdatedEvent.bind(this))}turnOff(){document.removeEventListener("rebuy:cart.add",this.dispatchCartUpdatedEvent.bind(this)),document.removeEventListener("rebuy:cart.change",this.dispatchCartUpdatedEvent.bind(this))}async dispatchCartUpdatedEvent(){await this.cartService.dispatchCartUpdatedEvent()}}class xa{constructor(t,e,n,o,i,r){this.shop=t,this.shopperFeatureToggleService=e,this.settingsStorage=n,this.cartListenerManager=o,this.extensionFeatureSelector=i,this.fonduePublicObject=r}async initFeatures(t,e,n,o){if(!_(e)){const t=await j.getInstance().get();await this.shopperFeatureToggleService.init({sessionId:t,shopDomain:this.shop})}await this.cartListenerManager.register();const i={shop:this.shop,storeFrontSettings:t,cashbackProduct:e,currentCart:n,forcedEnabledFeatures:this.getForcedEnabledFeatures()},r=this.extensionFeatureSelector.select(i).filter((t=>!o?.includes(t.getName())));await Promise.allSettled(r.map((async t=>{await this.handleFeatureInitialize(t,i)})))}async handleFeatureInitialize(t,e){const n=t.getName(),o=this.fonduePublicObject.getFeatureStatus(n);if(vo(o))return bo.warn(this.constructor.name,`Error while getting feature status for feature: ${n}`),yo("Error while getting feature status for feature");if(!t.shouldInit(o.data))return bo.info(this.constructor.name,`Skipping initialize for Feature : ${n}`),go(void 0);const i=this.fonduePublicObject.setFeatureStatus(n,Wr.Initializing);if(vo(i))return bo.warn(this.constructor.name,`Error while changing feature status to initializing for feature: ${n}`),i;const r=await t.init(e);if(vo(r))return bo.warn(this.constructor.name,`Error while initializing feature: ${n}`),r;const a=this.fonduePublicObject.setFeatureStatus(n,Wr.Initialized);return vo(a)?(bo.warn(this.constructor.name,`Error while changing feature status to initialized for feature: ${n}`),a):(vo(r)&&(bo.warn(this.constructor.name,`Error while initializing feature: ${n}`),this.fonduePublicObject.setFeatureStatus(n,Wr.UnSet)),r)}getForcedEnabledFeatures(){try{const t=new URLSearchParams(window.location.search).get(M.sessionKeys.fondueFeature)?.split(",");return _(t)?this.settingsStorage.getItem(M.sessionKeys.fondueFeature)??[]:(this.settingsStorage.setItem(M.sessionKeys.fondueFeature,t),this.settingsStorage.removeItem(M.sessionKeys.cbAppliedShown),t)}catch(t){return bo.error(this.constructor.name,"Error while getting forced enabled features",{err:t,errorMessage:t?.message,stringifyError:JSON.stringify(t)}),[]}}}class Ca{constructor(t,e){this.fondueUtils=t,this.cartService=e}register(){document.addEventListener(this.fondueUtils.events.internal.fonduePromotionApplied,this.run.bind(this))}async run(t){await this.cartService.apply(t.detail.item)}}class Ea{filter(t,e){return t.filter((t=>{const n=e.find((e=>e.variantId===t.variantId));return!n||n.quantity!==t.quantity}))}}class Sa{constructor(t){this.cartService=t,this.LOG_PREFIX="RebuyRequestHandler",this.before.bind(this),this.after.bind(this),this.lock=!1}shouldHandle(t,e){return _(t)?{result:Tr.DoNotIntercept}:{result:Tr.Intercept}}async before(t,e,n){if(_(window.Rebuy.SmartCart)&&bo.report(this.LOG_PREFIX,"Rebuy request handler called even when Rebuy SmartCart object was not loaded, cashback related feature might not work as expected"),!this.noItemsOnRequest(e)&&!this.handling()){bo.info(this.LOG_PREFIX,"Rebuy cart changed, performing cart facade",{url:t,source:n}),this.lock=!0;try{await this.cartService.run({url:t,params:e,source:n}),this.setTimeoutToFreeLock()}catch{this.lock=!1}}}async after(t,e,n){}handling(){return this.lock}setTimeoutToFreeLock(){setTimeout((()=>{this.lock=!1}),800)}noItemsOnRequest(t){return _(t.cart.items())&&_(t.item)}}class Ia{constructor(t){this.fondueUtils=t,this.cartApiUrls=Object.values(Gr)}filter(t){return this.cartApiUrls.some((e=>t.toString().includes(e)))}filterFondueRequest(t){return!_(t)&&t.includes(this.fondueUtils.requestIndicator)}}!function(t){t.BeforeCartRequest="beforeCartRequest",t.AfterCartRequest="afterCartRequest"}(Yr||(Yr={}));class Aa{constructor(t,e,n,o,i){this.requestValidator=t,this.requestFilter=e,this.cartService=n,this.cartStoreService=o,this.hooksRunner=i,this.LOG_PREFIX="ShopifyRequestHandler",this.before.bind(this),this.after.bind(this),this.lock=!1}shouldHandle(t,e,n){return this.requestValidator.validate(t,e,n)}async before(t,e,n){bo.info(this.LOG_PREFIX,"Request is cart related, performing cart facade",{url:t,source:n}),this.lock=!0;try{bo.info(this.LOG_PREFIX,"Running beforeCartRequest hooks",{source:n}),await this.hooksRunner.run(Yr.BeforeCartRequest,t,e,n),bo.info(this.LOG_PREFIX,"Successfully ran beforeCartRequest hooks",{source:n}),bo.info(this.LOG_PREFIX,"Running cart facade",{source:n}),await this.cartService.run({url:t,params:e,source:n}),bo.info(this.LOG_PREFIX,"Successfully ran cart facade",{source:n}),this.setTimeoutToFreeLock()}catch(o){this.lock=!1,bo.warn(this.LOG_PREFIX,"Failed to run before",{url:t,params:e,source:n,error:o})}}async after(t,e,n){this.requestFilter.filter(t)&&this.callStackableWhenIntercept();try{await this.cartStoreService.storeCurrentCartSnapshot(),bo.info(this.LOG_PREFIX,"Running afterCartRequest hooks",{source:n}),await this.hooksRunner.run(Yr.AfterCartRequest,t,e,n),bo.info(this.LOG_PREFIX,"Successfully ran afterCartRequest hooks",{source:n})}catch(o){bo.warn(this.LOG_PREFIX,"Failed to run after",{url:t,params:e,source:n,error:o})}}handling(){return this.lock}setTimeoutToFreeLock(){const t=setInterval((()=>{this.lock=!1,clearInterval(t)}),800)}callStackableWhenIntercept(){try{if(!window.stackableService)return;window.stackableService.send("cartChanged")}catch(t){return}}}class Ta{constructor(t,e,n,o,i){this.requestFilter=t,this.cartStoreService=e,this.requestParser=n,this.cashbackProductService=o,this.cartDiffFilter=i}validate(t,e,n){if(_(t)||this.requestFilter.filterFondueRequest(t)||!this.requestFilter.filter(t))return{result:Tr.DoNotIntercept};const o=this.cartStoreService.getCartSnapshot();if(_(o))return this.validateNonCartUpdateRequest();const i=this.parseRequest(e,n,o);if(void 0===i)return this.validateNonCartUpdateRequest();const r=this.cashbackProductService.get(),a=this.cartDiffFilter.filter(i,o.items);return this.validateCartUpdateRequest(a,r)}parseRequest(t,e,n){return this.requestParser.parse({body:t,source:e,cart:n})}validateNonCartUpdateRequest(){return{result:Tr.DoNotIntercept}}validateCartUpdateRequest(t,e){return e&&this.isCashbackProductUpdateOnly(t,e)?{result:Tr.Block}:{result:Tr.Intercept}}isCashbackProductUpdateOnly(t,e){if(!this.singleProductWasUpdated(t))return!1;const n=t[0];return this.productIsCashbackProduct(n,e)&&this.productWasNotRemoved(n)}singleProductWasUpdated(t){return 1===t.length}productIsCashbackProduct(t,e){return t.variantId===e.variantId}productWasNotRemoved(t){return t.quantity>0}}class Pa{constructor(t){this.hooks=t,this.logPrefix="HooksRunner"}async run(t,e,n,o){bo.info(this.logPrefix,"Running hooks",{type:t,source:o});const i=this.hooks.get(t);for(const t of i){bo.info(this.logPrefix,"Running hook",{hook:{type:t.type,name:t.name,appName:t.appName}});try{await t.callback(e,n,o),bo.info(this.logPrefix,"Successfully ran hook",{hook:{type:t.type,name:t.name,appName:t.appName}})}catch(e){bo.warn(this.logPrefix,"Error running hook",{hook:{type:t.type,name:t.name,appName:t.appName},error:e})}}}}!function(t){t.True="true",t.False="false",t.Default="default"}(Zr||(Zr={})),function(t){t.CashbackProduct="cashback-product",t.CartModule="cart-module",t.Bubble="bubble",t.Toast="toast",t.CartModuleSafeExtract="cart-module-safe-extract",t.CbAppliedToast="cb-applied-toast",t.CbAppliedPopup="cb-applied-popup",t.CbAppliedFab="cb-applied-fab",t.InStoreBubble="in-store-bubble",t.InStoreBanner="in-store-banner",t.OnsiteWidget="onsite-widget"}(Qr||(Qr={}));class _a{constructor(){this.LOG_PREFIX="FondueClickEventInterceptor",this.handler=null}apply(){this.applied?bo.info(this.LOG_PREFIX,"Interceptor already applied"):(document.addEventListener("click",this.clickEventHandler.bind(this)),[...document.getElementsByTagName("a")].forEach((t=>{t.href.includes(Gr.Change)&&t.addEventListener("click",this.clickEventHandler.bind(this))})),this.applied=!0)}unapply(){[...document.getElementsByTagName("a")].forEach((t=>t.removeEventListener("click",this.clickEventHandler.bind(this)))),this.applied=!1}register(t){this.handler=t}unregisterAll(){this.handler=null}async clickEventHandler(t){if(this.handler.handling())return;const e=this.extractHref(t);if(_(e)||!e.includes(Gr.Change))return;this.removeEventListener();const n=e.split("?")[1];if(!_(n)){t.preventDefault();try{const t=this.handler.shouldHandle(Gr.Change,n,Ar.Click);T(t).with({result:Tr.Intercept},(async()=>{await this.handler.before(Gr.Change,n,Ar.Click),window.location=e})).with({result:Tr.DoNotIntercept},(()=>{window.location=e})).with({result:Tr.Block},(()=>{bo.info("FondueClickEventInterceptor","Skipping original request")})).exhaustive()}catch(t){bo.error(self.constructor.name,"Error while preforming [before]",{error:t})}}}removeEventListener(){[...document.getElementsByTagName("a")].forEach((t=>t.removeEventListener("click",this.clickEventHandler.bind(this))))}extractHref(t){try{return t.target.href||evet.currentTarget.href}catch(t){return}}}class La{constructor(){this.LOG_PREFIX="FondueFormSubmissionInterceptor",this.handler=null}apply(){this.applied?bo.info(this.LOG_PREFIX,"Interceptor already applied"):(document.addEventListener("submit",this.submitEventHandler.bind(this)),this.applied=!0)}unapply(){document.removeEventListener("submit",this.submitEventHandler.bind(this)),this.applied=!1}register(t){this.handler=t}unregisterAll(){this.handler=null}async submitEventHandler(t){if(this.handler.handling())return;const e=new FormData(t.target),n=this.handler.shouldHandle(Gr.Add,e,Ar.Form);T(n).with({result:Tr.Intercept},(async()=>{t.preventDefault();try{await this.handler.before(Gr.Add,e,Ar.Form)}catch(t){bo.error(self.constructor.name,"Error while preforming [before]",{error:t})}document.removeEventListener("submit",this.submitEventHandler.bind(this)),t.target.submit()})).with({result:Tr.DoNotIntercept},(async()=>{})).with({result:Tr.Block},(()=>{bo.info("FondueFormSubmissionInterceptor","Skipping original request")})).exhaustive()}}class Oa{constructor(){this.LOG_PREFIX="FondueRebuyInterceptor",this.handler=null}apply(){this.applied?bo.info(this.LOG_PREFIX,"Interceptor already applied"):(document.addEventListener("rebuy:cart.add",this.onCartAdd.bind(this)),document.addEventListener("rebuy:cart.change",this.onCartChange.bind(this)),this.applied=!0)}unapply(){document.removeEventListener("rebuy:cart.add",this.onCartAdd.bind(this)),document.removeEventListener("rebuy:cart.change",this.onCartChange.bind(this)),this.applied=!1}register(t){this.handler=t}unregisterAll(){this.handler=null}async onCartAdd(t){try{await this.handler.before(Gr.RebuyAdd,t.detail,Ar.Rebuy)}catch(t){bo.error(self.constructor.name,"Error while preforming [before]",{error:t})}}async onCartChange(t){try{await this.handler.before(Gr.RebuyChange,t.detail,Ar.Rebuy),await this.handler.after(Gr.RebuyChange,t.detail,Ar.Rebuy)}catch(t){bo.error(self.constructor.name,"Error while preforming [before]",{error:t})}}}const Ra=window.XMLHttpRequest.prototype.send,Fa=window.XMLHttpRequest.prototype.open;class Ma{constructor(){this.LOG_PREFIX="FondueXHRInterceptor",this.handler=null}apply(){if(this.applied)return void bo.info(this.LOG_PREFIX,"XHR Interceptor already on");const t=this;window.XMLHttpRequest.prototype.open=function(){return t.originUrl=arguments[1],Fa.apply(this,arguments)},window.XMLHttpRequest.prototype.send=async function(){const e=4,n=t.handler.shouldHandle(t.originUrl,arguments,Ar.Xhr);T(n).with({result:Tr.Intercept},(async()=>{try{await t.handler.before(t.originUrl,arguments,Ar.Xhr)}catch(e){bo.error(t.constructor.name,"Error while preforming [before]",{error:e})}Ra.apply(this,arguments);const n=this.onreadystatechange;this.onreadystatechange=async function(){n&&n.apply(this,arguments),this.readyState===e&&await t.handler.after(this.responseURL,arguments,Ar.Xhr)}})).with({result:Tr.DoNotIntercept},(async()=>{Ra.apply(this,arguments);const t=this.onreadystatechange;this.onreadystatechange=async function(){t&&t.apply(this,arguments)}})).with({result:Tr.Block},(()=>{bo.info("FondueXHRInterceptor","Skipping original request")})).exhaustive()},this.applied=!0}unapply(){window.XMLHttpRequest.prototype.open=Fa,window.XMLHttpRequest.prototype.send=Ra,this.applied=!1}register(t){this.handler=t}unregisterAll(){this.handler=null}}class Da{constructor(t,e,n,o,i,r){this.cartService=t,this.cartStoreService=e,this.cashbackProductService=n,this.interceptors=o,this.cartInterceptorHandler=i,this.cashbackProductExtractedEventListener=r,this.LOG_PREFIX="CartFlowFeature"}isEnabled(t){if([g.Note,g.Hybrid].includes(t.storeFrontSettings.common.cashbackMode))return bo.debug(this.LOG_PREFIX,`Cashback mode is set to ${t.storeFrontSettings.common.cashbackMode.toString()}, feature disabled`),!1;if(_(t.cashbackProduct))return bo.debug(this.LOG_PREFIX,"No cashback product found, feature disabled"),!1;if(t.forcedEnabledFeatures.includes(this.getName()))return!0;const e=ir.manager().get(Qr.CashbackProduct,!0);return bo.debug(this.LOG_PREFIX,"Cart Flow is toggled "+(e?"on":"off")),e}async init(t){bo.info(this.LOG_PREFIX,"Initializing cart flow feature");try{return await this.injectCashbackOnload(t.storeFrontSettings,t.cashbackProduct),this.cashbackProductExtractedEventListener.register(),this.interceptors.forEach((t=>{t.register(this.cartInterceptorHandler),t.apply()})),go(void 0)}catch(t){return bo.error(this.LOG_PREFIX,"Failed to init cart flow feature",{error:t}),yo("Failed to load cart flow feature")}}shouldInit(t){return t===Wr.UnSet}async injectCashbackOnload(t,e){const n=t.common?.addCashbackProductOnLoad??!1;if(n){const t=await this.cartStoreService.storeCurrentCartSnapshot();await this.cashbackProductService.injectCashbackOnload(e,n,t)}await this.cartService.apply(e)}static build(t,e,n,o,i,r,a){const s=new To(e,t,n,M),c=$r.build(t,i,r),d=X.build(i),l=new wo(s,M,i,c,d),u=wr.build(),h=new ra(c,M,i),f=new Aa(new Ta(new Ia(M),h,u,l,new Ea),new Ia(M),a,h,new Pa(r.Hooks)),p=new Sa(a),m=o?p:f,b=[new Fr,new Ma,new La,new _a],g=[new Oa],y=o?g:b,v=new Ca(M,a);return new Da(a,h,l,y,m,v)}getName(){return Vr.CartFlow}}class Na{}Na.isDatadogServiceInitiated=!1,Na.init=(t={shouldLog:!1,shouldPublish:!0,datadogInitConfig:{extraData:{},clientToken:void 0,serviceName:void 0,env:void 0}})=>{Na.shouldLog=t.shouldLog,Na.shouldPublish=t.shouldPublish,Na.datadogInitConfig=t.datadogInitConfig;const{datadogInitConfig:e}=t;if(e&&e.clientToken&&e.serviceName||(Na.shouldPublish=!1),!Na.isDatadogServiceInitiated&&Na.shouldPublish)try{mo.onReady((()=>{mo.init({clientToken:t.datadogInitConfig.clientToken,service:t.datadogInitConfig.serviceName,site:"datadoghq.com",forwardErrorsToLogs:!1,env:t.datadogInitConfig.env,sampleRate:100}),Na.isDatadogServiceInitiated=!0}))}catch(t){Na.error(t.toString())}},Na.publishInfo=(t,e={})=>{Na.shouldPublish&&(e={...e,...Na.datadogInitConfig.extraData},mo.onReady((()=>mo.logger.info(t,e))))},Na.publishError=(t,e={})=>{Na.shouldPublish&&(e={...e,...Na.datadogInitConfig.extraData},mo.onReady((()=>mo.logger.error(t,e))))},Na.info=t=>{if(Na.shouldLog)try{console.log(`%cFONDUE: ${t}`,"color: white; background: gray")}catch(e){console.log(`Error: ${e.toString()}`),console.log(`Something went wrong while trying to log.info: ${t}`)}Na.publishInfo(t)},Na.error=t=>{try{console.log(`%cError: ${t}`,"color: blue; background: yellow")}catch(e){console.log(`Error: ${e.toString()}`),console.log(`Something went wrong while trying to log.error: ${t}`)}Na.publishError(t)};class $a{}$a.PageLoadCompleteEventName="PAGE_LOAD_COMPLETED_EVENT",$a.MiniCartRenderCompletedEventName="MINI_CART_RENDER_COMPLETED_EVENT",$a.LocationChangedEventName="LOCATION_CHANGED_EVENT",$a.ShopifyAnalyticsReadyEventName="SHOPIFY_ANALYTICS_EVENT";class Ba{constructor(){this.listeners={},this.shopifyClientApi=new Ha(this),this.domApi=new Ua}init(){this.handleLocationChangedEvent(),this.handlePageLoadCompletedEvent(),this.handleShopifyAnalyticsReadyEvent()}addListener(t,e){void 0===this.listeners[t]&&(this.listeners[t]=[]),this.listeners[t].push(e),t===$a.PageLoadCompleteEventName&&this.handleRaceConditionPageLoadCompletedEvent()}getCurrentLocation(){return window.location}getShopifyClientApi(){return Object.keys(this.shopifyClientApi.shopifyAnalytics).length||this.shopifyClientApi.initShopifyAnalytics(),this.shopifyClientApi}getDOMApi(){return this.domApi}observeAddedNode(t,e,n,o={childList:!0,subtree:!0}){new MutationObserver(((t,o)=>{for(const o of t)for(const t of o.addedNodes)if(t.nodeType===Node.ELEMENT_NODE){if(t.matches(e))return void n();const o=this.getDOMApi().getElementsByTagName("*",t);for(const t of o)if(t.matches(e))return void n()}})).observe(t,o)}handlePageLoadCompletedEvent(){document.addEventListener("readystatechange",(()=>{"complete"===document.readyState&&this.invokeEvent($a.PageLoadCompleteEventName,[])}))}handleLocationChangedEvent(){let t=`${window.location}`;setInterval((()=>{`${window.location}`!==t&&(t=`${window.location}`,this.invokeEvent($a.LocationChangedEventName,[window.location]))}),100)}handleShopifyAnalyticsReadyEvent(){let t=window.ShopifyAnalytics?.meta?.selectedVariantId;if(t)this.invokeEvent($a.ShopifyAnalyticsReadyEventName,[]);else{const e=setInterval((()=>{t=window.ShopifyAnalytics?.meta?.selectedVariantId,t&&(clearInterval(e),this.invokeEvent($a.ShopifyAnalyticsReadyEventName,[]))}),100)}}handleRaceConditionPageLoadCompletedEvent(){"complete"===document.readyState&&this.invokeEvent($a.PageLoadCompleteEventName,[])}invokeEvent(t,e){const n=this.listeners[t];if(n)for(const t of n)t(...e)}}class Ua{querySelector(t,e=document){return e.querySelector(t)}querySelectorAll(t,e=document){return e.querySelectorAll(t)}getElementsByTagName(t,e){return e.getElementsByTagName(t)}getParentElement(t){return t.parentElement}getBoundingClientRect(t){return t.getBoundingClientRect()}deleteElementById(t){const e=document.getElementById(t);e?e.remove():Na.info(`Could not find element for deletion; id: [${t}]`)}deleteElement(t){t&&t.remove()}getElementById(t,e=document){return e.getElementById(t)}pushDomElementAsBodyLastChild(t){document.body.lastElementChild.insertAdjacentHTML("afterend",t)}pushDomElementAsFirstChild(t,e){e.insertAdjacentHTML("afterbegin",t)}pushDomElement(t,e,n){n.insertAdjacentHTML(t,e)}parseHtmlToNode(t){const e=document.createElement("div");return e.innerHTML=t,e.firstChild}}class Ha{constructor(t){this.clientApi=t,this.initShopifyAnalytics()}initShopifyAnalytics(){this.shopifyAnalytics=void 0!==window.ShopifyAnalytics&&null!==window.ShopifyAnalytics?window.ShopifyAnalytics:{},this.shopify=window.Shopify}getAllVariants(){return this.shopifyAnalytics?.meta?.product?.variants}}class qa{constructor(t,e,n){this.cartStoreService=t,this.storage=e,this.cashbackCartDataBuilder=n,this.LogPrefix="CashbackCartDataGetter: "}async get(){const t={totalAmount:0,cashback:{products:[],appliedLineItems:[],totalAmount:{value:0,currency:""},availableMethods:{},activePromotions:[],remainingAmountToThreshold:0},cartItems:[]},e=await this.cartStoreService.storeCurrentCartSnapshot();if(_(e))return t;const n=this.storage.getItem(M.cashbackProductStorageKey);if(_(n))return t;const o={leanCart:e,cashbackProduct:n},i=await this.cashbackCartDataBuilder.build(o);return vo(i)?t:i.data}}class ja{calc(t){const e=t.cashback.products,n=e.length>0?e[0].minTotalAmountThreshold:0;return{isLowerThanThreshold:n&&0===t.cashback.totalAmount.value,threshold:n,cashbackProduct:n&&e[0]||null}}}class Ga{constructor(t){this.numberFormatter=t}calc(t,e,n){const o=Number(t);if(!e||!n)return this.numberFormatter.calc(o);const i=Number(n);try{return this.numberFormatter.calc(o+o*(i/100))}catch(t){return this.numberFormatter.calc(o)}}}class za{calc(t){const e=Number(t),n=Number.isInteger(e)?0:2;return e.toFixed(n)}}const Xa="percentage";var Va,Wa,Ka,Ja;!function(t){t.Common="common",t.LowerThanThreshold="lowerThanThreshold"}(Va||(Va={}));class Ya{constructor(t,e,n,o){this.minimalThresholdCalculator=t,this.cartMaxAmountCalculator=e,this.numberFormatter=n,this.imagesConfig=o}convert(t,e){const n=this.cartMaxAmountCalculator.calc(this.numberFormatter.calc(t.cashback.totalAmount.value),e.productPage.reflectGiftCardBoostInModule,e.common.giftCardPercentBonus),o=t.cashback.products.some((t=>t.appliedRule.type.toString()!==lo.Any));return{displayAmount:n,currency:e.common.currency,images:{...this.imagesConfig.images,merchantLogo:e.common.merchantLogo},moduleType:Va.Common,priceColor:e.cartPage.priceColor,outlineColor:e.cartPage.outlineColor,percentagePresent:t.cashback.products.length&&t.cashback.products.some((t=>t.unit===Xa)),percentageValue:t.cashback.products?.[0]?.amount??0,includeExcludeApplied:o,showLegacyModule:e.showLegacyModule,reflectGiftCardBoostInModule:e.productPage.reflectGiftCardBoostInModule}}static build(t){return new Ya(new ja,new Ga(new za),new za,t)}}class Za{constructor(t,e,n,o){this.minimalThresholdCalculator=t,this.cartMaxAmountCalculator=e,this.numberFormatter=n,this.imagesConfig=o}convert(t,e){const n=t.cashback.products.some((t=>t.appliedRule.type.toString()!==lo.Any)),o=this.minimalThresholdCalculator.calc(t),i=o.threshold-t.totalAmount,r=this.numberFormatter.calc(o.cashbackProduct?o.cashbackProduct.amount:0);return{displayAmount:this.cartMaxAmountCalculator.calc(r,e.productPage.reflectGiftCardBoostInModule,e.common.giftCardPercentBonus),amountToAdd:this.numberFormatter.calc(i),currency:e.common.currency,images:{...this.imagesConfig.images,merchantLogo:e.common.merchantLogo},moduleType:Va.LowerThanThreshold,priceColor:e.cartPage.priceColor,outlineColor:e.cartPage.outlineColor,percentagePresent:o.cashbackProduct&&o.cashbackProduct.unit===Xa,percentageValue:t.cashback.products?.[0]?.amount??0,thresholdAmount:o.threshold,includeExcludeApplied:n,showLegacyModule:e.showLegacyModule,reflectGiftCardBoostInModule:e.productPage.reflectGiftCardBoostInModule}}static build(t){return new Za(new ja,new Ga(new za),new za,t)}}class Qa{constructor(t,e,n){this.minimalThresholdCalculator=t,this.cartDataToCommonPropsConverter=e,this.cartDataToThresholdPropsConverter=n}convert(t,e){return this.minimalThresholdCalculator.calc(t).isLowerThanThreshold?this.cartDataToThresholdPropsConverter.convert(t,e):this.cartDataToCommonPropsConverter.convert(t,e)}static build(t){return new Qa(new ja,Ya.build(t),Za.build(t))}}class ts{buildHtml(t){return`<div class="fnd-content-title">\n        <span>Buy and</span>\n        <span class="fnd-pay-back-container">\n          <span>get</span>\n          <span class="fnd-pay-back">${t.currency}${t.displayAmount} back</span>\n        </span>\n      </div>\n      `}}class es{buildHtml(t){return`<div class="fnd-content-title">\n          <span>${t.includeExcludeApplied?`Add <span class="fnd-include-exclude-with-threshold">qualified items<span class="fnd-tooltip">Valued over $${t.thresholdAmount}</span></span> and`:Number(t.amountToAdd)>0?`You're ${t.currency}${t.amountToAdd} away`:"Buy and"}</span>\n          <span class="fnd-pay-back-container">\n            ${t.includeExcludeApplied?"get":t.amountToAdd?"from":"get"}\n            <span class="fnd-pay-back">${(t.percentagePresent&&t.amountToAdd?`${t.percentageValue}%`:`${t.currency}${t.displayAmount}`)+" back"}</span>\n          </span>\n        </div>`}}class ns{buildHtml(t){return`\n        ${"0"!==t.displayAmount?`\n            <p>You get${t.reflectGiftCardBoostInModule?" up to":""}\n                <span style="color: ${t.priceColor}">${t.currency}${t.displayAmount}</span>\n                after your purchase to use anywhere.\n            </p>\n        `:""}\n        <p style="margin:4px 0 0 0;" >\n            ${"0"===t.displayAmount?"Add a CashBack eligible product to your cart in order to receive real cash.":""} No points. No coupons. Just cash.\n        </p>\n`}}class os{buildHtml(t){return`\n        <p>\n          Spend\n          <span style="color:${t.priceColor}"> ${t.currency}${t.amountToAdd} more </span>\n          in order to get${t.reflectGiftCardBoostInModule&&!t.percentagePresent?" up to":""}\n          <span style="color:${t.priceColor}">${t.percentagePresent?`${t.percentageValue}%`:`${t.currency}${t.displayAmount}`} CashBack</span>\n          <div>\n              No points. No coupons. Just cash.\n          </div>\n      </p>\n    `}}class is{constructor(t,e,n,o){this.legacyBodyBuilder=t,this.legacyLowerThanThresholdBodyBuilder=e,this.commonBodyBuilder=n,this.commonLowerThanThresholdBodyBuilder=o}buildHtml(t){return!0===t.showLegacyModule?t.moduleType===Va.Common?this.legacyBodyBuilder.buildHtml(t):this.legacyLowerThanThresholdBodyBuilder.buildHtml(t):t.moduleType===Va.Common?this.commonBodyBuilder.buildHtml(t):this.commonLowerThanThresholdBodyBuilder.buildHtml(t)}static build(){return new is(new ns,new os,new ts,new es)}}class rs{constructor(t,e){this.bodyBuilder=t,this.lowerThanThresholdModuleBody=e}buildHtml(t){return`\n        <div class="fnd-banner-wrapper">\n          <div class="fnd-left-side">\n            <div class="fnd-content-text">\n              <div class="fnd-content-title-container">\n                ${t.moduleType===Va.Common?this.bodyBuilder.buildHtml(t):this.lowerThanThresholdModuleBody.buildHtml(t)}\n                <div class="fnd-img-container">\n                  <img src="${t.images.cashbackIcon}" alt="icon" />\n                </div>\n              </div>\n              <div class="fnd-content-subtitle">\n                After purchase\n              </div>\n            </div>\n          </div>\n          <div class="fnd-right-side">\n            <div class="fnd-popup-trigger" onclick='event.stopPropagation(),document.getElementById("id01").style.height="100%",document.getElementById("id01").style.opacity=1,document.getElementById("cash-back-modal").style.display="block"'>\n              How do I get it?\n            </div>\n          </div>\n        </div>\n      `}static build(){return new rs(new ts,new es)}}class as{constructor(t,e){this.legacyBodyBuilder=t,this.legacyLowerThanThresholdModuleBody=e}buildHtml(t){return`\n        <div class="fnd-legacy-banner-wrapper" style="border: 1px solid ${t.outlineColor}">\n            <div class="fnd-legacy-banner-wrapper-top">\n                <div class="fnd-legacy-logos-container">\n                    <div class="fnd-legacy-image-wrapper">\n                        <img width=20 height=20 src=${t.images.cashbackSign} alt="icon" />\n                    </div>\n                    <img width=96 height=12 src=${t.images.cashbackText} alt="logo" />\n                </div>\n                <div class="fnd-legacy-info-wrapper" onclick='document.getElementById("id01").style.height="100%",document.getElementById("id01").style.opacity=1,document.getElementById("cash-back-modal").style.display="block"'>\n                    <img width=14 height=14 src=${t.images.infoIcon} alt="i" />\n                </div>\n            </div>\n            <div class="fnd-legacy-banner-wrapper-bottom">\n                ${t.moduleType===Va.Common?this.legacyBodyBuilder.buildHtml(t):this.legacyLowerThanThresholdModuleBody.buildHtml(t)}\n            </div>\n        </div>\n      `}static build(){return new as(new ns,new os)}}class ss{constructor(t,e){this.legacyModuleBuilder=t,this.moduleBuilder=e}buildHtml(t){return!0===t.showLegacyModule?this.legacyModuleBuilder.buildHtml(t):this.moduleBuilder.buildHtml(t)}static build(){return new ss(as.build(),rs.build())}}class cs{constructor(t,e){this.cartDataToModulePropsConverter=t,this.moduleBuilder=e}create(t,e){const n=this.cartDataToModulePropsConverter.convert(t,e);return this.moduleBuilder.buildHtml(n)}}class ds{constructor(t,e,n){this.cartDataToModulePropsConverter=t,this.bodyBuilder=e,this.clientApi=n,this.LOG_PREFIX="ModuleElementUpdater"}async update(t,e,n){const o=this.cartDataToModulePropsConverter.convert(e,n),i=this.bodyBuilder.buildHtml(o),r=t.map((t=>{const e=t.getElementsByClassName("fnd-content-title")[0],n=this.clientApi.getDOMApi().parseHtmlToNode(i);return e.parentElement.replaceChild(n,e),n}));!_(r)&&r.length||bo.error(this.LOG_PREFIX,"Failed to find module body element")}}class ls{constructor(t,e,n,o,i){this.storeFrontSettings=t,this.clientApi=e,this.moduleElementCreator=n,this.moduleElementUpdater=o,this.childElements=i,this.lock=!1}async place(t,e){this.lockLock();try{await this.handlePlacing(t,e)}catch(t){bo.warn(this.constructor.name,"Failed to place cart module")}this.scheduleUnlock()}placingLocked(){return this.lock}async handlePlacing(t,e){const n=this.getModuleList(t);for(const o of n){const n=this.getModuleWrappers(t,o);n.length>0?await this.handleModuleAlreadyExists(n,e):(bo.report(this.constructor.name,"Placing cart module"),await this.handleModuleDoesNotExist(o,e))}for(const t of this.childElements)await t.updateElement(e)}getModuleList(t){return[...this.clientApi.getDOMApi().querySelectorAll(t.anchorSelector)]}getModuleWrappers(t,e){return[...this.clientApi.getDOMApi().querySelectorAll(t.anchorWrapperSelector,e)]}async handleModuleAlreadyExists(t,e){await this.moduleElementUpdater.update(t,e,this.storeFrontSettings)}async handleModuleDoesNotExist(t,e){const n=this.moduleElementCreator.create(e,this.storeFrontSettings);t.insertAdjacentHTML("afterbegin",n)}lockLock(){this.lock=!0}scheduleUnlock(){setTimeout((()=>{this.lock=!1}),100)}}class us{constructor(t,e,n){this.storage=t,this.modulePlacer=e,this.cashbackCartDataGetter=n}async init(){document.addEventListener(M.events.internal.extensionReady,this.place.bind(this)),document.addEventListener(M.events.internal.fondueCartUpdated,this.place.bind(this),!0),await this.observeModuleElement()}active(){return!0}async place(t){if(!this.modulePlacer.placingLocked()){const e=t.detail?.cartData?t.detail.cartData:await this.cashbackCartDataGetter.get();if(_(e.cashback?.products))return;const n={anchorSelector:"."+M.fondueModuleAnchor,anchorWrapperSelector:"."+M.fondueModuleBodyWrapper};await this.modulePlacer.place(n,e)}}async observeModuleElement(){new MutationObserver(((t,e)=>{t.forEach((async t=>{const e=[...t.addedNodes];if(e&&e.some((t=>t instanceof Element&&t.getElementsByClassName(M.fondueModuleAnchor).length>0))){const t=await this.cashbackCartDataGetter.get();await this.place({detail:{cartData:t}})}}))})).observe(document.body,{childList:!0,subtree:!0})}static build(t,e,n,o,i,r,a,s){const c=$r.build(t,a,s),d=new ra(c,M,a),l=new kr(e,M,ir.manager());return new us(a,new ls(o,n,new cs(Qa.build(i),ss.build()),new ds(Qa.build(i),is.build(),n),[r]),new qa(d,a,l))}}class hs{constructor(t,e,n){this.popupModalBuilder=t,this.cashbackPopupPropsBuilder=e,this.clientApi=n}async updateElement(t){this.removePopup(),this.appendPopup(t)}appendPopup(t){if(t.cashback&&Object.keys(t.cashback).length){const e=this.cashbackPopupPropsBuilder.getCashbackPopupProps(t),n=this.popupModalBuilder.build(e);if(e.popupAnchorElement){const t=document.querySelector(e.popupAnchorElement);if(_(t))return;this.clientApi.getDOMApi().pushDomElementAsFirstChild(n,t)}else this.clientApi.getDOMApi().pushDomElementAsBodyLastChild(n)}}removePopup(){const t=this.clientApi.getDOMApi(),e=t.querySelectorAll(".fnd-module-cashback-modal"),n=t.querySelectorAll(".fnd-module-bg-wrapper");e.length&&e.forEach((e=>t.deleteElement(e))),n.length&&n.forEach((e=>t.deleteElement(e)))}}!function(t){t.VirtualCard="VirtualCard",t.GiftCard="GiftCard",t.CouponCode="CouponCode",t.Donation="Donation"}(Wa||(Wa={}));class fs{constructor(){this.DEFAULT_METHODS_TEXT="Visa Prepaid Reward Card or Site Credit"}build(t){return`\n    <div class="fnd-cashback-modal fnd-module-cashback-modal" id="cash-back-modal" style="display:none;" onclick="event.stopPropagation();">\n        <div class="fnd-cashback-modal-content">\n            <div class="fnd-close-btn" onclick="event.stopPropagation();document.getElementById('id01').style.height='0%';document.getElementById('id01').style.opacity=0;document.getElementById('cash-back-modal').style.display='none'">\n                <img src="${t.images.closeBtn}" alt="close" />\n            </div>\n            \n            <div class="fnd-cashback-modal-content-header">\n                <img src="${t.images.modalCashbackLogo}" alt="icon" />\n                <h3>Reward Your Way</h3>\n                <span>No points. No coupons. Just cash.</span>\n            </div>\n            \n            <div class="fnd-cashback-modal-content-info">\n                <div class="fnd-cashback-modal-content-info-icon">\n                    <img src="${t.images.modalShoppingCart}" alt="icon" />\n                    <span>Purchase with CashBack</span>\n                </div>\n                <div class="fnd-cashback-modal-content-info-arrow">\n                    <img src="${t.images.longArrow}" class="fnd-long-arrow-img" alt="icon" />\n                    <img src="${t.images.arrow}" class="fnd-short-arrow-img" alt="icon" />                             \n                </div>\n                <div class="fnd-cashback-modal-content-info-icon">\n                    <img src="${t.images.modalEmail}" class="fnd-modal-email-icon" alt="icon" />\n                    <span>Open your confirmation email</span>\n                </div>\n                <div class="fnd-cashback-modal-content-info-arrow">\n                    <img src="${t.images.longArrow}" class="fnd-long-arrow-img" alt="icon" />\n                    <img src="${t.images.arrow}" class="fnd-short-arrow-img" alt="icon" />                             \n                </div>\n                <div class="fnd-cashback-modal-content-info-icon">                    \n                    <img src="${t.images.modalCash}" alt="icon" />\n                    <span>Redeem your cash</span>\n                </div>\n            </div>\n            \n            <div class="fnd-cashback-modal-content-eligible-products">\n                <span class="fnd-eligible-products-badge">\n                  ${"percentage"===t.cashback.unit?t.cashback.amount+"%":"$"+t.cashback.amount} CashBack Eligible\n                </span>\n                <div id="eligible-products-collapsible" class="fnd-collapsible">\n                    <div class="fnd-collapsible-header" onclick="event.stopPropagation();document.querySelector('#eligible-products-collapsible').classList.toggle('fnd-open')">\n                        <span class="fnd-collapsible-title">\n                            ${t.eligibleProducts.length||"No"} ${1===t.eligibleProducts.length?"product":"products"}\n                        </span>\n                        <img src="${t.images.collapsibleArrow}" class="fnd-collapsible-arrow" alt="arrow" />\n                    </div>\n                    <div class="fnd-collapsible-content">\n                        ${t.eligibleProducts.length?t.eligibleProducts.map((t=>`\n                            <span class="fnd-collapsible-content-product-line">\n                              ${t.quantity>1?`${t.quantity}X`:""} ${t.title}\n                            </span>  \n                            `)).join(""):'\n                            <span class="fnd-collapsible-content-no-products">\n                                There are no CashBack eligible products in your cart\n                            </span>\n                            '}\n                    </div>\n                </div>\n                <div class="fnd-eligible-products-footer">\n                    <span class="fnd-eligible-products-footer-promotion-name">\n                        CashBack\n                        ${"percentage"===t.cashback.unit?`\n                            <span class="fnd-eligible-products-footer-promotion-badge">\n                                ${t.cashback.amount}%\n                            </span>\n                        `:""}\n                    </span>\n                    <span class="fnd-eligible-products-footer-promotion-total">\n                        ${t.currency}${t.cashback.totalAmount}\n                    </span>\n                </div>\n                ${t.cashback.amountToAdd>0?`\n                    <div class="fnd-eligible-products-threshold-info">\n                        <img src="${t.images.infoIcon}" alt="i" />\n                        <p>\n                            Add <span>${t.currency}${t.cashback.amountToAdd}</span> of eligible products to your order to <b>get CashBack</b>\n                        </p>\n                    </div>\n                `:""}\n            </div>\n            \n            ${t.notEligibleProducts?.length?`\n                <div class="fnd-cashback-modal-content-eligible-products">\n                    <span class="fnd-not-eligible-products-badge">Not Eligible for CashBack</span>\n                    <div id="not-eligible-products-collapsible" class="fnd-collapsible">\n                        <div class="fnd-collapsible-header" onclick="event.stopPropagation();document.querySelector('#not-eligible-products-collapsible').classList.toggle('fnd-open')">\n                            <span class="fnd-collapsible-title">\n                                ${t.notEligibleProducts?.length} ${1===t.notEligibleProducts.length?"product":"products"}\n                            </span>\n                            <img src="${t.images.collapsibleArrow}" class="fnd-collapsible-arrow" alt="arrow" />\n                        </div>\n                        <div class="fnd-collapsible-content">\n                            ${t.notEligibleProducts?.map((t=>`\n                                <span class="fnd-collapsible-content-product-line">\n                                    ${t.quantity>1?`${t.quantity}X`:""} ${t.title}\n                                </span>  \n                            `)).join("")}                        \n                        </div>\n                    </div>\n                </div>\n            `:""}\n            \n            <div class="fnd-cashback-modal-content-bottom">\n                <span>Choose how to get your reward: ${this.getMethodsText(t.availableMethods)}. ${t.returnPeriod>0?`It will be usable once the ${t.returnPeriod}-day holding period has passed.`:""}</span>\n                <span>After a qualifying purchase, you have 6 months to claim your reward. See example of a redemption form\n                  <a href="https://shopper.getfondue.com/cashback/redeem" target="_blank"> here.</a>\n                </span>\n            </div>\n          \n            <div class="fnd-cashback-footer">\n               ${t.tosLink?`<a href="${t.tosLink}" target="_blank" class="fnd-cashback-redemption-terms-link">\n                    Terms & Conditions\n                </a>`:`<div class="fnd-safe-secure-wrapper">\n                    <img src="${t.images.secure}" alt="icon" />\n                    Safe & Secure\n                </div>`}\n\n                <div class="fnd-powered-wrapper">\n                    <span class="fnd-powered-wrapper-span">Promotion Powered by</span>\n                    <img src="${t.images.fondueLogoDark}" width="40" height="8" alt="powered" />\n                </div>\n                <a href="https://www.getfondue.com/cb-terms" target="_blank" class="fnd-cashback-redemption-terms-link">\n                    Redemption Terms\n                </a>\n            </div>\n        </div>\n    </div>\n\n    <div class="fnd-bg-wrapper fondue-module-bg-wrapper"\n        onclick="event.stopPropagation();document.getElementById('id01').style.height='0%';document.getElementById('id01').style.opacity=0;document.getElementById('cash-back-modal').style.display='none'"\n        id="id01">    \n    </div>\n`}getMethodsText(t){if(!t)return this.DEFAULT_METHODS_TEXT;const e=Object.values(t)?.map((t=>this.getMethodLabel(t.type)));if(_(e))return this.DEFAULT_METHODS_TEXT;if(1===e.length)return e[0];const n=e.pop();return e.join(", ")+" or "+n}getMethodLabel(t){return T(t).with(Wa.VirtualCard,(()=>"Visa prepaid card")).with(Wa.GiftCard,(()=>"gift card")).with(Wa.CouponCode,(()=>"reward coupon code")).with(Wa.Donation,(()=>"donation")).exhaustive()}}class ps{constructor(t,e,n,o){this.cartThresholdEvaluator=t,this.numberFormatter=e,this.storeFrontSettings=n,this.imagesConfig=o}getCashbackPopupProps(t){const e=this.cartThresholdEvaluator.calc(t).threshold-t.totalAmount;return{images:{...this.imagesConfig.images},currency:this.storeFrontSettings.common.currency,popupAnchorElement:this.storeFrontSettings.cartPage.selectors.miniCartPopupCheckoutButton,eligibleProducts:t.cartItems.filter((e=>t.cashback.appliedLineItems.map((t=>t.productId)).includes(e.productId.toString()))),notEligibleProducts:t.cartItems.filter((e=>!t.cashback.appliedLineItems.map((t=>t.productId)).includes(e.productId.toString())&&!t.cashback.products.map((t=>t.cashbackVariantId)).includes(e.variantId.toString()))),tosLink:this.storeFrontSettings.modalPopup.tosLink,returnPeriod:this.storeFrontSettings.common.returnPeriod,cashback:{unit:t.cashback.products[0]?.unit,amount:t.cashback.products[0]?.amount||0,totalAmount:Number(t.cashback.totalAmount.value.toFixed(2)),amountToAdd:Number(this.numberFormatter.calc(e))},availableMethods:this.storeFrontSettings.common.availableMethods}}}!function(t){t.Auto="AUTO",t.Manual="MANUAL"}(Ka||(Ka={}));class ms{constructor(t,e){this.AUTO_PLACEMENT_SELECTOR_STORAGE_KEY="fondue-auto-placement-selector",this.fetch=()=>{const t=this.storage.getItem(this.AUTO_PLACEMENT_SELECTOR_STORAGE_KEY);if(t)return t;Na.info("No selector found in storage, trying to find it by searching the DOM");const e=this.autoPlacementSelectorFinder.findAutoPlacementSelector();return e?(Na.info(`Selector found by searching the DOM: ${e}, updating storage`),this.storage.setItem(this.AUTO_PLACEMENT_SELECTOR_STORAGE_KEY,e),e):(Na.info("No selector was found in the DOM, returning null"),null)},this.autoPlacementSelectorFinder=t,this.storage=e}}let bs,gs;function ys(t,e,n){let o=null,i=[],r=t,a=0;for(;r&&r!==bs.root.parentElement;){let t=_s(Cs(r))||_s(...Es(r))||_s(...Ss(r))||_s(Is(r))||[{name:"*",penalty:3}];const s=As(r);if(e===Ja.All)s&&(t=t.concat(t.filter(Ps).map((t=>Ts(t,s)))));else if(e===Ja.Two)t=t.slice(0,1),s&&(t=t.concat(t.filter(Ps).map((t=>Ts(t,s)))));else if(e===Ja.One){const[e]=t=t.slice(0,1);s&&Ps(e)&&(t=[Ts(e,s)])}for(let e of t)e.level=a;if(i.push(t),i.length>=bs.seedMinLength&&(o=vs(i,n),o))break;r=r.parentElement,a++}return o||(o=vs(i,n)),o}function vs(t,e){const n=Rs(Os(t));if(n.length>bs.threshold)return e?e():null;for(let t of n)if(xs(t))return t;return null}function ws(t){let e=t[0],n=e.name;for(let o=1;o<t.length;o++){const i=t[o].level||0;n=e.level===i-1?`${t[o].name} > ${n}`:`${t[o].name} ${n}`,e=t[o]}return n}function ks(t){return t.map((t=>t.penalty)).reduce(((t,e)=>t+e),0)}function xs(t){switch(gs.querySelectorAll(ws(t)).length){case 0:throw new Error(`Can't select any node with this selector: ${ws(t)}`);case 1:return!0;default:return!1}}function Cs(t){const e=t.getAttribute("id");return e&&bs.idName(e)?{name:"#"+Us(e,{isIdentifier:!0}),penalty:0}:null}function Es(t){return Array.from(t.attributes).filter((t=>bs.attr(t.name,t.value))).map((t=>({name:"["+Us(t.name,{isIdentifier:!0})+'="'+Us(t.value)+'"]',penalty:.5})))}function Ss(t){return Array.from(t.classList).filter(bs.className).map((t=>({name:"."+Us(t,{isIdentifier:!0}),penalty:1})))}function Is(t){const e=t.tagName.toLowerCase();return bs.tagName(e)?{name:e,penalty:2}:null}function As(t){const e=t.parentNode;if(!e)return null;let n=e.firstChild;if(!n)return null;let o=0;for(;n&&(n.nodeType===Node.ELEMENT_NODE&&o++,n!==t);)n=n.nextSibling;return o}function Ts(t,e){return{name:t.name+`:nth-child(${e})`,penalty:t.penalty+1}}function Ps(t){return"html"!==t.name&&!t.name.startsWith("#")}function _s(...t){const e=t.filter(Ls);return e.length>0?e:null}function Ls(t){return null!=t}function*Os(t,e=[]){if(t.length>0)for(let n of t[0])yield*Os(t.slice(1,t.length),e.concat(n));else yield e}function Rs(t){return Array.from(t).sort(((t,e)=>ks(t)-ks(e)))}function*Fs(t,e,n={counter:0,visited:new Map}){if(t.length>2&&t.length>bs.optimizedMinLength)for(let o=1;o<t.length-1;o++){if(n.counter>bs.maxNumberOfTries)return;n.counter+=1;const i=[...t];i.splice(o,1);const r=ws(i);if(n.visited.has(r))return;xs(i)&&Ms(i,e)&&(yield i,n.visited.set(r,!0),yield*Fs(i,e,n))}}function Ms(t,e){return gs.querySelector(ws(t))===e}!function(t){t[t.All=0]="All",t[t.Two=1]="Two",t[t.One=2]="One"}(Ja||(Ja={}));const Ds=/[ -,\.\/:-@\[-\^`\{-~]/,Ns=/[ -,\.\/:-@\[\]\^`\{-~]/,$s=/(^|\\+)?(\\[A-F0-9]{1,6})\x20(?![a-fA-F0-9\x20])/g,Bs={escapeEverything:!1,isIdentifier:!1,quotes:"single",wrap:!1};function Us(t,e={}){const n=Object.assign(Object.assign({},Bs),e);"single"!=n.quotes&&"double"!=n.quotes&&(n.quotes="single");const o="double"==n.quotes?'"':"'",i=n.isIdentifier,r=t.charAt(0);let a="",s=0;const c=t.length;for(;s<c;){const e=t.charAt(s++);let r,d=e.charCodeAt(0);if(d<32||d>126){if(d>=55296&&d<=56319&&s<c){const e=t.charCodeAt(s++);56320==(64512&e)?d=((1023&d)<<10)+(1023&e)+65536:s--}r="\\"+d.toString(16).toUpperCase()+" "}else r=n.escapeEverything?Ds.test(e)?"\\"+e:"\\"+d.toString(16).toUpperCase()+" ":/[\t\n\f\r\x0B]/.test(e)?"\\"+d.toString(16).toUpperCase()+" ":"\\"==e||!i&&('"'==e&&o==e||"'"==e&&o==e)||i&&Ns.test(e)?"\\"+e:e;a+=r}return i&&(/^-[-\d]/.test(a)?a="\\-"+a.slice(1):/\d/.test(r)&&(a="\\3"+r+" "+a.slice(1))),a=a.replace($s,(function(t,e,n){return e&&e.length%2?t:(e||"")+n})),!i&&n.wrap?o+a+o:a}class Hs{constructor(t){this.findAutoPlacementSelector=()=>{const t=this.findAutoPlacementTargetElement();if(!t)return void Na.info("Could not find auto placement element");Na.info("Found auto placement element",t[0]);const e=function(t,e){if(t.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if("html"===t.tagName.toLowerCase())return"html";const n={root:document.body,idName:t=>!0,className:t=>!0,tagName:t=>!0,attr:(t,e)=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4};bs=Object.assign(Object.assign({},n),void 0),gs=function(t,e){return t.nodeType===Node.DOCUMENT_NODE?t:t===e.root?t.ownerDocument:t}(bs.root,n);let o=ys(t,Ja.All,(()=>ys(t,Ja.Two,(()=>ys(t,Ja.One)))));if(o){const e=Rs(Fs(o,t));return e.length>0&&(o=e[0]),ws(o)}throw new Error("Selector was not found.")}(t[0]);return Na.info("Found auto placement selector",e),e},this.findAutoPlacementTargetElement=()=>{const t=[],e=[this.findShopifyDefaultCallToActionButtonTarget,this.findButtonCheckoutTarget,this.findArticleCheckoutTarget,this.findInputCheckoutTarget],n=[this.findFormCheckoutTarget,this.findDivSectionCheckoutTarget];for(const n of e){const e=n();e.length>0&&t.push(...e)}if(0===t.length)for(const e of n){const n=e();n.length>0&&t.push(...n)}return t.sort(this.sortDomElementsByPosition),t},this.sortDomElementsByPosition=(t,e)=>{const n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),i=n.top,r=o.top,a=n.left,s=o.left;return i<r?-1:i>r?1:a<s?-1:a>s?1:0},this.findFormCheckoutTarget=()=>{const t=this.clientApi.getDOMApi().querySelectorAll('form[action="/cart"]');return this.evaluateTargetsVisibility(t)},this.findDivSectionCheckoutTarget=()=>{const t=this.clientApi.getDOMApi().querySelectorAll('div[class*="checkout"]:not([class*="dynamic"])');return this.evaluateTargetsVisibility(t)},this.findInputCheckoutTarget=()=>{const t=this.clientApi.getDOMApi().querySelectorAll('input[class*="checkout"], input[name*="checkout"]'),e=this.evaluateTargetsVisibility(t);return this.evaluateTargetsHasCheckoutText(e)},this.findButtonCheckoutTarget=()=>{const t=this.clientApi.getDOMApi().querySelectorAll('button[class*="checkout"], button[name*="checkout"]'),e=this.evaluateTargetsVisibility(t);return this.evaluateTargetsHasCheckoutText(e)},this.findArticleCheckoutTarget=()=>{const t=this.clientApi.getDOMApi().querySelectorAll('a[href*="/checkout"]');return this.evaluateTargetsVisibility(t)},this.findShopifyDefaultCallToActionButtonTarget=()=>{const t=this.clientApi.getDOMApi().querySelectorAll(".cart__ctas");return this.evaluateTargetsVisibility(t)},this.evaluateTargetsHasCheckoutText=t=>{const e=[];for(const n of t)this.hasCheckoutText(n)&&e.push(n);return e},this.evaluateTargetsVisibility=t=>{const e=[];for(const n of t)this.isElementVisible(n)&&e.push(n);return e},this.isElementVisible=t=>{if(null===t.offsetParent)return!1;const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility},this.hasCheckoutText=t=>t.value.toLowerCase().indexOf("check")>-1||t.textContent.toLowerCase().indexOf("check")>-1,this.clientApi=t}}class qs{constructor(t,e,n){this.storeFrontSettings=t,this.selectorsModulePlacer=e,this.autoPlacementSelectorFetcher=n,this.logPrefix="AutomaticModulePlacementHandler: "}async init(){try{const t=this.autoPlacementSelectorFetcher.fetch();if(!t||!this.isCartPage())return;await this.selectorsModulePlacer.place(t,!1)}catch(t){bo.warn(this.logPrefix,"Something went wrong while trying to find the selector for placement",{error:JSON.stringify(t)})}}isCartPage(){return"/cart"===window.location.pathname}active(){return this.storeFrontSettings.cartPage.modulePlacement.method===Ka.Auto}static build(t,e,n,o){const i=new ms(new Hs(t),n);return new qs(e,o,i)}}class js{constructor(t,e,n){this.clientApi=t,this.storeFrontSettings=e,this.selectorsModulePlacer=n,this.LogPrefix="BySelectorsModulePlacementHandler: ",this.onCheckoutButtonRendered=async t=>{this.clientApi.getDOMApi().querySelectorAll(".fnd-cart-module-wrapper-mini-cart").forEach((t=>t.remove()));const e=Object.entries(t);if(0===e.length)return;const[n,o]=e[0];_(n)||_(o)||await this.selectorsModulePlacer.place(o,!0)}}async init(){await this.miniCartSelectorsInit(),await this.cartInit()}active(){return Object.values(this.storeFrontSettings.cartPage.selectors).some((t=>!_(t)))}async miniCartSelectorsInit(){const t={miniCartCheckoutButton:this.storeFrontSettings.cartPage.selectors.miniCartCheckoutButton,miniCartPopupCheckoutButton:this.storeFrontSettings.cartPage.selectors.miniCartPopupCheckoutButton};this.clientApi.addListener($a.MiniCartRenderCompletedEventName,this.onCheckoutButtonRendered),this.setupMiniCartRenderCompletedEvent(t),await this.onCheckoutButtonRendered(t)}async cartInit(){const t=this.storeFrontSettings.cartPage.selectors.cartCheckoutButton;this.isCartPage()&&!_(t)&&await this.selectorsModulePlacer.place(t,!1)}isCartPage(){return"/cart"===window.location.pathname}setupMiniCartRenderCompletedEvent(t){if(_(this.storeFrontSettings.cartPage.selectors.miniCart)||_(this.storeFrontSettings.cartPage.selectors.miniCartChangesListener))return void bo.info(this.LogPrefix,"[setupMiniCartRenderCompletedEvent]: Mini cart selector is not defined");const e=this.clientApi.getDOMApi().querySelector(this.storeFrontSettings.cartPage.selectors.miniCart);e?_(this.storeFrontSettings.cartPage.selectors.miniCartChangesListener)||this.clientApi.observeAddedNode(e,this.storeFrontSettings.cartPage.selectors.miniCartChangesListener,(()=>{this.clientApi.invokeEvent($a.MiniCartRenderCompletedEventName,[t])})):bo.info(this.LogPrefix,"[setupMiniCartRenderCompletedEvent]: Can't find the selector in the DOM")}static build(t,e,n){return new js(t,e,n)}}class Gs{static calculateMaxCashbackAmount(t,e,n){const o=Number(t);if(!e||!n)return Gs.fondueNumberFormatter(o);const i=Number(n);try{return Gs.fondueNumberFormatter(o+o*(i/100))}catch(t){return Gs.fondueNumberFormatter(o)}}static fondueNumberFormatter(t){const e=Number(t),n=Number.isInteger(e)?0:2;return e.toFixed(n)}}class zs{static createHtml(t){return`<div class="fnd-content-title">\n        <span>Buy and</span>\n        <span class="fnd-pay-back-container">\n          <span>get</span>\n          <span class="fnd-pay-back">${(t.percentagePresent&&t.amountToAdd?`${t.displayAmount}%`:`${t.currency}${t.displayAmount}`)+" back"}</span>\n        </span>\n      </div>`}}class Xs{static createHtml(t){return`<div class="fnd-content-title">\n          <span>${t.includeExcludeApplied?`Add <span class="fnd-include-exclude-with-threshold">qualified items<span class="fnd-tooltip">Valued over $${t.thresholdAmount}</span></span> and`:t.amountToAdd>0?`You're ${t.currency}${t.amountToAdd} away`:"Buy and"}</span>\n          <span class="fnd-pay-back-container">\n            ${t.includeExcludeApplied?"get":t.amountToAdd?"from":"get"}\n            <span class="fnd-pay-back">${(t.percentagePresent&&t.amountToAdd?`${t.percentageValue}%`:`${t.currency}${t.displayAmount}`)+" back"}</span>\n          </span>\n        </div>`}}class Vs{static createHtml(t){return`${"0"!==t.displayAmount?`\n            <p>You get${t.reflectGiftCardBoostInModule?" up to":""}\n                <span style="color: ${t.priceColor}">${t.currency}${t.displayAmount}</span>\n                after your purchase to use anywhere.\n            </p>\n        `:""}\n        <p style="margin:4px 0 0 0;" >\n            ${"0"===t.displayAmount?"Add a CashBack eligible product to your cart in order to receive real cash.":""} No points. No coupons. Just cash.\n        </p>`}}class Ws{static createHtml(t){return`<p>\n            Spend\n            <span style="color:${t.priceColor}"> ${t.currency}${t.amountToAdd} more </span>\n            in order to get${t.reflectGiftCardBoostInModule&&!t.percentagePresent?" up to":""}\n            <span style="color:${t.priceColor}">${t.percentagePresent?`${t.percentageValue}%`:`${t.currency}${t.displayAmount}`} CashBack</span>\n            <div>\n                No points. No coupons. Just cash.\n            </div>\n            </p>`}}class Ks{constructor(t){this.elementId=t}createHtml(t){const e={displayAmount:t.displayAmount??Gs.calculateMaxCashbackAmount(t.amount,t.reflectGiftCardBoostInModule,t.giftCardPercentBonus),currency:t.currency,amountToAdd:t.amountToAdd,thresholdAmount:t.thresholdAmount||null,percentagePresent:t.percentagePresent,percentageValue:t.percentageValue,reflectGiftCardBoostInModule:t.reflectGiftCardBoostInModule,includeExcludeApplied:t.includeExcludeApplied};return!0===t.showLegacyModule?`<div class="fnd-legacy-banner-wrapper" style="border: 1px solid ${t.outlineColor}">\n            <div class="fnd-legacy-banner-wrapper-top">\n              <div class="fnd-legacy-logos-container">\n                <div class="fnd-legacy-image-wrapper">\n                  <img width=20 height=20 src=${t.images.cashbackSign} alt="icon" />\n                </div>\n                <img width=96 height=12 src=${t.images.cashbackText} alt="logo" />\n              </div>\n              <div class="fnd-legacy-info-wrapper" onclick='document.getElementById("id01").style.height="100%",document.getElementById("id01").style.opacity=1,document.getElementById("cash-back-modal").style.display="block"'>\n                <img width=14 height=14 src=${t.images.infoIcon} alt="i" />\n              </div>\n            </div>\n            <div class="fnd-legacy-banner-wrapper-bottom">\n                ${t.moduleType===Va.Common?Vs.createHtml(e):Ws.createHtml(e)}\n            </div>\n          </div>`:`<div class="fnd-banner-wrapper">\n          <div class="fnd-left-side">\n            <div class="fnd-content-text">\n              <div class="fnd-content-title-container">\n                ${"common"===t.moduleType?zs.createHtml(e):Xs.createHtml(e)}\n                <div class="fnd-img-container">\n                  <img src="${t.images.cashbackIcon}" alt="icon" />\n                </div>\n              </div>\n              <div class="fnd-content-subtitle">\n                After purchase\n              </div>\n            </div>\n          </div>\n          <div class="fnd-right-side">\n            <div class="fnd-popup-trigger" onclick='event.stopPropagation(),document.getElementById("id01").style.height="100%",document.getElementById("id01").style.opacity=1,document.getElementById("cash-back-modal").style.display="block"'>\n              How do I get it?\n            </div>\n          </div>\n        </div>`}}const Js="percentage";class Ys{constructor(t,e,n){this.config=t,this.clientApi=n,this.moduleSelectorMap={},this.storeFrontSettings=e}append(t,e,n,o,i){this.moduleSelectorMap=this.prepareSelectorsAndPlaceModules(t,this.moduleSelectorMap,e,n,o,i)}appendInside(t,e,n,o){this.append(t,e,"afterbegin",n,o)}create(t){const e=t.cashback.products.some((t=>t.appliedRule.type.toString()!==lo.Any)),n=(new ja).calc(t),o=n.threshold-t.totalAmount,i=n.isLowerThanThreshold?{amount:Gs.fondueNumberFormatter(n.cashbackProduct.amount||0),amountToAdd:Gs.fondueNumberFormatter(o),currency:this.storeFrontSettings.common.currency,images:{...this.config.images,merchantLogo:this.storeFrontSettings.common.merchantLogo},moduleType:"lowerThanThreshold",priceColor:this.storeFrontSettings.cartPage.priceColor,outlineColor:this.storeFrontSettings.cartPage.outlineColor,percentagePresent:n.cashbackProduct.unit===Js,percentageValue:t.cashback.products?.[0]?.amount??0,thresholdAmount:n.threshold,includeExcludeApplied:e,showLegacyModule:this.storeFrontSettings.showLegacyModule}:{amount:Gs.fondueNumberFormatter(t.cashback.totalAmount.value),currency:this.storeFrontSettings.common.currency,images:{...this.config.images,merchantLogo:this.storeFrontSettings.common.merchantLogo},moduleType:"common",priceColor:this.storeFrontSettings.cartPage.priceColor,outlineColor:this.storeFrontSettings.cartPage.outlineColor,percentagePresent:t.cashback.products.length&&t.cashback.products.some((t=>t.unit===Js)),includeExcludeApplied:e,showLegacyModule:this.storeFrontSettings.showLegacyModule};return new Ks("cb-mini-cart-module").createHtml(i)}prepareSelectorsAndPlaceModules(t,e,n,o,i,r){return Na.info("Deleting old elements from DOM"),i&&Object.keys(this.moduleSelectorMap).forEach((t=>{const e=this.clientApi.getDOMApi().getElementById(t);e&&!e.parentElement?.classList?.contains("fondue-cart-module-wrapper")&&this.clientApi.getDOMApi().deleteElementById(t)})),e=this.mapperIdToElementViaSelectors(n),Na.info("Appending cashback module in DOM"),this.appendCashbackModule(t,e,o,r),e}mapperIdToElementViaSelectors(t){const e={};return Object.values(t).map(((t,n)=>{""!==t&&this.clientApi.getDOMApi().querySelectorAll(t).forEach(((t,n)=>e[`cashback-module-${Math.floor(1e6*Math.random())}`]=t))})),e}appendCashbackModule(t,e,n,o){if(!t.cashback.products.length&&!o)return;if(!Object.keys(e).length)return;const i=t.cashback.products.some((t=>t.appliedRule.type.toString()!==lo.Any)),r=(new ja).calc(t),a=r.threshold-t.totalAmount,s=r.isLowerThanThreshold?{amount:Gs.fondueNumberFormatter(r.cashbackProduct.amount||0),amountToAdd:Gs.fondueNumberFormatter(a),currency:this.storeFrontSettings.common.currency,images:{...this.config.images,merchantLogo:this.storeFrontSettings.common.merchantLogo},moduleType:"lowerThanThreshold",priceColor:this.storeFrontSettings.cartPage.priceColor,outlineColor:this.storeFrontSettings.cartPage.outlineColor,percentagePresent:r.cashbackProduct.unit===Js,percentageValue:t.cashback.products?.[0]?.amount??0,thresholdAmount:r.threshold,includeExcludeApplied:i,showLegacyModule:this.storeFrontSettings.showLegacyModule}:{amount:Gs.fondueNumberFormatter(t.cashback.totalAmount.value),currency:this.storeFrontSettings.common.currency,images:{...this.config.images,merchantLogo:this.storeFrontSettings.common.merchantLogo},moduleType:"common",priceColor:this.storeFrontSettings.cartPage.priceColor,outlineColor:this.storeFrontSettings.cartPage.outlineColor,percentagePresent:t.cashback.products.length&&t.cashback.products.some((t=>t.unit===Js)),includeExcludeApplied:i,showLegacyModule:this.storeFrontSettings.showLegacyModule};for(const[t,o]of Object.entries(e))if(o){const e=new Ks(t);if(this.clientApi.getDOMApi().pushDomElement(n,e.createHtml(s),o),!1===this.storeFrontSettings.showLegacyModule){const t=this.clientApi.getDOMApi().getBoundingClientRect(this.clientApi.getDOMApi().getParentElement(o)),e=this.clientApi.getDOMApi().getElementById(o.id).firstElementChild;o.style.justifyContent=t.width>600?"flex-end":"space-between",e.style.width=t.width>600?"inherit":"100%"}}}}class Zs{constructor(t){this.clientApi=t}isInThemeEditor(t){return t&&t.parentElement&&t.parentElement.hasAttribute("data-shopify-editor-block")}}class Qs{constructor(t,e,n,o,i,r=!1){this.cashbackCartDataGetter=t,this.moduleAppender=e,this.themeEditor=n,this.cartThresholdEvaluator=o,this.storeFrontSettings=i,this.isMiniCart=r,this.LOG_PREFIX="CashbackModule",this.wrapperElement=this.createWrapperElement(),this.updateModuleRef=this.updateModule.bind(this),bo.info(this.LOG_PREFIX,"Created module manager instance")}async init(t){bo.info(this.LOG_PREFIX,"Initializing"),t.insertAdjacentElement("beforebegin",this.wrapperElement),await this.initModule(),document.addEventListener(M.events.internal.fondueCartUpdated,this.updateModuleRef)}createWrapperElement(){const t=`fondue-cart-module-wrapper-${Math.floor(9e5*Math.random())+1e4}`;bo.info(this.LOG_PREFIX,`Creating CashBack module: ${t}`);const e=document.createElement("div");return e.id=t,e.classList.add("fnd-cart-module-wrapper"),e.style.display="none",this.isMiniCart&&e.classList.add("fnd-cart-module-wrapper-mini-cart"),e}async initModule(){bo.info(this.LOG_PREFIX,"Initializing module");const t=await this.cashbackCartDataGetter.get();this.appendModule(t),this.showOrHideModuleBasedOnCartData(t)}appendModule(t){bo.info(this.LOG_PREFIX,"Starting to append module");const e=this.themeEditor.isInThemeEditor(this.wrapperElement);bo.info(this.LOG_PREFIX,"isThemeEditor is "+(e?"true":"false")),(e||t.cashback&&Object.keys(t.cashback).length)&&(bo.info(this.LOG_PREFIX,"Appending module"),this.moduleAppender.appendInside(t,{[this.wrapperElement.id]:`#${this.wrapperElement.id}`},!1,!0))}async updateModule(t){if(!document.getElementById(this.wrapperElement.id))return void document.removeEventListener(M.events.internal.fondueCartUpdated,this.updateModuleRef);bo.info(this.LOG_PREFIX,"updating module");const e=t.detail?.cartData?t.detail.cartData:await this.cashbackCartDataGetter.get(),n=this.cartThresholdEvaluator.calc(e),o=Gs.calculateMaxCashbackAmount(Gs.fondueNumberFormatter(e.cashback.totalAmount.value),this.storeFrontSettings.productPage.reflectGiftCardBoostInModule,this.storeFrontSettings.common.giftCardPercentBonus),i=n.threshold-e.totalAmount,r=0===e.cashback.totalAmount.value&&e.cashback.products.some((t=>"percentage"===t.unit)),a={displayAmount:o,reflectGiftCardBoostInModule:this.storeFrontSettings.productPage.reflectGiftCardBoostInModule,priceColor:this.storeFrontSettings.cartPage.priceColor,currency:this.storeFrontSettings.common.currency,amountToAdd:Number(Gs.fondueNumberFormatter(i)),percentagePresent:r,percentageValue:e.cashback.products?.[0]?.amount??0,includeExcludeApplied:!1},s=this.storeFrontSettings.showLegacyModule;let c=n.isLowerThanThreshold?Xs.createHtml(a):zs.createHtml(a);s&&(c=n.isLowerThanThreshold?Ws.createHtml(a):Vs.createHtml(a));const d=this.wrapperElement.getElementsByClassName(s?"fnd-legacy-banner-wrapper-bottom":"fnd-content-title");_(d)?bo.error(this.LOG_PREFIX,"Failed to find module body element"):(d[0].innerHTML=c,this.showOrHideModuleBasedOnCartData(e))}showOrHideModuleBasedOnCartData(t){this.shouldBeDisplayed(t)?this.showModule():this.hideModule()}shouldBeDisplayed(t){return!!this.themeEditor.isInThemeEditor(this.wrapperElement)||!_(t.cashback.products)}showModule(){this.wrapperElement.style.display=this.storeFrontSettings.showLegacyModule?"block":"flex"}hideModule(){this.wrapperElement.style.display="none"}}class tc{constructor(t,e,n,o,i,r,a){this.storeFrontSettings=t,this.shopifyThemeEditor=e,this.moduleAppender=n,this.cashbackCartDataGetter=o,this.clientApi=i,this.cartThresholdEvaluator=r,this.modulePopup=a,this.LogPrefix="SelectorsModulePlacer: "}async place(t,e){const n=this.clientApi.getDOMApi().querySelectorAll(t);for(const t of n){const n=new Qs(this.cashbackCartDataGetter,this.moduleAppender,this.shopifyThemeEditor,this.cartThresholdEvaluator,this.storeFrontSettings,e);await n.init(t);const o=await this.cashbackCartDataGetter.get();await this.modulePopup.updateElement(o)}}static build(t,e,n,o,i,r,a,s){const c=new Ys(r,i,n),d=$r.build(t,o,s),l=new ja,u=new ra(d,M,o),h=new kr(e,M,ir.manager()),f=new qa(u,o,h),p=new Zs(n);return new tc(i,p,c,f,n,l,a)}}class ec{constructor(t){this.modulePlacementHandlers=t,this.logPrefix="ModulePlacementHandler"}async init(){for(const t of this.modulePlacementHandlers)t.active()&&await t.init()}static build(t,e,n,o,i,r){const a={images:{cashbackSign:`${i}/cashback-extension/assets/cashback-sign.svg`,cashbackText:`${i}/cashback-extension/assets/cashback-text.svg`,cashbackIcon:`${i}/cashback-extension/assets/module-bill.svg`,closeBtn:`${i}/cashback-extension/assets/close-btn.svg`,infoIcon:`${i}/cashback-extension/assets/info.svg`,fondueLogoDark:`${i}/cashback-extension/assets/fondue-logo-dark.svg`,modalCashbackLogo:`${i}/cashback-extension/assets/modal-cashback-logo.svg`,modalShoppingCart:`${i}/cashback-extension/assets/modal-shopping-cart.svg`,modalEmail:`${i}/cashback-extension/assets/modal-email.svg`,modalCash:`${i}/cashback-extension/assets/modal-redeem-cash.svg`,secure:`${i}/cashback-extension/assets/secure.svg`,arrow:`${i}/cashback-extension/assets/arrow.svg`,longArrow:`${i}/cashback-extension/assets/long-arrow.svg`,collapsibleArrow:`${i}/cashback-extension/assets/collapsible-arrow.svg`}},s=new Ba;s.init();const c=new ja,d=new za,l=new ps(c,d,o,a),u=new hs(new fs,l,s),h=tc.build(t,e,s,n,o,a,u,r),f=js.build(s,o,h),p=qs.build(s,o,n,h),m=us.build(t,e,s,o,a,u,n,r);return new ec([f,p,m])}}class nc{constructor(t,e,n,o){this.fondueApi=t,this.settingsStorage=e,this.fondueCdnUrl=n,this.fonduePublicObject=o,this.LOG_PREFIX="CartModuleFeature"}shouldInit(t){return!0}isEnabled(t){if(_(t.cashbackProduct))return!1;if(t.forcedEnabledFeatures.includes(this.getName()))return!0;const e=ir.manager().get(Qr.CartModule,!0);return bo.debug(this.LOG_PREFIX,"Cart Module is toggled "+(e?"on":"off"),{custom:{cartToken:t.currentCart?.token}}),e}async init(t){bo.info(this.LOG_PREFIX,"Initializing cart module feature");try{const e=ec.build(t.shop,this.fondueApi,this.settingsStorage,t.storeFrontSettings,this.fondueCdnUrl,this.fonduePublicObject);return await e.init(),go(void 0)}catch(t){return bo.warn(this.LOG_PREFIX,"Failed to init cart module feature",{error:t}),yo(t.message)}}static build(t,e,n,o){return new nc(t,e,n,o)}getName(){return Vr.CartModule}}var oc,ic,rc,ac,sc;!function(t){t.NoChange="NO_CHANGE",t.Increase="INCREASE",t.IncreaseFromZero="INCREASE_FROM_ZERO",t.Decrease="DECREASE",t.Zero="ZERO",t.ZeroWithThreshold="ZERO_WITH_THRESHOLD",t.ZeroWithThresholdDecreased="ZERO_WITH_THRESHOLD_DECREASED",t.CbApplied="CB_APPLIED"}(oc||(oc={}));class cc{constructor(t){this.storage=t}getTransition(t){return T(!0).when((()=>this.isCbApplied(t.currentCashbackAmount)),(()=>oc.CbApplied)).when((()=>0===t.previousCashbackAmount&&t.previousCashbackAmount<t.currentCashbackAmount),(()=>oc.IncreaseFromZero)).when((()=>t.previousCashbackAmount<t.currentCashbackAmount),(()=>oc.Increase)).when((()=>0===t.currentCashbackAmount&&t.previousCashbackAmount>t.currentCashbackAmount&&t.remainingThreshold<t.threshold),(()=>oc.ZeroWithThresholdDecreased)).when((()=>0===t.currentCashbackAmount&&t.remainingThreshold<t.threshold),(()=>oc.ZeroWithThreshold)).when((()=>0===t.currentCashbackAmount),(()=>oc.Zero)).when((()=>t.previousCashbackAmount>t.currentCashbackAmount),(()=>oc.Decrease)).when((()=>t.previousCashbackAmount===t.currentCashbackAmount),(()=>oc.NoChange)).otherwise((()=>{throw new Error("Non-exhaustive pattern match")}))}isCbApplied(t){const e=this.storage.getItem("fnd-expand-on-cb-applied"),n=!e&&0===t;return e||this.storage.setItem("fnd-expand-on-cb-applied",!0),n}}class dc{accumulate(t){const e=t.filter((t=>t.cashback.transition===oc.CbApplied));if(!_(e))return e.pop();const n=t.filter((t=>[oc.Increase,oc.IncreaseFromZero].includes(t.cashback.transition)));return _(n)?t.pop():n.pop()}}class lc{dispatch(t){document.dispatchEvent(new CustomEvent(M.events.internal.modalClosed,{detail:{origin:t.origin}}))}}class uc{dispatch(t){document.dispatchEvent(new CustomEvent(M.events.internal.modalOpened,{detail:{origin:t.origin}}))}}class hc{constructor(t,e){this.modalOpenedEventDispatcher=t,this.modalClosedEventDispatcher=e}opened(t){this.modalOpenedEventDispatcher.dispatch(t)}closed(t){this.modalClosedEventDispatcher.dispatch(t)}static build(){return new hc(new uc,new lc)}}!function(t){t.CashbackApplied="CASHBACK_APPLIED",t.InStore="IN_STORE"}(ic||(ic={})),function(t){t.Percentage="percentage",t.Number="number"}(rc||(rc={})),function(t){t.Open="fnd-open",t.Close="fnd-close",t.Show="fnd-show",t.Hide="fnd-hide"}(ac||(ac={}));class fc{static formatPromotionAmount(t,e,n=2){return e===rc.Percentage?`${t}%`:`$${this.formatDollarAmount(t,n)}`}static formatDollarAmount(t,e=2){return t.toFixed(e)}}class pc{constructor(t){this.fondueCdnUrl=t,this.Selectors={closeBtnSelectorId:"fnd-in-store-fab-close-btn",fabContentContainerSelectorId:"fnd-in-store-fab-content",fabContentPreTitleContainerSelectorId:"fnd-in-store-fab-pre-title",fabContentPostTitleContainerSelectorId:"fnd-in-store-fab-post-title",fabContainer:"fnd-in-store-fab-container",fabContainerNotBottom:"fnd-position-not-bottom",contentAmountElementId:"fnd-content-amount-element",contentAmountPrefixElementId:"fnd-content-amount-prefix-element"},this.OPEN_ANIMATION_TIMEOUT=1700,this.SHOW_ANIMATION_TIMEOUT=500,this.CLOSE_ANIMATION_TIMEOUT=500}open(t,e=!0){this.setComponentState(ac.Open,e?this.OPEN_ANIMATION_TIMEOUT:void 0),t&&t()}close(t,e=!0){this.setComponentState(ac.Close,e?this.CLOSE_ANIMATION_TIMEOUT:void 0),t&&t()}show(t,e=!0){this.setComponentState(ac.Show,e?this.SHOW_ANIMATION_TIMEOUT:void 0),t&&t()}hide(t,e=!0){this.setComponentState(ac.Hide),t&&t()}init(t,e,n,o){this.anchorElement=e,this.callbacks=o;const i=n?.onsiteWidget.position;this.anchorElement.insertAdjacentHTML("afterbegin",this.buildHtml({amount:t.amount,unit:t.unit,images:this.getImagesLinks(),appliedRule:t.appliedRule,minTotalAmountThreshold:0,remainingAmountToThreshold:0,position:i})),document.body.appendChild(this.anchorElement),this.fabContainer=document.querySelector(`.${this.Selectors.fabContainer}`),this.closeBtnContainer=document.getElementById(this.Selectors.closeBtnSelectorId),this.contentAmountElement=document.getElementById(this.Selectors.contentAmountElementId),this.contentAmountPrefixElement=document.getElementById(this.Selectors.contentAmountPrefixElementId),this.preTitleElement=document.getElementById(this.Selectors.fabContentPreTitleContainerSelectorId),this.postTitleElement=document.getElementById(this.Selectors.fabContentPostTitleContainerSelectorId),this.hide(),this.registerListeners()}render(t){T(t.cashback.transition).with(oc.IncreaseFromZero,(()=>{this.cashbackAmountIncreasedHandler(t)})).with(oc.Increase,(()=>{this.cashbackAmountIncreasedHandler(t)})).with(oc.ZeroWithThresholdDecreased,(()=>{const e={amount:t.cashback.promotionData.amount,unit:t.cashback.promotionData.unit,classList:""},n={cashbackAmount:t.cashback.amount.value,appliedRule:t.cashback.promotionData.appliedRule,minTotalAmountThreshold:t.cashback.promotionData.minTotalAmountThreshold,remainingAmountToThreshold:t.cashback.remainingAmountToThreshold};this.contentAmountElement.innerHTML=this.buildContentAmountElement(e),this.preTitleElement.innerHTML=this.buildPreTitleElement(n),this.contentAmountPrefixElement.innerHTML=this.buildContentAmountPrefixElement(n);const o=this.postTitleElement.children.length>0?[this.postTitleElement]:[],i=this.preTitleElement.children.length>0?[this.preTitleElement]:[];this.elementsToUnfoldAndFold(o,i)})).with(oc.ZeroWithThreshold,(()=>{const e={amount:t.cashback.promotionData.amount,unit:t.cashback.promotionData.unit,classList:""},n={cashbackAmount:t.cashback.amount.value,appliedRule:t.cashback.promotionData.appliedRule,minTotalAmountThreshold:t.cashback.promotionData.minTotalAmountThreshold,remainingAmountToThreshold:t.cashback.remainingAmountToThreshold};this.contentAmountElement.innerHTML=this.buildContentAmountElement(e),this.preTitleElement.innerHTML=this.buildPreTitleElement(n),this.contentAmountPrefixElement.innerHTML=this.buildContentAmountPrefixElement(n),this.zeroWithThresholdAnimationHandler()})).with(oc.Zero,(()=>{const e={amount:t.cashback.promotionData.amount,unit:t.cashback.promotionData.unit,classList:""},n={cashbackAmount:t.cashback.amount.value,appliedRule:t.cashback.promotionData.appliedRule,minTotalAmountThreshold:t.cashback.promotionData.minTotalAmountThreshold,remainingAmountToThreshold:t.cashback.remainingAmountToThreshold};this.contentAmountPrefixElement.innerHTML=this.buildContentAmountPrefixElement(n),this.contentAmountElement.innerHTML=this.buildContentAmountElement(e),this.preTitleElement.innerHTML=this.buildPreTitleElement(n),this.postTitleElement.innerHTML=this.buildPostTitleElement(n);const o=this.postTitleElement.children.length>0?[this.postTitleElement]:[],i=this.preTitleElement.children.length>0?[this.preTitleElement]:[];this.postTitleElement.children.length>0&&this.elementsToUnfoldAndFold(o,i)})).with(oc.CbApplied,(()=>{const e={amount:t.cashback.promotionData.amount,unit:t.cashback.promotionData.unit,classList:""},n={cashbackAmount:t.cashback.amount.value,appliedRule:t.cashback.promotionData.appliedRule,minTotalAmountThreshold:t.cashback.promotionData.minTotalAmountThreshold,remainingAmountToThreshold:t.cashback.remainingAmountToThreshold};this.contentAmountPrefixElement.innerHTML=this.buildContentAmountPrefixElement(n),this.contentAmountElement.innerHTML=this.buildContentAmountElement(e),this.preTitleElement.innerHTML=this.buildPreTitleElement(n),this.postTitleElement.innerHTML=this.buildPostTitleElement(n);const o=this.postTitleElement.children.length>0?[this.postTitleElement]:[];this.postTitleElement.children.length>0&&this.elementsToUnfoldAndFold(o,[])})).otherwise((()=>{const e={amount:t.cashback.amount.value,unit:t.cashback.amount.currency,classList:"fnd-cashback-eligible"},n={cashbackAmount:t.cashback.amount.value,appliedRule:t.cashback.promotionData.appliedRule,minTotalAmountThreshold:t.cashback.promotionData.minTotalAmountThreshold,remainingAmountToThreshold:t.cashback.remainingAmountToThreshold};this.contentAmountPrefixElement.innerHTML=this.buildContentAmountPrefixElement(n),this.contentAmountElement.innerHTML=this.buildContentAmountElement(e),this.preTitleElement.innerHTML=this.buildPreTitleElement(n),this.postTitleElement.innerHTML=this.buildPostTitleElement(n)}))}elementsToUnfoldAndFold(t,e){t.forEach((t=>{t.children.length>0&&t.classList.add("fnd-unfold"),t.classList.remove("fnd-fold")})),e.forEach((t=>{t.classList.remove("fnd-unfold"),t.classList.add("fnd-fold")}))}zeroWithThresholdAnimationHandler(){this.fabContainer.classList.add("fnd-fab-element-move-up-and-down"),this.elementsToUnfoldAndFold([this.preTitleElement],[this.postTitleElement]),setTimeout((()=>{this.fabContainer.classList.remove("fnd-fab-element-move-up-and-down")}),1800)}cashbackAmountIncreasedHandler(t){const e={amount:t.cashback.amount.value,unit:t.cashback.amount.currency,classList:"fnd-cashback-eligible"},n={cashbackAmount:t.cashback.amount.value,appliedRule:t.cashback.promotionData.appliedRule,minTotalAmountThreshold:t.cashback.promotionData.minTotalAmountThreshold,remainingAmountToThreshold:t.cashback.remainingAmountToThreshold},o=this.buildContentAmountPrefixElement(n),i=this.buildContentAmountElement(e),r=this.buildPreTitleElement(n),a=this.buildPostTitleElement(n);this.cashbackAmountIncreasedAnimationHandler({newContentAmount:i,newContentAmountPrefix:o,newPostTitle:a,newPreTitle:r,transition:t.cashback.transition})}cashbackAmountIncreasedAnimationHandler(t){this.fabContainer.classList.add("fnd-fab-element-move-up-and-down"),setTimeout((()=>{this.elementsToUnfoldAndFold([],[...this.preTitleElement.children.length>0?[this.preTitleElement]:[],...this.postTitleElement.children.length>0?[this.postTitleElement]:[]])}),150),setTimeout((()=>{t.transition===oc.IncreaseFromZero&&this.contentAmountPrefixElement.innerHTML!==t.newContentAmountPrefix&&this.contentAmountPrefixElement.classList.add("fnd-fab-show-text-animation"),this.contentAmountPrefixElement.innerHTML=t.newContentAmountPrefix,this.contentAmountElement.innerHTML=t.newContentAmount,this.preTitleElement.innerHTML=t.newPreTitle,this.postTitleElement.innerHTML=t.newPostTitle}),700),setTimeout((()=>{this.fabContainer.classList.remove("fnd-fab-element-move-up-and-down"),this.contentAmountPrefixElement.classList.remove("fnd-fab-show-text-animation")}),1800)}getImagesLinks(){return{dismissBtn:`${this.fondueCdnUrl}/cashback-extension/assets/dismiss-btn.svg`,infoBtn:`${this.fondueCdnUrl}/cashback-extension/assets/fab-info.svg`}}registerListeners(){this.closeBtnContainer.onclick=()=>{this.close(this.callbacks.onClose)},document.getElementById(this.Selectors.fabContentContainerSelectorId).onclick=()=>{this.hide(this.callbacks.onClick)}}getStateAnimationClass(t){return`${t}-animation`}setComponentState(t,e){this.fabContainer.classList.remove(...Object.values(ac)),void 0===e?this.setComponentStateWithoutAnimation(t):this.setComponentStateWithAnimation(t,e),this.state=t}animationCallback(t){const e=this.getStateAnimationClass(t);[ac.Hide,ac.Close].includes(t)&&(this.fabContainer.classList.add(t),this.closeBtnContainer.classList.remove(...Object.values(ac))),this.fabContainer.classList.remove(e)}setComponentStateWithAnimation(t,e){const n=this.getStateAnimationClass(t);[ac.Show,ac.Open].includes(t)?(this.closeBtnContainer.classList.add(t),this.fabContainer.classList.add(t),this.fabContainer.classList.add(n)):this.fabContainer.classList.add(n),setTimeout((()=>this.animationCallback(t)),e)}setComponentStateWithoutAnimation(t){[ac.Show,ac.Open].includes(t)?(this.closeBtnContainer.classList.add(t),this.fabContainer.classList.add(t)):(this.fabContainer.classList.add(t),this.closeBtnContainer.classList.remove(...Object.values(ac)))}buildHtml(t){return document.documentElement.style.setProperty("--fnd-in-store-fab-bottom-height-percentage",""+t.position.heightPercentage/100),`\n      <div class="${t.position.heightPercentage>0?this.Selectors.fabContainer+" "+this.Selectors.fabContainerNotBottom:this.Selectors.fabContainer}" id="${this.Selectors.fabContainer}">\n        <div class="fnd-in-store-fab-content-container">\n          <div id="${this.Selectors.closeBtnSelectorId}" class="fnd-in-store-fab-close-btn">\n            <img src="${t.images.dismissBtn}" alt="close"/>\n          </div>\n          <div class="fnd-in-store-fab-content" id="${this.Selectors.fabContentContainerSelectorId}">\n            <div id="fnd-in-store-fab-pre-title"></div>\n            ${this.buildTitle(t)}\n            <div id="fnd-in-store-fab-post-title"></div>\n          </div>  \n        </div>\n        </div>\n        </div>\n      </div>\n    `}buildTitle(t){const e={amount:t.amount,unit:t.unit,classList:""};return`\n      <div class="fnd-in-store-fab-content-title">\n        <div id="${this.Selectors.contentAmountPrefixElementId}" class="fnd-in-store-fab-text-wrapper">You</div>\n        <div class="fnd-in-store-fab-text-wrapper">Get</div>\n        <div id="${this.Selectors.contentAmountElementId}">${this.buildContentAmountElement(e)}</div>\n        <div class="fnd-in-store-fab-text-wrapper">Back!</div>\n        <img class="fnd-in-store-fab-info-btn" src="${t.images.infoBtn}" alt=""/>\n      </div>\n    `}buildPreTitleElement(t){return T({hasCashback:t.cashbackAmount>0,hasEligibilityRules:t.appliedRule.type!==lo.Any,hasThreshold:t.minTotalAmountThreshold>0,remainingAmountLowerThanThreshold:t.minTotalAmountThreshold>t.remainingAmountToThreshold}).with({hasCashback:!0},(()=>"")).with({hasEligibilityRules:!0,remainingAmountLowerThanThreshold:!1},(()=>"")).with({hasThreshold:!0,remainingAmountLowerThanThreshold:!0},(()=>`<div class="fnd-in-store-fab-pre-post-title-text-wrapper">Only ${fc.formatPromotionAmount(t.remainingAmountToThreshold,rc.Number)} away to</div>`)).otherwise((()=>""))}buildPostTitleElement(t){return T({hasCashback:t.cashbackAmount>0,hasEligibilityRules:t.appliedRule.type!==lo.Any,hasThreshold:t.minTotalAmountThreshold>0,remainingAmountLowerThanThreshold:t.minTotalAmountThreshold>t.remainingAmountToThreshold}).with({hasCashback:!0},(()=>"")).with({hasEligibilityRules:!0,remainingAmountLowerThanThreshold:!1},(()=>'<div class="fnd-in-store-fab-pre-post-title-text-wrapper">on qualified items</div>')).with({hasThreshold:!0,remainingAmountLowerThanThreshold:!1},(()=>`<div class="fnd-in-store-fab-pre-post-title-text-wrapper">on any purchase over ${fc.formatPromotionAmount(t.minTotalAmountThreshold,rc.Number)}</div>`)).otherwise((()=>""))}buildContentAmountPrefixElement(t){return T({hasCashback:t.cashbackAmount>0,hasEligibilityRules:t.appliedRule.type!==lo.Any,hasThreshold:t.minTotalAmountThreshold>0,remainingAmountLowerThanThreshold:t.minTotalAmountThreshold>t.remainingAmountToThreshold}).with({hasCashback:!0},(()=>"You")).when((t=>t.hasThreshold||t.hasEligibilityRules),(()=>"")).otherwise((()=>"You"))}buildContentAmountElement(t){return`<div class="fnd-in-store-fab-text-wrapper ${t.classList} ">\n              ${fc.formatPromotionAmount(t.amount,t.unit)}\n            </div>`}}class mc{constructor(t,e){this.fondueCdnUrl=t,this.storeFrontSettings=e,this.Selectors={content:"fnd-content",cashbackMethodOptionsId:"fnd-cashback-method-options",bodyContentContainer:"fnd-body-content-container",contentTextOptions:"fnd-content-text-options"},this.methodsBaseData={[Wa.VirtualCard]:{subTitle:"Prepaid Visa",imageAlt:"Prepaid Visa",imageSrc:this.getImagesLinks().visaImageSrc,content:"prepaid Visa card",priority:1},[Wa.GiftCard]:{subTitle:"Store gift credit",imageAlt:"Store gift credit",imageSrc:this.getImagesLinks().giftCardImageSrc,content:"bonus gift card",priority:2},[Wa.CouponCode]:{subTitle:"Coupon code",imageAlt:"Coupon code",imageSrc:this.getImagesLinks().couponCodeImageSrc,content:"coupon code",priority:2}}}init(t,e,n,o){this.anchorElement=e,this.callbacks=o,this.anchorElement.insertAdjacentHTML("afterbegin",this.buildHtml({cashbackOptions:[],images:this.getImagesLinks()})),this.methodOptionContainer=document.getElementById(this.Selectors.cashbackMethodOptionsId),this.contentTextOptionsContainer=document.getElementById(this.Selectors.contentTextOptions)}render(t){const e=this.buildHtmlProps(t).cashbackOptions.sort(((t,e)=>t.priority-e.priority));this.methodOptionContainer.innerHTML=this.buildMethodOptionsHtml({cashbackOptions:e,images:this.getImagesLinks()}),this.contentTextOptionsContainer.innerHTML=this.buildTextOptionsHtml(e,this.storeFrontSettings.common.allowCashbackOnDiscountedOrder)}open(t,e=!0){}close(t,e=!0){}show(t,e=!0){}hide(t,e=!0){}buildHtmlProps(t){const e=Object.keys(t.cashback.availableMethods);return{cashbackOptions:T(t.cashback.amount.value).when((t=>t>0),(()=>e.map((e=>({title:fc.formatPromotionAmount(t.cashback.availableMethods[e].totalAmount,rc.Number),...this.methodsBaseData[e]}))))).otherwise((()=>e.map((e=>({title:this.buildTitleOfMethod(t.cashback.availableMethods[e],t.cashback.promotionData),...this.methodsBaseData[e]})))))}}buildTitleOfMethod(t,e){const n=fc.formatPromotionAmount(e.amount,e.unit);return t.type===Wa.VirtualCard?n:`${n} + Bonus`}getImagesLinks(){return{secureImageSrc:`${this.fondueCdnUrl}/cashback-extension/assets/modal-secure.svg`,cashbackIconSrc:`${this.fondueCdnUrl}/cashback-extension/assets/modal-cashback.svg`,logo:`${this.fondueCdnUrl}/cashback-extension/assets/modal-fondue-logo-dark.svg`,separator:`${this.fondueCdnUrl}/cashback-extension/assets/modal-separator.svg`,visaImageSrc:`${this.fondueCdnUrl}/cashback-extension/assets/visa.svg`,giftCardImageSrc:`${this.fondueCdnUrl}/cashback-extension/assets/gift-card.svg`,couponCodeImageSrc:`${this.fondueCdnUrl}/cashback-extension/assets/coupon-code.svg`}}buildTextOptionsHtml(t,e){return`Complete your purchase with eligible products for CashBack and choose digital ${t.sort().map((t=>t.content)).join(" or ")}.${e?"":" Not valid with a coupon."}`}buildHtml(t){const e=this.buildMethodOptionsHtml(t),n=this.buildFooter(t);return`<div class="${this.Selectors.content}" id="${this.Selectors.content}">\n              <div id="fnd-body-content-container">\n                <div class="fnd-content-container">\n                  <div class="fnd-content-subtitle-container">\n                     <img class="fnd-content-subtitle-img" src="${t.images.cashbackIconSrc}" width="16px" height="16px" alt="CashBack sign">\n                    <div class="fnd-content-subtitle">Choose CashBack that works for you</div>  \n                  </div>\n                  <div class="fnd-content-text-container">\n                    <div id="fnd-content-text-options" class="fnd-content-text"></div> \n                  </div>             \n                </div>\n                <div id="${this.Selectors.cashbackMethodOptionsId}" class="fnd-cashback-method-options">\n                    ${e}\n                </div>\n          \n          </div>\n          ${n}\n        </div>`}buildMethodOptionsHtml(t){const e=this.buildImagesSeparator(t);return t.cashbackOptions.map((t=>this.buildCashbackMethodOptionHtml(t))).join(e)}buildCashbackMethodOptionHtml(t){return`<div class="fnd-cashback-method-option-container">\n          <img class="fnd-option-img" src="${t.imageSrc}" alt="${t.imageAlt}">\n          <div>\n            <div class="fnd-content-title">${t.title}</div>\n            <div class="fnd-content-title">CashBack</div>\n            <div class="fnd-content-subtitle">${t.subTitle}</div>\n          </div>\n        </div>`}buildFooter(t){return`<div class="fnd-modal-footer-container">\n              <div class="fnd-content-text">${this.footerText()}</div>\n              <div>\n               <div class="fnd-footer">\n                 ${this.addMerchantTosLink()}\n                 <div class="fnd-item-container">\n                    <a href="https://www.getfondue.com/cb-terms" target="_blank" class="fnd-text fnd-link">\n                        CashBack redemption terms\n                    </a>                     \n                  </div>\n                <div class="fnd-item-container">\n                    <span class="fnd-text">Promotion Powered by</span>\n                    <img class="fnd-log-img"  src="${t.images.logo}" alt="powered" />\n                </div>\n            </div>\n              </div>\n            </div>`}addMerchantTosLink(){return this.storeFrontSettings.modalPopup.tosLink?`<div class="fnd-item-container">\n                    <a href="${this.storeFrontSettings.modalPopup.tosLink}" target="_blank" class="fnd-text fnd-link">\n                        Terms of service\n                    </a>               \n                  </div>`:"<div/>"}footerText(){const t="After a qualifying purchase, you have 6 months to select your CashBack method from the confirmation email.",e=this.storeFrontSettings.common.returnPeriod;return 0===e?t:`${t} It will be usable ${e} days after your order date.`}buildImagesSeparator(t){return`<img class="fnd-separator" src="${t.images.separator}" alt="or icon" />`}}class bc{constructor(t,e,n){this.fondueCdnUrl=t,this.headerComponent=e,this.bodyComponent=n,this.Selectors={modal:"fnd-modal",closeBtn:"fnd-modal-close-btn",headerContainer:"fnd-modal-header-container",bodyContainer:"fnd-modal-body-container"}}open(t,e=!0){this.setComponentState(ac.Open),t&&t()}close(t,e=!0){this.setComponentState(ac.Close),t&&t()}init(t,e,n,o){this.anchorElement=e,this.callbacks=o;const i=n.onsiteWidget.position.heightPercentage>0??!1;this.anchorElement.insertAdjacentHTML("afterbegin",this.buildHtml({images:{...this.getImagesLinks()},positionMiddle:i})),this.modalElement=e.querySelector(`#${this.Selectors.modal}`),this.headerWrapperElement=e.querySelector(`#${this.Selectors.headerContainer}`),this.bodyWrapperElement=e.querySelector(`#${this.Selectors.bodyContainer}`),this.hide(),this.headerComponent.init(t,this.headerWrapperElement,n),this.bodyComponent.init(t,this.bodyWrapperElement,n)}render(t){this.headerComponent.render(t),this.bodyComponent.render(t)}show(t,e=!0){this.setComponentState(ac.Show),this.registerListeners(),t&&t()}hide(t,e=!0){this.setComponentState(ac.Hide),t&&t()}setComponentState(t){this.modalElement.classList.remove(...Object.values(ac)),this.modalElement.classList.add(t)}registerListeners(){document.getElementById(this.Selectors.closeBtn).onclick=()=>this.close(this.callbacks.onClose)}getImagesLinks(){return{closeImageSrc:`${this.fondueCdnUrl}/cashback-extension/assets/dismiss-btn.svg`}}buildHtml(t){const{positionMiddle:e}=t;return`\n    <div class="${"fnd-modal"+(e?" fnd-height-middle":"")}" id="fnd-modal">\n      <div class="${this.Selectors.closeBtn}" id="${this.Selectors.closeBtn}" role="none">\n          <img class="fnd-modal-close-btn-img" src="${t.images.closeImageSrc}" alt="close" role="button" />\n        </div>\n      <div class="fnd-modal-container" id="fnd-modal-container">\n        <div class="${this.Selectors.headerContainer}" id="${this.Selectors.headerContainer}"></div>\n        <div class="${this.Selectors.bodyContainer}" id="${this.Selectors.bodyContainer}"></div>\n      </div>\n    </div> `}}class gc{constructor(t){this.fondueCdnUrl=t,this.Selectors={headerWrapper:"fnd-modal-header-wrapper",content:"fnd-content",eligibleLineItemsTotalCbContainer:"fnd-modal-header-eligible-items-total-cb-container",eligibleLineItemsContainer:"fnd-modal-header-eligible-items-container",chevronArrowImg:"fnd-chevron-arrow-img"},this.topGradientBackgroundClass="fnd-top-gradient-background",this.bottomGradientBackgroundClass="fnd-bottom-gradient-background"}init(t,e,n,o){this.anchorElement=e,this.anchorElement.insertAdjacentHTML("afterbegin",this.buildModalHeaderAnchor()),this.headerWrapper=this.anchorElement.querySelector(`#${this.Selectors.headerWrapper}`),this.headerWrapper.insertAdjacentHTML("afterbegin",this.buildDefaultHtml()),this.images=this.getImagesLinks(),this.registerListeners()}render(t){this.headerWrapper.innerHTML=T(t.cashback.amount.value).when((t=>t>0),(()=>this.buildWithDataHtml(t))).otherwise((()=>this.buildZeroAmountHtml(t))),this.registerListeners()}open(t,e=!0){}close(t,e=!0){}show(t,e=!0){}hide(t,e=!0){}handleScroll(){const t=this.anchorElement.querySelector(`#${this.Selectors.eligibleLineItemsContainer}`),e=t.scrollTop,n=t.clientHeight,o=t.scrollHeight;n!==o&&(0===e?this.showOnlyBottomGradientBackground(t):e+n>=o?this.showOnlyTopGradientBackground(t):this.showTopAndBottomGradientBackground(t))}showOnlyBottomGradientBackground(t){t.classList.remove(this.topGradientBackgroundClass),this.addClassIfNotExists(t,this.bottomGradientBackgroundClass)}showOnlyTopGradientBackground(t){t.classList.remove(this.bottomGradientBackgroundClass),this.addClassIfNotExists(t,this.topGradientBackgroundClass)}showTopAndBottomGradientBackground(t){this.addClassIfNotExists(t,this.topGradientBackgroundClass),this.addClassIfNotExists(t,this.bottomGradientBackgroundClass)}addClassIfNotExists(t,e){t.classList.contains(e)||t.classList.add(e)}registerListeners(){const t=document.getElementById(this.Selectors.eligibleLineItemsTotalCbContainer);t&&(t.onclick=()=>{this.toggleEligibleLineItems(),this.handleScroll()});const e=this.anchorElement.querySelector(`#${this.Selectors.eligibleLineItemsContainer}`);e&&e?.addEventListener("scroll",this.handleScroll.bind(this))}toggleEligibleLineItems(){const t=this.anchorElement.querySelector(`#${this.Selectors.eligibleLineItemsContainer}`);t.classList.toggle("fnd-show"),document.getElementById(this.Selectors.chevronArrowImg).classList.toggle("fnd-clicked"),setTimeout((()=>t.classList.toggle("fnd-el-animation")),50)}buildModalHeaderAnchor(){return`<div class="${this.Selectors.headerWrapper}" id="${this.Selectors.headerWrapper}"></div>`}buildDefaultHtml(){return`<div class="${this.Selectors.content}">CashBack Reward</div>`}buildZeroAmountHtml(t){const{amount:e,unit:n}=t.cashback.promotionData,o=fc.formatPromotionAmount(e,n);return`\n      <div class="${this.Selectors.content}">\n        ${o} CashBack\n      </div>\n      ${this.buildSubtitleElement(t)}\n    `}buildSubtitleElement(t){return T({hasCashback:t.cashback.amount.value>0,hasEligibilityRules:t.cashback.promotionData.appliedRule.type!==lo.Any,hasThreshold:t.cashback.promotionData.minTotalAmountThreshold>0}).with({hasCashback:!0},(()=>"")).with({hasEligibilityRules:!0,hasThreshold:!1},(()=>'<div class="fnd-modal-header-subtitle">on qualified items</div>')).with({hasEligibilityRules:!1,hasThreshold:!0},(()=>`<div class="fnd-modal-header-subtitle">on any purchase over ${fc.formatPromotionAmount(t.cashback.promotionData.minTotalAmountThreshold,rc.Number)}</div>`)).with({hasEligibilityRules:!0,hasThreshold:!0},(()=>`<div class="fnd-modal-header-subtitle">on qualified items with purchases over ${fc.formatPromotionAmount(t.cashback.promotionData.minTotalAmountThreshold,rc.Number)}</div>`)).otherwise((()=>""))}buildWithDataHtml(t){const e=`${T(t.cashback.amount.currency.toUpperCase()).with("USD",(()=>"$")).otherwise((()=>{throw new Error("Not supported currency")}))}${fc.formatDollarAmount(t.cashback.amount.value)}`;return`\n            <div class="${this.Selectors.content}">\n              You get <span class="fnd-cashback-eligible">${e}</span> back!\n            </div>\n            ${this.buildEligibleItemsHtml(t)}\n        `}buildEligibleItemsHtml(t){const e=this.getImagesLinks(),{amount:n,unit:o}=t.cashback.promotionData,i=fc.formatPromotionAmount(n,o);return`<div class="fnd-modal-header-eligible-items-wrapper">\n              <div class="${this.Selectors.eligibleLineItemsTotalCbContainer}" id="${this.Selectors.eligibleLineItemsTotalCbContainer}">\n                <div>Your current cart qualifies for ${i} back</div>\n                <div class="fnd-chevron-arrow">\n                    <img id="${this.Selectors.chevronArrowImg}" class="${this.Selectors.chevronArrowImg}" \n                            src="${e.chevronIconSrc}" alt="${e.chevronIconSrc}" />\n                </div>\n              </div>\n              <div class="${this.Selectors.eligibleLineItemsContainer}" id="${this.Selectors.eligibleLineItemsContainer}">\n                ${this.getEligibleItemsComponent(t.eligibleLineItems)}\n              </div>\n          </div>`}getEligibleItemsComponent(t){return t.map((t=>`<div class="fnd-eligible-line-item-container">\n                <div class="fnd-eligible-line-item-title">${this.shortenProductTitle(t.title)}</div>\n                <div class="fnd-eligible-line-item-sign">\n                    <img class="fnd-eligible-line-item-sign-img" src="${this.images.cashbackIconSrc}"/>\n                </div>\n              </div>`)).join(" ")}getImagesLinks(){return{chevronIconSrc:`${this.fondueCdnUrl}/cashback-extension/assets/collapsible-arrow.svg`,cashbackIconSrc:`${this.fondueCdnUrl}/cashback-extension/assets/modal-cashback-green.svg`}}shortenProductTitle(t){return t.length>28?t.slice(0,26)+"..":t}}class yc{constructor(t){this.modalComponent=t,this.Selectors={modalWrapper:"fnd-in-store-fab-modal-wrapper",modalComponent:"fnd-modal"},this.state=ac.Hide}show(t,e=!0){this.setComponentState(ac.Show),this.modalComponent.show(),t&&t()}hide(t,e=!0){this.modalComponent.hide(),this.setComponentState(ac.Hide),t&&t()}open(t,e=!0){this.setComponentState(ac.Open),this.modalComponent.open(),t&&t()}close(t,e=!0){this.setComponentState(ac.Close),t&&t()}setComponentState(t){this.modalWrapperElement.classList.remove(...Object.values(ac)),this.modalWrapperElement.classList.add(t),this.state=t}init(t,e,n,o){this.anchorElement=e,this.callbacks=o,this.anchorElement.insertAdjacentHTML("afterbegin",this.buildHtml()),this.modalWrapperElement=e.querySelector(`#${this.Selectors.modalWrapper}`),this.modalComponent.init(t,this.modalWrapperElement,n,{onClose:()=>this.close(this.callbacks.onClose)}),this.modalComponentElement=e.querySelector(`#${this.Selectors.modalComponent}`),this.modalWrapperElement.onclick=t=>this.onOutOfFocus(t),this.hide()}render(t){this.modalComponent.render(t),[ac.Hide,ac.Close].includes(this.state)&&this.hide()}onOutOfFocus(t){t.target===this.modalWrapperElement&&t.target!==this.modalComponentElement&&this.close(this.callbacks.onClose)}buildHtml(){return`<div class="${this.Selectors.modalWrapper}" id="${this.Selectors.modalWrapper}"></div>`}static build(t,e){const n=e.getItem(M.settingsStorageKey);return new yc(new bc(t,new gc(t),new mc(t,n)))}}class vc{constructor(){this.Selectors={minimizedFabElementSelector:"fnd-in-store-minimized-fab",minimizedFabElementMiddleSelector:"fnd-in-store-minimized-fab-middle",cashbackAmountIncreaseSelector:"fnd-fab-element-move-up-and-down"},this.OPEN_ANIMATION_TIMEOUT=500,this.SHOW_ANIMATION_TIMEOUT=500,this.HIDE_ANIMATION_TIMEOUT=500,this.MOUSE_EVENTS_TIMEOUT=300,this.CLICK_EVENT_TIMEOUT=100}open(t,e=!0){this.setComponentState(ac.Open,this.OPEN_ANIMATION_TIMEOUT),this.registerMouseListeners(),t&&t()}close(t,e=!0){this.setComponentState(ac.Close),this.unregisterMouseListeners(),t&&t()}show(t,e=!0){this.setComponentState(ac.Show,this.SHOW_ANIMATION_TIMEOUT),this.registerMouseListeners(),t&&t()}hide(t,e=!0){this.setComponentState(ac.Hide,this.HIDE_ANIMATION_TIMEOUT),this.unregisterMouseListeners(),t&&t()}init(t,e,n,o){this.anchorElement=e,this.callbacks=o;const i=n?.onsiteWidget.position;this.anchorElement.insertAdjacentHTML("afterbegin",this.buildHtml({position:i}));const r=i?.heightPercentage>0?this.Selectors.minimizedFabElementMiddleSelector:this.Selectors.minimizedFabElementSelector;this.fabContainer=document.querySelector(`.${r}`),this.close(),this.registerListeners()}render(t){T(t.cashback.transition).with(oc.Increase,(()=>this.handleIncreased())).with(oc.IncreaseFromZero,(()=>this.handleIncreased())).otherwise((()=>{}))}handleIncreased(){this.fabContainer.classList.add(this.Selectors.cashbackAmountIncreaseSelector),setTimeout((()=>{this.fabContainer.classList.remove(this.Selectors.cashbackAmountIncreaseSelector)}),800)}onMouseOver(){this.fabContainer.classList.remove("fnd-mouse-leave"),this.fabContainer.classList.add("fnd-mouse-hover")}removeMouseEventsClasses(){this.fabContainer.classList.remove("fnd-mouse-hover"),this.fabContainer.classList.remove("fnd-mouse-leave")}onMouseLeave(){this.fabContainer.classList.add("fnd-mouse-leave"),setTimeout((()=>{this.removeMouseEventsClasses()}),this.MOUSE_EVENTS_TIMEOUT)}registerListeners(){this.fabContainer.onclick=()=>{this.unregisterMouseListeners(),this.hide(this.callbacks.onClick),setTimeout((()=>{this.removeMouseEventsClasses()}),this.CLICK_EVENT_TIMEOUT)},this.registerMouseListeners()}registerMouseListeners(){window.innerWidth>=M.common.mobileMaxScreenSize&&(this.fabContainer.onmouseover=()=>this.onMouseOver(),this.fabContainer.onmouseleave=this.onMouseLeave.bind(this))}unregisterMouseListeners(){window.innerWidth>=M.common.mobileMaxScreenSize&&(this.fabContainer.onmouseover=void 0,this.fabContainer.onmouseleave=void 0)}getStateAnimationClass(t){return`${t}-animation`}setComponentState(t,e){this.fabContainer.classList.remove(...Object.values(ac));const n=this.getStateAnimationClass(t);[ac.Show,ac.Open].includes(t)?(this.fabContainer.classList.add(t),this.fabContainer.classList.add(n)):this.fabContainer.classList.add(n),e?setTimeout((()=>this.animationCallback(t)),e):this.animationCallback(t),this.state=t}animationCallback(t){const e=this.getStateAnimationClass(t);[ac.Hide,ac.Close].includes(t)&&this.fabContainer.classList.add(t),this.fabContainer.classList.remove(e)}buildHtml({position:t}){const e=t.heightPercentage>0?`${this.Selectors.minimizedFabElementMiddleSelector}`:`${this.Selectors.minimizedFabElementSelector}`;return`\n        <div class="${e}" id="${e}"></div>\n    `}}!function(t){t.Expand="EXPAND",t.Minimized="MINIMIZED"}(sc||(sc={}));class wc{constructor(t,e,n,o,i){this.component=t,this.minimizeComponent=e,this.modalComponent=n,this.storage=o,this.modalEventsDispatcher=i,this.COMPONENT_STATE_KEY="fnd-in-store-fab-component-state",this.WRAPPER_ID="fnd-in-store-wrapper",this.MODAL_CLOSE_CALLBACK_DELAY=100,this.COMPONENT_CLOSE_DELAY=200,this.Z_INDEX_OVERRIDE="2147483647",this.Z_INDEX_DEFAULT="999",this.openComponentOnRender=!0}init(t){this.wrapperElement=document.createElement("div"),this.wrapperElement.id=this.WRAPPER_ID,this.wrapperElement.classList.add(this.WRAPPER_ID),this.wrapperElement.style.display="none";const e=this.storage.getItem(M.settingsStorageKey);this.component.init(t,this.wrapperElement,e.storeAppearance,{onClick:this.onComponentClick.bind(this),onClose:this.onCloseComponentWithDelay.bind(this)}),this.minimizeComponent.init(t,this.wrapperElement,e.storeAppearance,{onClick:this.onMinimizedComponentClick.bind(this)}),this.modalComponent.init(t,this.wrapperElement,e.storeAppearance,{onClose:this.onModalClose.bind(this)}),this.wrapperElement.style.display="block"}render(t){this.component.render(t),this.minimizeComponent.render(t),this.modalComponent.render(t),this.openComponentOnRender&&(this.openComponentOnRender=!1,this.openComponentByState())}onCloseComponentWithDelay(){setTimeout((()=>this.onComponentClose()),this.COMPONENT_CLOSE_DELAY)}onComponentClose(){this.minimizeComponent.show(),this.saveComponentState(sc.Minimized)}onModalClose(){setTimeout((()=>this.component.show(void 0,!1)),this.MODAL_CLOSE_CALLBACK_DELAY),this.changeInStoreComponentPosition(this.Z_INDEX_DEFAULT),this.saveComponentState(sc.Expand),this.modalEventsDispatcher.closed({origin:ic.InStore})}onComponentClick(){this.modalComponent.show(),this.changeInStoreComponentPosition(this.Z_INDEX_OVERRIDE),this.modalEventsDispatcher.opened({origin:ic.InStore})}onMinimizedComponentClick(){this.component.show(),this.saveComponentState(sc.Expand)}saveComponentState(t){this.storage.setItem(this.COMPONENT_STATE_KEY,t)}openComponentByState(){const t=this.storage.getItem(this.COMPONENT_STATE_KEY);T(t).with(sc.Minimized,(()=>this.minimizeComponent.open())).otherwise((()=>this.component.open()))}changeInStoreComponentPosition(t){this.wrapperElement.style.zIndex=t}static build(t,e){return new wc(new pc(t),new vc,yc.build(t,e),e,hc.build())}}class kc{constructor(t,e,n,o,i){this.fondueUtils=t,this.orchestrator=e,this.storage=n,this.cashbackAmountBasedTransitionMapper=o,this.cartDataAccumulator=i,this.eventBuffer=[],this.EVENTS_WINDOW=1e3}async serve(t){const e=this.storage.getItem(M.settingsStorageKey);this.orchestrator.init(this.mapToCashbackProduct(t.cashback.activePromotions[0]),e.storeAppearance),this.eventBuffer=[],this.registerListeners(),this.render(t)}registerListeners(){document.addEventListener(this.fondueUtils.events.internal.fondueCartUpdated,this.onEvent.bind(this))}onEvent(t){this.render(t.detail.cartData)}render(t){const e=t.cashback.activePromotions[0],n=this.getPreviousAmount(),o=t.cashback.totalAmount.value,i=this.cashbackAmountBasedTransitionMapper.getTransition({previousCashbackAmount:n,currentCashbackAmount:o,remainingThreshold:t.cashback.remainingAmountToThreshold,threshold:e.minTotalAmountThreshold??0}),r=t.cartItems.filter((e=>t.cashback.appliedLineItems.map((t=>t.productId)).includes(e.productId))).map((t=>({title:t.title}))),a={cashback:{amount:{value:t.cashback.totalAmount.value,currency:e.currency},remainingAmountToThreshold:t.cashback.remainingAmountToThreshold,promotionData:{amount:e.amount,unit:e.unit,appliedRule:e.appliedRule,minTotalAmountThreshold:e.minTotalAmountThreshold??0},transition:i,availableMethods:t.cashback.availableMethods},eligibleLineItems:r};this.eventBuffer.push(a),setInterval((()=>this.processEvents()),this.EVENTS_WINDOW)}processEvents(){if(xr.isEmpty(this.eventBuffer))return;const t=this.cartDataAccumulator.accumulate(this.eventBuffer);this.emitResult(t),this.flushBuffer()}emitResult(t){this.orchestrator.render(t),this.storage.setItem(this.fondueUtils.cashbackAmountKey,t.cashback.amount.value)}flushBuffer(){this.eventBuffer=[]}getPreviousAmount(){return void 0===this.storage.getItem(this.fondueUtils.cashbackAmountKey)?0:parseFloat(this.storage.getItem(this.fondueUtils.cashbackAmountKey))}mapToCashbackProduct(t){return{publicId:t.publicId,variantId:t.cashbackVariantId,amount:t.amount,currency:t.currency,unit:t.unit,target:t.target,appliedRule:t.appliedRule}}}class xc{constructor(t,e,n,o,i){this.cartDataBuilder=t,this.service=e,this.cartClient=n,this.fondueUtils=o,this.fonduePublicObject=i,this.LOG_PREFIX="InStoreFabFeature"}isEnabled(t){if(_(t.cashbackProduct))return bo.debug(this.LOG_PREFIX,"No cashback product found, feature disabled"),!1;if(t.forcedEnabledFeatures.includes(this.getName()))return!0;const e=ir.manager().get(Qr.OnsiteWidget,Zr.Default);return T(e).with(Zr.Default,(()=>t.storeFrontSettings.storeAppearance.onsiteWidget.enabled)).with(Zr.True,(()=>!0)).with(Zr.False,(()=>!1)).otherwise((()=>(bo.error(this.LOG_PREFIX,"Wrong value of feature toggle, falling back to merchants config",{featureToggle:e}),!1)))}async init(t){bo.info(this.LOG_PREFIX,"Initializing in store fab feature");try{bo.info(this.LOG_PREFIX,"In store fab service init");const e=await this.cartDataBuilder.build({leanCart:t.currentCart,cashbackProduct:t.cashbackProduct});return vo(e)?void bo.warn(`${this.LOG_PREFIX}`,"Error while building cart data",{error:e}):(await this.service.serve(e.data),await this.updateFabPlacedNote(t.currentCart),go(void 0))}catch(t){return bo.warn(this.LOG_PREFIX,"Failed to init in store fab feature",{error:t}),yo(t.message)}}shouldInit(t){return!0}async updateFabPlacedNote(t){t.attributes[this.fondueUtils.noteAttributesKeys.fabPlaced]||await this.cartClient.updateNotes([{key:this.fondueUtils.noteAttributesKeys.fabPlaced,value:"true"}])}static build(t,e,n,o,i,r){const a=new kr(e,n,ir.manager()),s=$r.build(t,i,r),c=new kc(n,wc.build(o,i),i,new cc(i),new dc);return new xc(a,c,s,n,r)}getName(){return Vr.InStoreFab}}class Cc{createHtml(t){return`\n        <div class="fnd-toast-wrapper">\n        <div class="fnd-close-btn" onclick="document.getElementById('fnd-cashback-applied-toast-wrapper').style.display='none'">\n                <img src="${t.images.dismissBtn}" alt="close" />\n            </div>\n                <div class="fnd-toast-gif-wrapper">\n                  <div class="fnd-toast-gif-background"></div>\n                  <img class="fnd-toast-gif-image" src="${t.images.walletGif}" alt="wallet">\n                </div>\n                <div class="fnd-toast-text-wrapper">\n                  <div class="fnd-cashback-applied-text">\n                    ${"percentage"===t.unit?`${t.amount}%`:`$${t.amount}`} CashBack applied on this order!\n                  </div>\n                  <div class="fnd-info-wrapper" onclick='document.getElementById("id01").style.height="100%",document.getElementById("id01").style.opacity=1,document.getElementById("cash-back-modal").style.display="block"'>\n                      How do I get it?\n                  </div>\n                </div>\n        </div>\n      `}}class Ec{constructor(t,e,n,o){this.imagesConfig=t,this.htmlCreator=e,this.fondueUtils=n,this.storage=o,this.LOG_PREFIX="CashbackToast",this.TOAST_LOAD_WAITING_MS=1e3,this.WRAPPER_ID="fnd-cashback-applied-toast-wrapper",this.wrapperElement=this.createWrapperElement(),bo.info(this.LOG_PREFIX,"Created toast wrapper")}init(t){bo.info(this.LOG_PREFIX,"Initializing"),this.showToastWithTimeout(t),document.addEventListener(M.events.internal.fondueCodeApplied,this.onFondueCodeApplied.bind(this))}createWrapperElement(){bo.info(this.LOG_PREFIX,"Creating CashBack applied toast");const t=document.createElement("div");return t.id=this.WRAPPER_ID,t.classList.add(this.WRAPPER_ID),t.style.display="none",t}initToast(t,e){bo.info(this.LOG_PREFIX,"Creating Toast content");const n={amount:t,unit:e,...this.imagesConfig};this.wrapperElement.insertAdjacentHTML("afterbegin",this.htmlCreator.createHtml(n))}onFondueCodeApplied(t){this.showToastWithTimeout(t.detail.item)}showToastWithTimeout(t){const e=this.storage.getItem(this.fondueUtils.sessionKeys.cashbackToast);t.publicId!==e&&(setTimeout((()=>{this.initToast(t.amount,t.unit),document.body.appendChild(this.wrapperElement),this.wrapperElement.style.display="block"}),this.TOAST_LOAD_WAITING_MS),this.storage.setItem(this.fondueUtils.sessionKeys.cashbackToast,t.publicId))}}class Sc{constructor(t,e,n){this.modulePopup=t,this.cashbackAppliedToast=e,this.cashbackCartDataGetter=n,this.LOG_PREFIX="CashbackAppliedToastBuilder"}async init(t){bo.info(this.LOG_PREFIX,"Cashback applied toast handler initializing"),this.cashbackAppliedToast.init(t);const e=await this.cashbackCartDataGetter.get();await this.modulePopup.updateElement(e)}static build(t,e,n,o,i,r,a){const s={images:{cashbackSign:`${n}/cashback-extension/assets/cash-back-sign.svg`,cashbackText:`${n}/cashback-extension/assets/cashback-text.svg`,closeBtn:`${n}/cashback-extension/assets/close-btn.svg`,infoIcon:`${n}/cashback-extension/assets/info.svg`,fondueLogoDark:`${n}/cashback-extension/assets/fondue-logo-dark.svg`,modalCashbackLogo:`${n}/cashback-extension/assets/modal-cashback-logo.svg`,modalShoppingCart:`${n}/cashback-extension/assets/modal-shopping-cart.svg`,modalEmail:`${n}/cashback-extension/assets/modal-email.svg`,modalCash:`${n}/cashback-extension/assets/modal-redeem-cash.svg`,secure:`${n}/cashback-extension/assets/secure.svg`,arrow:`${n}/cashback-extension/assets/arrow.svg`,longArrow:`${n}/cashback-extension/assets/long-arrow.svg`,collapsibleArrow:`${n}/cashback-extension/assets/collapsible-arrow.svg`}},c={images:{walletGif:`${n}/cashback-extension/assets/wallet.gif`,dismissBtn:`${n}/cashback-extension/assets/dismiss-btn.svg`}},d=new Ba,l=$r.build(t,i,a),u=new ra(l,M,i),h=new kr(e,M,ir.manager()),f=new qa(u,i,h),p=new ps(new ja,new za,r,s),m=new hs(new fs,p,d),b=new Cc,g=new Ec(c,b,o,i);return new Sc(m,g,f)}}class Ic{constructor(t,e,n,o,i){this.fondueApi=t,this.fondueCdnUrl=e,this.fondueUtils=n,this.storage=o,this.fonduePublicObject=i,this.LOG_PREFIX="ToastFeature"}isEnabled(t){return _(t.cashbackProduct)?(bo.debug(this.LOG_PREFIX,"No cashback product found, feature disabled"),!1):!!t.forcedEnabledFeatures.includes(this.getName())||(t.storeFrontSettings.common.enableToastNotification||ir.manager().get(Qr.Toast,!1))}async init(t){bo.info(this.LOG_PREFIX,"Initializing toast feature");try{bo.info(this.LOG_PREFIX,"Cashback applied toast handler init");const e=Sc.build(t.shop,this.fondueApi,this.fondueCdnUrl,this.fondueUtils,this.storage,t.storeFrontSettings,this.fonduePublicObject);return await e.init(t.cashbackProduct),go(void 0)}catch(t){return bo.warn(this.LOG_PREFIX,"Failed to init toast feature",{error:t}),yo(t.message)}}shouldInit(t){return!0}static build(t,e,n,o,i){return new Ic(t,e,n,o,i)}getName(){return Vr.Toast}}class Ac{constructor(t){this.extensionFeatures=t}select(t){return this.extensionFeatures.filter((e=>e.isEnabled(t)))}static build(t,e,n,o,i,r,a,s){const c=new To(e,t,n,M);return new Ac([Da.build(t,e,n,i,r,a,s),nc.build(c,r,o,a),Ic.build(c,o,M,r,a),xc.build(t,c,M,o,r,a)])}}class Tc{constructor(t,e,n,o){this.storeFrontSettingsService=t,this.cartStoreService=e,this.cashbackProductService=n,this.extensionFeatureInitializer=o}async init(t){bo.info(this.constructor.name,"Starting to handle features init");const e=await this.storeFrontSettingsService.fetchAndStore();if(vo(e))return void console.error(e.message);const n=e.data,o=await this.cartStoreService.storeCurrentCartSnapshot();bo.info(this.constructor.name,"Fetching cashback product");const i=await this.cashbackProductService.getAndPersist(t.code,t.source);xr.isEmpty(i)?bo.info(this.constructor.name,`Could not fetch cashback product for code - ${t.code}`):(bo.info(this.constructor.name,"Applying features"),await this.extensionFeatureInitializer.initFeatures(n,i,o,t.disabledFeatures))}}class Pc{constructor(t,e,n){this.fondueApi=t,this.fondueUtils=e,this.storage=n}async fetchAndStore(){const t=this.storage.getItem(this.fondueUtils.settingsStorageKey);if(t)return go(t);const e=await this.fondueApi.storeFrontSettings();return vo(e)||this.storage.setItem(this.fondueUtils.settingsStorageKey,e.data),e}async get(){return await this.fetchAndStore()}}class _c{constructor(t,e,n,o,i,r,a,s){this.storeFrontSettingsService=t,this.cartStoreService=e,this.extensionEnabler=n,this.extensionLoadedEventDispatcher=o,this.fonduePublicObject=i,this.cashbackCartService=r,this.codeExtractor=a,this.eventListeners=s,this.LOG_PREFIX="ExtensionRunner"}async run(){const t=await this.storeFrontSettingsService.fetchAndStore();if(vo(t))return void console.error(t.message);const e=t.data;if(bo.enabled=e.common.shouldLog,!this.extensionEnabler.enabled(e)){const t=await this.cartStoreService.storeCurrentCartSnapshot();return console.log("%c Fondue CashBack extension is DISABLED","background: #FACC14; color: #423121"),bo.enabled=!1,void await this.cashbackCartService.removeCashbackFromCart(t)}try{bo.info(this.LOG_PREFIX,"Initializing cashback extension"),this.eventListeners.forEach((t=>t.register())),bo.info(this.LOG_PREFIX,"Event listeners registered"),this.codeExtractor.extract(),this.fonduePublicObject.status=Ir.Ready,await this.dispatchExtensionLoadedEvent(),bo.info(this.LOG_PREFIX,"Cashback extension initialized successfully"),this.printExtensionStarted(t.data.common.cashbackMode)}catch(t){bo.error(this.LOG_PREFIX,`Extension runner error, [e]: ${t}`,{error:t})}}printExtensionStarted(t){console.log("\n%c 🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕 \n         Fondue CashBack Extension is Running!          \n         Learn more at > https://getfondue.com          \n 🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕🫕 \n","background: #FACC14; color: #423121"),console.debug(`%cFONDUE | Merchant CashBack mode is [${t.toString()}]`,"background: #FACC14; color: #423121")}async dispatchExtensionLoadedEvent(){this.extensionLoadedEventDispatcher.dispatch(void 0)}static buildFeatureToggles(t,e,n){bo.info("ExtensionRunner","initializing shopper feature toggles");const o=new pa(t,e,n);ir.build(o)}static build(t,n,o,i,r,a,s){const c=new To(n,t,o,M),d=$r.build(t,a,s),l=la.build(a),u=new G(M),h=new z(M),f=new X(a,u,h,M,j.getInstance()),p=new wo(c,M,a,d,f),m=new ga,b=new Pc(c,M,a);_c.buildFeatureToggles(c,M,a);const g=ia.build(t,n,o,a,s),y=new va(wa.build(c,g),new ka(g),new L(new e));r?(console.log("%c Fondue CashBack extension Rebuy mode","background: #FACC14; color: #423121"),bo.info("ExtensionRunner","Extension runner Rebuy mode is ready",{shopDomain:t})):document.addEventListener("rebuy.loaded",(async function(t){window?.Rebuy?.SmartCart&&"disabled"!==window?.Rebuy?.SmartCart?.status&&bo.report("ExtensionRunner","Rebuy loaded event was fired after initializing extension on Shopify cart mode, cashback related feature might not work as expected")}));const v=new ra(d,M,a),w=new xa(t,ir.manager(),a,y,Ac.build(t,n,o,i,r,a,s,g),s),k=new Tc(b,v,p,w),x=new ua(M,k,a,new fa(M)),C=new aa(M,g);return new _c(b,v,new ya(M,m,a),new ha,s,g,l,[x,C,new ba(c),new ma(c)])}}class Lc{constructor(t,e,n,o,i,r){this.shopDomain=t,this.fondueUrl=e,this.version=n,this.fondueCdnUrl=o,this.storage=i,this.fonduePublicObject=r}build(t){return _c.build(this.shopDomain,this.fondueUrl,this.version,this.fondueCdnUrl,t,this.storage,this.fonduePublicObject)}}const Oc={appName:"upcart",name:"addToCart",type:Yr.AfterCartRequest,callback:async(t,e,n)=>{window.upcartRegisterAddToCart&&window.upcartRegisterAddToCart()}};class Rc{constructor(t,e){this.fondueUtils=t,this.storage=e}registerCartId(t){const e=t.includes("gid://shopify/Cart/")?t:`gid://shopify/Cart/${t}`;this.storage.setItem(this.fondueUtils.sessionKeys.sessionCartId,e)}getCartId(){console.error("%cError: getCartId method should be implemented by merchant","background: #FACC14; color: red")}dispatchUpdatedCartEvent(){document.dispatchEvent(new CustomEvent(this.fondueUtils.events.public.cartUpdated))}}class Fc{constructor(){this.LOG_PREFIX="Hooks",this.beforeCartRequestHooks=[],this.afterCartRequestHooks=[]}register(t){bo.info(this.LOG_PREFIX,"registering hook",{hook:{type:t.type,name:t.name,appName:t.appName}});try{return T(t).with({type:Yr.BeforeCartRequest},(()=>this.beforeCartRequestHooks.push(t))).with({type:Yr.AfterCartRequest},(()=>this.afterCartRequestHooks.push(t))).exhaustive(),bo.info(this.LOG_PREFIX,"Successfully registered hook",{hook:{type:t.type,name:t.name,appName:t.appName}}),!0}catch(e){return bo.error(this.LOG_PREFIX,"Failed to register hook",{hook:{type:t.type,name:t.name,appName:t.appName}}),!1}}get(t){return T(t).with(Yr.BeforeCartRequest,(()=>this.beforeCartRequestHooks)).with(Yr.AfterCartRequest,(()=>this.afterCartRequestHooks)).exhaustive()}}class Mc{constructor(t){this.promotionInitDispatcher=t}async init(t){try{return this.promotionInitDispatcher.dispatch({code:t.code,disableToast:t.disableToast}),go(void 0)}catch(t){return bo.warn(this.constructor.name,t.message),yo(t.message)}}}class Dc{dispatch(t){const e={detail:{code:t.code,disableToast:t.disableToast}},n=new CustomEvent(M.events.internal.promotionInit,e);window.dispatchEvent(n)}}class Nc{constructor(t,e,n,o){this.envVars=t,this.hooks=e,this.promotion=n,this.cart=o,this.featuresStatusMap={},this.status=Ir.Initializing,Object.values(Vr).forEach((t=>{this.featuresStatusMap[t]=Wr.UnSet}))}get Cart(){return this.cart}get Hooks(){return this.hooks}get Promotion(){return this.promotion}setFeatureStatus(t,e){return this.featuresStatusMap[t]=e,go(void 0)}getFeatureStatus(t){const e=this.featuresStatusMap[t];return e?go(e):yo(`could not find status for feature: ${t}`)}getEnvVar(t){return this.envVars[t]??""}static build(t){return new Nc(t,new Fc,new Mc(new Dc),new Rc(M,new q))}}const $c="Extension Runner Main",Bc=new q,Uc=Nc.build({appEnv:"production",growthbookApiHost:"https://cdn.growthbook.io",growthbookClientKey:"sdk-z3K3DrDV3xYZ29P0"});Uc.Hooks.register(Oc),window.Fondue||(window.Fondue=Uc);const Hc=async t=>{(t=>{if(new O(t,M).extract()){const t=bo.enabled;bo.enabled=!0,bo.info($c,"code was found and stored in session"),bo.enabled=t}})(Bc);const n=Bc.getItem("fondue-playground"),o=new URLSearchParams(window.location.search).get("fondue-playground");if(_(n)&&!_(o)&&Bc.setItem("fondue-playground",o),o&&!(()=>{const t=document.currentScript;return t instanceof HTMLScriptElement&&t.src.includes("playground/")})()){const t=`playground/${o}.js`,e=document.createElement("script");return e.src=`${Gc}/cashback-extension/${t}`,e.async=!0,e.type="application/javascript",void document.documentElement.appendChild(e)}const i=new URLSearchParams(window.location.search).get(M.sessionKeys.fonduebugger);_(i)||Bc.setItem(M.sessionKeys.fonduebugger,i);const r=await(async(t,e)=>{const n=new To(qc,t,jc,M),o=new Pc(n,M,e);return await o.fetchAndStore()})(t,Bc),a=vo(r)?y.AutomaticIdentification:r.data.common.forceCartMode,s=new Lc(t,qc,jc,Gc,Bc,Uc),c=new R(s,new L(new e));await new F(s,c).run(a)},qc="https://api.getfondue.com",jc="363592503af6e5beb1df7d556aea4e4aa02cfc52",Gc="https://public.getfondue.com",zc=(()=>{const t=new Date(window.performance.timeOrigin);return{data:window.performance.mark("fondue-start"),timeOrigin:t}})();bo.init(!1,"production","pubf5748acaa870c7ac95c615a4bb7c1b76"),bo.addContext("version",jc),console.log("%c 🫕 💛 📲","background: #FACC14; color: #423121"),console.log(`%c 🫕 ${jc} 🫕`,"background: #FACC14; color: #423121");(()=>{let t=0;const e=setInterval((async()=>{t+=1,40===t&&(bo.error($c,"Unable to get shop domain after 40 times"),clearInterval(e));const n=(()=>{try{const t=document.getElementById("fondue-cashback");if(!t)return;const e=t.getAttribute("shop");return e.endsWith(".myshopify.com")?e:void bo.warn($c,"Extracted shop domain is not a valid Shopify domain",{shopDomain:e})}catch(t){return void bo.warn($c,"Error extracting shop domain from script params",t)}})()??window?.Shopify?.shop;_(n)||(clearInterval(e),bo.addContext("shopDomain",n),(async t=>{bo.report($c,"[Fondue Main Started]",{measure:{startTime:zc.data.startTime,timeOrigin:zc.timeOrigin}}),await Hc(t);const e=(()=>{const t=window.performance.mark("fondue-end"),e=window.performance.measure("fondue-runtime","fondue-start","fondue-end");return{endDate:t.startTime,duration:e.duration}})();bo.report($c,"[Fondule Ready]",{measure:{endDate:e.endDate,duration:e.duration,timeOrigin:zc.timeOrigin}})})(n))}),200)})()}();
