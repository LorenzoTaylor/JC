var vyg=function(oe){"use strict";var Bl=Object.defineProperty;var xl=(oe,k,Y)=>k in oe?Bl(oe,k,{enumerable:!0,configurable:!0,writable:!0,value:Y}):oe[k]=Y;var D=(oe,k,Y)=>xl(oe,typeof k!="symbol"?k+"":k,Y);function k(n){return n!=null&&typeof n=="object"&&n["@@functional/placeholder"]===!0}function Y(n){return function e(t){return arguments.length===0||k(t)?e:n.apply(this,arguments)}}function ue(n){return function e(t,s){switch(arguments.length){case 0:return e;case 1:return k(t)?e:Y(function(i){return n(t,i)});default:return k(t)&&k(s)?e:k(t)?Y(function(i){return n(i,s)}):k(s)?Y(function(i){return n(t,i)}):n(t,s)}}}function dt(n){return function e(t,s,i){switch(arguments.length){case 0:return e;case 1:return k(t)?e:ue(function(r,a){return n(t,r,a)});case 2:return k(t)&&k(s)?e:k(t)?ue(function(r,a){return n(r,s,a)}):k(s)?ue(function(r,a){return n(t,r,a)}):Y(function(r){return n(t,s,r)});default:return k(t)&&k(s)&&k(i)?e:k(t)&&k(s)?ue(function(r,a){return n(r,a,i)}):k(t)&&k(i)?ue(function(r,a){return n(r,s,a)}):k(s)&&k(i)?ue(function(r,a){return n(t,r,a)}):k(t)?Y(function(r){return n(r,s,i)}):k(s)?Y(function(r){return n(t,r,i)}):k(i)?Y(function(r){return n(t,s,r)}):n(t,s,i)}}}function je(n,e){return Object.prototype.hasOwnProperty.call(e,n)}var Os=Y(function(e){return e===null?"Null":e===void 0?"Undefined":Object.prototype.toString.call(e).slice(8,-1)});function Kt(n){return Object.prototype.toString.call(n)==="[object Object]"}const Ps=Number.isInteger||function(e){return e<<0===e};function ks(n){return Object.prototype.toString.call(n)==="[object String]"}function Cs(n,e){var t=n<0?e.length+n:n;return ks(e)?e.charAt(t):e[t]}function Ns(n){return new RegExp(n.source,n.flags?n.flags:(n.global?"g":"")+(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.sticky?"y":"")+(n.unicode?"u":"")+(n.dotAll?"s":""))}function Qt(n,e,t){if(t||(t=new Ds),ws(n))return n;var s=function(r){var a=t.get(n);if(a)return a;t.set(n,r);for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(r[l]=Qt(n[l],!0,t));return r};switch(Os(n)){case"Object":return s(Object.create(Object.getPrototypeOf(n)));case"Array":return s(Array(n.length));case"Date":return new Date(n.valueOf());case"RegExp":return Ns(n);case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":return n.slice();default:return n}}function ws(n){var e=typeof n;return n==null||e!="object"&&e!="function"}var Ds=function(){function n(){this.map={},this.length=0}return n.prototype.set=function(e,t){var s=this.hash(e),i=this.map[s];i||(this.map[s]=i=[]),i.push([e,t]),this.length+=1},n.prototype.hash=function(e){var t=[];for(var s in e)t.push(Object.prototype.toString.call(e[s]));return t.join()},n.prototype.get=function(e){if(this.length<=180){for(var t in this.map)for(var a=this.map[t],s=0;s<a.length;s+=1){var i=a[s];if(i[0]===e)return i[1]}return}var r=this.hash(e),a=this.map[r];if(a)for(var s=0;s<a.length;s+=1){var i=a[s];if(i[0]===e)return i[1]}},n}(),N=Y(function(e){return e!=null&&typeof e.clone=="function"?e.clone():Qt(e)});function Ls(n,e){for(var t=e,s=0;s<n.length;s+=1){if(t==null)return;var i=n[s];Ps(i)?t=Cs(i,t):t=t[i]}return t}var Us=dt(function(e,t,s){var i={},r;t=t||{},s=s||{};for(r in t)je(r,t)&&(i[r]=je(r,s)?e(r,t[r],s[r]):t[r]);for(r in s)je(r,s)&&!je(r,i)&&(i[r]=s[r]);return i}),Ms=dt(function n(e,t,s){return Us(function(i,r,a){return Kt(r)&&Kt(a)?n(e,r,a):e(i,r,a)},t,s)}),$s=dt(function(e,t,s){return Ms(function(i,r,a){return e(r,a)},t,s)}),Bs=ue(Ls),zt=ue(function(e,t){var s={};for(var i in t)e(t[i],i,t)&&(s[i]=t[i]);return s});const E=n=>typeof n=="function"&&!!(n.constructor&&n.call&&n.apply),j=n=>typeof n=="string",ee=n=>n===null,H=n=>typeof n>"u",se=n=>ee(n)||H(n),x=n=>!H(n),be=n=>!se(n),xs=n=>be(n)&&n!=="",Wt=n=>n instanceof Error,gt=(n,e)=>{const t=e.split(".");return Bs(t,n)},Gs=(n,e)=>!!gt(n,e),Yt=n=>!ee(n)&&typeof n=="object"&&!Array.isArray(n),O=n=>!ee(n)&&Object.prototype.toString.call(n)==="[object Object]",Vs=(n,e)=>{if(!Array.isArray(n)||!Array.isArray(e))return N(e);const t=N(n);return e.forEach((s,i)=>{t[i]=Array.isArray(s)||Yt(s)?F(t[i],s):s}),t},F=(n,e)=>$s(Vs,n,e),He=n=>O(n)&&Object.keys(n).length>0,Ce=n=>{const e=zt(x,n);return Object.keys(e).forEach(t=>{const s=e[t];O(s)&&(e[t]=Ce(s))}),e},pe=n=>{const e=zt(be,n);return Object.keys(e).forEach(t=>{const s=e[t];O(s)&&(e[t]=pe(s))}),e},Fs=n=>n.replace(/^\s+|\s+$/gm,""),js=n=>n.replace(/ {2,}/g," "),qt=n=>n.replace(/^\.+/,""),Ke=n=>{let e=n;if(!j(n)&&!se(n))try{e=JSON.stringify(n)}catch{e=null}return e},Hs=n=>{const e=Array.from(n,t=>String.fromCodePoint(t)).join("");return globalThis.btoa(e)},Ks=n=>Hs(new TextEncoder().encode(n)),Qe=(n,e,t,s,i)=>{const r={category:n,name:e,properties:t,options:s};return E(i)&&(r.callback=i),E(s)&&(r.category=n,r.name=e,r.properties=t,delete r.options,r.callback=s),E(t)&&(r.category=n,r.name=e,delete r.properties,delete r.options,r.callback=t),E(e)&&(r.category=n,delete r.name,delete r.properties,delete r.options,r.callback=e),E(n)&&(delete r.category,delete r.name,delete r.properties,delete r.options,r.callback=n),O(n)?(delete r.name,delete r.category,r.properties=n,r.options=e):O(e)&&(delete r.name,r.properties=e,r.options=E(t)?null:t),j(n)&&!j(e)&&(delete r.category,r.name=n),x(r.category)||delete r.category,x(r.name)||delete r.name,r.properties=r.properties?N(r.properties):{},x(r.options)?r.options=N(r.options):delete r.options,r.properties=F(O(r.properties)?r.properties:{},{name:j(r.name)?r.name:null,category:j(r.category)?r.category:null}),r},ht=(n,e,t,s)=>{const i={name:n,properties:e,options:t};return E(s)&&(i.callback=s),E(t)&&(i.properties=e,delete i.options,i.callback=t),E(e)&&(delete i.properties,delete i.options,i.callback=e),i.properties=be(i.properties)?N(i.properties):{},x(i.options)?i.options=N(i.options):delete i.options,i},Xt=(n,e,t,s)=>{const i={userId:n,traits:e,options:t};return E(s)&&(i.callback=s),E(t)&&(i.userId=n,i.traits=e,delete i.options,i.callback=t),E(e)&&(i.userId=n,delete i.traits,delete i.options,i.callback=e),(O(n)||ee(n))&&(i.userId=null,i.traits=n,i.options=e),x(i.userId)?i.userId=Ke(i.userId):delete i.userId,O(i.traits)?i.traits=N(i.traits):delete i.traits,x(i.options)?i.options=N(i.options):delete i.options,i},Jt=(n,e,t,s)=>{const i={to:n,from:e,options:t};return E(s)&&(i.callback=s),E(t)&&(i.to=n,i.from=e,delete i.options,i.callback=t),E(e)?(i.to=n,delete i.from,delete i.options,i.callback=e):(O(e)||ee(e))&&(i.to=n,delete i.from,i.options=e),E(n)?(delete i.to,delete i.from,delete i.options,i.callback=n):(O(n)||ee(n))&&(delete i.to,delete i.from,i.options=n),x(i.to)?i.to=Ke(i.to):delete i.to,x(i.from)?i.from=Ke(i.from):delete i.from,x(i.options)?i.options=N(i.options):delete i.options,i},Zt=(n,e,t,s)=>{const i={groupId:n,traits:e,options:t};return E(s)&&(i.callback=s),E(t)&&(i.groupId=n,i.traits=e,delete i.options,i.callback=t),E(e)&&(i.groupId=n,delete i.traits,delete i.options,i.callback=e),E(n)?(i.groupId=null,delete i.traits,delete i.options,i.callback=n):(O(n)||ee(n))&&(i.groupId=null,i.traits=n,i.options=E(e)?null:e),x(i.groupId)?i.groupId=Ke(i.groupId):delete i.groupId,i.traits=O(i.traits)?N(i.traits):{},x(i.options)?i.options=N(i.options):delete i.options,i},ft="CapabilitiesManager",ie="ConfigManager",en="EventManager",tn="PluginsManager",Ne="UserSessionManager",ze="ErrorHandler",Ie="PluginEngine",nn="StoreManager",Qs="readyApi",zs="EventRepository",Ws="ExternalSrcLoader",Ys="HttpClient",sn="VoyageApplication",pt="AnalyticsCore",rn="VoyageLabs JavaScript SDK",we="3.6.1",qs="app.vyg.js",on="npm",an="VoyageJS-Initiated",Xs="ad-block page request",Js="/ad-blocked",vt="preloadedEventsBuffer",Zs="Consent Management Interaction",ei="ajs_trait_",ti="ajs_prop_",ln="ajs_aid",cn="ajs_uid",un="ajs_event",ni=10*1e3,si=31536e3*1e3,De=30*60*1e3,dn=10*1e3,ii=10*1e3,ri=250,gn=(n="app")=>{globalThis.VoyageGlobals||(globalThis.VoyageGlobals={}),globalThis.VoyageGlobals[n]||(globalThis.VoyageGlobals[n]={})},We=(n,e,t="app")=>{gn(t),globalThis.VoyageGlobals[t][n]=e},oi=(n,e="app")=>(gn(e),globalThis.VoyageGlobals[e][n]);function ai(n,e,t=ri){let s;return(...i)=>{globalThis.clearTimeout(s),s=globalThis.setTimeout(()=>{n.apply(e,i)},t)}}const hn=(n,e)=>{const t={};return n.forEach((s,i)=>{if(i.startsWith(e)){const r=i.substring(e.length);t[r]=n.get(i)}}),t},li=(n=[])=>{const e={trait:ei,properties:ti},t=new URLSearchParams(globalThis.location.search);t.get(un)&&n.unshift(["track",t.get(un),hn(t,e.properties)]),t.get(cn)&&n.unshift(["identify",t.get(cn),hn(t,e.trait)]),t.get(ln)&&n.unshift(["setAnonymousId",t.get(ln)])},ci=n=>{const e="load";let t=[],s=0;for(;s<n.length;){if(n[s]&&n[s][0]===e){t=N(n[s]),n.splice(s,1);break}s+=1}return t},ui=n=>{const e="consent",t=n.filter(i=>i[0]===e),s=n.filter(i=>i[0]!==e);n.splice(0,n.length,...t,...s)},di=n=>{const e=oi(vt)||[];li(e),e.length>0&&(n.enqueuePreloadBufferEvents(e),We(vt,[]))},gi=(n,e)=>{const t=n.shift();let s;if(E(e[t])){switch(t){case"page":s=Qe(...n);break;case"track":s=ht(...n);break;case"identify":s=Xt(...n);break;case"alias":s=Jt(...n);break;case"group":s=Zt(...n);break;default:e[t](...n);break}s&&e[t](s)}},hi=10*1e3,P=":: ",fi=n=>`A script with the id "${n}" is already loaded. Skipping the loading of this script to prevent conflicts.`,fn=(n,e)=>`Failed to load the script with the id "${n}" from URL "${e}".`,pi=(n,e,t)=>`A timeout of ${t} ms occurred while trying to load the script with id "${n}" from URL "${e}".`,vi=(n,e)=>`${n}${P}A circular reference has been detected in the object and the property "${e}" has been dropped from the output.`,yi="Failed to convert the value to a JSON string.",Ei="JSONStringify",mi=(n,e,t)=>{const s=[];return function(i,r){if(!(e!=null&&e.includes(i))&&!(n&&se(r))){if(typeof r!="object"||ee(r))return r;for(;s.length>0&&s[s.length-1]!==this;)s.pop();return s.includes(r)?(t==null||t.warn(vi(Ei,i)),"[Circular Reference]"):(s.push(r),r)}}},de=(n,e,t,s)=>{try{return JSON.stringify(n,mi(e,t,s))}catch(i){return s==null||s.warn(yi,i),null}},Le=(n,e)=>{let t=n;return Wt(n)?t.message=`${e}: ${n.message}`:t=new Error(`${e}: ${de(n)}`),t},Si="RS_JS_SDK",bi=(n,e,t=!0,s=null,i=null,r={})=>{const a=document.createElement("script");return a.type="text/javascript",a.onload=s,a.onerror=i,a.src=n,a.id=e,a.async=t,Object.keys(r).forEach(l=>{a.setAttribute(l,r[l])}),a.setAttribute("data-loader",Si),a},Ii=n=>{var r,a,l,d;const e=document.getElementsByTagName("head");if(e.length>0){(a=e[0])==null||a.insertBefore(n,(r=e[0])==null?void 0:r.firstChild);return}const t=document.getElementsByTagName("script");if(t.length>0&&((l=t[0])!=null&&l.parentNode)){(d=t[0])==null||d.parentNode.insertBefore(n,t[0]);return}const s=document.createElement("head");s.appendChild(n);const i=document.getElementsByTagName("html")[0];i==null||i.insertBefore(s,i.firstChild)},Ti=(n,e,t,s=!0,i)=>new Promise((r,a)=>{document.getElementById(e)&&a(new Error(fi(e)));try{let d;Ii(bi(n,e,s,()=>{globalThis.clearTimeout(d),r(e)},()=>{globalThis.clearTimeout(d),a(new Error(fn(e,n)))},i)),d=globalThis.setTimeout(()=>{a(new Error(pi(e,n,t)))},t)}catch(d){a(Le(d,fn(e,n)))}});class pn{constructor(e,t,s=hi){D(this,"hasErrorHandler",!1);this.errorHandler=e,this.logger=t,this.timeout=s,this.hasErrorHandler=!!this.errorHandler,this.onError=this.onError.bind(this)}loadJSFile(e){const{url:t,id:s,timeout:i,async:r,callback:a,extraAttributes:l}=e,d=!E(a);Ti(t,s,i||this.timeout,r,l).then(m=>{d||a(m)}).catch(m=>{this.onError(m),d||a()})}onError(e){var t;if(this.hasErrorHandler)(t=this.errorHandler)==null||t.onError(e,Ws);else throw e}}var _i=Symbol.for("preact-signals");function Ye(){if(ge>1)ge--;else{for(var n,e=!1;Ue!==void 0;){var t=Ue;for(Ue=void 0,yt++;t!==void 0;){var s=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&yn(t))try{t.c()}catch(i){e||(n=i,e=!0)}t=s}}if(yt=0,ge--,e)throw n}}function K(n){if(ge>0)return n();ge++;try{return n()}finally{Ye()}}var M=void 0,Ue=void 0,ge=0,yt=0,qe=0;function vn(n){if(M!==void 0){var e=n.n;if(e===void 0||e.t!==M)return e={i:0,S:n,p:M.s,n:void 0,t:M,e:void 0,x:void 0,r:e},M.s!==void 0&&(M.s.n=e),M.s=e,n.n=e,32&M.f&&n.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=M.s,e.n=void 0,M.s.n=e,M.s=e),e}}function Q(n){this.v=n,this.i=0,this.n=void 0,this.t=void 0}Q.prototype.brand=_i,Q.prototype.h=function(){return!0},Q.prototype.S=function(n){this.t!==n&&n.e===void 0&&(n.x=this.t,this.t!==void 0&&(this.t.e=n),this.t=n)},Q.prototype.U=function(n){if(this.t!==void 0){var e=n.e,t=n.x;e!==void 0&&(e.x=t,n.e=void 0),t!==void 0&&(t.e=e,n.x=void 0),n===this.t&&(this.t=t)}},Q.prototype.subscribe=function(n){var e=this;return ce(function(){var t=e.value,s=M;M=void 0;try{n(t)}finally{M=s}})},Q.prototype.valueOf=function(){return this.value},Q.prototype.toString=function(){return this.value+""},Q.prototype.toJSON=function(){return this.value},Q.prototype.peek=function(){var n=M;M=void 0;try{return this.value}finally{M=n}},Object.defineProperty(Q.prototype,"value",{get:function(){var n=vn(this);return n!==void 0&&(n.i=this.i),this.v},set:function(n){if(n!==this.v){if(yt>100)throw new Error("Cycle detected");this.v=n,this.i++,qe++,ge++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{Ye()}}}});function g(n){return new Q(n)}function yn(n){for(var e=n.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function En(n){for(var e=n.s;e!==void 0;e=e.n){var t=e.S.n;if(t!==void 0&&(e.r=t),e.S.n=e,e.i=-1,e.n===void 0){n.s=e;break}}}function mn(n){for(var e=n.s,t=void 0;e!==void 0;){var s=e.p;e.i===-1?(e.S.U(e),s!==void 0&&(s.n=e.n),e.n!==void 0&&(e.n.p=s)):t=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=s}n.s=t}function Me(n){Q.call(this,void 0),this.x=n,this.s=void 0,this.g=qe-1,this.f=4}(Me.prototype=new Q).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===qe))return!0;if(this.g=qe,this.f|=1,this.i>0&&!yn(this))return this.f&=-2,!0;var n=M;try{En(this),M=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return M=n,mn(this),this.f&=-2,!0},Me.prototype.S=function(n){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}Q.prototype.S.call(this,n)},Me.prototype.U=function(n){if(this.t!==void 0&&(Q.prototype.U.call(this,n),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}},Me.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var n=this.t;n!==void 0;n=n.x)n.t.N()}},Object.defineProperty(Me.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var n=vn(this);if(this.h(),n!==void 0&&(n.i=this.i),16&this.f)throw this.v;return this.v}});function Sn(n){var e=n.u;if(n.u=void 0,typeof e=="function"){ge++;var t=M;M=void 0;try{e()}catch(s){throw n.f&=-2,n.f|=8,Et(n),s}finally{M=t,Ye()}}}function Et(n){for(var e=n.s;e!==void 0;e=e.n)e.S.U(e);n.x=void 0,n.s=void 0,Sn(n)}function Ri(n){if(M!==this)throw new Error("Out-of-order effect");mn(this),M=n,this.f&=-2,8&this.f&&Et(this),Ye()}function $e(n){this.x=n,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}$e.prototype.c=function(){var n=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{n()}},$e.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,Sn(this),En(this),ge++;var n=M;return M=this,Ri.bind(this,n)},$e.prototype.N=function(){2&this.f||(this.f|=2,this.o=Ue,Ue=this)},$e.prototype.d=function(){this.f|=8,1&this.f||Et(this)};function ce(n){var e=new $e(n);try{e.c()}catch(t){throw e.d(),t}return e.d.bind(e)}class bn{constructor(){this.items=[]}enqueue(e){this.items.push(e)}dequeue(){return this.items.length===0?null:this.items.shift()}isEmpty(){return this.items.length===0}size(){return this.items.length}clear(){this.items=[]}}const Xe={LOG:0,INFO:1,DEBUG:2,WARN:3,ERROR:4,NONE:5},In="ERROR",Ai="VYG SDK",Oi="font-weight: bold; background: black; color: white;",Pi="font-weight: normal;";class ki{constructor(e=In,t="",s=console){this.minLogLevel=Xe[e],this.scope=t,this.logProvider=s}log(...e){this.outputLog("LOG",e)}info(...e){this.outputLog("INFO",e)}debug(...e){this.outputLog("DEBUG",e)}warn(...e){this.outputLog("WARN",e)}error(...e){this.outputLog("ERROR",e)}outputLog(e,t){var s,i;this.minLogLevel<=Xe[e]&&((i=(s=this.logProvider)[e.toLowerCase()])==null||i.call(s,...this.formatLogData(t)))}setScope(e){this.scope=e||this.scope}setMinLogLevel(e){this.minLogLevel=Xe[e],H(this.minLogLevel)&&(this.minLogLevel=Xe[In])}formatLogData(e){if(Array.isArray(e)&&e.length>0){let t=`%c ${Ai}`;this.scope&&(t=`${t} - ${this.scope}`);const s=j(e[0])?e[0].trim():"";t=`${t} %c ${s}`;const i=[t,Oi,Pi];return j(e[0])||i.push(e[0]),i.push(...e.slice(1)),i}return e}}const re=new ki,Tn=["localStorage","memoryStorage","cookieStorage","sessionStorage","none"],mt="cookieStorage",Ci='"getSourceConfig" must be a function. Please make sure that it is defined and returns a valid source configuration object.',_n="Unable to process/parse source configuration response.",Ni="The source is disabled. Please enable the source in the dashboard to send events.",wi="Failed to prepare data for the request.",Di="Failed to generate the event object.",Li="Failed to invoke plugin because the extension point name is missing.",Ui="Failed to invoke plugin because the extension point name is invalid.",Mi=n=>`Failed to load the SDK as the base URL for ${n} is not valid.`,$i=(n,e,t)=>`${n}${P}The consent manager "${e}" is not supported. Please choose one of the following supported consent managers: "${Object.keys(t)}".`,Bi=n=>`${n}${P}Failed to initialize the error reporting plugin.`,xi=n=>`${n}${P}Failed to notify the error.`,Gi=n=>`${n}${P}Plugin name is missing.`,Vi=(n,e)=>`${n}${P}Plugin "${e}" already exists.`,Fi=(n,e)=>`${n}${P}Plugin "${e}" not found.`,ji=(n,e)=>`${n}${P}Plugin "${e}" not found in plugins but found in byName. This indicates a bug in the plugin engine. Please report this issue to the development team.`,Hi=(n,e,t)=>`${n}${P}Plugin "${e}" could not be loaded because some of its dependencies "${t}" do not exist.`,Ki=(n,e,t)=>`${n}${P}Failed to invoke the "${e}" extension point of plugin "${t}".`,Qi=(n,e)=>`${n}${P}The "${e}" storage type is `,zi=n=>`Failed to fetch the source config. Reason: ${n}`,Wi=n=>`The write key "${n}" is invalid. It must be a non-empty string. Please check that the write key is correct and try again.`,Yi=n=>`The data plane URL "${n}" is invalid. It must be a valid URL string. Please check that the data plane URL is correct and try again.`,qi=n=>`${n}${P}The callback is not a function.`,Xi=(n,e,t,s)=>`${n} with status: ${e}, ${t} for URL: ${s}.`,Ji=(n,e,t)=>`${n} due to timeout or no connection (${e?e.type:""}) for URL: ${t}.`,Zi=(n,e)=>`${n} for URL: ${e}`,er=n=>`Failed to save the value for "${n}" to storage`,tr=n=>`Failed to retrieve or parse data for "${n}" from storage`,nr=n=>`The server responded with status ${n} while setting the cookies. As a fallback, the cookies will be set client side.`,sr=n=>`The server failed to set the ${n} cookie. As a fallback, the cookies will be set client side.`,ir="Failed to set/remove cookies via server. As a fallback, the cookies will be managed client side.",rr=(n,e,t)=>`${n}${P}The storage type "${e}" is not supported. Please choose one of the following supported types: "${Tn}". The default type "${t}" will be used instead.`,or=(n,e,t,s)=>`${n}${P}The error reporting provider "${e}" is not supported. Please choose one of the following supported providers: "${Object.keys(t)}". The default provider "${s}" will be used instead.`,ar=(n,e,t,s)=>`${n}${P}The storage encryption version "${e}" is not supported. Please choose one of the following supported versions: "${Object.keys(t)}". The default version "${s}" will be used instead.`,lr=(n,e,t)=>`${n}${P}The storage data migration has been disabled because the configured storage encryption version (${e}) is not the latest (${t}). To enable storage data migration, please update the storage encryption version to the latest version.`,cr=(n,e,t)=>`${n}${P}The provided cookie domain (${e}) does not match the current webpage's domain (${t}). Hence, the cookies will be set client-side.`,ur=(n,e,t,s)=>`${n}${P}The "${e}" property defined under "${t}" is a reserved keyword. Please choose a different property name to avoid conflicts with reserved keywords (${s}).`,dr=n=>`${n}${P}The Beacon API is not supported by your browser. The events will be sent using XHR instead.`,gr=(n,e,t)=>`${n}${P}The session timeout value "${e}" is not a number. The default timeout of ${t} ms will be used instead.`,hr=n=>`${n}${P}The session timeout value is 0, which disables the automatic session tracking feature. If you want to enable session tracking, please provide a positive integer value for the timeout.`,fr=(n,e,t)=>`${n}${P}The session timeout value ${e} ms is less than the recommended minimum of ${t} ms. Please consider increasing the timeout value to ensure optimal performance and reliability.`,pr=(n,e,t)=>`${n}${P}The provided session ID (${e}) is either invalid, not a positive integer, or not at least "${t}" digits long. A new session ID will be auto-generated instead.`,vr=n=>`${n}${P}The storage is either full or unavailable, so the data will not be persisted. Switching to in-memory storage.`,yr=(n,e,t,s)=>`${n}${P}The storage type "${t}" is not available for entry "${e}". The SDK will initialize the entry with "${s}" storage type instead.`,Er=(n,e)=>`${n}${P}The write key "${e}" is not a string. Please check that the write key is correct and try again.`,mr=n=>`${n}${P}The group() method must be called with at least one argument.`,Rn="Failed to invoke the ready callback",Sr="API Callback Invocation Failed",br="NativeDestinationQueuePlugin initialization failed",Ir="XhrQueuePlugin initialization failed",Tr="DeviceModeTransformationPlugin initialization failed",_r="NativeDestinationQueuePlugin event enqueue failed",Rr="XhrQueuePlugin event enqueue failed",Ar=(n,e)=>`${n}${P}The provided source config URL "${e}" is invalid. Using the default source config URL instead.`,Or=(n,e)=>`Failed to load the polyfill script with ID "${n}" from URL ${e}.`,Pr=(n,e,t)=>`${n}${P}The pre-consent storage strategy "${e}" is not supported. Please choose one of the following supported strategies: "none, session, anonymousId". The default strategy "${t}" will be used instead.`,kr=(n,e,t)=>`${n}${P}The pre-consent events delivery type "${e}" is not supported. Please choose one of the following supported types: "immediate, buffer". The default type "${t}" will be used instead.`,Cr=(n,e,t,s)=>{const i=t.length===1,r=i?` '${t[0]}' plugin was`:` ['${t.join("', '")}'] plugins were`,a=`${n}${P}${e}, but${r} not configured to load.`;return s?`${a} So, ${i?"the plugin":"those plugins"} will be loaded automatically.`:`${a} Ignore if this was intentional. Otherwise, consider adding ${i?"it":"them"} to the 'plugins' load API option.`},Nr=(n,e)=>`${n}${P}The provided polyfill URL "${e}" is invalid. The default polyfill URL will be used instead.`,An="js-integrations",On="plugins",wr=new RegExp("^(https?:\\/\\/)(((([a-zA-Z\\d]([a-zA-Z\\d-]*[a-zA-Z\\d])*)\\.)+[a-zA-Z]{2,}|localhost|((25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[0-1]?[0-9]?[0-9]?)))(\\:\\d+)?(\\/[-a-zA-Z\\d%_.~+]*)*(\\?[;&a-zA-Z\\d%_.~+=-]*)?(\\#[-a-zA-Z\\d_]*)?$"),Be="modern",Pn="https://cdn.rudderlabs.com",St="v3",kn=`${Pn}/${St}/${Be}/${An}`,Cn=`${Pn}/${St}/${Be}/${On}`,Nn="https://api.rudderstack.com",bt="bugsnag",ve="v3",Dr="xhr",It={oneTrust:"OneTrustConsentManager",ketch:"KetchConsentManager",custom:"CustomConsentManager"},Je={[bt]:"Bugsnag"},Ze={[ve]:"StorageEncryption",legacy:"StorageEncryptionLegacy"},Lr={[Dr]:"XhrQueue",beacon:"BeaconQueue"},Ur="rsaRequest",Mr=g(N({logLevel:"ERROR",configUrl:Nn,loadIntegration:!0,sessions:{autoTrack:!0,timeout:De},sameSiteCookie:"Lax",polyfillIfRequired:!0,integrations:{All:!0},useBeacon:!1,beaconQueueOptions:{},destinationsQueueOptions:{},queueOptions:{},lockIntegrationsVersion:!1,lockPluginsVersion:!1,uaChTrackLevel:"none",plugins:[],useGlobalIntegrationsConfigInEvents:!1,bufferDataPlaneEventsUntilReady:!1,dataPlaneEventsBufferTimeout:ii,storage:{encryption:{version:ve},migrate:!0},sendAdblockPageOptions:{},useServerSideCookies:!1})),L={userId:"",userTraits:{},anonymousId:"",groupId:"",groupTraits:{},initialReferrer:"",initialReferringDomain:"",sessionInfo:{},authToken:null},$r=10,Br={autoTrack:!0,timeout:De},xr={userId:g(L.userId),userTraits:g(L.userTraits),anonymousId:g(L.anonymousId),groupId:g(L.groupId),groupTraits:g(L.groupTraits),initialReferrer:g(L.initialReferrer),initialReferringDomain:g(L.initialReferringDomain),sessionInfo:g(L.sessionInfo),authToken:g(L.authToken)},Gr={isOnline:g(!0),storage:{isLocalStorageAvailable:g(!1),isCookieStorageAvailable:g(!1),isSessionStorageAvailable:g(!1)},isBeaconAvailable:g(!1),isLegacyDOM:g(!1),isUaCHAvailable:g(!1),isCryptoAvailable:g(!1),isIE11:g(!1),isAdBlocked:g(!1)},Vr={isErrorReportingEnabled:g(!1),isMetricsReportingEnabled:g(!1),errorReportingProviderPluginName:g(void 0),isErrorReportingPluginLoaded:g(!1)},Fr=g(void 0),jr={activeDataplaneUrl:g(void 0),integrationsCDNPath:g(kn),pluginsCDNPath:g(Cn),sourceConfigUrl:g(void 0),status:g(void 0),initialized:g(!1),logLevel:g("ERROR"),loaded:g(!1),readyCallbacks:g([]),writeKey:g(void 0),dataPlaneUrl:g(void 0)},Hr={enabled:g(!1),initialized:g(!1),data:g({}),activeConsentManagerPluginName:g(void 0),preConsent:g({enabled:!1}),postConsent:g({}),resolutionStrategy:g("and"),provider:g(void 0),metadata:g(void 0)},Kr={retries:g(0),dropped:g(0),sent:g(0),queued:g(0),triggered:g(0)},Qr={app:g({name:rn,namespace:qs,version:we,installType:on}),traits:g(null),library:g({name:rn,version:we,snippetVersion:globalThis.VoyageSnippetVersion}),userAgent:g(""),device:g(null),network:g(null),os:g({name:"",version:""}),locale:g(null),screen:g({density:0,width:0,height:0,innerWidth:0,innerHeight:0}),"ua-ch":g(void 0),timezone:g(void 0)},zr={configuredDestinations:g([]),activeDestinations:g([]),loadOnlyIntegrations:g({}),failedDestinations:g([]),loadIntegration:g(!0),initializedDestinations:g([]),clientDestinationsReady:g(!1),integrationsConfig:g({})},Wr={toBeProcessedArray:g([]),readyCallbacksArray:g([])},Yr={ready:g(!1),loadedPlugins:g([]),failedPlugins:g([]),pluginsToLoadFromConfig:g([]),activePlugins:g([]),totalPluginsToLoad:g(0)},qr={encryptionPluginName:g(void 0),migrate:g(!1),type:g(void 0),cookie:g(void 0),entries:g({}),trulyAnonymousTracking:g(!1)},Xr={isEnabledServerSideCookies:g(!1),dataServiceUrl:g(void 0)},Jr={eventsQueuePluginName:g(void 0),deliveryEnabled:g(!0)},o={...N({capabilities:Gr,consents:Hr,context:Qr,eventBuffer:Wr,lifecycle:jr,loadOptions:Mr,metrics:Kr,nativeDestinations:zr,plugins:Yr,reporting:Vr,session:xr,source:Fr,storage:qr,serverCookies:Xr,dataPlaneEvents:Jr})};class Zr{constructor(e={},t){D(this,"plugins",[]);D(this,"byName",{});D(this,"cache",{});D(this,"config",{throws:!0});this.config={throws:!0,...e},this.logger=t}register(e,t){var i,r;if(!e.name){const a=Gi(Ie);if(this.config.throws)throw new Error(a);(i=this.logger)==null||i.error(a,e)}if(this.byName[e.name]){const a=Vi(Ie,e.name);if(this.config.throws)throw new Error(a);(r=this.logger)==null||r.error(a)}this.cache={},this.plugins=this.plugins.slice();let s=this.plugins.length;this.plugins.forEach((a,l)=>{var d;(d=a.deps)!=null&&d.includes(e.name)&&(s=Math.min(s,l))}),this.plugins.splice(s,0,e),this.byName[e.name]=e,E(e.initialize)&&e.initialize(t)}unregister(e){var i,r;const t=this.byName[e];if(!t){const a=Fi(Ie,e);if(this.config.throws)throw new Error(a);(i=this.logger)==null||i.error(a)}const s=this.plugins.indexOf(t);if(s===-1){const a=ji(Ie,e);if(this.config.throws)throw new Error(a);(r=this.logger)==null||r.error(a)}this.cache={},delete this.byName[e],this.plugins=this.plugins.slice(),this.plugins.splice(s,1)}getPlugin(e){return this.byName[e]}getPlugins(e){const t=e??".";return this.cache[t]||(this.cache[t]=this.plugins.filter(s=>{var i,r;if((i=s.deps)!=null&&i.some(a=>!this.byName[a])){const a=s.deps.filter(l=>!this.byName[l]);return(r=this.logger)==null||r.error(Hi(Ie,s.name,a)),!1}return t==="."?!0:Gs(s,t)})),this.cache[t]}processRawPlugins(e){e(this.plugins),this.cache={}}invoke(e,t=!0,...s){let i=e;if(!i)throw new Error(Li);const r=i.startsWith("!"),a=this.config.throws??i.endsWith("!");if(i=i.replace(/(^!|!$)/g,""),!i)throw new Error(Ui);const l=i.split(".");l.pop();const d=l.join(".");return(t?this.getPlugins(i):[this.getPlugins(i)[0]]).map(S=>{var U;const B=gt(S,i);if(!E(B)||r)return B;try{return B.apply(gt(S,d),s)}catch(p){if(a)throw p;(U=this.logger)==null||U.error(Ki(Ie,i,S.name),p)}return null})}invokeSingle(e,...t){return this.invoke(e,!1,...t)[0]}invokeMultiple(e,...t){return this.invoke(e,!0,...t)}}const wn=new Zr({throws:!0},re),et="The request failed",eo=[et],to="RS_JS_SDK",no=n=>{let e;try{if(j(n))e=n;else if(n instanceof Error)e=n.message;else if(n instanceof ErrorEvent)e=n.message;else if(n instanceof Event){const t=n.target;if(t&&t.localName!=="script"||t!=null&&t.dataset&&(t.dataset.loader!==to||t.dataset.isnonnativesdk!=="true"))return"";e=`Error in loading a third-party script from URL ${t==null?void 0:t.src} with ID ${t==null?void 0:t.id}.`}else e=n.message?n.message:de(n)}catch(t){e=`Unknown error: ${t.message}`}return e},so=n=>n.message?!eo.some(e=>n.message.includes(e)):!0;class io{constructor(e,t){this.logger=e,this.pluginEngine=t,this.errorBuffer=new bn,this.attachEffect()}attachEffect(){if(o.reporting.isErrorReportingPluginLoaded.value===!0)for(;this.errorBuffer.size()>0;)this.errorBuffer.dequeue()}attachErrorListeners(){var e;"addEventListener"in globalThis?(globalThis.addEventListener("error",t=>{this.onError(t,void 0,void 0,void 0,"unhandledException")}),globalThis.addEventListener("unhandledrejection",t=>{this.onError(t,void 0,void 0,void 0,"unhandledPromiseRejection")})):(e=this.logger)==null||e.debug("Failed to attach global error listeners.")}init(e){if(this.pluginEngine)try{const s=this.pluginEngine.invokeSingle("errorReporting.init",o,this.pluginEngine,e,this.logger);s instanceof Promise&&s.then(i=>{this.errReportingClient=i}).catch(i=>{var r;(r=this.logger)==null||r.error(Bi(ze),i)})}catch(t){this.onError(t,ze)}}onError(e,t="",s="",i=!1,r="handled"){let a=no(e);if(!a)return;a=js(`${t}${P}${s} ${a}`);let l=new Error(a);if(Wt(e)&&(l=Object.create(e,{message:{value:a}})),r==="handled")if(this.notifyError(l),this.logger){if(this.logger.error(a),i)throw l}else throw l;o.reporting.isErrorReportingEnabled.value&&o.reporting.isErrorReportingPluginLoaded.value}leaveBreadcrumb(e){if(this.pluginEngine)try{this.pluginEngine.invokeSingle("errorReporting.breadcrumb",this.pluginEngine,this.errReportingClient,e,this.logger)}catch(t){this.onError(t,ze,"errorReporting.breadcrumb")}}notifyError(e){var t,s;if(this.errReportingClient&&so(e))try{(t=this.pluginEngine)==null||t.invokeSingle("errorReporting.notify",this.pluginEngine,this.errReportingClient,e,o,this.logger)}catch(i){(s=this.logger)==null||s.error(xi(ze),i)}}}const tt=new io(re,wn),ro=n=>n.config.connectionMode!=="cloud"||n.config.useNativeSDKToSend===!0||n.config.useNativeSDK===!0,oo=n=>n.config.connectionMode==="hybrid"||n.config.useNativeSDKToSend===!0,Dn=n=>n.filter(ro),Ln=["BeaconQueue","Bugsnag","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ErrorReporting","ExternalAnonymousId","GoogleLinker","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],ao={voyageAnalyticsRemotePlugins:{url:()=>Promise.resolve(window.VoyageGlobals&&window.VoyageGlobals.app&&window.VoyageGlobals.app.pluginsCDNPath?""+window.VoyageGlobals.app.pluginsCDNPath+"/rsa-plugins.js":"https://cdn.rudderlabs.com/v3/modern/plugins/rsa-plugins.js"),format:"esm",from:"vite"}},lo=async(n,e)=>{const t=typeof n=="function"?await n():n,s=document.createElement("script");s.type="text/javascript",s.onload=e,s.src=t,document.getElementsByTagName("head")[0].appendChild(s)};function Un(n,e){const t=Object.assign(n,e);for(const s of Object.keys(t))typeof t[s]=="object"&&typeof e[s]=="object"&&(t[s]=Un(t[s],e[s]));return t}const Mn=n=>Un({},(globalThis.__federation_shared__||{}).default||{});async function co(n){const e=ao[n];if(e.inited)return e.lib;if(e.format==="var")return new Promise(t=>{const s=()=>{e.inited||(e.lib=window[n],e.lib.init(Mn(e.from)),e.inited=!0),t(e.lib)};return lo(e.url,s)});if(["esm","systemjs"].includes(e.format))return new Promise((t,s)=>{(typeof e.url=="function"?e.url:()=>Promise.resolve(e.url))().then(r=>{import(r).then(a=>{if(!e.inited){const l=Mn(e.from);a.init(l),e.lib=a,e.lib.init(l),e.inited=!0}t(e.lib)}).catch(s)})})}function z(n,e){if(!(n!=null&&n.default)&&e){let t=Object.create(null);return t.default=n,t.__esModule=!0,t}return n}function W(n,e){return co(n).then(t=>t.get(e).then(s=>s()))}const uo=n=>{switch(n){case"BeaconQueue":return()=>W("voyageAnalyticsRemotePlugins","./BeaconQueue").then(e=>z(e,!0));case"Bugsnag":return()=>W("voyageAnalyticsRemotePlugins","./Bugsnag").then(e=>z(e,!0));case"CustomConsentManager":return()=>W("voyageAnalyticsRemotePlugins","./CustomConsentManager").then(e=>z(e,!0));case"DeviceModeDestinations":return()=>W("voyageAnalyticsRemotePlugins","./DeviceModeDestinations").then(e=>z(e,!0));case"DeviceModeTransformation":return()=>W("voyageAnalyticsRemotePlugins","./DeviceModeTransformation").then(e=>z(e,!0));case"ErrorReporting":return()=>W("voyageAnalyticsRemotePlugins","./ErrorReporting").then(e=>z(e,!0));case"ExternalAnonymousId":return()=>W("voyageAnalyticsRemotePlugins","./ExternalAnonymousId").then(e=>z(e,!0));case"GoogleLinker":return()=>W("voyageAnalyticsRemotePlugins","./GoogleLinker").then(e=>z(e,!0));case"KetchConsentManager":return()=>W("voyageAnalyticsRemotePlugins","./KetchConsentManager").then(e=>z(e,!0));case"NativeDestinationQueue":return()=>W("voyageAnalyticsRemotePlugins","./NativeDestinationQueue").then(e=>z(e,!0));case"OneTrustConsentManager":return()=>W("voyageAnalyticsRemotePlugins","./OneTrustConsentManager").then(e=>z(e,!0));case"StorageEncryption":return()=>W("voyageAnalyticsRemotePlugins","./StorageEncryption").then(e=>z(e,!0));case"StorageEncryptionLegacy":return()=>W("voyageAnalyticsRemotePlugins","./StorageEncryptionLegacy").then(e=>z(e,!0));case"StorageMigrator":return()=>W("voyageAnalyticsRemotePlugins","./StorageMigrator").then(e=>z(e,!0));case"XhrQueue":return()=>W("voyageAnalyticsRemotePlugins","./XhrQueue").then(e=>z(e,!0));default:return}},Tt=n=>{const e={};return n.forEach(t=>{if(Ln.includes(t)){const s=uo(t);s&&(e[t]=s)}}),e},_t=()=>({}),go=()=>({}),ho=n=>(Tt==null?void 0:Tt(n))||{},Rt={..._t(),...go()},fo=n=>({...ho(n)});class po{constructor(e,t,s){this.engine=e,this.errorHandler=t,this.logger=s,this.onError=this.onError.bind(this)}init(){o.lifecycle.status.value="pluginsLoading",We("pluginsCDNPath",o.lifecycle.pluginsCDNPath.value),this.setActivePlugins(),this.registerLocalPlugins(),this.registerRemotePlugins(),this.attachEffects()}attachEffects(){ce(()=>{(o.plugins.activePlugins.value.length===0||o.plugins.loadedPlugins.value.length+o.plugins.failedPlugins.value.length===o.plugins.totalPluginsToLoad.value)&&K(()=>{o.plugins.ready.value=!0,o.lifecycle.status.value="pluginsReady"})})}getPluginsToLoadBasedOnConfig(){let e=o.plugins.pluginsToLoadFromConfig.value;if(!e)return[];const t=[{configurationStatus:()=>x(o.dataPlaneEvents.eventsQueuePluginName.value),configurationStatusStr:"Data plane events delivery is enabled",activePluginName:o.dataPlaneEvents.eventsQueuePluginName.value,supportedPlugins:Object.values(Lr),shouldAddMissingPlugins:!0},{configurationStatus:()=>x(o.reporting.errorReportingProviderPluginName.value),configurationStatusStr:"Error reporting is enabled",activePluginName:o.reporting.errorReportingProviderPluginName.value,basePlugins:["ErrorReporting"],supportedPlugins:Object.values(Je)},{configurationStatus:()=>Dn(o.nativeDestinations.configuredDestinations.value).length>0,configurationStatusStr:"Device mode destinations are connected to the source",supportedPlugins:["DeviceModeDestinations","NativeDestinationQueue"]},{configurationStatus:()=>Dn(o.nativeDestinations.configuredDestinations.value).some(i=>i.shouldApplyDeviceModeTransformation),configurationStatusStr:"Device mode transformations are enabled for at least one destination",supportedPlugins:["DeviceModeTransformation"]},{configurationStatus:()=>x(o.consents.activeConsentManagerPluginName.value),configurationStatusStr:"Consent management is enabled",activePluginName:o.consents.activeConsentManagerPluginName.value,supportedPlugins:Object.values(It)},{configurationStatus:()=>x(o.storage.encryptionPluginName.value),configurationStatusStr:"Storage encryption is enabled",activePluginName:o.storage.encryptionPluginName.value,supportedPlugins:Object.values(Ze)},{configurationStatus:()=>o.storage.migrate.value,configurationStatusStr:"Storage migration is enabled",supportedPlugins:["StorageMigrator"]}],s=!1;return t.forEach(i=>{i.configurationStatus()?(e=e.filter(i.activePluginName?r=>!(r!==i.activePluginName&&i.supportedPlugins.includes(r)):r=>x(r)),this.addMissingPlugins(i,s,e)):e=e.filter(i.basePlugins!==void 0?r=>!(i.basePlugins.includes(r)||i.supportedPlugins.includes(r)):r=>!i.supportedPlugins.includes(r))}),[...Object.keys(_t()),...e]}addMissingPlugins(e,t,s){var l;const i=e.shouldAddMissingPlugins||t;let r;e.activePluginName?r=[...e.basePlugins||[],e.activePluginName]:r=[...e.supportedPlugins];const a=r.filter(d=>!s.includes(d));a.length>0&&(i&&s.push(...a),(l=this.logger)==null||l.warn(Cr(tn,e.configurationStatusStr,a,i)))}setActivePlugins(){const e=this.getPluginsToLoadBasedOnConfig(),t=[...Object.keys(Rt),...Ln],s=[],i=[];e.forEach(r=>{t.includes(r)?s.push(r):i.push(r)}),i.length>0&&this.onError(new Error(`Ignoring loading of unknown plugins: ${i.join(",")}. Mandatory plugins: ${Object.keys(_t()).join(",")}. Load option plugins: ${o.plugins.pluginsToLoadFromConfig.value.join(",")}`)),K(()=>{o.plugins.totalPluginsToLoad.value=e.length,o.plugins.activePlugins.value=s,o.plugins.failedPlugins.value=i})}registerLocalPlugins(){Object.values(Rt).forEach(e=>{E(e)&&o.plugins.activePlugins.value.includes(e().name)&&this.register([e()])})}registerRemotePlugins(){const e=fo(o.plugins.activePlugins.value);Promise.all(Object.keys(e).map(async t=>{await e[t]().then(s=>this.register([s.default()])).catch(s=>{o.plugins.failedPlugins.value=[...o.plugins.failedPlugins.value,t],this.onError(s,t)})})).catch(t=>{this.onError(t)})}invokeMultiple(e,...t){try{return this.engine.invokeMultiple(e,...t)}catch(s){return this.onError(s,e),[]}}invokeSingle(e,...t){try{return this.engine.invokeSingle(e,...t)}catch(s){return this.onError(s,e),null}}register(e){e.forEach(t=>{try{this.engine.register(t,o)}catch(s){o.plugins.failedPlugins.value=[...o.plugins.failedPlugins.value,t.name],this.onError(s)}})}unregisterLocalPlugins(){Object.values(Rt).forEach(e=>{try{this.engine.unregister(e().name)}catch(t){this.onError(t)}})}onError(e,t){if(this.errorHandler)this.errorHandler.onError(e,tn,t);else throw e}}const $n=(n,e)=>{try{return JSON.parse(n||"")}catch(t){const s=Le(t,"Failed to parse response data");if(E(e))e(s);else throw s}},vo={headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},method:"GET"},Bn=(n,e,t)=>{const s=F(vo,e||{});return t&&(s.headers=F(s.headers,{Authorization:t})),s.url=n,s},xn=(n,e=ni,t)=>new Promise((s,i)=>{let r;if(n.sendRawData===!0)r=n.data;else if(r=de(n.data,!1,[],t),ee(r)){i({error:new Error(wi),undefined:void 0,options:n});return}const a=new XMLHttpRequest,l=m=>{i({error:new Error(Xi(et,a.status,a.statusText,n.url)),xhr:a,options:n})},d=m=>{i({error:new Error(Ji(et,m,n.url)),xhr:a,options:n})};a.ontimeout=d,a.onerror=d,a.onload=()=>{a.status>=200&&a.status<400?s({response:a.responseText,xhr:a,options:n}):l()},a.open(n.method,n.url),n.withCredentials===!0&&(a.withCredentials=!0),a.timeout=e,Object.keys(n.headers).forEach(m=>{n.headers[m]&&a.setRequestHeader(m,n.headers[m])});try{a.send(r)}catch(m){i({error:Le(m,Zi(et,n.url)),xhr:a,options:n})}});class At{constructor(e,t){D(this,"hasErrorHandler",!1);this.errorHandler=e,this.logger=t,this.hasErrorHandler=!!this.errorHandler,this.onError=this.onError.bind(this)}async getData(e){const{url:t,options:s,timeout:i,isRawResponse:r}=e;try{const a=await xn(Bn(t,s,this.basicAuthHeader),i,this.logger);return{data:r?a.response:$n(a.response,this.onError),details:a}}catch(a){return this.onError(a.error??a),{data:void 0,details:a}}}getAsyncData(e){const{callback:t,url:s,options:i,timeout:r,isRawResponse:a}=e,l=!E(t);xn(Bn(s,i,this.basicAuthHeader),r,this.logger).then(d=>{l||t(a?d.response:$n(d.response,this.onError),d)}).catch(d=>{this.onError(d.error??d),l||t(void 0,d)})}onError(e){var t;if(this.hasErrorHandler)(t=this.errorHandler)==null||t.onError(e,Ys);else throw e}setAuthHeader(e,t=!1){const s=t?e:Ks(`${e}:`);this.basicAuthHeader=`Basic ${s}`}resetAuthHeader(){this.basicAuthHeader=void 0}}const yo=new At(tt,re),q="cookieStorage",X="localStorage",te="sessionStorage",ae="memoryStorage",ye="none",Te={userId:"rl_user_id",userTraits:"rl_trait",anonymousId:"rl_anonymous_id",groupId:"rl_group_id",groupTraits:"rl_group_trait",initialReferrer:"rl_page_init_referrer",initialReferringDomain:"rl_page_init_referring_domain",sessionInfo:"rl_session",authToken:"rl_auth_token"},Eo="test_voyage_cookie",mo="test_voyage_ls",So="test_voyage_ss",bo="__tld__",Gn="clientDataInCookie",Vn="clientDataInLocalStorage",Io="clientDataInMemory",Fn="clientDataInSessionStorage",jn=["userId","userTraits","anonymousId","groupId","groupTraits","initialReferrer","initialReferringDomain","sessionInfo","authToken"],_e={[q]:Gn,[X]:Vn,[ae]:Io,[te]:Fn},To="Failed to encode the cookie data.",Hn=(n,e)=>{try{return encodeURIComponent(n)}catch(t){e==null||e.error(To,t);return}},Kn=n=>{try{return decodeURIComponent(n)}catch{return}},_o=n=>{const e={},t=n.split(/\s*;\s*/);let s;return t[0]&&t.forEach(i=>{s=i.split("=");const r=s[0]?Kn(s[0]):void 0;r&&(e[r]=s[1]?Kn(s[1]):void 0)}),e},Ro=(n,e,t,s)=>{const i={...t||{}};let r=`${Hn(n,s)}=${Hn(e,s)}`;ee(e)&&(i.maxage=-1),i.maxage&&(i.expires=new Date(+new Date+i.maxage)),i.path&&(r+=`; path=${i.path}`),i.domain&&(r+=`; domain=${i.domain}`),i.expires&&(r+=`; expires=${i.expires.toUTCString()}`),i.samesite&&(r+=`; samesite=${i.samesite}`),i.secure&&(r+="; secure"),globalThis.document.cookie=r},Ot=()=>{const n=globalThis.document.cookie;return _o(n)},Ao=n=>Ot()[n],he=function(n,e,t,s){switch(arguments.length){case 4:case 3:case 2:return Ro(n,e,t,s);case 1:return n?Ao(n):Ot();default:return Ot()}},Oo=(n,e)=>{const t=new URL(o.lifecycle.sourceConfigUrl.value),s=`${t.origin}${t.pathname}?view=ad`,i=new At(n,e);i.setAuthHeader(o.lifecycle.writeKey.value),i.getAsyncData({url:s,options:{method:"HEAD",headers:{"Content-Type":void 0}},isRawResponse:!0,callback:(r,a)=>{var l;o.capabilities.isAdBlocked.value=(a==null?void 0:a.error)!==void 0||((l=a==null?void 0:a.xhr)==null?void 0:l.responseURL)!==s}})},Po=()=>!se(globalThis.crypto)&&E(globalThis.crypto.getRandomValues),Qn=()=>!se(globalThis.navigator.userAgentData),ko=()=>!se(globalThis.navigator.sendBeacon)&&E(globalThis.navigator.sendBeacon),Co=()=>!!globalThis.navigator.userAgent.match(/Trident.*rv:11\./),No=(n,e="none")=>{var t;e==="none"&&n(void 0),e==="default"&&n(navigator.userAgentData),e==="full"&&((t=navigator.userAgentData)==null||t.getHighEntropyValues(["architecture","bitness","brands","mobile","model","platform","platformVersion","uaFullVersion","fullVersionList","wow64"]).then(s=>{n(s)}).catch(()=>{n()}))},wo=()=>{const n=globalThis.document.createElement("div");return n.setAttribute("data-a-b","c"),n.dataset?n.dataset.aB==="c":!1},Pt={URL:()=>!E(globalThis.URL)||!E(globalThis.URLSearchParams),Promise:()=>!E(globalThis.Promise),"Number.isNaN":()=>!E(globalThis.Number.isNaN),"Number.isInteger":()=>!E(globalThis.Number.isInteger),"Array.from":()=>!E(globalThis.Array.from),"Array.prototype.find":()=>!E(globalThis.Array.prototype.find),"Array.prototype.includes":()=>!E(globalThis.Array.prototype.includes),"String.prototype.endsWith":()=>!E(globalThis.String.prototype.endsWith),"String.prototype.startsWith":()=>!E(globalThis.String.prototype.startsWith),"String.prototype.includes":()=>!E(globalThis.String.prototype.includes),"String.prototype.replaceAll":()=>!E(globalThis.String.prototype.replaceAll),"String.fromCodePoint":()=>!E(globalThis.String.fromCodePoint),"Object.entries":()=>!E(globalThis.Object.entries),"Object.values":()=>!E(globalThis.Object.values),"Object.assign":()=>!E(globalThis.Object.assign),"Object.fromEntries":()=>!E(globalThis.Object.fromEntries),"Element.prototype.dataset":()=>!wo(),TextEncoder:()=>!E(globalThis.TextEncoder)||!E(globalThis.TextDecoder),requestAnimationFrame:()=>!E(globalThis.requestAnimationFrame)||!E(globalThis.cancelAnimationFrame),CustomEvent:()=>!E(globalThis.CustomEvent),"navigator.sendBeacon":()=>!E(globalThis.navigator.sendBeacon),ArrayBuffer:()=>!E(globalThis.Uint8Array),Set:()=>!E(globalThis.Set),atob:()=>!E(globalThis.atob)},Do=()=>{const n=Object.keys(Pt);let e=!1;for(let t=0;t<n.length;t++){const s=Pt[n[t]];if(E(s)&&s()){e=!0;break}}return e},zn=()=>{let n={density:0,width:0,height:0,innerWidth:0,innerHeight:0};return n={width:globalThis.screen.width,height:globalThis.screen.height,density:globalThis.devicePixelRatio,innerWidth:globalThis.innerWidth,innerHeight:globalThis.innerHeight},n},Wn=n=>{const e=["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"],t=[22,1014],s=e.includes(n.name)||t.includes(n.code);return n instanceof DOMException&&s},Re=(n=X,e,t)=>{let s,i;try{switch(n){case ae:return!0;case q:s=e,i=Eo;break;case X:s=e??globalThis.localStorage,i=mo;break;case te:s=e??globalThis.sessionStorage,i=So;break;default:return!1}return s?(s.setItem(i,"true"),s.getItem(i)?(s.removeItem(i),!0):!1):!1}catch(r){const a=Qi(ft,n);let l="unavailable";return Wn(r)&&(l="full"),t==null||t.warn(`${a}${l}.`,r),!1}},Lo=n=>{const e=document.createElement("a");return e.href=n,e.hostname},Uo=n=>{const e=typeof globalThis.URL!="function"?Lo(n):new URL(n).hostname,t=(e==null?void 0:e.split("."))??[],s=t[t.length-1],i=[];if(t.length===4&&s&&s===parseInt(s,10).toString())return i;if(t.length<=1)return t[0]&&t[0].indexOf("localhost")!==-1?["localhost"]:i;for(let r=t.length-2;r>=0;r-=1)i.push(t.slice(r).join("."));return i},Mo=n=>{const e=Uo(n);for(let t=0;t<e.length;t+=1){const s=e[t],i=bo,r={domain:`${s.indexOf("localhost")!==-1?"":"."}${s}`};if(he(i,1,r),he(i))return he(i,null,r),s}return""},$o=()=>{const n=`.${Mo(globalThis.location.href)}`;return{maxage:si,path:"/",domain:!n||n==="."?void 0:n,samesite:"Lax",enabled:!0}},Bo=()=>({enabled:!0}),xo=()=>({enabled:!0}),Go=()=>({enabled:!0}),Pe=class Pe{constructor(e={},t){D(this,"isSupportAvailable",!0);D(this,"isEnabled",!0);D(this,"length",0);if(Pe.globalSingleton)return Pe.globalSingleton;this.options=$o(),this.logger=t,this.configure(e),Pe.globalSingleton=this}configure(e){return this.options=F(this.options??{},e),e.sameDomainCookiesOnly&&delete this.options.domain,this.isSupportAvailable=Re(q,this,this.logger),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){return he(e,t,this.options,this.logger),this.length=Object.keys(he()).length,!0}getItem(e){const t=he(e);return H(t)?null:t}removeItem(e){const t=this.setItem(e,null);return this.length=Object.keys(he()).length,t}clear(){}key(e){return this.keys()[e]??null}keys(){return Object.keys(he())}};D(Pe,"globalSingleton",null);let nt=Pe;class Vo{constructor(e,t){D(this,"isEnabled",!0);D(this,"length",0);D(this,"data",{});this.options=Go(),this.logger=t,this.configure(e??{})}configure(e){return this.options=F(this.options,e),this.isEnabled=!!this.options.enabled,this.options}setItem(e,t){return this.data[e]=t,this.length=Object.keys(this.data).length,t}getItem(e){return e in this.data?this.data[e]:null}removeItem(e){return e in this.data&&delete this.data[e],this.length=Object.keys(this.data).length,null}clear(){this.data={},this.length=0}key(e){return this.keys()[e]??null}keys(){return Object.keys(this.data)}}const kt=new Vo({},re);var Fo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jo(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Yn={exports:{}};(function(n,e){(function(t,s){n.exports=s()})(Fo,function(){function t(p){return p=JSON.stringify(p),!!/^\{[\s\S]*\}$/.test(p)}function s(p){return p===void 0||typeof p=="function"?p+"":JSON.stringify(p)}function i(p){if(typeof p=="string")try{return JSON.parse(p)}catch{return p}}function r(p){return{}.toString.call(p)==="[object Function]"}function a(p){return Object.prototype.toString.call(p)==="[object Array]"}function l(p){var b="_Is_Incognit",A="yes";try{p||(p=window.localStorage),p.setItem(b,A),p.removeItem(b)}catch{var R={};R._data={},R.setItem=function(V,Ve){return R._data[V]=String(Ve)},R.getItem=function(V){return R._data.hasOwnProperty(V)?R._data[V]:void 0},R.removeItem=function(V){return delete R._data[V]},R.clear=function(){return R._data={}},p=R}finally{p.getItem(b)===A&&p.removeItem(b)}return p}var d=l();function m(){if(!(this instanceof m))return new m}m.prototype={set:function(b,A){if(b&&!t(b))d.setItem(b,s(A));else if(t(b))for(var R in b)this.set(R,b[R]);return this},get:function(b){if(b===void 0){var A={};return this.forEach(function(xt,lt){return A[xt]=lt}),A}if(b.charAt(0)==="?")return this.has(b.substr(1));var R=arguments;if(R.length>1){for(var G={},V=0,Ve=R.length;V<Ve;V++){var Bt=i(d.getItem(R[V]));this.has(R[V])&&(G[R[V]]=Bt)}return G}return i(d.getItem(b))},clear:function(){return d.clear(),this},remove:function(b){var A=this.get(b);return d.removeItem(b),A},has:function(b){return{}.hasOwnProperty.call(this.get(),b)},keys:function(){var b=[];return this.forEach(function(A){b.push(A)}),b},forEach:function(b){for(var A=0,R=d.length;A<R;A++){var G=d.key(A);b(G,this.get(G))}return this},search:function(b){for(var A=this.keys(),R={},G=0,V=A.length;G<V;G++)A[G].indexOf(b)>-1&&(R[A[G]]=this.get(A[G]));return R},len:function(){return d.length}};var S=null;function B(p,b){var A=arguments,R=null;if(S||(S=m()),A.length===0)return S.get();if(A.length===1){if(typeof p=="string")return S.get(p);if(t(p))return S.set(p)}if(A.length===2&&typeof p=="string"){if(!b)return S.remove(p);if(b&&typeof b=="string")return S.set(p,b);b&&r(b)&&(R=null,R=b(p,S.get(p)),B.set(p,R))}if(A.length===2&&a(p)&&r(b))for(var G=0,V=p.length;G<V;G++)R=b(p[G],S.get(p[G])),B.set(p[G],R);return B}for(var U in m.prototype)B[U]=m.prototype[U];return B})})(Yn);var Ho=Yn.exports;const Ee=jo(Ho);class Ko{constructor(e={},t){D(this,"isSupportAvailable",!0);D(this,"isEnabled",!0);D(this,"length",0);this.options=Bo(),this.logger=t,this.configure(e)}configure(e){return this.options=F(this.options,e),this.isSupportAvailable=Re(X,this,this.logger),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){Ee.set(e,t),this.length=Ee.len()}getItem(e){const t=Ee.get(e);return H(t)?null:t}removeItem(e){Ee.remove(e),this.length=Ee.len()}clear(){Ee.clear(),this.length=0}key(e){return this.keys()[e]??null}keys(){return Ee.keys()}}const qn=new Ko({},re);class Qo{constructor(e={},t){D(this,"isSupportAvailable",!0);D(this,"isEnabled",!0);D(this,"length",0);D(this,"store",globalThis.sessionStorage);this.options=xo(),this.logger=t,this.configure(e)}configure(e){return this.options=F(this.options,e),this.isSupportAvailable=Re(te,this,this.logger),this.isEnabled=!!(this.options.enabled&&this.isSupportAvailable),this.options}setItem(e,t){this.store.setItem(e,t),this.length=this.store.length}getItem(e){const t=this.store.getItem(e);return H(t)?null:t}removeItem(e){this.store.removeItem(e),this.length=this.store.length}clear(){this.store.clear(),this.length=0}key(e){return this.store.key(e)}keys(){const e=[];for(let t=0;t<this.store.length;t+=1){const s=this.store.key(t);s!==null&&e.push(s)}return e}}const Xn=new Qo({},re),ne=n=>{switch(n){case X:return qn;case te:return Xn;case ae:return kt;case q:return new nt({},re);default:return kt}},zo=n=>{const e=new nt({},re).configure(n);o.storage.cookie.value={maxage:e.maxage,path:e.path,domain:e.domain,samesite:e.samesite,expires:e.expires,secure:e.secure}},Wo=n=>{qn.configure(n)},Yo=n=>{kt.configure(n)},qo=n=>{Xn.configure(n)},Xo=(n={},e={},t={},s={})=>{zo(n),Wo(e),Yo(t),qo(s)};class Jo{constructor(e,t,s){D(this,"hasErrorHandler",!1);this.id=e.id,this.name=e.name,this.isEncrypted=e.isEncrypted??!1,this.validKeys=e.validKeys??{},this.engine=t??ne(X),this.noKeyValidation=Object.keys(this.validKeys).length===0,this.noCompoundKey=e.noCompoundKey,this.originalEngine=this.engine,this.errorHandler=e.errorHandler??tt,this.hasErrorHandler=!!this.errorHandler,this.logger=e.logger??re,this.pluginsManager=s}createValidKey(e){const{name:t,id:s,validKeys:i,noKeyValidation:r,noCompoundKey:a}=this;if(r)return a?e:[t,s,e].join(".");let l;return Object.values(i).forEach(d=>{d===e&&(l=a?e:[t,s,e].join("."))}),l}swapQueueStoreToInMemoryEngine(){const{name:e,id:t,validKeys:s,noCompoundKey:i}=this,r=ne(ae);Object.keys(s).forEach(a=>{const l=this.get(s[a]),d=i?a:[e,t,a].join(".");r.setItem(d,l),this.remove(a)}),this.engine=r}set(e,t){var i;const s=this.createValidKey(e);if(s)try{this.engine.setItem(s,this.encrypt(de(t,!1,[],this.logger)))}catch(r){Wn(r)?((i=this.logger)==null||i.warn(vr(`Store ${this.id}`)),this.swapQueueStoreToInMemoryEngine(),this.set(e,t)):this.onError(Le(r,er(e)))}}get(e){const t=this.createValidKey(e);try{if(!t)return null;const s=this.decrypt(this.engine.getItem(t));return se(s)?null:JSON.parse(s)}catch(s){return this.onError(new Error(`${tr(e)}: ${s.message}`)),null}}remove(e){const t=this.createValidKey(e);t&&this.engine.removeItem(t)}getOriginalEngine(){return this.originalEngine}decrypt(e){return se(e)?null:this.crypto(e,"decrypt")}encrypt(e){return this.crypto(e,"encrypt")}crypto(e,t){if(!this.isEncrypted||!e||typeof e!="string"||Fs(e)==="")return e;const i=`storage.${t}`,r=this.pluginsManager?this.pluginsManager.invokeSingle(i,e):e;return typeof r>"u"?e:r??""}onError(e){var t;if(this.hasErrorHandler)(t=this.errorHandler)==null||t.onError(e,`Store ${this.id}`);else throw e}}const Zo=(n,e)=>{var s;let t;if(n.consents.preConsent.value.enabled)switch((s=n.consents.preConsent.value.storage)==null?void 0:s.strategy){case"none":t=ye;break;case"session":e!=="sessionInfo"&&(t=ye);break;case"anonymousId":e!=="anonymousId"&&(t=ye);break}return t};class ea{constructor(e,t,s){D(this,"stores",{});D(this,"isInitialized",!1);D(this,"hasErrorHandler",!1);this.errorHandler=t,this.logger=s,this.hasErrorHandler=!!this.errorHandler,this.pluginsManager=e,this.onError=this.onError.bind(this)}init(){var s;if(this.isInitialized)return;const e=o.loadOptions.value,t={cookieStorageOptions:{samesite:e.sameSiteCookie,secure:e.secureCookie,domain:e.setCookieDomain,sameDomainCookiesOnly:e.sameDomainCookiesOnly,enabled:!0},localStorageOptions:{enabled:!0},inMemoryStorageOptions:{enabled:!0},sessionStorageOptions:{enabled:!0}};Xo(Ce(F(t.cookieStorageOptions??{},((s=o.storage.cookie)==null?void 0:s.value)??{})),Ce(t.localStorageOptions),Ce(t.inMemoryStorageOptions),Ce(t.sessionStorageOptions)),this.initClientDataStores(),this.isInitialized=!0}initClientDataStores(){this.initializeStorageState(),[ae,X,q,te].forEach(t=>{var s;(s=ne(t))!=null&&s.isEnabled&&this.setStore({id:_e[t],name:_e[t],isEncrypted:!0,noCompoundKey:!0,type:t})})}initializeStorageState(){var a;let e=o.storage.type.value,t=(a=o.loadOptions.value.storage)==null?void 0:a.entries;const s=o.consents.postConsent.value.storage;(x(s==null?void 0:s.type)||x(s==null?void 0:s.entries))&&(e=s==null?void 0:s.type,t=s==null?void 0:s.entries);let i=!0,r={};jn.forEach(l=>{var b;const d=l,m=l,S=(b=t==null?void 0:t[d])==null?void 0:b.type,U=Zo(o,l)??S??e??mt,p=this.getResolvedStorageTypeForEntry(U,l);p!==ye&&(i=!1),r={...r,[l]:{type:p,key:Te[m]}}}),K(()=>{o.storage.type.value=e,o.storage.entries.value=r,o.storage.trulyAnonymousTracking.value=i})}getResolvedStorageTypeForEntry(e,t){var i,r,a,l,d,m;let s=e;switch(e){case X:(i=ne(X))!=null&&i.isEnabled||(s=ae);break;case te:(r=ne(te))!=null&&r.isEnabled||(s=ae);break;case ae:case ye:break;case q:default:(a=ne(q))!=null&&a.isEnabled?s=q:(l=ne(X))!=null&&l.isEnabled?s=X:(d=ne(te))!=null&&d.isEnabled?s=te:s=ae;break}return s!==e&&((m=this.logger)==null||m.warn(yr(nn,t,e,s))),s}setStore(e){const t=ne(e.type);return this.stores[e.id]=new Jo(e,t,this.pluginsManager),this.stores[e.id]}getStore(e){return this.stores[e]}onError(e){var t;if(this.hasErrorHandler)(t=this.errorHandler)==null||t.onError(e,nn);else throw e}}const ta=n=>n.replace(/\/{2,}/g,"/"),Ae=n=>{if(!j(n))return!1;try{return E(globalThis.URL)&&new URL(n),wr.test(n)}catch{return!1}},na=n=>{if(!j(n)||n.trim().length===0)throw new Error(Wi(n))},sa=n=>{if(!Ae(n))throw new Error(Yi(n))},ia=(n,e)=>{na(n),sa(e)},ra=n=>O(n)&&O(n.source)&&!se(n.source.id)&&O(n.source.config)&&Array.isArray(n.source.destinations),oa=n=>typeof n=="string"&&Tn.includes(n),Jn=n=>{const e=new URL(n),{host:t,protocol:s}=e,i=t.split(".");let r;return i.length>2?r=`${i[i.length-2]}.${i[i.length-1]}`:r=t,{topDomain:r,protocol:s}},aa=n=>{const{topDomain:e,protocol:t}=Jn(n);return`${t}//${e}`},la=(n,e)=>{const t=e?window.location.origin:aa(window.location.href),s=n.startsWith("/")?n.substring(1):n;return`${t}/${s}`},ca=n=>{const{topDomain:e}=Jn(window.location.href);return e===n},ua=n=>{const e=[];return n.forEach(t=>{t.enabled&&!t.deleted&&e.push({id:t.id,displayName:t.destinationDefinition.displayName,config:t.config,shouldApplyDeviceModeTransformation:t.shouldApplyDeviceModeTransformation||!1,propagateEventsUntransformedOnError:t.propagateEventsUntransformedOnError||!1,userFriendlyId:`${t.destinationDefinition.displayName.replaceAll(" ","-")}___${t.id}`})}),e},Oe=n=>n!=null&&n.endsWith("/")?Oe(n.substring(0,n.length-1)):n,Ct=n=>{try{return new URL(n).host}catch{return null}},Zn=n=>Ct(n)??"",da=n=>{const e={};try{const t=new URL(n),s="utm_";t.searchParams.forEach((i,r)=>{if(r.startsWith(s)){let a=r.substring(s.length);a==="campaign"&&(a="name"),e[a]=i}})}catch{}return e},ga=n=>{let e=n;try{const t=new URL(n);e=t.origin+t.pathname+t.search}catch{}return e},ha=()=>!!(window.chrome&&window.chrome.runtime&&window.chrome.runtime.id),Nt="none",wt="immediate",fa=n=>{var e,t;return((t=(e=n==null?void 0:n.statsCollection)==null?void 0:e.errors)==null?void 0:t.enabled)===!0},pa=n=>{var e,t;return(t=(e=n==null?void 0:n.statsCollection)==null?void 0:e.errors)==null?void 0:t.provider},va=n=>{var e,t;return((t=(e=n==null?void 0:n.statsCollection)==null?void 0:e.metrics)==null?void 0:t.enabled)===!0},st={All:!0},ya=n=>{const e={sendPageEvent:!1,trackConsent:!1,discardPreConsentEvents:!1};if(O(n)){const t=N(n);e.storage=t.storage,x(t.integrations)&&(e.integrations=O(t.integrations)?t.integrations:st),e.discardPreConsentEvents=t.discardPreConsentEvents===!0,e.sendPageEvent=t.sendPageEvent===!0,e.trackConsent=t.trackConsent===!0,He(t.consentManagement)&&(e.consentManagement=F(t.consentManagement,{enabled:o.consents.enabled.value}))}return e},es=n=>He(n)||Array.isArray(n),Ea=(n,e)=>{let{provider:t}=n;const s=t?It[t]:void 0;return t&&!s&&(e==null||e.error($i(ie,t,It)),t=void 0),{provider:t,consentManagerPluginName:s}},ts=(n,e)=>{let t,s=[],i=[],r=!1,a,l=(n==null?void 0:n.enabled)===!0;He(n)&&l&&({provider:a,consentManagerPluginName:t}=Ea(n,e),es(n.allowedConsentIds)&&(s=n.allowedConsentIds,r=!0),es(n.deniedConsentIds)&&(i=n.deniedConsentIds,r=!0));const d={allowedConsentIds:s,deniedConsentIds:i};return l=l&&!!t,{provider:a,consentManagerPluginName:t,initialized:r,enabled:l,consentsData:d}},ma=()=>{const n=document.getElementsByTagName("script"),e=/(?:^|\/)rsa(\.min)?\.js$/;for(const t of n){const s=t.getAttribute("src");if(s&&e.test(s))return s}},Sa=(n,e)=>{if(o.reporting.isErrorReportingEnabled.value=fa(n.source.config)&&!ha(),o.reporting.isMetricsReportingEnabled.value=va(n.source.config),o.reporting.isErrorReportingEnabled.value){const t=pa(n.source.config),s=t?Je[t]:void 0;!H(t)&&!s&&(e==null||e.warn(or(ie,t,Je,bt))),o.reporting.errorReportingProviderPluginName.value=s??Je[bt]}},ba=n=>{var B;const{useServerSideCookies:e,dataServiceEndpoint:t,storage:s,setCookieDomain:i,sameDomainCookiesOnly:r}=o.loadOptions.value;let a=s==null?void 0:s.type;x(a)&&!oa(a)&&(n==null||n.warn(rr(ie,a,mt)),a=mt);let l=(B=s==null?void 0:s.encryption)==null?void 0:B.version;const d=l&&Ze[l];!H(l)&&H(d)?(n==null||n.warn(ar(ie,l,Ze,ve)),l=ve):H(l)&&(l=ve);const m=s==null?void 0:s.migrate,S=m&&l===ve;m===!0&&S!==m&&(n==null||n.warn(lr(ie,l,ve))),K(()=>{o.storage.type.value=a;let U=(s==null?void 0:s.cookie)??{};if(e){o.serverCookies.isEnabledServerSideCookies.value=e;const p=U.domain??i,b=x(p)&&!ca(qt(p))||r,A=la(t??Ur,b??!1);if(Ae(A)){o.serverCookies.dataServiceUrl.value=Oe(A);const R=Ct(window.location.href),G=Ct(A);R!==G&&(U={...U,samesite:"None",secure:!0}),!r&&b&&G!==qt(p)&&(o.serverCookies.isEnabledServerSideCookies.value=!1,n==null||n.warn(cr(ie,p,G)))}else o.serverCookies.isEnabledServerSideCookies.value=!1}o.storage.cookie.value=U,o.storage.encryptionPluginName.value=Ze[l],o.storage.migrate.value=S})},Ia=n=>{var B,U,p,b;const{provider:e,consentManagerPluginName:t,initialized:s,enabled:i,consentsData:r}=ts(o.loadOptions.value.consentManagement,n),a=o.loadOptions.value.preConsent;let l=((B=a==null?void 0:a.storage)==null?void 0:B.strategy)??Nt;const d=["none","session","anonymousId"];x(l)&&!d.includes(l)&&(l=Nt,n==null||n.warn(Pr(ie,(U=a==null?void 0:a.storage)==null?void 0:U.strategy,Nt)));let m=((p=a==null?void 0:a.events)==null?void 0:p.delivery)??wt;const S=["immediate","buffer"];x(m)&&!S.includes(m)&&(m=wt,n==null||n.warn(kr(ie,(b=a==null?void 0:a.events)==null?void 0:b.delivery,wt))),K(()=>{var A;o.consents.activeConsentManagerPluginName.value=t,o.consents.initialized.value=s,o.consents.enabled.value=i,o.consents.data.value=r,o.consents.provider.value=e,o.consents.preConsent.value={enabled:((A=o.loadOptions.value.preConsent)==null?void 0:A.enabled)===!0&&s===!1&&i===!0,storage:{strategy:l},events:{delivery:m}}})},Ta=n=>{var s;let e=o.consents.resolutionStrategy.value,t;O(n.consentManagementMetadata)&&(o.consents.provider.value&&(e=((s=n.consentManagementMetadata.providers.find(i=>i.provider===o.consents.provider.value))==null?void 0:s.resolutionStrategy)??o.consents.resolutionStrategy.value),t=n.consentManagementMetadata),o.consents.provider.value==="custom"&&(e=void 0),K(()=>{o.consents.metadata.value=N(t),o.consents.resolutionStrategy.value=e})},_a=n=>{if(o.dataPlaneEvents.deliveryEnabled.value){const e="XhrQueue";let t=e;o.loadOptions.value.useBeacon&&(o.capabilities.isBeaconAvailable.value?t="BeaconQueue":(t=e,n==null||n.warn(dr(ie)))),K(()=>{o.dataPlaneEvents.eventsQueuePluginName.value=t})}},Ra=(n,e,t,s,i)=>{const r=new URLSearchParams({p:on,v:we,build:Be,writeKey:e,lockIntegrationsVersion:t.toString(),lockPluginsVersion:s.toString()});let a=Nn,l=r,d="/sourceConfig/",m="";if(Ae(n)){const S=new URL(n);Oe(S.pathname).endsWith("/sourceConfig")||(S.pathname=`${Oe(S.pathname)}/sourceConfig/`),S.pathname=ta(S.pathname),r.forEach((B,U)=>{S.searchParams.get(U)===null&&S.searchParams.set(U,B)}),a=S.origin,d=S.pathname,l=S.searchParams,m=S.hash}else i==null||i.warn(Ar(ie,n));return`${a}${d}?${l}${m}`},ns=(n,e,t,s,i,r)=>{let a="";if(r){if(!Ae(r))throw new Error(Mi(n));return Oe(r)}const l=ma();return a=l?l.split("/").slice(0,-1).concat(e).join("/"):t,i&&(a=a.replace(`/${St}/${Be}/${e}`,`/${s}/${Be}/${e}`)),a},Aa=(n,e,t)=>ns("integrations",An,kn,n,e,t),Oa=(n,e,t)=>ns("plugins",On,Cn,n,e,t);class Pa{constructor(e,t,s){D(this,"hasErrorHandler",!1);this.errorHandler=t,this.logger=s,this.httpClient=e,this.hasErrorHandler=!!this.errorHandler,this.onError=this.onError.bind(this),this.processConfig=this.processConfig.bind(this)}attachEffects(){ce(()=>{var e;(e=this.logger)==null||e.setMinLogLevel(o.lifecycle.logLevel.value)})}init(){this.attachEffects(),ia(o.lifecycle.writeKey.value,o.lifecycle.dataPlaneUrl.value);const{logLevel:e,configUrl:t,lockIntegrationsVersion:s,lockPluginsVersion:i,destSDKBaseURL:r,pluginsSDKBaseURL:a}=o.loadOptions.value;o.lifecycle.activeDataplaneUrl.value=Oe(o.lifecycle.dataPlaneUrl.value);const l=Aa(we,s,r),d=Oa(we,i,a);ba(this.logger),Ia(this.logger),_a(this.logger),K(()=>{o.lifecycle.integrationsCDNPath.value=l,o.lifecycle.pluginsCDNPath.value=d,e&&(o.lifecycle.logLevel.value=e),o.lifecycle.sourceConfigUrl.value=Ra(t,o.lifecycle.writeKey.value,s,i,this.logger)}),this.getConfig()}onError(e,t,s){var i;if(this.hasErrorHandler)(i=this.errorHandler)==null||i.onError(e,ie,t,s);else throw e}processConfig(e,t){var r;if(!e){this.onError(zi(t==null?void 0:t.error));return}let s;try{j(e)?s=JSON.parse(e):s=e}catch(a){this.onError(a,_n,!0);return}if(!ra(s)){this.onError(new Error(_n),void 0,!0);return}if(s.source.enabled===!1){(r=this.logger)==null||r.error(Ni);return}Sa(s,this.logger);const i=s.source.destinations.length>0?ua(s.source.destinations):[];K(()=>{o.source.value={config:s.source.config,id:s.source.id,workspaceId:s.source.workspaceId},o.nativeDestinations.configuredDestinations.value=i,o.plugins.pluginsToLoadFromConfig.value=o.loadOptions.value.plugins??[],Ta(s),o.lifecycle.status.value="configured"})}getConfig(){const e=o.loadOptions.value.getSourceConfig;if(e){if(!E(e))throw new Error(Ci);const t=e();t instanceof Promise?t.then(s=>this.processConfig(s)).catch(s=>{this.onError(s,"SourceConfig")}):this.processConfig(t)}else this.httpClient.getAsyncData({url:o.lifecycle.sourceConfigUrl.value,options:{headers:{"Content-Type":void 0}},callback:this.processConfig})}}const ka=()=>{const n=new Date().toString().match(/([A-Z]+[+-]\d+)/);return n&&n[1]?n[1]:"NA"},ss=()=>(document==null?void 0:document.referrer)||"$direct",Ca=()=>{const n=document.getElementsByTagName("link");let e="";for(let t=0;n[t];t+=1){const s=n[t];if(s.getAttribute("rel")==="canonical"&&!e){e=s.getAttribute("href")??"";break}}return e},Na=()=>{if(H(globalThis.navigator))return null;let{userAgent:n}=globalThis.navigator;const{brave:e}=globalThis.navigator;if(e&&Object.getPrototypeOf(e).isBrave){const t=n.match(/(chrome)\/([\w.]+)/i);t&&(n=`${n} Brave/${t[2]}`)}return n},wa=()=>H(globalThis.navigator)?null:globalThis.navigator.language??globalThis.navigator.browserLanguage,is=()=>{const n=Ca();let e=globalThis.location.pathname;const{href:t}=globalThis.location;let s=t;const{search:i}=globalThis.location;if(n)try{const d=new URL(n);d.search===""?s=n+i:s=n,e=d.pathname}catch{}const r=ga(s),{title:a}=document,l=ss();return{path:e,referrer:l,referring_domain:Zn(l),search:i,title:a,url:r,tab_url:t}},Da=`https://polyfill-fastly.io/v3/polyfill.min.js?version=3.111.0&features=${Object.keys(Pt).join("%2C")}`,La=10*1e3,rs="voyagePolyfill";class Ua{constructor(e,t){this.logger=t,this.errorHandler=e,this.externalSrcLoader=new pn(this.errorHandler,this.logger),this.onError=this.onError.bind(this),this.onReady=this.onReady.bind(this)}init(){try{this.prepareBrowserCapabilities(),this.attachWindowListeners()}catch(e){this.onError(e)}}detectBrowserCapabilities(){K(()=>{o.capabilities.storage.isCookieStorageAvailable.value=Re(q,ne(q),this.logger),o.capabilities.storage.isLocalStorageAvailable.value=Re(X,void 0,this.logger),o.capabilities.storage.isSessionStorageAvailable.value=Re(te,void 0,this.logger),o.capabilities.isBeaconAvailable.value=ko(),o.capabilities.isUaCHAvailable.value=Qn(),o.capabilities.isCryptoAvailable.value=Po(),o.capabilities.isIE11.value=Co(),o.capabilities.isOnline.value=globalThis.navigator.onLine,o.context.userAgent.value=Na(),o.context.locale.value=wa(),o.context.screen.value=zn(),o.context.timezone.value=ka(),Qn()&&No(e=>{o.context["ua-ch"].value=e},o.loadOptions.value.uaChTrackLevel)}),ce(()=>{o.loadOptions.value.sendAdblockPage===!0&&o.lifecycle.sourceConfigUrl.value!==void 0&&Oo(this.errorHandler,this.logger)})}prepareBrowserCapabilities(){var i;o.capabilities.isLegacyDOM.value=Do();const e=o.loadOptions.value.polyfillURL;let t=Da;if(be(e)&&(Ae(e)?t=e:(i=this.logger)==null||i.warn(Nr(ft,e))),o.loadOptions.value.polyfillIfRequired&&o.capabilities.isLegacyDOM.value&&Ae(t)){const r=t!==o.loadOptions.value.polyfillURL;if(r){const a=`RS_polyfillCallback_${o.lifecycle.writeKey.value}`,l=()=>{this.onReady(),delete globalThis[a]};globalThis[a]=l,t=`${t}&callback=${a}`}this.externalSrcLoader.loadJSFile({url:t,id:rs,async:!0,timeout:La,callback:a=>{a?r||this.onReady():this.onError(new Error(Or(rs,t)))}})}else this.onReady()}attachWindowListeners(){globalThis.addEventListener("offline",()=>{o.capabilities.isOnline.value=!1}),globalThis.addEventListener("online",()=>{o.capabilities.isOnline.value=!0}),globalThis.addEventListener("resize",ai(()=>{o.context.screen.value=zn()},this))}onReady(){this.detectBrowserCapabilities(),o.lifecycle.status.value="browserCapabilitiesReady"}onError(e){if(this.errorHandler)this.errorHandler.onError(e,ft);else throw e}}function Ma(n){return crypto.getRandomValues(new Uint8Array(n))}for(var os=4096,it=[],fe=0,Dt;fe<256;fe++)it[fe]=(fe+256).toString(16).substring(1);function $a(){(!Dt||fe+16>os)&&(Dt=Ma(os),fe=0);for(var n=0,e,t="";n<16;n++)e=Dt[fe+n],n==6?t+=it[e&15|64]:n==8?t+=it[e&63|128]:t+=it[e],n&1&&n>1&&n<11&&(t+="-");return fe+=16,t}for(var me=256,rt=[],ot;me--;)rt[me]=(me+256).toString(16).substring(1);function Ba(){var n=0,e,t="";if(!ot||me+16>256){for(ot=Array(n=256);n--;)ot[n]=256*Math.random()|0;n=me=0}for(;n<16;n++)e=ot[me+n],n==6?t+=rt[e&15|64]:n==8?t+=rt[e&63|128]:t+=rt[e],n&1&&n>1&&n<11&&(t+="-");return me++,t}const xa=()=>!se(globalThis.crypto)&&E(globalThis.crypto.getRandomValues),as=()=>xa()?$a():Ba(),Ga=()=>new Date().toISOString(),Va="web",Fa=["integrations","anonymousId","originalTimestamp"],ls=["library","consentManagement","userAgent","ua-ch","screen"],Lt=["id","anonymous_id","user_id","sent_at","timestamp","received_at","original_timestamp","event","event_text","channel","context_ip","context_request_ip","context_passed_ip","group_id","previous_id"],cs=n=>typeof n=="number"&&!Number.isNaN(n),ja=(n,e)=>e.toString().length>=n,us=n=>cs(n)&&n>=0&&Number.isInteger(n),ds=10,gs=n=>{const e=Date.now();return!n||e>n},Ha=()=>Date.now(),Ka=(n,e)=>!n||!us(n)||!ja(ds,n)?(e==null||e.warn(pr(Ne,n,ds)),!1):!0,Qa=n=>{const e=Date.now(),t=n||De;return{id:e,expiresAt:e+t,timeout:t,sessionStart:void 0,autoTrack:!0}},za=(n,e)=>({id:Ka(n,e)?n:Ha(),sessionStart:void 0,manualTrack:!0}),xe=n=>n===q||n===X||n===te||n===ae,Ut=()=>as(),Wa=n=>{const e=is(),t={};return Object.keys(e).forEach(s=>{t[s]=(n==null?void 0:n[s])||e[s]}),t.initial_referrer=(n==null?void 0:n.initial_referrer)||o.session.initialReferrer.value,t.initial_referring_domain=(n==null?void 0:n.initial_referring_domain)||o.session.initialReferringDomain.value,t},Ya=(n,e)=>{const t=(e==null?void 0:e.page)||{},s=n,i=is();return Object.keys(i).forEach(r=>{H(s[r])&&(s[r]=t[r]||i[r])}),H(s.initial_referrer)&&(s.initial_referrer=t.initial_referrer||o.session.initialReferrer.value),H(s.initial_referring_domain)&&(s.initial_referring_domain=t.initial_referring_domain||o.session.initialReferringDomain.value),s},Mt=(n,e,t)=>{O(n)&&Object.keys(n).forEach(s=>{(Lt.includes(s)||Lt.includes(s.toLowerCase()))&&(t==null||t.warn(ur(en,s,e,Lt)))})},qa=(n,e)=>{const{properties:t,traits:s,context:i}=n,{traits:r}=i;Mt(t,"properties",e),Mt(s,"traits",e),Mt(r,"context.traits",e)},Xa=(n,e)=>{e.anonymousId&&j(e.anonymousId)&&(n.anonymousId=e.anonymousId),O(e.integrations)&&(n.integrations=e.integrations),e.originalTimestamp&&j(e.originalTimestamp)&&(n.originalTimestamp=e.originalTimestamp)},Ja=(n,e,t)=>{let s=n;return Object.keys(e).forEach(i=>{if(!Fa.includes(i)&&!ls.includes(i)){if(i!=="context")s=F(s,{[i]:e[i]});else if(!H(e[i])&&O(e[i])){const r={};Object.keys(e[i]).forEach(a=>{ls.includes(a)||(r[a]=e[i][a])}),s=F(s,{...r})}}}),s},Za=()=>{var n;return o.loadOptions.value.useGlobalIntegrationsConfigInEvents&&(O((n=o.consents.postConsent.value)==null?void 0:n.integrations)||O(o.nativeDestinations.loadOnlyIntegrations.value))},el=(n,e)=>{O(e)&&(Xa(n,e),n.context=Ja(n.context,e))},tl=n=>{var t;let e;return Za()?e=N(((t=o.consents.postConsent.value)==null?void 0:t.integrations)??o.nativeDestinations.loadOnlyIntegrations.value):O(n)?e=n:e=st,e},Ge=(n,e,t,s)=>{var a,l,d;const i={channel:Va,context:{traits:N(o.session.userTraits.value),sessionId:o.session.sessionInfo.value.id||void 0,sessionStart:o.session.sessionInfo.value.sessionStart||void 0,...o.consents.enabled.value&&{consentManagement:{deniedConsentIds:N(o.consents.data.value.deniedConsentIds),allowedConsentIds:N(o.consents.data.value.allowedConsentIds),provider:o.consents.provider.value,resolutionStrategy:o.consents.resolutionStrategy.value}},"ua-ch":o.context["ua-ch"].value,app:o.context.app.value,library:o.context.library.value,userAgent:o.context.userAgent.value,os:o.context.os.value,locale:o.context.locale.value,screen:o.context.screen.value,campaign:da(globalThis.location.href),page:Wa(t),timezone:o.context.timezone.value},originalTimestamp:Ga(),integrations:st,messageId:as(),userId:n.userId||o.session.userId.value};xe((a=o.storage.entries.value.anonymousId)==null?void 0:a.type)?i.anonymousId=o.session.anonymousId.value:i.anonymousId=Ut(),o.storage.trulyAnonymousTracking.value&&(i.context.trulyAnonymousTracking=!0),n.type==="identify"&&(i.context.traits=((l=o.storage.entries.value.userTraits)==null?void 0:l.type)!==ye?N(o.session.userTraits.value):n.context.traits),n.type==="group"&&((n.groupId||o.session.groupId.value)&&(i.groupId=n.groupId||o.session.groupId.value),(n.traits||o.session.groupTraits.value)&&(i.traits=((d=o.storage.entries.value.groupTraits)==null?void 0:d.type)!==ye?N(o.session.groupTraits.value):n.traits));const r=F(n,i);return r.event===void 0&&(r.event=null),r.properties===void 0&&(r.properties=null),el(r,e),qa(r,s),r.integrations=tl(r.integrations),r};class nl{constructor(e){this.logger=e}generatePageEvent(e,t,s,i){let r=s??{};return r.name=t,r.category=e,r=Ya(r,i),Ge({properties:r,name:t,category:e,type:"page"},i,r,this.logger)}generateTrackEvent(e,t,s){return Ge({properties:t,event:e,type:"track"},s,void 0,this.logger)}generateIdentifyEvent(e,t,s){return Ge({userId:e,type:"identify",context:{traits:t}},s,void 0,this.logger)}generateAliasEvent(e,t,s){const r=Ge({previousId:t,type:"alias"},s,void 0,this.logger);return r.userId=e??r.userId,r}generateGroupEvent(e,t,s){const i={type:"group"};return e&&(i.groupId=e),t&&(i.traits=t),Ge(i,s,void 0,this.logger)}create(e){let t;switch(e.type){case"page":t=this.generatePageEvent(e.category,e.name,e.properties,e.options);break;case"track":t=this.generateTrackEvent(e.name,e.properties,e.options);break;case"identify":t=this.generateIdentifyEvent(e.userId,e.traits,e.options);break;case"alias":t=this.generateAliasEvent(e.to,e.from,e.options);break;case"group":t=this.generateGroupEvent(e.groupId,e.traits,e.options);break}return t}}class sl{constructor(e,t,s,i){this.eventRepository=e,this.userSessionManager=t,this.errorHandler=s,this.logger=i,this.eventFactory=new nl(this.logger),this.onError=this.onError.bind(this)}init(){this.eventRepository.init()}resume(){this.eventRepository.resume()}addEvent(e){this.userSessionManager.refreshSession();const t=this.eventFactory.create(e);t?this.eventRepository.enqueue(t,e.callback):this.onError(new Error(Di))}onError(e,t,s){if(this.errorHandler)this.errorHandler.onError(e,en,t,s);else throw e}}class il{constructor(e,t,s,i,r){this.storeManager=i,this.pluginsManager=s,this.logger=t,this.errorHandler=e,this.httpClient=r,this.onError=this.onError.bind(this),this.serverSideCookieDebounceFuncs={}}init(){this.syncStorageDataToState(),this.registerEffects()}syncStorageDataToState(){this.migrateStorageIfNeeded(),this.migrateDataFromPreviousStorage(),this.setUserId(this.getUserId()),this.setUserTraits(this.getUserTraits()),this.setGroupId(this.getGroupId()),this.setGroupTraits(this.getGroupTraits());const{externalAnonymousIdCookieName:e,anonymousIdOptions:t}=o.loadOptions.value;let s;be(e)&&typeof e=="string"&&(s=this.getExternalAnonymousIdByCookieName(e)),this.setAnonymousId(s??this.getAnonymousId(t)),this.setAuthToken(this.getAuthToken()),this.setInitialReferrerInfo(),this.configureSessionTracking()}configureSessionTracking(){let e=this.getSessionInfo();if(this.isPersistenceEnabledForStorageEntry("sessionInfo")){const t=this.getConfiguredSessionTrackingInfo(),s=e??Br;e={...s,...t,autoTrack:t.autoTrack&&s.manualTrack!==!0}}o.session.sessionInfo.value=this.isPersistenceEnabledForStorageEntry("sessionInfo")?e:L.sessionInfo,o.session.sessionInfo.value.autoTrack&&this.startOrRenewAutoTracking(o.session.sessionInfo.value)}setInitialReferrerInfo(){const e=this.getInitialReferrer(),t=this.getInitialReferringDomain();if(e&&t)this.setInitialReferrer(e),this.setInitialReferringDomain(t);else{const s=e||ss();this.setInitialReferrer(s),this.setInitialReferringDomain(Zn(s))}}isPersistenceEnabledForStorageEntry(e){var t;return xe((t=o.storage.entries.value[e])==null?void 0:t.type)}migrateDataFromPreviousStorage(){const e=o.storage.entries.value,t=[q,X,te];Object.keys(e).forEach(s=>{var l,d;const i=s,r=(l=e[i])==null?void 0:l.type,a=(d=this.storeManager)==null?void 0:d.getStore(_e[r]);a&&t.forEach(m=>{var B;const S=(B=this.storeManager)==null?void 0:B.getStore(_e[m]);if(S&&m!==r){const U=S.get(Te[i]);xs(U)&&a.set(Te[i],U),S.remove(Te[i])}})})}migrateStorageIfNeeded(){if(!o.storage.migrate.value)return;const e=[Gn,Vn,Fn],t=[];e.forEach(s=>{var r;const i=(r=this.storeManager)==null?void 0:r.getStore(s);i&&t.push(i)}),Object.keys(Te).forEach(s=>{const i=Te[s];t.forEach(r=>{var l;const a=(l=this.pluginsManager)==null?void 0:l.invokeSingle("storage.migrate",i,r.engine,this.errorHandler,this.logger);se(a)||r.set(i,a)})})}getConfiguredSessionTrackingInfo(){var i,r,a,l,d;let e=((i=o.loadOptions.value.sessions)==null?void 0:i.autoTrack)!==!1;if(!e)return{autoTrack:e};let t;const s=(r=o.loadOptions.value.sessions)==null?void 0:r.timeout;return us(s)?t=s:((a=this.logger)==null||a.warn(gr(Ne,s,De)),t=De),t===0&&((l=this.logger)==null||l.warn(hr(Ne)),e=!1),t>0&&t<dn&&((d=this.logger)==null||d.warn(fr(Ne,t,dn))),{timeout:t,autoTrack:e}}onError(e,t){if(this.errorHandler)this.errorHandler.onError(e,Ne,t);else throw e}getEncryptedCookieData(e,t){const s=[];return e.forEach(i=>{const r=t==null?void 0:t.encrypt(de(i.value,!1,[],this.logger));be(r)&&s.push({name:i.name,value:r})}),s}makeRequestToSetCookie(e,t){var s,i,r,a,l,d,m,S;(S=this.httpClient)==null||S.getAsyncData({url:o.serverCookies.dataServiceUrl.value,options:{method:"POST",data:de({reqType:"setCookies",workspaceId:(s=o.source.value)==null?void 0:s.workspaceId,data:{options:{maxAge:(i=o.storage.cookie.value)==null?void 0:i.maxage,path:(r=o.storage.cookie.value)==null?void 0:r.path,domain:(a=o.storage.cookie.value)==null?void 0:a.domain,sameSite:(l=o.storage.cookie.value)==null?void 0:l.samesite,secure:(d=o.storage.cookie.value)==null?void 0:d.secure,expires:(m=o.storage.cookie.value)==null?void 0:m.expires},cookies:e}}),sendRawData:!0,withCredentials:!0},isRawResponse:!0,callback:t})}setServerSideCookies(e,t,s){try{const i=this.getEncryptedCookieData(e,s);i.length>0&&this.makeRequestToSetCookie(i,(r,a)=>{var l,d,m;((l=a==null?void 0:a.xhr)==null?void 0:l.status)===200?e.forEach(S=>{var b;const B=s==null?void 0:s.get(S.name),U=de(S.value,!1,[]);de(B,!1,[])!==U&&((b=this.logger)==null||b.error(sr(S.name)),t&&t(S.name,S.value))}):((m=this.logger)==null||m.error(nr((d=a==null?void 0:a.xhr)==null?void 0:d.status)),e.forEach(S=>{t&&t(S.name,S.value)}))})}catch(i){this.onError(i,ir),e.forEach(r=>{t&&t(r.name,r.value)})}}syncValueToStorage(e,t){var r,a,l;const s=o.storage.entries.value,i=(r=s[e])==null?void 0:r.type;if(xe(i)){const d=(a=this.storeManager)==null?void 0:a.getStore(_e[i]),m=(l=s[e])==null?void 0:l.key;t&&(j(t)||He(t))?o.serverCookies.isEnabledServerSideCookies.value&&i===q?(this.serverSideCookieDebounceFuncs[e]&&globalThis.clearTimeout(this.serverSideCookieDebounceFuncs[e]),this.serverSideCookieDebounceFuncs[e]=globalThis.setTimeout(()=>{this.setServerSideCookies([{name:m,value:t}],(S,B)=>{d==null||d.set(S,B)},d)},$r)):d==null||d.set(m,t):d==null||d.remove(m)}}registerEffects(){jn.forEach(e=>{ce(()=>{this.syncValueToStorage(e,o.session[e].value)})})}setAnonymousId(e,t){var i;let s=e;this.isPersistenceEnabledForStorageEntry("anonymousId")?(!s&&t&&(s=(i=this.pluginsManager)==null?void 0:i.invokeSingle("userSession.anonymousIdGoogleLinker",t)),s=s||Ut()):s=L.anonymousId,o.session.anonymousId.value=s}getAnonymousId(e){var s,i;const t=(s=o.storage.entries.value.anonymousId)==null?void 0:s.type;if(xe(t)){let r=this.getEntryValue("anonymousId");!r&&e&&(r=(i=this.pluginsManager)==null?void 0:i.invokeSingle("storage.getAnonymousId",ne,e)),o.session.anonymousId.value=r||Ut()}return o.session.anonymousId.value}getEntryValue(e){var i,r,a;const t=o.storage.entries.value,s=(i=t[e])==null?void 0:i.type;if(xe(s)){const l=(r=this.storeManager)==null?void 0:r.getStore(_e[s]),d=(a=t[e])==null?void 0:a.key;return(l==null?void 0:l.get(d))??null}return null}getExternalAnonymousIdByCookieName(e){const t=ne(q);return t!=null&&t.isEnabled?t.getItem(e)??null:null}getUserId(){return this.getEntryValue("userId")}getUserTraits(){return this.getEntryValue("userTraits")}getGroupId(){return this.getEntryValue("groupId")}getGroupTraits(){return this.getEntryValue("groupTraits")}getInitialReferrer(){return this.getEntryValue("initialReferrer")}getInitialReferringDomain(){return this.getEntryValue("initialReferringDomain")}getSessionInfo(){return this.getEntryValue("sessionInfo")}getAuthToken(){return this.getEntryValue("authToken")}getSessionId(){const e=this.getSessionInfo()??L.sessionInfo;return e.autoTrack&&!gs(e.expiresAt)||e.manualTrack?e.id??null:null}refreshSession(){let e=this.getSessionInfo()??L.sessionInfo;(e.autoTrack||e.manualTrack)&&(e.autoTrack&&(this.startOrRenewAutoTracking(e),e=o.session.sessionInfo.value),e.sessionStart===void 0?e={...e,sessionStart:!0}:e.sessionStart&&(e={...e,sessionStart:!1})),o.session.sessionInfo.value=e,o.lifecycle.status.value!=="readyExecuted"&&this.syncValueToStorage("sessionInfo",e)}reset(e,t){const{session:s}=o,{manualTrack:i,autoTrack:r}=s.sessionInfo.value;K(()=>{s.userId.value=L.userId,s.userTraits.value=L.userTraits,s.groupId.value=L.groupId,s.groupTraits.value=L.groupTraits,s.authToken.value=L.authToken,e&&this.setAnonymousId(),!t&&(r?(s.sessionInfo.value=L.sessionInfo,this.startOrRenewAutoTracking(s.sessionInfo.value)):i&&this.startManualTrackingInternal())})}setUserId(e){o.session.userId.value=this.isPersistenceEnabledForStorageEntry("userId")&&e?e:L.userId}setUserTraits(e){o.session.userTraits.value=this.isPersistenceEnabledForStorageEntry("userTraits")&&e?F(o.session.userTraits.value??L.userTraits,e):L.userTraits}setGroupId(e){o.session.groupId.value=this.isPersistenceEnabledForStorageEntry("groupId")&&e?e:L.groupId}setGroupTraits(e){o.session.groupTraits.value=this.isPersistenceEnabledForStorageEntry("groupTraits")&&e?F(o.session.groupTraits.value??L.groupTraits,e):L.groupTraits}setInitialReferrer(e){o.session.initialReferrer.value=this.isPersistenceEnabledForStorageEntry("initialReferrer")&&e?e:L.initialReferrer}setInitialReferringDomain(e){o.session.initialReferringDomain.value=this.isPersistenceEnabledForStorageEntry("initialReferringDomain")&&e?e:L.initialReferringDomain}startOrRenewAutoTracking(e){if(gs(e.expiresAt))o.session.sessionInfo.value=Qa(e.timeout);else{const t=Date.now(),s=e.timeout;o.session.sessionInfo.value=F(e,{expiresAt:t+s})}}start(e){o.session.sessionInfo.value=za(e,this.logger)}startManualTrackingInternal(){this.start(Date.now())}end(){o.session.sessionInfo.value=L.sessionInfo}setAuthToken(e){o.session.authToken.value=this.isPersistenceEnabledForStorageEntry("authToken")&&e?e:L.authToken}}const rl=["BeaconQueue","Bugsnag","CustomConsentManager","DeviceModeDestinations","DeviceModeTransformation","ErrorReporting","ExternalAnonymousId","GoogleLinker","KetchConsentManager","NativeDestinationQueue","OneTrustConsentManager","StorageEncryption","StorageEncryptionLegacy","StorageMigrator","XhrQueue"],ol=(n,e)=>{var a,l,d,m;const t=N(e);return j(t.setCookieDomain)||delete t.setCookieDomain,["Strict","Lax","None"].includes(t.sameSiteCookie)||delete t.sameSiteCookie,t.secureCookie=t.secureCookie===!0,["none","default","full"].includes(t.uaChTrackLevel)||delete t.uaChTrackLevel,O(t.integrations)||delete t.integrations,t.plugins=t.plugins??rl,t.useGlobalIntegrationsConfigInEvents=t.useGlobalIntegrationsConfigInEvents===!0,t.bufferDataPlaneEventsUntilReady=t.bufferDataPlaneEventsUntilReady===!0,t.sendAdblockPage=t.sendAdblockPage===!0,t.useServerSideCookies=t.useServerSideCookies===!0,t.dataServiceEndpoint&&typeof t.dataServiceEndpoint!="string"&&delete t.dataServiceEndpoint,O(t.sendAdblockPageOptions)||delete t.sendAdblockPageOptions,x(t.loadIntegration)?t.loadIntegration=t.loadIntegration===!0:delete t.loadIntegration,O(t.storage)?(t.storage=pe(t.storage),t.storage.migrate=((a=t.storage)==null?void 0:a.migrate)===!0):delete t.storage,O(t.beaconQueueOptions)?t.beaconQueueOptions=pe(t.beaconQueueOptions):delete t.beaconQueueOptions,O(t.destinationsQueueOptions)?t.destinationsQueueOptions=pe(t.destinationsQueueOptions):delete t.destinationsQueueOptions,O(t.queueOptions)?t.queueOptions=pe(t.queueOptions):delete t.queueOptions,t.lockIntegrationsVersion=t.lockIntegrationsVersion===!0,t.lockPluginsVersion=t.lockPluginsVersion===!0,cs(t.dataPlaneEventsBufferTimeout)||delete t.dataPlaneEventsBufferTimeout,O((l=t.storage)==null?void 0:l.cookie)?t.storage.cookie=pe((m=t.storage)==null?void 0:m.cookie):(d=t.storage)==null||delete d.cookie,O(t.preConsent)?t.preConsent=pe(t.preConsent):delete t.preConsent,F(n,t)},hs="dataplaneEventsQueue",fs="destinationsEventsQueue",al="transformEvent",ll=(n,e)=>Object.keys(n).filter(t=>n[t]!==!0||!e[t]).reduce((t,s)=>{const i=N(t);return i[s]=n[s],i},{}),cl=(n,e)=>{const t=N(n),s=n.integrations??st,i=e.nativeDestinations.integrationsConfig.value,r=ll(s,i);return t.integrations=F(i,r),t},ul=n=>{var e,t,s;return n.consents.preConsent.value.enabled&&((e=n.consents.preConsent.value.events)==null?void 0:e.delivery)==="buffer"&&(((t=n.consents.preConsent.value.storage)==null?void 0:t.strategy)==="session"||((s=n.consents.preConsent.value.storage)==null?void 0:s.strategy)==="none")};class dl{constructor(e,t,s,i){this.pluginsManager=e,this.errorHandler=s,this.logger=i,this.httpClient=new At(s,i),this.storeManager=t,this.onError=this.onError.bind(this)}init(){try{this.dataplaneEventsQueue=this.pluginsManager.invokeSingle(`${hs}.init`,o,this.httpClient,this.storeManager,this.errorHandler,this.logger)}catch(s){this.onError(s,Ir)}try{this.dmtEventsQueue=this.pluginsManager.invokeSingle(`${al}.init`,o,this.pluginsManager,this.httpClient,this.storeManager,this.errorHandler,this.logger)}catch(s){this.onError(s,Tr)}try{this.destinationsEventsQueue=this.pluginsManager.invokeSingle(`${fs}.init`,o,this.pluginsManager,this.storeManager,this.dmtEventsQueue,this.errorHandler,this.logger)}catch(s){this.onError(s,br)}ce(()=>{var s,i;o.nativeDestinations.clientDestinationsReady.value===!0&&((s=this.destinationsEventsQueue)==null||s.start(),(i=this.dmtEventsQueue)==null||i.start())});const e=ul(o);let t;ce(()=>{var r,a;const s=o.loadOptions.value.bufferDataPlaneEventsUntilReady===!0&&o.nativeDestinations.clientDestinationsReady.value===!1;(o.nativeDestinations.activeDestinations.value.some(l=>oo(l))===!1||s===!1)&&!e&&((r=this.dataplaneEventsQueue)==null?void 0:r.scheduleTimeoutActive)!==!0&&(globalThis.clearTimeout(t),(a=this.dataplaneEventsQueue)==null||a.start())}),o.loadOptions.value.bufferDataPlaneEventsUntilReady===!0&&(t=globalThis.setTimeout(()=>{var s,i;((s=this.dataplaneEventsQueue)==null?void 0:s.scheduleTimeoutActive)!==!0&&((i=this.dataplaneEventsQueue)==null||i.start())},o.loadOptions.value.dataPlaneEventsBufferTimeout))}resume(){var e,t,s,i;((e=this.dataplaneEventsQueue)==null?void 0:e.scheduleTimeoutActive)!==!0&&(o.consents.postConsent.value.discardPreConsentEvents&&((t=this.dataplaneEventsQueue)==null||t.clear(),(s=this.destinationsEventsQueue)==null||s.clear()),(i=this.dataplaneEventsQueue)==null||i.start())}enqueue(e,t){let s;try{s=cl(e,o),this.pluginsManager.invokeSingle(`${hs}.enqueue`,o,this.dataplaneEventsQueue,s,this.errorHandler,this.logger)}catch(i){this.onError(i,Rr)}try{const i=N(e);this.pluginsManager.invokeSingle(`${fs}.enqueue`,o,this.destinationsEventsQueue,i,this.errorHandler,this.logger)}catch(i){this.onError(i,_r)}try{t==null||t(s)}catch(i){this.onError(i,Sr)}}onError(e,t,s){if(this.errorHandler)this.errorHandler.onError(e,zs,t,s);else throw e}}const ps=n=>{const e=new CustomEvent(n,{detail:{analyticsInstance:globalThis.voyageanalytics},bubbles:!0,cancelable:!0,composed:!0});globalThis.document.dispatchEvent(e)};class vs{constructor(){this.preloadBuffer=new bn,this.initialized=!1,this.errorHandler=tt,this.logger=re,this.externalSrcLoader=new pn(this.errorHandler,this.logger),this.capabilitiesManager=new Ua(this.errorHandler,this.logger),this.httpClient=yo}load(e,t,s={}){var a;if(o.lifecycle.status.value)return;let i=N(t),r=N(s);Yt(t)&&(r=t,i=void 0),K(()=>{o.lifecycle.writeKey.value=e,o.lifecycle.dataPlaneUrl.value=i,o.loadOptions.value=ol(o.loadOptions.value,r),o.lifecycle.status.value="mounted"}),o.loadOptions.value.logLevel&&((a=this.logger)==null||a.setMinLogLevel(o.loadOptions.value.logLevel)),We("state",o,e),this.startLifecycle()}startLifecycle(){ce(()=>{try{switch(o.lifecycle.status.value){case"mounted":this.onMounted();break;case"browserCapabilitiesReady":this.onBrowserCapabilitiesReady();break;case"configured":this.onConfigured();break;case"pluginsLoading":break;case"pluginsReady":this.onPluginsReady();break;case"initialized":this.onInitialized();break;case"loaded":this.onLoaded();break;case"destinationsLoading":break;case"destinationsReady":this.onDestinationsReady();break;case"ready":this.onReady();break;case"readyExecuted":default:break}}catch(e){this.errorHandler.onError(Le(e,"Failed to load the SDK"),pt)}})}onBrowserCapabilitiesReady(){di(this),this.prepareInternalServices(),this.loadConfig()}onLoaded(){this.processBufferedEvents(),o.consents.preConsent.value.enabled===!0?o.lifecycle.status.value="ready":this.loadDestinations()}onMounted(){this.capabilitiesManager.init()}enqueuePreloadBufferEvents(e){Array.isArray(e)&&e.forEach(t=>this.preloadBuffer.enqueue(N(t)))}processDataInPreloadBuffer(){for(;this.preloadBuffer.size()>0;){const e=this.preloadBuffer.dequeue();e&&gi([...e],this)}}prepareInternalServices(){this.pluginsManager=new po(wn,this.errorHandler,this.logger),this.storeManager=new ea(this.pluginsManager,this.errorHandler,this.logger),this.configManager=new Pa(this.httpClient,this.errorHandler,this.logger),this.userSessionManager=new il(this.errorHandler,this.logger,this.pluginsManager,this.storeManager,this.httpClient),this.eventRepository=new dl(this.pluginsManager,this.storeManager,this.errorHandler,this.logger),this.eventManager=new sl(this.eventRepository,this.userSessionManager,this.errorHandler,this.logger)}loadConfig(){var e;o.lifecycle.writeKey.value&&this.httpClient.setAuthHeader(o.lifecycle.writeKey.value),(e=this.configManager)==null||e.init()}onPluginsReady(){var e,t,s,i,r;this.errorHandler.init(this.externalSrcLoader),(e=this.storeManager)==null||e.init(),(t=this.userSessionManager)==null||t.init(),o.consents.enabled.value&&!o.consents.initialized.value&&((s=this.pluginsManager)==null||s.invokeSingle("consentManager.init",o,this.logger),o.consents.preConsent.value.enabled===!1&&((i=this.pluginsManager)==null||i.invokeSingle("consentManager.updateConsentsInfo",o,this.storeManager,this.logger))),(r=this.eventManager)==null||r.init(),o.lifecycle.status.value="initialized"}onConfigured(){var e;(e=this.pluginsManager)==null||e.init()}onInitialized(){this.processDataInPreloadBuffer(),E(o.loadOptions.value.onLoaded)&&o.loadOptions.value.onLoaded(globalThis.voyageanalytics),K(()=>{o.lifecycle.loaded.value=!0,o.lifecycle.status.value="loaded"}),this.initialized=!0,ps("RSA_Initialised")}onReady(){o.lifecycle.status.value="readyExecuted",o.eventBuffer.readyCallbacksArray.value.forEach(e=>{try{e()}catch(t){this.errorHandler.onError(t,pt,Rn)}}),ps("RSA_Ready")}processBufferedEvents(){let e=o.eventBuffer.toBeProcessedArray.value;for(;e.length>0;){const t=e.shift();if(o.eventBuffer.toBeProcessedArray.value=e,t){const s=t[0];E(this[s])&&this[s](...t.slice(1),!0)}e=o.eventBuffer.toBeProcessedArray.value}}loadDestinations(){var t,s;if(o.nativeDestinations.clientDestinationsReady.value)return;(t=this.pluginsManager)==null||t.invokeSingle("nativeDestinations.setActiveDestinations",o,this.pluginsManager,this.errorHandler,this.logger);const e=o.nativeDestinations.activeDestinations.value.length;if(e===0){o.lifecycle.status.value="destinationsReady";return}o.lifecycle.status.value="destinationsLoading",(s=this.pluginsManager)==null||s.invokeSingle("nativeDestinations.load",o,this.externalSrcLoader,this.errorHandler,this.logger),ce(()=>{(e===0||o.nativeDestinations.initializedDestinations.value.length+o.nativeDestinations.failedDestinations.value.length===e)&&K(()=>{o.lifecycle.status.value="destinationsReady",o.nativeDestinations.clientDestinationsReady.value=!0})})}onDestinationsReady(){o.lifecycle.status.value!=="ready"&&(o.lifecycle.status.value="ready")}ready(e,t=!1){const s="ready";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}if(this.errorHandler.leaveBreadcrumb(`New ${s} invocation`),!E(e)){this.logger.error(qi(Qs));return}if(o.lifecycle.status.value==="readyExecuted")try{e()}catch(i){this.errorHandler.onError(i,pt,Rn)}else o.eventBuffer.readyCallbacksArray.value=[...o.eventBuffer.readyCallbacksArray.value,e]}page(e,t=!1){var i;const s="page";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} event`),o.metrics.triggered.value+=1,(i=this.eventManager)==null||i.addEvent({type:"page",category:e.category,name:e.name,properties:e.properties,options:e.options,callback:e.callback}),o.capabilities.isAdBlocked.value===!0&&e.category!==an&&this.page(Qe(an,Xs,{path:Js},o.loadOptions.value.sendAdblockPageOptions))}track(e,t=!1){var i;const s="track";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} event`),o.metrics.triggered.value+=1,(i=this.eventManager)==null||i.addEvent({type:s,name:e.name||void 0,properties:e.properties,options:e.options,callback:e.callback})}identify(e,t=!1){var r,a,l;const s="identify";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} event`),o.metrics.triggered.value+=1,!!(e.userId&&o.session.userId.value&&e.userId!==o.session.userId.value)&&this.reset(),ee(e.userId)||(r=this.userSessionManager)==null||r.setUserId(e.userId),(a=this.userSessionManager)==null||a.setUserTraits(e.traits),(l=this.eventManager)==null||l.addEvent({type:s,userId:e.userId,traits:e.traits,options:e.options,callback:e.callback})}alias(e,t=!1){var r,a,l;const s="alias";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} event`),o.metrics.triggered.value+=1;const i=e.from??((r=this.userSessionManager)==null?void 0:r.getUserId())??((a=this.userSessionManager)==null?void 0:a.getAnonymousId());(l=this.eventManager)==null||l.addEvent({type:s,to:e.to,from:i,options:e.options,callback:e.callback})}group(e,t=!1){var i,r,a;const s="group";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} event`),o.metrics.triggered.value+=1,ee(e.groupId)||(i=this.userSessionManager)==null||i.setGroupId(e.groupId),(r=this.userSessionManager)==null||r.setGroupTraits(e.traits),(a=this.eventManager)==null||a.addEvent({type:s,groupId:e.groupId,traits:e.traits,options:e.options,callback:e.callback})}reset(e,t=!1){var i;const s="reset";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} invocation, resetAnonymousId: ${e}`),(i=this.userSessionManager)==null||i.reset(e)}getAnonymousId(e){var t;return(t=this.userSessionManager)==null?void 0:t.getAnonymousId(e)}setAnonymousId(e,t,s=!1){var r;const i="setAnonymousId";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[i,e,t]];return}this.errorHandler.leaveBreadcrumb(`New ${i} invocation`),(r=this.userSessionManager)==null||r.setAnonymousId(e,t)}getUserId(){return o.session.userId.value}getUserTraits(){return o.session.userTraits.value}getGroupId(){return o.session.groupId.value}getGroupTraits(){return o.session.groupTraits.value}startSession(e,t=!1){var i;const s="startSession";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb(`New ${s} invocation`),(i=this.userSessionManager)==null||i.start(e)}endSession(e=!1){var s;const t="endSession";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[t]];return}this.errorHandler.leaveBreadcrumb(`New ${t} invocation`),(s=this.userSessionManager)==null||s.end()}getSessionId(){var t;return((t=this.userSessionManager)==null?void 0:t.getSessionId())??null}consent(e,t=!1){var i,r,a,l;const s="consent";if(!o.lifecycle.loaded.value){o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,[s,e]];return}this.errorHandler.leaveBreadcrumb("New consent invocation"),K(()=>{o.consents.preConsent.value={...o.consents.preConsent.value,enabled:!1},o.consents.postConsent.value=ya(e);const{initialized:d,consentsData:m}=ts(o.consents.postConsent.value.consentManagement,this.logger);o.consents.initialized.value=d||o.consents.initialized.value,o.consents.data.value=m}),o.consents.enabled.value&&!o.consents.initialized.value&&((i=this.pluginsManager)==null||i.invokeSingle("consentManager.updateConsentsInfo",o,this.storeManager,this.logger)),(r=this.storeManager)==null||r.initializeStorageState(),(a=this.userSessionManager)==null||a.syncStorageDataToState(),(l=this.eventManager)==null||l.resume(),this.loadDestinations(),this.sendTrackingEvents(t)}sendTrackingEvents(e){if(o.consents.postConsent.value.trackConsent){const t=ht(Zs);e?o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,["track",t]]:this.track(t)}if(o.consents.postConsent.value.sendPageEvent){const t=Qe();e?o.eventBuffer.toBeProcessedArray.value=[...o.eventBuffer.toBeProcessedArray.value,["page",t]]:this.page(t)}}setAuthToken(e){var t;(t=this.userSessionManager)==null||t.setAuthToken(e)}}const ke=class ke{constructor(){D(this,"analyticsInstances",{});D(this,"defaultAnalyticsKey","");D(this,"logger",re);if(ke.globalSingleton)return ke.globalSingleton;tt.attachErrorListeners(),this.setDefaultInstanceKey=this.setDefaultInstanceKey.bind(this),this.getAnalyticsInstance=this.getAnalyticsInstance.bind(this),this.load=this.load.bind(this),this.ready=this.ready.bind(this),this.triggerBufferedLoadEvent=this.triggerBufferedLoadEvent.bind(this),this.page=this.page.bind(this),this.track=this.track.bind(this),this.identify=this.identify.bind(this),this.alias=this.alias.bind(this),this.group=this.group.bind(this),this.reset=this.reset.bind(this),this.getAnonymousId=this.getAnonymousId.bind(this),this.setAnonymousId=this.setAnonymousId.bind(this),this.getUserId=this.getUserId.bind(this),this.getUserTraits=this.getUserTraits.bind(this),this.getGroupId=this.getGroupId.bind(this),this.getGroupTraits=this.getGroupTraits.bind(this),this.startSession=this.startSession.bind(this),this.endSession=this.endSession.bind(this),this.getSessionId=this.getSessionId.bind(this),this.setAuthToken=this.setAuthToken.bind(this),this.consent=this.consent.bind(this),ke.globalSingleton=this,this.triggerBufferedLoadEvent(),globalThis.voyageanalytics=this}setDefaultInstanceKey(e){e&&(this.defaultAnalyticsKey=e)}getAnalyticsInstance(e){const t=e??this.defaultAnalyticsKey;return!!this.analyticsInstances[t]||(this.analyticsInstances[t]=new vs),this.analyticsInstances[t]}load(e,t,s){if(!j(e)){this.logger.error(Er(sn,e));return}this.analyticsInstances[e]||(this.setDefaultInstanceKey(e),this.analyticsInstances[e]=new vs,this.getAnalyticsInstance(e).load(e,t,s))}triggerBufferedLoadEvent(){const e=Array.isArray(globalThis.voyageanalytics)?globalThis.voyageanalytics:[];ui(e);const t=ci(e);We(vt,N(e)),t.length>0&&(t.shift(),this.load.apply(null,t))}ready(e){this.getAnalyticsInstance().ready(e)}page(e,t,s,i,r){this.getAnalyticsInstance().page(Qe(e,t,s,i,r))}track(e,t,s,i){this.getAnalyticsInstance().track(ht(e,t,s,i))}identify(e,t,s,i){this.getAnalyticsInstance().identify(Xt(e,t,s,i))}alias(e,t,s,i){this.getAnalyticsInstance().alias(Jt(e,t,s,i))}group(e,t,s,i){if(arguments.length===0){this.logger.error(mr(sn));return}this.getAnalyticsInstance().group(Zt(e,t,s,i))}reset(e){this.getAnalyticsInstance().reset(e)}getAnonymousId(e){return this.getAnalyticsInstance().getAnonymousId(e)}setAnonymousId(e,t){this.getAnalyticsInstance().setAnonymousId(e,t)}getUserId(){return this.getAnalyticsInstance().getUserId()}getUserTraits(){return this.getAnalyticsInstance().getUserTraits()}getGroupId(){return this.getAnalyticsInstance().getGroupId()}getGroupTraits(){return this.getAnalyticsInstance().getGroupTraits()}startSession(e){return this.getAnalyticsInstance().startSession(e)}endSession(){return this.getAnalyticsInstance().endSession()}getSessionId(){return this.getAnalyticsInstance().getSessionId()}setAuthToken(e){return this.getAnalyticsInstance().setAuthToken(e)}consent(e){return this.getAnalyticsInstance().consent(e)}};D(ke,"globalSingleton",null);let at=ke,w;const C=new at;C.load("2fe3EI1HYIujd0VnhiJzSmfCyA8","https://cdp.vyg.app",{loadIntegration:!1});function gl(){return typeof Shopify<"u"?Shopify.shop:null}let Se=null;async function hl(){if(Se)return Se;const n=await w.get(window.Shopify.routes.root+"cart.js",void 0,void 0,"JSON");return n.token&&(Se=n.token),n.token}function ys(n){const e=n==null?void 0:n.split("?");return(e==null?void 0:e[0])||null}async function $t(n){return n=n||{},n.lookupId=gl(),n.cartToken=ys(Se),n.cartToken||(Se=await hl(),n.cartToken=ys(Se)),n}const fl=C.track;C.track=function(n,e,t){$t(t).then(s=>{fl(n,e,s)})};const pl=C.page;C.page=function(n,e,t,s){$t(s).then(i=>{pl(n,e,t,i)})};const vl=C.identify;C.identify=function(n,e,t){$t(t).then(s=>{vl(n,e,s)})};let Es=!1;const yl=function(){const n={"/products/":"Product Viewed","/cart":"Cart Viewed","/account/register":"Registration Viewed","/account/login":"Login Viewed"},e={},t=window.location.href;let s="",i="",r,a,l;const d=[{dest:"product_id",src:"product_id"},{dest:"sku",src:"sku"},{dest:"quantity",src:"quantity"},{dest:"name",src:"product_title"},{dest:"price",src:"price"},{dest:"category",src:"product_type"},{dest:"variant",src:"variant_title"},{dest:"brand",src:"vendor"},{dest:"url",src:"url"},{dest:"image_url",src:"image"}],m=new Set(["note","original_total_price","requires_shipping","token","total_discount","total_price","total_weight","item_count"]),S=new Set(["original_total_price","total_price","total_discount"]),B=new Set(["price","original_price","discounted_price","line_price","original_line_price","total_discount","final_price","final_line_price","line_level_total_discount"]),U=[{dest:"product_id",src:"id"},{dest:"sku",src:"sku"},{dest:"name",src:"title"},{dest:"category",src:"product_type"},{dest:"variant",src:"variants"},{dest:"url",src:"url"}];function p(){const u=btoa("2fe3EI1HYIujd0VnhiJzSmfCyA8:"),c="https://api.rudderstack.com/sourceConfig";return new Promise(function(h,y){w.ajax({url:c,method:"GET",contentType:"application/json",timeout:2e3,beforeSend:function(f){f.setRequestHeader("Authorization","Basic "+u)},success:function(f){var v,I;((I=(v=f.source)==null?void 0:v.config)==null?void 0:I.disableClientSideIdentifier)===!0?h(!1):h(!0)},error:function(f,v,I){console.debug("Couldn't fetch Source Config due error: "+f.responseJSON.message),h(!0)}})})}const b=u=>!u&&J({action:"get",name:"voyage_user_id"})==="captured"?(C.reset(!0),J({action:"set",name:"voyage_user_id",value:"Not Captured"}),!0):!1;function A(){s=Shopify.currency.active,i=window.location.pathname.split("/"),r=ShopifyAnalytics.meta.page.customerId||__st.cid||window.meta.page.customerId;const u=b(r);l=J({action:"get",name:"_hp2_id.1200528076"}),l?l=JSON.parse(decodeURIComponent(l)):console.debug("No heap cookie found."),e.buttonAddToCart=w('form[action="/cart/add"] [type="submit"]'),Rl().then(c=>{const h=xt(c);c.token&&(Se=c.token),u||h?lt().then(y=>{Vt(y),Ss(y),console.log("Successfully updated cart"),Is(),Ts(y,1e4)}).catch(y=>{console.debug("Error occurred while updating cart:",y)}):(Is(!0),Ts(c))}),p().then(c=>{c?(a=!0,Bt()):a=!1}),Ve(),Cl(),Ol(),Ul(),w("button[data-search-form-submit]").on("click",Al)}const R=(u,c)=>{const h=u.innerWidth,y=u.innerHeight,{top:f,bottom:v,left:I,right:_,height:T}=c.getBoundingClientRect();if(f<y&&v>0&&I<h&&_>0){let Z=T;if(f<0&&(Z+=f),v>y&&(Z+=y-v),Z/T>.8)return!0}return!1};function G(){const u=document.getElementsByTagName("a"),c=/^(?!\/\/cdn)[-.:/,a-z,A-Z,0-9]*\/products\//,h=Array.prototype.slice.call(u).filter(f=>c.test(f.href));let y=h.filter(f=>{f.querySelector("img")});return y.length===0&&(y=h.filter(f=>{var I,_;const v=f.parentNode.parentNode.parentNode;return((I=v.nextElementSibling)==null?void 0:I.querySelector("img"))||((_=v.previousElementSibling)==null?void 0:_.querySelector("img"))})),y}function V(u,c){const h=[],y=[];let f=!1;i[i.length-2]=="products"&&(f=!0),u.forEach(v=>{const I=R(window,v),_=c.includes(v.href);I&&!_&&(!f||!v.href.includes(t))&&(h.push(v),c.push(v.href))}),h.length>0&&(h.forEach(v=>{const I=v.href.match(/(\/products\/)((\w|-)*)(\?|\$?)/)[2];w.get(`/products/${I}.json`,void 0,void 0,"JSON").then(_=>{var Z,le;const T=ct(_.product,U);T.currency=s,T.sku=String(((Z=T.variant[0])==null?void 0:Z.sku)||T.product_id),T.price=(le=T.variant[0])==null?void 0:le.price,y.push(T)}).catch(_=>{console.debug("Voyage unable to fetch",I,_)})}),window.setTimeout(()=>{y.length>0&&C.track("Product List Viewed",{products:y})},2500))}function Ve(){const u=G();if(u.length>0){const c=[];let h=window.setTimeout(()=>{V(u,c)},200);document.addEventListener("scroll",()=>{clearTimeout(h),h=window.setTimeout(()=>{V(u,c)},200)})}else Ll("Product List Viewed")}function Bt(){r&&J({action:"get",name:"voyage_user_id"})!=="captured"&&(l&&J({action:"get",name:"voyage_heap_identities"})!=="captured"?(C.identify(r,{heapUserID:l.userId,heapSessionId:l.sessionId}),J({action:"set",name:"voyage_heap_identities",value:"captured"})):C.identify(r),J({action:"set",name:"voyage_user_id",value:"captured"})),l&&J({action:"get",name:"voyage_heap_identities"})!=="captured"&&(C.identify(C.getUserId(),{heapUserID:l.userId,heapSessionId:l.sessionId}),J({action:"set",name:"voyage_heap_identities",value:"captured"}))}function xt(u){const{attributes:c}=u;return!(c!=null&&c.voyageAnonymousId)}function lt(){const u=C.getAnonymousId(),c=C.getSessionId();if(!u||!c||Es)return;const h=w.post(window.Shopify.routes.root+"cart/update.json",{attributes:{voyageAnonymousId:u,voyageSessionId:c}},void 0,"json");return Es=!0,h}function Gt(u,c,h,y=0){3>y?w.ajax({url:"https://cdp.vyg.app/v1/webhook?writeKey=2fe3EI1HYIujd0VnhiJzSmfCyA8",method:"POST",contentType:"application/json",data:JSON.stringify(u)}).then(()=>{h(),console.log(`Successfully sent ${c} event to voyage`)}).catch(()=>{setTimeout(()=>{Gt(u,c,h,y+1)},1e3*y)}):console.log(`Failed to sent ${c} event to voyage`)}function Ss(u){const c={event:"rudderSessionIdentifier",sessionId:C.getSessionId(),cartToken:u.token};Gt(c,"sessionIdentifier",bl)}function Sl(){const u=C.getSessionId(),c=J({action:"get",name:"rs_shopify_session_id"});return u!=c}function bs(){if(Sl()){const c=lt();c&&c.then(h=>{Ss(h)})}}function bl(){const u={action:"set",expire_hr:1,name:"rs_shopify_session_id",value:C.getSessionId()};J(u)}function Is(u=!1){const c="sessionIdentifierPollTime_placeHolder";u&&bs(),setInterval(()=>{bs()},c)}function Ts(u,c=0){setTimeout(()=>{const h=Tl();setTimeout(()=>{Il(u)},h)},c)}function Il(u){Vt(u);const c=50*60*1e3;setInterval(()=>{Vt(u)},c)}function Vt(u){const c={event:"rudderIdentifier",anonymousId:C.getAnonymousId(),cartToken:u.token,cart:u};Gt(c,"anonymousIdentifier",_l)}function Tl(){const c=Date.now(),h=Number(J({action:"get",name:"rs_shopify_cart_identified_at"}));return 3e6-(c-h)}function _l(){const u={action:"set",expire_hr:1,name:"rs_shopify_cart_identified_at",value:`${Date.now()}`};J(u)}function Rl(){return w.get(window.Shopify.routes.root+"cart.js",void 0,void 0,"JSON")}function Al(){const u=w("button[data-search-form-submit]").closest("form").find('input[type="button"]').val()||w("button[data-search-form-submit]").closest("form").find('input[type="search"]').val();u&&C.track("Products Searched",u)}function Ol(){let u="",c="";for(const h of Object.keys(n))if(Pl(h)){u=h,c=n[h];break}switch(u){case"/products/":kl(c);break;case"/cart":Dl(c);break;default:console.info("Voyage does not track this page")}}function ct(u,c,h=null){const y={};return c.forEach(f=>{if(f.src.indexOf(".")>-1){const v=f.src.split(".")[0],I=f.src.split(".")[1];u[v]?(y[f.dest]=u[v][I],delete u[v][I]):u[v+"s"]&&(y[f.dest]=u[v+"s"][0][I],delete u[v+"s"][0][I])}else if(u[f.src]){if(f.src==="variants"&&Array.isArray(u[f.src])){if(h||h!=null){const v=u[f.src].find(I=>String(I.id)===h);v&&(y[f.dest]=[v])}y[f.dest]||(y[f.dest]=[u[f.src][0]])}else y[f.dest]=u[f.src];delete u[f.src]}}),y}function Pl(u){return t.indexOf(u)>-1}function kl(u){const c=window.location.pathname;if(c==="/collections"||c==="/products")console.info("Voyage does not track this page");else{const h=c.split("/");if(h[h.length-2]=="products"){let y=[],f=history.replaceState;history.replaceState=function(){f.apply(history,arguments);const I=jt();I!=null&&!y.includes(I)&&(y.push(I),Rs(u,I))};const v=jt();Rs(u,v)}}}function Ft(){return(t.indexOf("?")>-1?t.split("?")[0]:t)+".json"}function Cl(){const u=window.location,c=u.pathname,h=c.split("/").pop(),y=u.href;let f;try{f=c.split("/")[c.split("/").length-2]}catch{f=""}const v={path:c,referrer:document.referrer,search:u.search,title:document.title,url:y};n[c]==="Registration Viewed"?(C.track(n[c],v),a&&w("#create_customer").submit(Nl)):n[c]==="Login Viewed"?(C.track(n[c],v),a&&w("#customer_login").submit(wl)):C.page(f,h,v)}function Nl(){const u=w('#create_customer [type="email"]').val(),c=w('#create_customer [name="customer[first_name]"]').val(),h=w('#create_customer [name="customer[last_name]"]').val();C.identify({email:u,firstName:c,lastName:h})}function wl(){const u=w('#customer_login [type="email"]').val(),c=w('#customer_login [name="customer[first_name]"]').val(),h=w('#customer_login [name="customer[last_name]"]').val();C.identify({email:u,firstName:c,lastName:h})}function Fe(u){return(parseFloat(u)/100).toFixed(2)}function Dl(u){function c(y,f){var _;const v={},I=new Set;if(f.forEach(T=>{const{dest:Z,src:le}=T;I.add(le),v[Z]=y[le]}),Object.keys(y).forEach(T=>{I.has(T)||(v[T]=y[T])}),Object.keys(v).forEach(T=>{B.has(T)&&(v[T]=Fe(v[T]))}),v.discounts&&v.discounts.length>0)for(let T=0;T<v.discounts.length;T++)v.discounts[T].amount=Fe(v.discounts[T].amount);if(v.line_level_discount_allocations&&v.line_level_discount_allocations.length>0)for(let T=0;T<v.line_level_discount_allocations.length;T++)v.line_level_discount_allocations[T].amount=Fe(v.line_level_discount_allocations[T].amount),(_=v.line_level_discount_allocations[T].discount_application)!=null&&_.total_allocated_amount&&(v.line_level_discount_allocations[T].discount_application.total_allocated_amount=Fe(v.line_level_discount_allocations[T].discount_application.total_allocated_amount));return v}const h=Ft();ut(h).done(function(y){console.debug(y);const{items:f}=y,{currency:v}=y,I={products:[]};Object.keys(y).forEach(_=>{m.has(_)&&(I[_]=y[_])}),f.forEach((_,T)=>{const Z=c(_,d);Z.position=T+1,Z.currency=v,I.products.push(Z)}),Object.keys(I).forEach(_=>{S.has(_)&&(I[_]=Fe(I[_]))}),C.track(u,I)}).fail(function(y){console.log(y)})}const Ll=u=>{let c=Ft();if(t.indexOf("/collections/")>-1){const[h,y]=c.split("collections");y.indexOf("all")>-1&&(c=`${h}products.json`),ut(c).done(function(f){const v={products:[]};f.products&&(f.products.forEach(I=>{const _=ct(I,U);_.currency=s,_.sku=String(_.variant[0].sku||_.product_id),_.price=_.variant[0].price,v.products.push(_)}),C.track(u,v))}).fail(function(f){console.log(f)})}};function _s(){const u=`${this.href}.json`;ut(u).done(function(c){console.log("[Product Clicked] data.product",c.product);const h=jt(),y=ct(c.product,U,h);y.currency=s,w(e.buttonAddToCart).on("click",As.bind(y)),w("a").filter((f,v)=>v.href.indexOf(".facebook.com")>-1).each((f,v)=>{w(v).on("click",_s)}),C.track("Product Clicked",y)}).fail(function(c){console.debug(c)})}function jt(){const u=window.location.search,h=new URLSearchParams(u).get("variant");return h||null}function Ul(){w("a").filter((u,c)=>c.href.indexOf("/products")>-1).each((u,c)=>{w(c).on("click",_s)})}function Rs(u,c,h=null){h===null&&(h=Ft()),ut(h).done(function(y){const f=ct(y.product,U,c);f.currency=s,f.sku=String(f.variant[0].sku||f.product_id),f.variant&&!f.price&&(f.price=f.variant[0].price),w(e.buttonAddToCart).on("click",As.bind(f)),w('form[action="/cart/add"] [type="button"]').each((v,I)=>{const _=w(I).html().toLowerCase();(_.indexOf("buy")>-1||_.indexOf("checkout")>-1)&&w(I).on("click",Ml.bind(f))}),C.track(u,f)}).fail(function(y){console.debug(y)})}function As(){C.track("Product Added",this)}function Ml(){C.track("Checkout Started",this)}function ut(u){let c=w.Deferred();return w.ajax({url:u,dataType:"jsonp",header:{"Access-Control-Allow-Origin":"*"},success:function(h){return c.resolve(h)},fail:function(){return c.reject()}}),c.promise()}function $l(){let u={},c=document.cookie.split(/ *; */),h;if(c[0]=="")return u;for(let y=0;y<c.length;++y)h=c[y].split("="),u[h[0]]=h[1];return u}function J(u={}){let c;const{name:h,value:y,expire_hr:f,path:v="/",samesite:I="Lax",action:_="get"}=u;switch(_){case"set":let T="";if(f){const le=new Date;le.setTime(le.getTime()+f*60*60*1e3),T="; expires="+le.toUTCString()}document.cookie=h+"="+y+T+";path="+v+";SameSite="+I,c="Cookie Successfully Set";break;case"get":c=$l()[h];break;default:c="Invalid Action";break}return c}const Ht=document.createElement("script");Ht.setAttribute("src","//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"),document.head.appendChild(Ht),Ht.addEventListener("load",function(){w=$.noConflict(!0),A()})}(),El=Object.freeze(Object.defineProperty({__proto__:null,ShopifyTracking:yl},Symbol.toStringTag,{value:"Module"})),ms=new at;ms.load("2fe3EI1HYIujd0VnhiJzSmfCyA8","https://cdp.vyg.app",{loadIntegration:!1});const ml=El;return oe.analytics=ms,oe.shopifyTracker=ml,Object.defineProperty(oe,Symbol.toStringTag,{value:"Module"}),oe}({});
